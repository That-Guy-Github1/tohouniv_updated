th_global_setup_danmaku_duels_data = {
	1 = {
		if = {
			limit = { NOT = { has_global_flag = th_setup_danmaku_duels_counter } }
			set_global_flag = th_setup_danmaku_duels_counter
			set_variable = {
				which = th_danmaku_duel_counter
				value = 0
			}
			set_variable = {
				which = th_danmaku_max_duels
				value = 31	#There can be only 30 simultaneous Danmaku Duels at any given point at time
			}
		}
	}
}

th_prepare_country_for_danmaku_duel = {
	set_country_flag = th_is_in_a_danmaku_duel
	set_ruler_flag = th_ruler_is_in_a_danmaku_duel
	set_variable = {
		which = th_danmaku_action_points
		which = th_danmaku_max_action_points
	}
	th_update_danmaku_action_point_bar = yes
}

th_assign_country_to_danmaku_duel_instance = {
	th_prepare_country_for_danmaku_duel = yes
	set_ruler_flag = th_is_in_danmaku_duel_instance_$instance$
	set_ruler_flag = th_is_country_$country_id$_in_danmaku_duel_of_$instance$
	save_global_event_target_as = th_danmaku_duelist_of_id_$country_id$_of_instance_$instance$
}

th_setup_danmaku_duel_instance = {
	set_variable = {
		which = th_danmaku_duel_instance_$instance$_round_counter
		value = 1
	}
	set_variable = {
		which = th_danmaku_duel_instance_$instance$_opponent_turn	#Is 0 for the first striker, is 1 for the second striker. Gets reset to 0 after the second striker ends turn so initiative can be rerolled.
		value = 0
	}
	set_variable = {
		which = th_danmaku_duel_instance_$instance$_turn_duration_counter
		which = th_dnamaku_default_turn_duration
	}
	set_variable = {
		which = th_danmaku_duel_logged_actions_for_instance_$instance$
		value = 0
	}
}

th_create_danmaku_duel_instance = {
	if = {
		limit = { is_variable_equal = { which = th_danmaku_duel_counter   value = 1 } }
		$country_1$ = { th_assign_country_to_danmaku_duel_instance = { instance = 1 country_id = 1 } }
		$country_2$ = { th_assign_country_to_danmaku_duel_instance = { instance = 1 country_id = 2 } }
		th_setup_danmaku_duel_instance = { instance = 1 }
	}
	else_if = {
		limit = { is_variable_equal = { which = th_danmaku_duel_counter   value = 2 } }
		$country_1$ = { th_assign_country_to_danmaku_duel_instance = { instance = 2 country_id = 1 } }
		$country_2$ = { th_assign_country_to_danmaku_duel_instance = { instance = 2 country_id = 2 } }
		th_setup_danmaku_duel_instance = { instance = 2 }
	}
	else_if = {
		limit = { is_variable_equal = { which = th_danmaku_duel_counter   value = 3 } }
		$country_1$ = { th_assign_country_to_danmaku_duel_instance = { instance = 3 country_id = 1 } }
		$country_2$ = { th_assign_country_to_danmaku_duel_instance = { instance = 3 country_id = 2 } }
		th_setup_danmaku_duel_instance = { instance = 3 }
	}
	else_if = {
		limit = { is_variable_equal = { which = th_danmaku_duel_counter   value = 4 } }
		$country_1$ = { th_assign_country_to_danmaku_duel_instance = { instance = 4 country_id = 1 } }
		$country_2$ = { th_assign_country_to_danmaku_duel_instance = { instance = 4 country_id = 2 } }
		th_setup_danmaku_duel_instance = { instance = 4 }
	}
	else_if = {
		limit = { is_variable_equal = { which = th_danmaku_duel_counter   value = 5 } }
		$country_1$ = { th_assign_country_to_danmaku_duel_instance = { instance = 5 country_id = 1 } }
		$country_2$ = { th_assign_country_to_danmaku_duel_instance = { instance = 5 country_id = 2 } }
		th_setup_danmaku_duel_instance = { instance = 5 }
	}
	else_if = {
		limit = { is_variable_equal = { which = th_danmaku_duel_counter   value = 6 } }
		$country_1$ = { th_assign_country_to_danmaku_duel_instance = { instance = 6 country_id = 1 } }
		$country_2$ = { th_assign_country_to_danmaku_duel_instance = { instance = 6 country_id = 2 } }
		th_setup_danmaku_duel_instance = { instance = 6 }
	}
	else_if = {
		limit = { is_variable_equal = { which = th_danmaku_duel_counter   value = 7 } }
		$country_1$ = { th_assign_country_to_danmaku_duel_instance = { instance = 7 country_id = 1 } }
		$country_2$ = { th_assign_country_to_danmaku_duel_instance = { instance = 7 country_id = 2 } }
		th_setup_danmaku_duel_instance = { instance = 7 }
	}
	else_if = {
		limit = { is_variable_equal = { which = th_danmaku_duel_counter   value = 8 } }
		$country_1$ = { th_assign_country_to_danmaku_duel_instance = { instance = 8 country_id = 1 } }
		$country_2$ = { th_assign_country_to_danmaku_duel_instance = { instance = 8 country_id = 2 } }
		th_setup_danmaku_duel_instance = { instance = 8 }
	}
	else_if = {
		limit = { is_variable_equal = { which = th_danmaku_duel_counter   value = 9 } }
		$country_1$ = { th_assign_country_to_danmaku_duel_instance = { instance = 9 country_id = 1 } }
		$country_2$ = { th_assign_country_to_danmaku_duel_instance = { instance = 9 country_id = 2 } }
		th_setup_danmaku_duel_instance = { instance = 9 }
	}
	else_if = {
		limit = { is_variable_equal = { which = th_danmaku_duel_counter   value = 10 } }
		$country_1$ = { th_assign_country_to_danmaku_duel_instance = { instance = 10 country_id = 1 } }
		$country_2$ = { th_assign_country_to_danmaku_duel_instance = { instance = 10 country_id = 2 } }
		th_setup_danmaku_duel_instance = { instance = 10 }
	}
	else_if = {
		limit = { is_variable_equal = { which = th_danmaku_duel_counter   value = 11 } }
		$country_1$ = { th_assign_country_to_danmaku_duel_instance = { instance = 11 country_id = 1 } }
		$country_2$ = { th_assign_country_to_danmaku_duel_instance = { instance = 11 country_id = 2 } }
		th_setup_danmaku_duel_instance = { instance = 11 }
	}
	else_if = {
		limit = { is_variable_equal = { which = th_danmaku_duel_counter   value = 12 } }
		$country_1$ = { th_assign_country_to_danmaku_duel_instance = { instance = 12 country_id = 1 } }
		$country_2$ = { th_assign_country_to_danmaku_duel_instance = { instance = 12 country_id = 2 } }
		th_setup_danmaku_duel_instance = { instance = 12 }
	}
	else_if = {
		limit = { is_variable_equal = { which = th_danmaku_duel_counter   value = 13 } }
		$country_1$ = { th_assign_country_to_danmaku_duel_instance = { instance = 13 country_id = 1 } }
		$country_2$ = { th_assign_country_to_danmaku_duel_instance = { instance = 13 country_id = 2 } }
		th_setup_danmaku_duel_instance = { instance = 13 }
	}
	else_if = {
		limit = { is_variable_equal = { which = th_danmaku_duel_counter   value = 14 } }
		$country_1$ = { th_assign_country_to_danmaku_duel_instance = { instance = 14 country_id = 1 } }
		$country_2$ = { th_assign_country_to_danmaku_duel_instance = { instance = 14 country_id = 2 } }
		th_setup_danmaku_duel_instance = { instance = 14 }
	}
	else_if = {
		limit = { is_variable_equal = { which = th_danmaku_duel_counter   value = 15 } }
		$country_1$ = { th_assign_country_to_danmaku_duel_instance = { instance = 15 country_id = 1 } }
		$country_2$ = { th_assign_country_to_danmaku_duel_instance = { instance = 15 country_id = 2 } }
		th_setup_danmaku_duel_instance = { instance = 15 }
	}
	else_if = {
		limit = { is_variable_equal = { which = th_danmaku_duel_counter   value = 16 } }
		$country_1$ = { th_assign_country_to_danmaku_duel_instance = { instance = 16 country_id = 1 } }
		$country_2$ = { th_assign_country_to_danmaku_duel_instance = { instance = 16 country_id = 2 } }
		th_setup_danmaku_duel_instance = { instance = 16 }
	}
	else_if = {
		limit = { is_variable_equal = { which = th_danmaku_duel_counter   value = 17 } }
		$country_1$ = { th_assign_country_to_danmaku_duel_instance = { instance = 17 country_id = 1 } }
		$country_2$ = { th_assign_country_to_danmaku_duel_instance = { instance = 17 country_id = 2 } }
		th_setup_danmaku_duel_instance = { instance = 17 }
	}
	else_if = {
		limit = { is_variable_equal = { which = th_danmaku_duel_counter   value = 18 } }
		$country_1$ = { th_assign_country_to_danmaku_duel_instance = { instance = 18 country_id = 1 } }
		$country_2$ = { th_assign_country_to_danmaku_duel_instance = { instance = 18 country_id = 2 } }
		th_setup_danmaku_duel_instance = { instance = 18 }
	}
	else_if = {
		limit = { is_variable_equal = { which = th_danmaku_duel_counter   value = 19 } }
		$country_1$ = { th_assign_country_to_danmaku_duel_instance = { instance = 19 country_id = 1 } }
		$country_2$ = { th_assign_country_to_danmaku_duel_instance = { instance = 19 country_id = 2 } }
		th_setup_danmaku_duel_instance = { instance = 19 }
	}
	else_if = {
		limit = { is_variable_equal = { which = th_danmaku_duel_counter   value = 20 } }
		$country_1$ = { th_assign_country_to_danmaku_duel_instance = { instance = 20 country_id = 1 } }
		$country_2$ = { th_assign_country_to_danmaku_duel_instance = { instance = 20 country_id = 2 } }
		th_setup_danmaku_duel_instance = { instance = 20 }
	}
	else_if = {
		limit = { is_variable_equal = { which = th_danmaku_duel_counter   value = 21 } }
		$country_1$ = { th_assign_country_to_danmaku_duel_instance = { instance = 21 country_id = 1 } }
		$country_2$ = { th_assign_country_to_danmaku_duel_instance = { instance = 21 country_id = 2 } }
		th_setup_danmaku_duel_instance = { instance = 21 }
	}
	else_if = {
		limit = { is_variable_equal = { which = th_danmaku_duel_counter   value = 22 } }
		$country_1$ = { th_assign_country_to_danmaku_duel_instance = { instance = 22 country_id = 1 } }
		$country_2$ = { th_assign_country_to_danmaku_duel_instance = { instance = 22 country_id = 2 } }
		th_setup_danmaku_duel_instance = { instance = 22 }
	}
	else_if = {
		limit = { is_variable_equal = { which = th_danmaku_duel_counter   value = 23 } }
		$country_1$ = { th_assign_country_to_danmaku_duel_instance = { instance = 23 country_id = 1 } }
		$country_2$ = { th_assign_country_to_danmaku_duel_instance = { instance = 23 country_id = 2 } }
		th_setup_danmaku_duel_instance = { instance = 23 }
	}
	else_if = {
		limit = { is_variable_equal = { which = th_danmaku_duel_counter   value = 24 } }
		$country_1$ = { th_assign_country_to_danmaku_duel_instance = { instance = 24 country_id = 1 } }
		$country_2$ = { th_assign_country_to_danmaku_duel_instance = { instance = 24 country_id = 2 } }
		th_setup_danmaku_duel_instance = { instance = 24 }
	}
	else_if = {
		limit = { is_variable_equal = { which = th_danmaku_duel_counter   value = 25 } }
		$country_1$ = { th_assign_country_to_danmaku_duel_instance = { instance = 25 country_id = 1 } }
		$country_2$ = { th_assign_country_to_danmaku_duel_instance = { instance = 25 country_id = 2 } }
		th_setup_danmaku_duel_instance = { instance = 25 }
	}
	else_if = {
		limit = { is_variable_equal = { which = th_danmaku_duel_counter   value = 26 } }
		$country_1$ = { th_assign_country_to_danmaku_duel_instance = { instance = 26 country_id = 1 } }
		$country_2$ = { th_assign_country_to_danmaku_duel_instance = { instance = 26 country_id = 2 } }
		th_setup_danmaku_duel_instance = { instance = 26 }
	}
	else_if = {
		limit = { is_variable_equal = { which = th_danmaku_duel_counter   value = 27 } }
		$country_1$ = { th_assign_country_to_danmaku_duel_instance = { instance = 27 country_id = 1 } }
		$country_2$ = { th_assign_country_to_danmaku_duel_instance = { instance = 27 country_id = 2 } }
		th_setup_danmaku_duel_instance = { instance = 27 }
	}
	else_if = {
		limit = { is_variable_equal = { which = th_danmaku_duel_counter   value = 28 } }
		$country_1$ = { th_assign_country_to_danmaku_duel_instance = { instance = 28 country_id = 1 } }
		$country_2$ = { th_assign_country_to_danmaku_duel_instance = { instance = 28 country_id = 2 } }
		th_setup_danmaku_duel_instance = { instance = 28 }
	}
	else_if = {
		limit = { is_variable_equal = { which = th_danmaku_duel_counter   value = 29 } }
		$country_1$ = { th_assign_country_to_danmaku_duel_instance = { instance = 29 country_id = 1 } }
		$country_2$ = { th_assign_country_to_danmaku_duel_instance = { instance = 29 country_id = 2 } }
		th_setup_danmaku_duel_instance = { instance = 29 }
	}
	else_if = {
		limit = { is_variable_equal = { which = th_danmaku_duel_counter   value = 30 } }
		$country_1$ = { th_assign_country_to_danmaku_duel_instance = { instance = 30 country_id = 1 } }
		$country_2$ = { th_assign_country_to_danmaku_duel_instance = { instance = 30 country_id = 2 } }
		th_setup_danmaku_duel_instance = { instance = 30 }
	}
	else = {
		log = "Too many Danmaku Duel instances were called. Could not add $country_1$ and $country_2$ to a duel."
	}
}

th_roll_initiative = {
	custom_tooltip = th_roll_initiative_tt
	hidden_effect = {
		set_variable = {
			which = th_danmaku_rolled_initiative
			value = 0
		}
		random_list = {
			1 = { change_variable = { which = th_danmaku_rolled_initiative value = 1 } }
			1 = { change_variable = { which = th_danmaku_rolled_initiative value = 2 } }
			1 = { change_variable = { which = th_danmaku_rolled_initiative value = 3 } }
			1 = { change_variable = { which = th_danmaku_rolled_initiative value = 4 } }
		}
		change_variable = {
			which = th_danmaku_rolled_initiative
			which = th_danmaku_ini_bonus
		}
	}
}
th_alternative_roll_initiative = {	#I LOOOOOOOOVE EU4's inability to have random numbers
	custom_tooltip = th_roll_initiative_tt
	hidden_effect = {
		export_to_variable = {
			which = th_danmaku_randomizer
			value = max_manpower
		}
		export_to_variable = {
			which = $variable$
			value = manpower
		}
		change_variable = {
			which = th_danmaku_randomizer
			which = $variable$
		}
		divide_variable = {
			which = th_danmaku_randomizer
			value = 2
		}
		set_variable = {
			which = $variable$
			which = th_danmaku_randomizer
		}
		random = {
			chance = 0.25
			change_variable = {
				which = th_danmaku_randomizer
				value = 1
			}
		}
		random = {
			chance = 0.25
			change_variable = {
				which = th_danmaku_randomizer
				value = 2
			}
		}
		random = {
			chance = 0.25
			change_variable = {
				which = th_danmaku_randomizer
				value = 3
			}
		}
		divide_variable = {
			which = th_danmaku_randomizer
			value = 4
		}
		round_variable = {
			which = th_danmaku_randomizer
			value = -1
		}
		multiply_variable = {
			which = th_danmaku_randomizer
			value = 4
		}
		subtract_variable = {
			which = $variable$
			which = th_danmaku_randomizer
		}
		round_variable = {
			which = $variable$
			value = 0
		}
		change_variable = {
			which = $variable$
			which = $bonus$
		}
	}
}

th_roll_initiative_for_current_instance = {
	custom_tooltip = th_roll_initiative_for_current_instance_tt
	hidden_effect = {
		$country_1$ = { th_roll_initiative = yes }
		$country_2$ = {
			th_alternative_roll_initiative = {
				variable = th_danmaku_rolled_initiative
				bonus = th_danmaku_ini_bonus
			}
			set_variable = {
				which = th_danmaku_rolled_initiative_transfer
				which = th_danmaku_rolled_initiative
			}
			while = {
				limit = {
					NOT = {
						is_variable_equal = {
							which = th_danmaku_rolled_initiative_transfer
							value = 0
						}
					}
				}
				if = {
					limit = { check_variable = { which = th_danmaku_rolled_initiative_transfer value = 1 } }
					change_variable = { which = th_danmaku_rolled_initiative_transfer value = -1 }
				}
				else = {
					change_variable = { which = th_danmaku_rolled_initiative_transfer value = 1 }
				}
				$country_1$ = { change_variable = { which = th_danmaku_rolled_initiative_comperator value = 1 } }
			}
		}
		$country_1$ = {
			if = {
				limit = {
					check_variable = {
						which = th_danmaku_rolled_initiative
						which = th_danmaku_rolled_initiative_comperator
					}
				}
				set_ruler_flag = th_danmaku_has_turn_ownership
				$country_2$ = {
					set_ruler_flag = th_danmaku_has_not_turn_ownership
				}
			}
			else = {
				set_ruler_flag = th_danmaku_has_not_turn_ownership
				$country_2$ = {
					set_ruler_flag = th_danmaku_has_turn_ownership
				}
			}
		}
	}
}

th_roll_initiative_for_root_scope = {
	$opponent$ = { custom_tooltip = th_roll_initiative_root_for_current_instance_tt }
	hidden_effect = {
		$opponent$ = { th_roll_initiative = yes }
		th_alternative_roll_initiative = {
			variable = th_danmaku_rolled_initiative
			bonus = th_danmaku_ini_bonus
		}
		set_variable = {
			which = th_danmaku_rolled_initiative_transfer
			which = th_danmaku_rolled_initiative
		}
		while = {
			limit = {
				NOT = {
					is_variable_equal = {
						which = th_danmaku_rolled_initiative_transfer
						value = 0
					}
				}
			}
			if = {
				limit = { check_variable = { which = th_danmaku_rolled_initiative_transfer value = 1 } }
				change_variable = { which = th_danmaku_rolled_initiative_transfer value = -1 }
			}
			else = {
				change_variable = { which = th_danmaku_rolled_initiative_transfer value = 1 }
			}
			$opponent$ = { change_variable = { which = th_danmaku_rolled_initiative_comperator value = 1 } }
		}
		$opponent$ = {
			if = {
				limit = {
					check_variable = {
						which = th_danmaku_rolled_initiative
						which = th_danmaku_rolled_initiative_comperator
					}
				}
				set_ruler_flag = th_danmaku_has_turn_ownership
				prev = {
					set_ruler_flag = th_danmaku_has_not_turn_ownership
				}
			}
			else = {
				set_ruler_flag = th_danmaku_has_not_turn_ownership
				prev = {
					set_ruler_flag = th_danmaku_has_turn_ownership
				}
			}
		}
	}
}


th_create_danmaku_duel_against_country = {
	if = {
		limit = {
			tag = $country_1$
			tag = $country_2$
		}
		log = "Called a Danmaku Duel against itself. That is not possible."
	}
	else_if = {
		limit = {
			OR = {
				$country_1$ = { th_is_in_a_danmaku_duel = yes }
				$country_2$ = { th_is_in_a_danmaku_duel = yes }
			}
		}
		log = "Either country is already in a danmaku duel."
	}
	else = {
		if = {
			limit = { tag = $country_1$ }
			$country_2$ = { custom_tooltip = th_create_danmaku_duel_instance_against_root_tt }
		}
		else_if = {
			limit = { tag = $country_2$ }
			$country_1$ = { custom_tooltip = th_create_danmaku_duel_instance_against_root_tt }
		}
		else = {
			$country_1$ = { custom_tooltip = th_join_danmaku_duel_instance_tt }
			$country_2$ = { custom_tooltip = th_join_danmaku_duel_instance_tt }
			custom_tooltip = th_create_danmaku_duel_instance_tt
		}
		hidden_effect = {
			th_global_setup_danmaku_duels_data = yes
			1 = {
				if = {
					limit = {
						NOT = {
							check_variable = {
								which = th_danmaku_duel_counter
								which = th_danmaku_max_duels
							}
						}
					}
					change_variable = {
						which = th_danmaku_duel_counter
						value = 1
					}
					th_create_danmaku_duel_instance = {
						country_1 = $country_1$
						country_2 = $country_2$
					}
					th_roll_initiative_for_current_instance = {
						country_1 = $country_1$
						country_2 = $country_2$
					}
				}
				else = {
					log = "Too many Danmaku Duel instances were called..."
				}
			}
		}
	}
}


th_change_danmaku_specific_instance_round = {
	hidden_effect = {
		1 = {
			if = {
				limit = { NOT = { check_variable = { which = th_danmaku_duel_instance_$instance$_opponent_turn value = 1 } } }
				1 = { set_variable = { which = th_danmaku_duel_instance_$instance$_opponent_turn value = 1 } }
			}
			else = {
				1 = {
					set_variable = { which = th_danmaku_duel_instance_$instance$_opponent_turn value = 0 }
					change_variable = { which = th_danmaku_duel_instance_$instance$_round_counter value = 1 }
				}
			}
			set_variable = {
				which = th_danmaku_duel_instance_$instance$_turn_duration_counter
				which = th_dnamaku_default_turn_duration
			}
		}
	}
	if = {
		limit = {
			1 = {
				NOT = { check_variable = { which = th_danmaku_duel_instance_$instance$_opponent_turn value = 0 } }
				check_variable = { which = th_danmaku_default_setting_reroll_initiative value = 1 }
			}
		}
		th_roll_initiative_for_root_scope = { opponent = $opponent$ }
	}
	else = {
		if = {
			limit = { $opponent$ = { th_has_turn_ownership = yes } }
			$opponent$ = {
				custom_tooltip = th_end_turn_for_this_ruler_tt
				clr_ruler_flag = th_danmaku_has_turn_ownership
				set_ruler_flag = th_danmaku_has_not_turn_ownership
			}
			custom_tooltip = th_start_turn_for_this_ruler_tt
			set_ruler_flag = th_danmaku_has_turn_ownership
			clr_ruler_flag = th_danmaku_has_not_turn_ownership
		}
		else = {
			$opponent$ = {
				custom_tooltip = th_start_turn_for_this_ruler_tt
				set_ruler_flag = th_danmaku_has_turn_ownership
				clr_ruler_flag = th_danmaku_has_not_turn_ownership
			}
			custom_tooltip = th_end_turn_for_this_ruler_tt
			clr_ruler_flag = th_danmaku_has_turn_ownership
			set_ruler_flag = th_danmaku_has_not_turn_ownership
		}
	}
}

th_change_danmaku_instance_round = {
	if = { limit = { th_get_danmaku_duel_instance = { instance = 1 } } th_change_danmaku_specific_instance_round = { instance = 1 opponent = $opponent$ } }
	if = { limit = { th_get_danmaku_duel_instance = { instance = 2 } } th_change_danmaku_specific_instance_round = { instance = 2 opponent = $opponent$ } }
	if = { limit = { th_get_danmaku_duel_instance = { instance = 3 } } th_change_danmaku_specific_instance_round = { instance = 3 opponent = $opponent$ } }
	if = { limit = { th_get_danmaku_duel_instance = { instance = 4 } } th_change_danmaku_specific_instance_round = { instance = 4 opponent = $opponent$ } }
	if = { limit = { th_get_danmaku_duel_instance = { instance = 5 } } th_change_danmaku_specific_instance_round = { instance = 5 opponent = $opponent$ } }
	if = { limit = { th_get_danmaku_duel_instance = { instance = 6 } } th_change_danmaku_specific_instance_round = { instance = 6 opponent = $opponent$ } }
	if = { limit = { th_get_danmaku_duel_instance = { instance = 7 } } th_change_danmaku_specific_instance_round = { instance = 7 opponent = $opponent$ } }
	if = { limit = { th_get_danmaku_duel_instance = { instance = 8 } } th_change_danmaku_specific_instance_round = { instance = 8 opponent = $opponent$ } }
	if = { limit = { th_get_danmaku_duel_instance = { instance = 9 } } th_change_danmaku_specific_instance_round = { instance = 9 opponent = $opponent$ } }
	if = { limit = { th_get_danmaku_duel_instance = { instance = 10 } } th_change_danmaku_specific_instance_round = { instance = 10 opponent = $opponent$ } }
	if = { limit = { th_get_danmaku_duel_instance = { instance = 11 } } th_change_danmaku_specific_instance_round = { instance = 11 opponent = $opponent$ } }
	if = { limit = { th_get_danmaku_duel_instance = { instance = 12 } } th_change_danmaku_specific_instance_round = { instance = 12 opponent = $opponent$ } }
	if = { limit = { th_get_danmaku_duel_instance = { instance = 13 } } th_change_danmaku_specific_instance_round = { instance = 13 opponent = $opponent$ } }
	if = { limit = { th_get_danmaku_duel_instance = { instance = 14 } } th_change_danmaku_specific_instance_round = { instance = 14 opponent = $opponent$ } }
	if = { limit = { th_get_danmaku_duel_instance = { instance = 15 } } th_change_danmaku_specific_instance_round = { instance = 15 opponent = $opponent$ } }
	if = { limit = { th_get_danmaku_duel_instance = { instance = 16 } } th_change_danmaku_specific_instance_round = { instance = 16 opponent = $opponent$ } }
	if = { limit = { th_get_danmaku_duel_instance = { instance = 17 } } th_change_danmaku_specific_instance_round = { instance = 17 opponent = $opponent$ } }
	if = { limit = { th_get_danmaku_duel_instance = { instance = 18 } } th_change_danmaku_specific_instance_round = { instance = 18 opponent = $opponent$ } }
	if = { limit = { th_get_danmaku_duel_instance = { instance = 19 } } th_change_danmaku_specific_instance_round = { instance = 19 opponent = $opponent$ } }
	if = { limit = { th_get_danmaku_duel_instance = { instance = 20 } } th_change_danmaku_specific_instance_round = { instance = 20 opponent = $opponent$ } }
	if = { limit = { th_get_danmaku_duel_instance = { instance = 21 } } th_change_danmaku_specific_instance_round = { instance = 21 opponent = $opponent$ } }
	if = { limit = { th_get_danmaku_duel_instance = { instance = 22 } } th_change_danmaku_specific_instance_round = { instance = 22 opponent = $opponent$ } }
	if = { limit = { th_get_danmaku_duel_instance = { instance = 23 } } th_change_danmaku_specific_instance_round = { instance = 23 opponent = $opponent$ } }
	if = { limit = { th_get_danmaku_duel_instance = { instance = 24 } } th_change_danmaku_specific_instance_round = { instance = 24 opponent = $opponent$ } }
	if = { limit = { th_get_danmaku_duel_instance = { instance = 25 } } th_change_danmaku_specific_instance_round = { instance = 25 opponent = $opponent$ } }
	if = { limit = { th_get_danmaku_duel_instance = { instance = 26 } } th_change_danmaku_specific_instance_round = { instance = 26 opponent = $opponent$ } }
	if = { limit = { th_get_danmaku_duel_instance = { instance = 27 } } th_change_danmaku_specific_instance_round = { instance = 27 opponent = $opponent$ } }
	if = { limit = { th_get_danmaku_duel_instance = { instance = 28 } } th_change_danmaku_specific_instance_round = { instance = 28 opponent = $opponent$ } }
	if = { limit = { th_get_danmaku_duel_instance = { instance = 29 } } th_change_danmaku_specific_instance_round = { instance = 29 opponent = $opponent$ } }
	if = { limit = { th_get_danmaku_duel_instance = { instance = 30 } } th_change_danmaku_specific_instance_round = { instance = 30 opponent = $opponent$ } }
}

th_select_enemy_event_target_and_do_effect = {
	if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 1 } } event_target:th_danmaku_duelist_of_id_1_of_instance_1 = { $effect$ } }
	if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 2 } } event_target:th_danmaku_duelist_of_id_1_of_instance_2 = { $effect$ } }
	if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 3 } } event_target:th_danmaku_duelist_of_id_1_of_instance_3 = { $effect$ } }
	if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 4 } } event_target:th_danmaku_duelist_of_id_1_of_instance_4 = { $effect$ } }
	if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 5 } } event_target:th_danmaku_duelist_of_id_1_of_instance_5 = { $effect$ } }
	if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 6 } } event_target:th_danmaku_duelist_of_id_1_of_instance_6 = { $effect$ } }
	if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 7 } } event_target:th_danmaku_duelist_of_id_1_of_instance_7 = { $effect$ } }
	if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 8 } } event_target:th_danmaku_duelist_of_id_1_of_instance_8 = { $effect$ } }
	if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 9 } } event_target:th_danmaku_duelist_of_id_1_of_instance_9 = { $effect$ } }
	if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 10 } } event_target:th_danmaku_duelist_of_id_1_of_instance_10 = { $effect$ } }
	if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 11 } } event_target:th_danmaku_duelist_of_id_1_of_instance_11 = { $effect$ } }
	if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 12 } } event_target:th_danmaku_duelist_of_id_1_of_instance_12 = { $effect$ } }
	if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 13 } } event_target:th_danmaku_duelist_of_id_1_of_instance_13 = { $effect$ } }
	if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 14 } } event_target:th_danmaku_duelist_of_id_1_of_instance_14 = { $effect$ } }
	if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 15 } } event_target:th_danmaku_duelist_of_id_1_of_instance_15 = { $effect$ } }
	if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 16 } } event_target:th_danmaku_duelist_of_id_1_of_instance_16 = { $effect$ } }
	if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 17 } } event_target:th_danmaku_duelist_of_id_1_of_instance_17 = { $effect$ } }
	if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 18 } } event_target:th_danmaku_duelist_of_id_1_of_instance_18 = { $effect$ } }
	if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 19 } } event_target:th_danmaku_duelist_of_id_1_of_instance_19 = { $effect$ } }
	if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 20 } } event_target:th_danmaku_duelist_of_id_1_of_instance_20 = { $effect$ } }
	if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 21 } } event_target:th_danmaku_duelist_of_id_1_of_instance_21 = { $effect$ } }
	if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 22 } } event_target:th_danmaku_duelist_of_id_1_of_instance_22 = { $effect$ } }
	if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 23 } } event_target:th_danmaku_duelist_of_id_1_of_instance_23 = { $effect$ } }
	if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 24 } } event_target:th_danmaku_duelist_of_id_1_of_instance_24 = { $effect$ } }
	if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 25 } } event_target:th_danmaku_duelist_of_id_1_of_instance_25 = { $effect$ } }
	if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 26 } } event_target:th_danmaku_duelist_of_id_1_of_instance_26 = { $effect$ } }
	if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 27 } } event_target:th_danmaku_duelist_of_id_1_of_instance_27 = { $effect$ } }
	if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 28 } } event_target:th_danmaku_duelist_of_id_1_of_instance_28 = { $effect$ } }
	if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 29 } } event_target:th_danmaku_duelist_of_id_1_of_instance_29 = { $effect$ } }
	if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 30 } } event_target:th_danmaku_duelist_of_id_1_of_instance_30 = { $effect$ } }
	if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 1 } } event_target:th_danmaku_duelist_of_id_2_of_instance_1 = { $effect$ } }
	if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 2 } } event_target:th_danmaku_duelist_of_id_2_of_instance_2 = { $effect$ } }
	if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 3 } } event_target:th_danmaku_duelist_of_id_2_of_instance_3 = { $effect$ } }
	if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 4 } } event_target:th_danmaku_duelist_of_id_2_of_instance_4 = { $effect$ } }
	if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 5 } } event_target:th_danmaku_duelist_of_id_2_of_instance_5 = { $effect$ } }
	if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 6 } } event_target:th_danmaku_duelist_of_id_2_of_instance_6 = { $effect$ } }
	if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 7 } } event_target:th_danmaku_duelist_of_id_2_of_instance_7 = { $effect$ } }
	if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 8 } } event_target:th_danmaku_duelist_of_id_2_of_instance_8 = { $effect$ } }
	if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 9 } } event_target:th_danmaku_duelist_of_id_2_of_instance_9 = { $effect$ } }
	if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 10 } } event_target:th_danmaku_duelist_of_id_2_of_instance_10 = { $effect$ } }
	if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 11 } } event_target:th_danmaku_duelist_of_id_2_of_instance_11 = { $effect$ } }
	if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 12 } } event_target:th_danmaku_duelist_of_id_2_of_instance_12 = { $effect$ } }
	if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 13 } } event_target:th_danmaku_duelist_of_id_2_of_instance_13 = { $effect$ } }
	if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 14 } } event_target:th_danmaku_duelist_of_id_2_of_instance_14 = { $effect$ } }
	if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 15 } } event_target:th_danmaku_duelist_of_id_2_of_instance_15 = { $effect$ } }
	if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 16 } } event_target:th_danmaku_duelist_of_id_2_of_instance_16 = { $effect$ } }
	if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 17 } } event_target:th_danmaku_duelist_of_id_2_of_instance_17 = { $effect$ } }
	if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 18 } } event_target:th_danmaku_duelist_of_id_2_of_instance_18 = { $effect$ } }
	if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 19 } } event_target:th_danmaku_duelist_of_id_2_of_instance_19 = { $effect$ } }
	if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 20 } } event_target:th_danmaku_duelist_of_id_2_of_instance_20 = { $effect$ } }
	if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 21 } } event_target:th_danmaku_duelist_of_id_2_of_instance_21 = { $effect$ } }
	if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 22 } } event_target:th_danmaku_duelist_of_id_2_of_instance_22 = { $effect$ } }
	if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 23 } } event_target:th_danmaku_duelist_of_id_2_of_instance_23 = { $effect$ } }
	if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 24 } } event_target:th_danmaku_duelist_of_id_2_of_instance_24 = { $effect$ } }
	if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 25 } } event_target:th_danmaku_duelist_of_id_2_of_instance_25 = { $effect$ } }
	if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 26 } } event_target:th_danmaku_duelist_of_id_2_of_instance_26 = { $effect$ } }
	if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 27 } } event_target:th_danmaku_duelist_of_id_2_of_instance_27 = { $effect$ } }
	if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 28 } } event_target:th_danmaku_duelist_of_id_2_of_instance_28 = { $effect$ } }
	if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 29 } } event_target:th_danmaku_duelist_of_id_2_of_instance_29 = { $effect$ } }
	if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 30 } } event_target:th_danmaku_duelist_of_id_2_of_instance_30 = { $effect$ } }
}

#Solo Experience
#Following Touhou characters are supported:
# reimu, marisa, mima, konngara, sariel, rika, meira, kana, kotohime, ellen, rikako, chiyuri, yumemi, kurumi, elly, 
# gengetsu, mugetsu, yuuka, alice, yuki, mai, yumeko, shinki, rumia, cirno, daiyousei, meiling, koakuma, patchouli, 
# sakuya, remilia, flandre, satsuki, letty, chen, lily, prismriver, lunasa, merlin, lyrica, layla, youmu, youki, 
# yuyuko, ran, yukari, suika, wriggle, mystia, keine, tewi, reisen, eirin, kaguya, mokou, aya, medicine, komachi, 
# eiki, shizuha, minoriko, hina, nitori, momiji, sanae, kanako, suwako, iku, tenshi, kisume, yamame, parsee, yuugi, 
# satori, orin, okuu, koishi, nazrin, kogasa, ichirin, minamitsu, shou, byakuren, nue, hatate, kyouko, yoshika, 
# seiga, tojiko, futo, miko, mamizou, kokoro, wakasagihime, sekibanki, kagerou, benben, yatsuhashi, seija, shinmyoumaru, 
# raiko, sumireko, renko, maribel, seiran, ringo, doremy, sagune, clownpiece, junko, hecatia, toyohime, yorihime, 
# change, reisen_moon, joon, shion, sunny, star, luna, kasen, larva, nemuno, aunn, narumi, teireida, satonono, okina, 
# eika, urumi, kutaka, mayumi, keiki, yachie, saki, yuuma, mike, takane, sannyo, misumaru, tsukasa, megumu, chimata, 
# momoyo, son, enoko, chiyari, hisami, zanmu, rinnosuke, tokiko, miyoi, mizuchi, zun
th_create_danmaku_duel_against_unlanded_character = {
	custom_tooltip = th_create_danmaku_duel_against_unlanded_character_$target$_tt
	hidden_effect = {
		th_prepare_country_for_danmaku_duel = yes
		set_ruler_flag = th_is_duelling_an_unlanded_character
		set_ruler_flag = th_is_duelling_character_$target$
		th_roll_initiative_for_solo_fight = yes
		set_variable = {
			which = th_danmaku_unlanded_duel_round_counter
			value = 1
		}
		set_variable = {
			which = th_danmaku_unlanded_duel_opponent_turn
			value = 0
		}
		set_variable = {
			which = th_danmaku_unlanded_turn_duration
			value = 18
		}
		1 = {
			set_variable = {
				which = th_danmaku_default_turn_duration_transfer
				which = th_dnamaku_default_turn_duration
			}
			PREV = {
				set_variable = { which = th_danmaku_default_turn_duration_transfer 		which = PREV }
				set_variable = {
					which = th_danmaku_unlanded_turn_duration
					which = th_danmaku_default_turn_duration_transfer
				}
			}
		}
	}
}

th_roll_initiative_for_solo_fight = {
	custom_tooltip = th_roll_initiative_for_solo_fight_tt
	hidden_effect = {
		th_roll_initiative = yes
		th_alternative_roll_initiative = {
			variable = th_danmaku_unlanded_character_rolled_initiative
			bonus = th_danmaku_unlanded_character_ini_bonus
		}
		if = {
			limit = {
				check_variable = {
					which = th_danmaku_rolled_initiative
					which = th_danmaku_unlanded_character_rolled_initiative
				}
			}
			set_ruler_flag = th_danmaku_has_turn_ownership
			set_ruler_flag = th_danmaku_unlanded_character_not_turn_ownership
		}
		else = {
			set_ruler_flag = th_danmaku_unlanded_character_turn_ownership
			set_ruler_flag = th_danmaku_has_not_turn_ownership
		}
	}
}

th_end_turn_against_unlanded_character = {
	if = {
		limit = {
			NOT = {
				check_variable = {
					which = th_danmaku_unlanded_duel_opponent_turn
					value = 1
				}
			}
		}
		set_variable = {
			which = th_danmaku_unlanded_duel_opponent_turn
			value = 1
		}
		if = {
			limit = {
				has_ruler_flag = th_danmaku_has_turn_ownership
			}
			clr_ruler_flag = th_danmaku_has_turn_ownership
			clr_ruler_flag = th_danmaku_unlanded_character_not_turn_ownership
			set_ruler_flag = th_danmaku_unlanded_character_turn_ownership
			set_ruler_flag = th_danmaku_has_not_turn_ownership
		}
		else = {
			set_ruler_flag = th_danmaku_has_turn_ownership
			set_ruler_flag = th_danmaku_unlanded_character_not_turn_ownership
			clr_ruler_flag = th_danmaku_unlanded_character_turn_ownership
			clr_ruler_flag = th_danmaku_has_not_turn_ownership
		}
	}
	else = {
		set_variable = {
			which = th_danmaku_unlanded_duel_opponent_turn
			value = 0
		}
		change_variable = {
			which = th_danmaku_unlanded_duel_round_counter
			value = 1
		}
		th_roll_initiative_for_solo_fight = yes
	}
	1 = {
		set_variable = {
			which = th_danmaku_default_turn_duration_transfer
			which = th_dnamaku_default_turn_duration
		}
		PREV = {
			set_variable = { which = th_danmaku_default_turn_duration_transfer 		which = PREV }
			set_variable = {
				which = th_danmaku_unlanded_turn_duration
				which = th_danmaku_default_turn_duration_transfer
			}
		}
	}
}

#General Interaction mechanics
th_end_turn = {
	hidden_effect = {
		if = {
			limit = { th_is_not_duelling_an_unlanded_character = yes }
			th_select_enemy_event_target_and_do_effect = {
				effect = "
					th_change_danmaku_instance_round = { opponent = root }
				"
			}
		}
		else = {
			th_end_turn_against_unlanded_character = yes
		}
	}
}

th_monthly_danaku_duel_duration_reduction = {
	if = {
		limit = { 1 = { check_variable = { which = th_danmaku_duel_instance_$instance$_turn_duration_counter value = 0 } } }
		1 = {
			subtract_variable = {
				which = th_danmaku_duel_instance_$instance$_turn_duration_counter
				value = 1
			}
		}
		if = {
			limit = {
				1 = { NOT = { check_variable = { which = th_danmaku_duel_instance_$instance$_turn_duration_counter value = 1 } } }
				has_saved_global_event_target = th_danmaku_duelist_of_id_1_of_instance_$instance$
				has_saved_global_event_target = th_danmaku_duelist_of_id_2_of_instance_$instance$
			}
			if = {
				limit = { event_target:th_danmaku_duelist_of_id_1_of_instance_$instance$ = { th_has_turn_ownership = yes } }
				event_target:th_danmaku_duelist_of_id_1_of_instance_$instance$ = { th_change_danmaku_instance_round = { opponent = event_target:th_danmaku_duelist_of_id_2_of_instance_$instance$ } }
			}
			else = {
				event_target:th_danmaku_duelist_of_id_2_of_instance_$instance$ = { th_change_danmaku_instance_round = { opponent = event_target:th_danmaku_duelist_of_id_1_of_instance_$instance$ } }
			}
		}
	}
}

th_monthly_danaku_duel_update = {
	if = {
		limit = {
			has_global_flag = th_setup_danmaku_duels_counter
		}
		th_monthly_danaku_duel_duration_reduction = { instance = 1 }
		th_monthly_danaku_duel_duration_reduction = { instance = 2 }
		th_monthly_danaku_duel_duration_reduction = { instance = 3 }
		th_monthly_danaku_duel_duration_reduction = { instance = 4 }
		th_monthly_danaku_duel_duration_reduction = { instance = 5 }
		th_monthly_danaku_duel_duration_reduction = { instance = 6 }
		th_monthly_danaku_duel_duration_reduction = { instance = 7 }
		th_monthly_danaku_duel_duration_reduction = { instance = 8 }
		th_monthly_danaku_duel_duration_reduction = { instance = 9 }
		th_monthly_danaku_duel_duration_reduction = { instance = 10 }
		th_monthly_danaku_duel_duration_reduction = { instance = 11 }
		th_monthly_danaku_duel_duration_reduction = { instance = 12 }
		th_monthly_danaku_duel_duration_reduction = { instance = 13 }
		th_monthly_danaku_duel_duration_reduction = { instance = 14 }
		th_monthly_danaku_duel_duration_reduction = { instance = 15 }
		th_monthly_danaku_duel_duration_reduction = { instance = 16 }
		th_monthly_danaku_duel_duration_reduction = { instance = 17 }
		th_monthly_danaku_duel_duration_reduction = { instance = 18 }
		th_monthly_danaku_duel_duration_reduction = { instance = 19 }
		th_monthly_danaku_duel_duration_reduction = { instance = 20 }
		th_monthly_danaku_duel_duration_reduction = { instance = 21 }
		th_monthly_danaku_duel_duration_reduction = { instance = 22 }
		th_monthly_danaku_duel_duration_reduction = { instance = 23 }
		th_monthly_danaku_duel_duration_reduction = { instance = 24 }
		th_monthly_danaku_duel_duration_reduction = { instance = 25 }
		th_monthly_danaku_duel_duration_reduction = { instance = 26 }
		th_monthly_danaku_duel_duration_reduction = { instance = 27 }
		th_monthly_danaku_duel_duration_reduction = { instance = 28 }
		th_monthly_danaku_duel_duration_reduction = { instance = 29 }
		th_monthly_danaku_duel_duration_reduction = { instance = 30 }
	}
}

th_clear_combat_log_for_instance = {

}

th_log_ability = {
	hidden_effect = {
		1 = {
			if = {
				limit = {
					check_variable = {
						which = th_danmaku_duel_logged_actions_for_instance_$instance$
						value = 15
					}
				}
				th_clear_combat_log_for_instance = { instance = $instance$ }
			}
		}
	}
}