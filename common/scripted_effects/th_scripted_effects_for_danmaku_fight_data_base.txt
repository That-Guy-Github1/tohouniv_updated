################################################
# INSTANCES DEFINITOIN                         #
################################################

th_global_setup_danmaku_duels_data = {
	1 = {
		if = {
			limit = { NOT = { has_global_flag = th_setup_danmaku_duels_counter } }
			set_global_flag = th_setup_danmaku_duels_counter
			set_variable = {
				which = th_danmaku_duel_counter
				value = 0
			}
			set_variable = {
				which = th_danmaku_max_duels
				value = 16	#There can be only 15 simultaneous Danmaku Duels at any given point at time
			}
		}
	}
}

th_create_danmaku_duel_instance = {
	if = {
		limit = { NOT = { has_province_flag = th_danmaku_duel_instance_1_online } }
		$country_1$ = { th_assign_country_to_danmaku_duel_instance = { instance = 1 country_id = 1 } }
		$country_2$ = { th_assign_country_to_danmaku_duel_instance = { instance = 1 country_id = 2 } }
		th_setup_danmaku_duel_instance = { instance = 1 }
	}
	else_if = {
		limit = { NOT = { has_province_flag = th_danmaku_duel_instance_2_online } }
		$country_1$ = { th_assign_country_to_danmaku_duel_instance = { instance = 2 country_id = 1 } }
		$country_2$ = { th_assign_country_to_danmaku_duel_instance = { instance = 2 country_id = 2 } }
		th_setup_danmaku_duel_instance = { instance = 2 }
	}
	else_if = {
		limit = { NOT = { has_province_flag = th_danmaku_duel_instance_3_online } }
		$country_1$ = { th_assign_country_to_danmaku_duel_instance = { instance = 3 country_id = 1 } }
		$country_2$ = { th_assign_country_to_danmaku_duel_instance = { instance = 3 country_id = 2 } }
		th_setup_danmaku_duel_instance = { instance = 3 }
	}
	else_if = {
		limit = { NOT = { has_province_flag = th_danmaku_duel_instance_4_online } }
		$country_1$ = { th_assign_country_to_danmaku_duel_instance = { instance = 4 country_id = 1 } }
		$country_2$ = { th_assign_country_to_danmaku_duel_instance = { instance = 4 country_id = 2 } }
		th_setup_danmaku_duel_instance = { instance = 4 }
	}
	else_if = {
		limit = { NOT = { has_province_flag = th_danmaku_duel_instance_5_online } }
		$country_1$ = { th_assign_country_to_danmaku_duel_instance = { instance = 5 country_id = 1 } }
		$country_2$ = { th_assign_country_to_danmaku_duel_instance = { instance = 5 country_id = 2 } }
		th_setup_danmaku_duel_instance = { instance = 5 }
	}
	else_if = {
		limit = { NOT = { has_province_flag = th_danmaku_duel_instance_6_online } }
		$country_1$ = { th_assign_country_to_danmaku_duel_instance = { instance = 6 country_id = 1 } }
		$country_2$ = { th_assign_country_to_danmaku_duel_instance = { instance = 6 country_id = 2 } }
		th_setup_danmaku_duel_instance = { instance = 6 }
	}
	else_if = {
		limit = { NOT = { has_province_flag = th_danmaku_duel_instance_7_online } }
		$country_1$ = { th_assign_country_to_danmaku_duel_instance = { instance = 7 country_id = 1 } }
		$country_2$ = { th_assign_country_to_danmaku_duel_instance = { instance = 7 country_id = 2 } }
		th_setup_danmaku_duel_instance = { instance = 7 }
	}
	else_if = {
		limit = { NOT = { has_province_flag = th_danmaku_duel_instance_8_online } }
		$country_1$ = { th_assign_country_to_danmaku_duel_instance = { instance = 8 country_id = 1 } }
		$country_2$ = { th_assign_country_to_danmaku_duel_instance = { instance = 8 country_id = 2 } }
		th_setup_danmaku_duel_instance = { instance = 8 }
	}
	else_if = {
		limit = { NOT = { has_province_flag = th_danmaku_duel_instance_9_online } }
		$country_1$ = { th_assign_country_to_danmaku_duel_instance = { instance = 9 country_id = 1 } }
		$country_2$ = { th_assign_country_to_danmaku_duel_instance = { instance = 9 country_id = 2 } }
		th_setup_danmaku_duel_instance = { instance = 9 }
	}
	else_if = {
		limit = { NOT = { has_province_flag = th_danmaku_duel_instance_10_online } }
		$country_1$ = { th_assign_country_to_danmaku_duel_instance = { instance = 10 country_id = 1 } }
		$country_2$ = { th_assign_country_to_danmaku_duel_instance = { instance = 10 country_id = 2 } }
		th_setup_danmaku_duel_instance = { instance = 10 }
	}
	else_if = {
		limit = { NOT = { has_province_flag = th_danmaku_duel_instance_11_online } }
		$country_1$ = { th_assign_country_to_danmaku_duel_instance = { instance = 11 country_id = 1 } }
		$country_2$ = { th_assign_country_to_danmaku_duel_instance = { instance = 11 country_id = 2 } }
		th_setup_danmaku_duel_instance = { instance = 11 }
	}
	else_if = {
		limit = { NOT = { has_province_flag = th_danmaku_duel_instance_12_online } }
		$country_1$ = { th_assign_country_to_danmaku_duel_instance = { instance = 12 country_id = 1 } }
		$country_2$ = { th_assign_country_to_danmaku_duel_instance = { instance = 12 country_id = 2 } }
		th_setup_danmaku_duel_instance = { instance = 12 }
	}
	else_if = {
		limit = { NOT = { has_province_flag = th_danmaku_duel_instance_13_online } }
		$country_1$ = { th_assign_country_to_danmaku_duel_instance = { instance = 13 country_id = 1 } }
		$country_2$ = { th_assign_country_to_danmaku_duel_instance = { instance = 13 country_id = 2 } }
		th_setup_danmaku_duel_instance = { instance = 13 }
	}
	else_if = {
		limit = { NOT = { has_province_flag = th_danmaku_duel_instance_14_online } }
		$country_1$ = { th_assign_country_to_danmaku_duel_instance = { instance = 14 country_id = 1 } }
		$country_2$ = { th_assign_country_to_danmaku_duel_instance = { instance = 14 country_id = 2 } }
		th_setup_danmaku_duel_instance = { instance = 14 }
	}
	else_if = {
		limit = { NOT = { has_province_flag = th_danmaku_duel_instance_15_online } }
		$country_1$ = { th_assign_country_to_danmaku_duel_instance = { instance = 15 country_id = 1 } }
		$country_2$ = { th_assign_country_to_danmaku_duel_instance = { instance = 15 country_id = 2 } }
		th_setup_danmaku_duel_instance = { instance = 15 }
	}
	else = {
		log = "Too many Danmaku Duel instances were called. Could not add $country_1$ and $country_2$ to a duel."
	}
}

th_create_event_target_enemy_duelist = {
	save_event_target_as = root_duelist
	if = {
		limit = { th_is_not_duelling_an_unlanded_character = yes }
		if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 1 } } event_target:th_danmaku_duelist_of_id_1_of_instance_1 = { save_event_target_as = enemy_duelist } }
		if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 2 } } event_target:th_danmaku_duelist_of_id_1_of_instance_2 = { save_event_target_as = enemy_duelist } }
		if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 3 } } event_target:th_danmaku_duelist_of_id_1_of_instance_3 = { save_event_target_as = enemy_duelist } }
		if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 4 } } event_target:th_danmaku_duelist_of_id_1_of_instance_4 = { save_event_target_as = enemy_duelist } }
		if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 5 } } event_target:th_danmaku_duelist_of_id_1_of_instance_5 = { save_event_target_as = enemy_duelist } }
		if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 6 } } event_target:th_danmaku_duelist_of_id_1_of_instance_6 = { save_event_target_as = enemy_duelist } }
		if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 7 } } event_target:th_danmaku_duelist_of_id_1_of_instance_7 = { save_event_target_as = enemy_duelist } }
		if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 8 } } event_target:th_danmaku_duelist_of_id_1_of_instance_8 = { save_event_target_as = enemy_duelist } }
		if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 9 } } event_target:th_danmaku_duelist_of_id_1_of_instance_9 = { save_event_target_as = enemy_duelist } }
		if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 10 } } event_target:th_danmaku_duelist_of_id_1_of_instance_10 = { save_event_target_as = enemy_duelist } }
		if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 11 } } event_target:th_danmaku_duelist_of_id_1_of_instance_11 = { save_event_target_as = enemy_duelist } }
		if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 12 } } event_target:th_danmaku_duelist_of_id_1_of_instance_12 = { save_event_target_as = enemy_duelist } }
		if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 13 } } event_target:th_danmaku_duelist_of_id_1_of_instance_13 = { save_event_target_as = enemy_duelist } }
		if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 14 } } event_target:th_danmaku_duelist_of_id_1_of_instance_14 = { save_event_target_as = enemy_duelist } }
		if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 15 } } event_target:th_danmaku_duelist_of_id_1_of_instance_15 = { save_event_target_as = enemy_duelist } }
		if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 1 } } event_target:th_danmaku_duelist_of_id_2_of_instance_1 = { save_event_target_as = enemy_duelist } }
		if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 2 } } event_target:th_danmaku_duelist_of_id_2_of_instance_2 = { save_event_target_as = enemy_duelist } }
		if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 3 } } event_target:th_danmaku_duelist_of_id_2_of_instance_3 = { save_event_target_as = enemy_duelist } }
		if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 4 } } event_target:th_danmaku_duelist_of_id_2_of_instance_4 = { save_event_target_as = enemy_duelist } }
		if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 5 } } event_target:th_danmaku_duelist_of_id_2_of_instance_5 = { save_event_target_as = enemy_duelist } }
		if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 6 } } event_target:th_danmaku_duelist_of_id_2_of_instance_6 = { save_event_target_as = enemy_duelist } }
		if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 7 } } event_target:th_danmaku_duelist_of_id_2_of_instance_7 = { save_event_target_as = enemy_duelist } }
		if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 8 } } event_target:th_danmaku_duelist_of_id_2_of_instance_8 = { save_event_target_as = enemy_duelist } }
		if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 9 } } event_target:th_danmaku_duelist_of_id_2_of_instance_9 = { save_event_target_as = enemy_duelist } }
		if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 10 } } event_target:th_danmaku_duelist_of_id_2_of_instance_10 = { save_event_target_as = enemy_duelist } }
		if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 11 } } event_target:th_danmaku_duelist_of_id_2_of_instance_11 = { save_event_target_as = enemy_duelist } }
		if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 12 } } event_target:th_danmaku_duelist_of_id_2_of_instance_12 = { save_event_target_as = enemy_duelist } }
		if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 13 } } event_target:th_danmaku_duelist_of_id_2_of_instance_13 = { save_event_target_as = enemy_duelist } }
		if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 14 } } event_target:th_danmaku_duelist_of_id_2_of_instance_14 = { save_event_target_as = enemy_duelist } }
		if = { limit = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 15 } } event_target:th_danmaku_duelist_of_id_2_of_instance_15 = { save_event_target_as = enemy_duelist } }
		if = {
			limit = { NOT = { has_saved_event_target = enemy_duelist } }
			log = "Could not create enemy_duelist event_target. Maybe the enemy country does not exist?"
		}
	}
}

th_change_danmaku_instance_round = {
	if = { limit = { th_get_danmaku_duel_instance = { instance = 1 } } th_change_danmaku_specific_instance_round = { instance = 1 opponent = $opponent$ } }
	if = { limit = { th_get_danmaku_duel_instance = { instance = 2 } } th_change_danmaku_specific_instance_round = { instance = 2 opponent = $opponent$ } }
	if = { limit = { th_get_danmaku_duel_instance = { instance = 3 } } th_change_danmaku_specific_instance_round = { instance = 3 opponent = $opponent$ } }
	if = { limit = { th_get_danmaku_duel_instance = { instance = 4 } } th_change_danmaku_specific_instance_round = { instance = 4 opponent = $opponent$ } }
	if = { limit = { th_get_danmaku_duel_instance = { instance = 5 } } th_change_danmaku_specific_instance_round = { instance = 5 opponent = $opponent$ } }
	if = { limit = { th_get_danmaku_duel_instance = { instance = 6 } } th_change_danmaku_specific_instance_round = { instance = 6 opponent = $opponent$ } }
	if = { limit = { th_get_danmaku_duel_instance = { instance = 7 } } th_change_danmaku_specific_instance_round = { instance = 7 opponent = $opponent$ } }
	if = { limit = { th_get_danmaku_duel_instance = { instance = 8 } } th_change_danmaku_specific_instance_round = { instance = 8 opponent = $opponent$ } }
	if = { limit = { th_get_danmaku_duel_instance = { instance = 9 } } th_change_danmaku_specific_instance_round = { instance = 9 opponent = $opponent$ } }
	if = { limit = { th_get_danmaku_duel_instance = { instance = 10 } } th_change_danmaku_specific_instance_round = { instance = 10 opponent = $opponent$ } }
	if = { limit = { th_get_danmaku_duel_instance = { instance = 11 } } th_change_danmaku_specific_instance_round = { instance = 11 opponent = $opponent$ } }
	if = { limit = { th_get_danmaku_duel_instance = { instance = 12 } } th_change_danmaku_specific_instance_round = { instance = 12 opponent = $opponent$ } }
	if = { limit = { th_get_danmaku_duel_instance = { instance = 13 } } th_change_danmaku_specific_instance_round = { instance = 13 opponent = $opponent$ } }
	if = { limit = { th_get_danmaku_duel_instance = { instance = 14 } } th_change_danmaku_specific_instance_round = { instance = 14 opponent = $opponent$ } }
	if = { limit = { th_get_danmaku_duel_instance = { instance = 15 } } th_change_danmaku_specific_instance_round = { instance = 15 opponent = $opponent$ } }
}

th_danmaku_duel_on_annexed_effect = {
	th_clear_invalid_combat_instance = { instance = 1 }
	th_clear_invalid_combat_instance = { instance = 2 }
	th_clear_invalid_combat_instance = { instance = 3 }
	th_clear_invalid_combat_instance = { instance = 4 }
	th_clear_invalid_combat_instance = { instance = 5 }
	th_clear_invalid_combat_instance = { instance = 6 }
	th_clear_invalid_combat_instance = { instance = 7 }
	th_clear_invalid_combat_instance = { instance = 8 }
	th_clear_invalid_combat_instance = { instance = 9 }
	th_clear_invalid_combat_instance = { instance = 10 }
	th_clear_invalid_combat_instance = { instance = 11 }
	th_clear_invalid_combat_instance = { instance = 12 }
	th_clear_invalid_combat_instance = { instance = 13 }
	th_clear_invalid_combat_instance = { instance = 14 }
	th_clear_invalid_combat_instance = { instance = 15 }
}

th_monthly_danmaku_duel_update = {
	if = {
		limit = { has_global_flag = th_setup_danmaku_duels_counter }
		th_monthly_danmaku_duel_duration_reduction = { instance = 1 }
		th_monthly_danmaku_duel_duration_reduction = { instance = 2 }
		th_monthly_danmaku_duel_duration_reduction = { instance = 3 }
		th_monthly_danmaku_duel_duration_reduction = { instance = 4 }
		th_monthly_danmaku_duel_duration_reduction = { instance = 5 }
		th_monthly_danmaku_duel_duration_reduction = { instance = 6 }
		th_monthly_danmaku_duel_duration_reduction = { instance = 7 }
		th_monthly_danmaku_duel_duration_reduction = { instance = 8 }
		th_monthly_danmaku_duel_duration_reduction = { instance = 9 }
		th_monthly_danmaku_duel_duration_reduction = { instance = 10 }
		th_monthly_danmaku_duel_duration_reduction = { instance = 11 }
		th_monthly_danmaku_duel_duration_reduction = { instance = 12 }
		th_monthly_danmaku_duel_duration_reduction = { instance = 13 }
		th_monthly_danmaku_duel_duration_reduction = { instance = 14 }
		th_monthly_danmaku_duel_duration_reduction = { instance = 15 }
	}
}


################################################
# STATS DEFINITOINS                            #
################################################

th_set_default_danmaku_stats = {
	1 = {
		PREV = {
			set_variable = { which = th_danmaku_default_max_health 					which = PREV }
			set_variable = { which = th_danmaku_default_max_mana						which = PREV }
			set_variable = { which = th_danmaku_default_max_action_points				which = PREV }
			set_variable = { which = th_danmaku_default_hpm							which = PREV }
			set_variable = { which = th_danmaku_default_mpm							which = PREV }
			set_variable = { which = th_danmaku_default_ini_bonus						which = PREV }
			set_variable = { which = th_danmaku_default_hit_bonus						which = PREV }
			set_variable = { which = th_danmaku_default_physical_attack_bonus			which = PREV }
			set_variable = { which = th_danmaku_default_physical_attack_bonus_per_die	which = PREV }
			set_variable = { which = th_danmaku_default_physical_attack_die			which = PREV }
			set_variable = { which = th_danmaku_default_physical_attack_die_num		which = PREV }
			set_variable = { which = th_danmaku_default_physical_crit_roll_needed		which = PREV }
			set_variable = { which = th_danmaku_default_magical_attack_bonus			which = PREV }
			set_variable = { which = th_danmaku_default_magical_attack_bonus_per_die	which = PREV }
			set_variable = { which = th_danmaku_default_magical_attack_die				which = PREV }
			set_variable = { which = th_danmaku_default_magical_attack_die_num			which = PREV }
			set_variable = { which = th_danmaku_default_magical_crit_roll_needed		which = PREV }
			set_variable = { which = th_danmaku_default_psionic_attack_bonus			which = PREV }
			set_variable = { which = th_danmaku_default_psionic_attack_bonus_per_die	which = PREV }
			set_variable = { which = th_danmaku_default_psionic_attack_die				which = PREV }
			set_variable = { which = th_danmaku_default_psionic_attack_die_num			which = PREV }
			set_variable = { which = th_danmaku_default_psionic_crit_roll_needed		which = PREV }
			set_variable = { which = th_danmaku_default_crit_roll_damage_multipler		which = PREV }

			set_variable = { which = th_danmaku_default_physical_damage_modifier		which = PREV }
			set_variable = { which = th_danmaku_default_magical_damage_modifier		which = PREV }
			set_variable = { which = th_danmaku_default_psionic_damage_modifier		which = PREV }
			set_variable = { which = th_danmaku_default_bludgeoning_damage_modifier	which = PREV }
			set_variable = { which = th_danmaku_default_piercing_damage_modifier		which = PREV }
			set_variable = { which = th_danmaku_default_slashing_damage_modifier		which = PREV }
			set_variable = { which = th_danmaku_default_fire_damage_modifier			which = PREV }
			set_variable = { which = th_danmaku_default_frost_damage_modifier			which = PREV }
			set_variable = { which = th_danmaku_default_earth_damage_modifier			which = PREV }
			set_variable = { which = th_danmaku_default_lightning_damage_modifier		which = PREV }
			set_variable = { which = th_danmaku_default_nature_damage_modifier			which = PREV }
			set_variable = { which = th_danmaku_default_holy_damage_modifier			which = PREV }
			set_variable = { which = th_danmaku_default_shadow_damage_modifier			which = PREV }
			set_variable = { which = th_danmaku_default_necrotic_damage_modifier		which = PREV }
			set_variable = { which = th_danmaku_default_arcane_damage_modifier			which = PREV }
			set_variable = { which = th_danmaku_default_infernal_damage_modifier		which = PREV }

			set_variable = { which = th_danmaku_default_physical_resistance			which = PREV }
			set_variable = { which = th_danmaku_default_magical_resistance				which = PREV }
			set_variable = { which = th_danmaku_default_psionic_resistance				which = PREV }
			set_variable = { which = th_danmaku_default_bludgeoning_resistance			which = PREV }
			set_variable = { which = th_danmaku_default_piercing_resistance			which = PREV }
			set_variable = { which = th_danmaku_default_slashing_resistance			which = PREV }
			set_variable = { which = th_danmaku_default_fire_resistance				which = PREV }
			set_variable = { which = th_danmaku_default_frost_resistance				which = PREV }
			set_variable = { which = th_danmaku_default_earth_resistance				which = PREV }
			set_variable = { which = th_danmaku_default_lightning_resistance			which = PREV }
			set_variable = { which = th_danmaku_default_nature_resistance				which = PREV }
			set_variable = { which = th_danmaku_default_holy_resistance				which = PREV }
			set_variable = { which = th_danmaku_default_shadow_resistance				which = PREV }
			set_variable = { which = th_danmaku_default_necrotic_resistance			which = PREV }
			set_variable = { which = th_danmaku_default_arcane_resistance				which = PREV }
			set_variable = { which = th_danmaku_default_infernal_resistance			which = PREV }
			
			set_variable = { which = th_danmaku_default_healing_die					which = PREV }
			set_variable = { which = th_danmaku_default_healing_die_num				which = PREV }
			set_variable = { which = th_danmaku_default_healing_crit_roll_needed		which = PREV }
			set_variable = { which = th_danmaku_default_healing_received_bonus			which = PREV }
			set_variable = { which = th_danmaku_default_healing_received_modifier		which = PREV }

			set_variable = { which = th_danmaku_default_armor_class					which = PREV }
			set_variable = { which = th_danmaku_default_saving_throw_die				which = PREV }
			set_variable = { which = th_danmaku_default_resistance						which = PREV }

			set_variable = { which = th_danmaku_default_gold_gain						which = PREV }
			set_variable = { which = th_danmaku_default_power_gain						which = PREV }
			set_variable = { which = th_danmaku_default_start_level					which = PREV }
			set_variable = { which = th_danmaku_default_level_1_exp					which = PREV }
			set_variable = { which = th_danmaku_default_start_exp						which = PREV }
			set_variable = { which = th_danmaku_default_start_skills					which = PREV }

			set_variable = { which = th_danmaku_default_attack_type					which = PREV }
			set_variable = { which = th_danmaku_default_attack_school					which = PREV }

			#Attributes
			set_variable = { which = th_danmaku_default_attribute_constitution			which = PREV }
			set_variable = { which = th_danmaku_default_attribute_spirit				which = PREV }
			set_variable = { which = th_danmaku_default_attribute_martial				which = PREV }
			set_variable = { which = th_danmaku_default_attribute_spell_power			which = PREV }
			set_variable = { which = th_danmaku_default_attribute_psi					which = PREV }
			set_variable = { which = th_danmaku_default_attribute_agility				which = PREV }
			set_variable = { which = th_danmaku_default_attribute_speed					which = PREV }
			set_variable = { which = th_danmaku_default_attribute_durability			which = PREV }

			#Conversion rates
			set_variable = { which = th_danmaku_default_constitution_per_level			which = PREV }
			set_variable = { which = th_danmaku_default_spirit_per_level				which = PREV }
			set_variable = { which = th_danmaku_default_martial_per_level				which = PREV }
			set_variable = { which = th_danmaku_default_spell_power_per_level			which = PREV }
			set_variable = { which = th_danmaku_default_psi_per_level					which = PREV }
			set_variable = { which = th_danmaku_default_agility_per_level				which = PREV }
			set_variable = { which = th_danmaku_default_speed_per_level					which = PREV }
			set_variable = { which = th_danmaku_default_durability_per_level			which = PREV }
			set_variable = { which = th_danmaku_default_hp_per_constitution				which = PREV }
			set_variable = { which = th_danmaku_default_hpm_per_constitution			which = PREV }
			set_variable = { which = th_danmaku_default_mp_per_spirit					which = PREV }
			set_variable = { which = th_danmaku_default_mpm_per_spirit					which = PREV }
			set_variable = { which = th_danmaku_default_physical_attack_bonus_per_stat	which = PREV }
			set_variable = { which = th_danmaku_default_magical_attack_bonus_per_stat	which = PREV }
			set_variable = { which = th_danmaku_default_psionic_attack_bonus_per_stat	which = PREV }
			set_variable = { which = th_danmaku_default_armor_per_agility				which = PREV }
			set_variable = { which = th_danmaku_default_initiative_per_agility			which = PREV }
			set_variable = { which = th_danmaku_default_ap_per_speed					which = PREV }
			set_variable = { which = th_danmaku_default_resistance_per_durability		which = PREV }
			set_variable = { which = th_danmaku_default_resilience_per_durability		which = PREV }
			
			set_variable = { which = th_danmaku_max_health 								which = th_danmaku_default_max_health }
			set_variable = { which = th_danmaku_health 									which = th_danmaku_default_max_health }
			set_variable = { which = th_danmaku_max_mana								which = th_danmaku_default_max_mana }
			set_variable = { which = th_danmaku_mana									which = th_danmaku_default_max_mana }
			set_variable = { which = th_danmaku_max_action_points 						which = th_danmaku_default_max_action_points }
			set_variable = { which = th_danmaku_action_points 							which = th_danmaku_default_max_action_points }
			set_variable = { which = th_danmaku_hpm										which = th_danmaku_default_hpm }
			set_variable = { which = th_danmaku_mpm										which = th_danmaku_default_mpm }
			set_variable = { which = th_danmaku_ini_bonus								which = th_danmaku_default_ini_bonus }
			set_variable = { which = th_danmaku_hit_bonus								which = th_danmaku_default_hit_bonus }
			set_variable = { which = th_danmaku_physical_attack_bonus					which = th_danmaku_default_physical_attack_bonus }
			set_variable = { which = th_danmaku_physical_attack_bonus_per_die			which = th_danmaku_default_physical_attack_bonus_per_die }
			set_variable = { which = th_danmaku_physical_attack_die						which = th_danmaku_default_physical_attack_die }
			set_variable = { which = th_danmaku_physical_attack_die_num					which = th_danmaku_default_physical_attack_die_num }
			set_variable = { which = th_danmaku_physical_crit_roll_needed				which = th_danmaku_default_physical_crit_roll_needed }
			set_variable = { which = th_danmaku_physical_crit_roll_damage_multiplier	which = th_danmaku_default_crit_roll_damage_multipler }
			set_variable = { which = th_danmaku_magical_attack_bonus					which = th_danmaku_default_magical_attack_bonus }
			set_variable = { which = th_danmaku_magical_attack_bonus_per_die			which = th_danmaku_default_magical_attack_bonus_per_die }
			set_variable = { which = th_danmaku_magical_attack_die						which = th_danmaku_default_magical_attack_die }
			set_variable = { which = th_danmaku_magical_attack_die_num					which = th_danmaku_default_magical_attack_die_num }
			set_variable = { which = th_danmaku_magical_crit_roll_needed				which = th_danmaku_default_magical_crit_roll_needed }
			set_variable = { which = th_danmaku_magical_crit_roll_damage_multiplier		which = th_danmaku_default_crit_roll_damage_multipler }
			set_variable = { which = th_danmaku_psionic_attack_bonus					which = th_danmaku_default_psionic_attack_bonus }
			set_variable = { which = th_danmaku_psionic_attack_bonus_per_die			which = th_danmaku_default_psionic_attack_bonus_per_die }
			set_variable = { which = th_danmaku_psionic_attack_die						which = th_danmaku_default_psionic_attack_die }
			set_variable = { which = th_danmaku_psionic_attack_die_num					which = th_danmaku_default_psionic_attack_die_num }
			set_variable = { which = th_danmaku_psionic_crit_roll_needed				which = th_danmaku_default_psionic_crit_roll_needed }
			set_variable = { which = th_danmaku_psionic_crit_roll_damage_multiplier		which = th_danmaku_default_crit_roll_damage_multipler }

			set_variable = { which = th_danmaku_attack_type								which = th_danmaku_default_attack_type }
			set_variable = { which = th_danmaku_attack_school							which = th_danmaku_default_attack_school }

			set_variable = { which = th_danmaku_physical_damage_modifier				which = th_danmaku_default_physical_damage_modifier }
			set_variable = { which = th_danmaku_magical_damage_modifier					which = th_danmaku_default_magical_damage_modifier }
			set_variable = { which = th_danmaku_psionic_damage_modifier					which = th_danmaku_default_psionic_damage_modifier }
			set_variable = { which = th_danmaku_bludgeoning_damage_modifier				which = th_danmaku_default_bludgeoning_damage_modifier }
			set_variable = { which = th_danmaku_piercing_damage_modifier				which = th_danmaku_default_piercing_damage_modifier }
			set_variable = { which = th_danmaku_slashing_damage_modifier				which = th_danmaku_default_slashing_damage_modifier }
			set_variable = { which = th_danmaku_fire_damage_modifier					which = th_danmaku_default_fire_damage_modifier }
			set_variable = { which = th_danmaku_frost_damage_modifier					which = th_danmaku_default_frost_damage_modifier }
			set_variable = { which = th_danmaku_earth_damage_modifier					which = th_danmaku_default_earth_damage_modifier }
			set_variable = { which = th_danmaku_lightning_damage_modifier				which = th_danmaku_default_lightning_damage_modifier }
			set_variable = { which = th_danmaku_nature_damage_modifier					which = th_danmaku_default_nature_damage_modifier }
			set_variable = { which = th_danmaku_holy_damage_modifier					which = th_danmaku_default_holy_damage_modifier }
			set_variable = { which = th_danmaku_shadow_damage_modifier					which = th_danmaku_default_shadow_damage_modifier }
			set_variable = { which = th_danmaku_necrotic_damage_modifier				which = th_danmaku_default_necrotic_damage_modifier }
			set_variable = { which = th_danmaku_arcane_damage_modifier					which = th_danmaku_default_arcane_damage_modifier }
			set_variable = { which = th_danmaku_infernal_damage_modifier				which = th_danmaku_default_infernal_damage_modifier }
			set_variable = { which = th_danmaku_physical_resistance						which = th_danmaku_default_physical_resistance }
			set_variable = { which = th_danmaku_magical_resistance						which = th_danmaku_default_magical_resistance }
			set_variable = { which = th_danmaku_psionic_resistance						which = th_danmaku_default_psionic_resistance }
			set_variable = { which = th_danmaku_bludgeoning_resistance					which = th_danmaku_default_bludgeoning_resistance }
			set_variable = { which = th_danmaku_piercing_resistance						which = th_danmaku_default_piercing_resistance }
			set_variable = { which = th_danmaku_slashing_resistance						which = th_danmaku_default_slashing_resistance }
			set_variable = { which = th_danmaku_fire_resistance							which = th_danmaku_default_fire_resistance }
			set_variable = { which = th_danmaku_frost_resistance						which = th_danmaku_default_frost_resistance }
			set_variable = { which = th_danmaku_earth_resistance						which = th_danmaku_default_earth_resistance }
			set_variable = { which = th_danmaku_lightning_resistance					which = th_danmaku_default_lightning_resistance }
			set_variable = { which = th_danmaku_nature_resistance						which = th_danmaku_default_nature_resistance }
			set_variable = { which = th_danmaku_holy_resistance							which = th_danmaku_default_holy_resistance }
			set_variable = { which = th_danmaku_shadow_resistance						which = th_danmaku_default_shadow_resistance }
			set_variable = { which = th_danmaku_necrotic_resistance						which = th_danmaku_default_necrotic_resistance }
			set_variable = { which = th_danmaku_arcane_resistance						which = th_danmaku_default_arcane_resistance }
			set_variable = { which = th_danmaku_infernal_resistance						which = th_danmaku_default_infernal_resistance }
			
			set_variable = { which = th_danmaku_healing_die								which = th_danmaku_default_healing_die }
			set_variable = { which = th_danmaku_healing_die_num							which = th_danmaku_default_healing_die_num }
			set_variable = { which = th_danmaku_healing_crit_roll_needed				which = th_danmaku_default_healing_crit_roll_needed }
			set_variable = { which = th_danmaku_healing_received_bonus					which = th_danmaku_default_healing_received_bonus }
			set_variable = { which = th_danmaku_healing_received_modifier				which = th_danmaku_default_healing_received_modifier }

			set_variable = { which = th_danmaku_armor_class								which = th_danmaku_default_armor_class }
			set_variable = { which = th_danmaku_saving_throw_die						which = th_danmaku_default_saving_throw_die }
			set_variable = { which = th_danmaku_resistance								which = th_danmaku_default_resistance }

			#Attributes
			set_variable = { which = th_danmaku_attribute_constitution			which = th_danmaku_default_attribute_constitution }
			set_variable = { which = th_danmaku_attribute_spirit				which = th_danmaku_default_attribute_spirit }
			set_variable = { which = th_danmaku_attribute_martial				which = th_danmaku_default_attribute_martial }
			set_variable = { which = th_danmaku_attribute_spell_power			which = th_danmaku_default_attribute_spell_power }
			set_variable = { which = th_danmaku_attribute_psi					which = th_danmaku_default_attribute_psi }
			set_variable = { which = th_danmaku_attribute_agility				which = th_danmaku_default_attribute_agility }
			set_variable = { which = th_danmaku_attribute_speed					which = th_danmaku_default_attribute_speed }
			set_variable = { which = th_danmaku_attribute_durability			which = th_danmaku_default_attribute_durability }

			#Conversion rates
			set_variable = { which = th_danmaku_constitution_per_level			which = th_danmaku_default_constitution_per_level }
			set_variable = { which = th_danmaku_spirit_per_level				which = th_danmaku_default_spirit_per_level }
			set_variable = { which = th_danmaku_martial_per_level				which = th_danmaku_default_martial_per_level }
			set_variable = { which = th_danmaku_spell_power_per_level			which = th_danmaku_default_spell_power_per_level }
			set_variable = { which = th_danmaku_psi_per_level					which = th_danmaku_default_psi_per_level }
			set_variable = { which = th_danmaku_agility_per_level				which = th_danmaku_default_agility_per_level }
			set_variable = { which = th_danmaku_speed_per_level					which = th_danmaku_default_speed_per_level }
			set_variable = { which = th_danmaku_durability_per_level			which = th_danmaku_default_durability_per_level }
			set_variable = { which = th_danmaku_hp_per_constitution				which = th_danmaku_default_hp_per_constitution }
			set_variable = { which = th_danmaku_hpm_per_constitution			which = th_danmaku_default_hpm_per_constitution }
			set_variable = { which = th_danmaku_mp_per_spirit					which = th_danmaku_default_mp_per_spirit }
			set_variable = { which = th_danmaku_mpm_per_spirit					which = th_danmaku_default_mpm_per_spirit }
			set_variable = { which = th_danmaku_physical_attack_bonus_per_stat	which = th_danmaku_default_physical_attack_bonus_per_stat }
			set_variable = { which = th_danmaku_magical_attack_bonus_per_stat	which = th_danmaku_default_magical_attack_bonus_per_stat }
			set_variable = { which = th_danmaku_psionic_attack_bonus_per_stat	which = th_danmaku_default_psionic_attack_bonus_per_stat }
			set_variable = { which = th_danmaku_armor_per_agility				which = th_danmaku_default_armor_per_agility }
			set_variable = { which = th_danmaku_initiative_per_agility			which = th_danmaku_default_initiative_per_agility }
			set_variable = { which = th_danmaku_ap_per_speed					which = th_danmaku_default_ap_per_speed }
			set_variable = { which = th_danmaku_resistance_per_durability		which = th_danmaku_default_resistance_per_durability }
			set_variable = { which = th_danmaku_resilience_per_durability		which = th_danmaku_default_resilience_per_durability }

			set_variable = { which = th_danmaku_gold_gain								which = th_danmaku_default_gold_gain }
			set_variable = { which = th_danmaku_power_gain								which = th_danmaku_default_power_gain }
			set_variable = { which = th_ruler_danmaku_level								which = th_danmaku_default_start_level }
			set_variable = { which = th_danmaku_exp_threshold							which = th_danmaku_default_level_1_exp }
			set_variable = { which = th_danmaku_current_exp								which = th_danmaku_default_start_exp }
			set_variable = { which = th_danmaku_available_skill_points					which = th_danmaku_default_start_skills }
			set_variable = { which = th_danmaku_default_max_level						which = PREV }	#Utilizes same variable name
		}
	}
	th_get_weapon_attack_and_apply = yes
	#Set all the show variables
	th_gui_update_danmaku_bar_own_ruler = { type = health }
	th_gui_update_danmaku_bar_own_ruler = { type = mana }
	th_gui_update_danmaku_bar_own_ruler = { type = exp }
	th_gui_update_danmaku_bar_own_ruler = { type = action_points }
	th_update_gain_modifier = { type = gold }
	th_update_gain_modifier = { type = power }
}

th_convert_attributes_to_stats_and_apply = {
	#Con
	set_variable = { which = th_hp_per_constitution_bonus which = $hp_per_constitution$ }
	multiply_variable = { which = th_hp_per_constitution_bonus which = th_danmaku_attribute_constitution }
	change_variable = { which = th_danmaku_max_health which = th_hp_per_constitution_bonus }
	change_variable = { which = th_danmaku_health which = th_hp_per_constitution_bonus }

	set_variable = { which = th_hpm_per_constitution_bonus which = $hpm_per_constitution$ }
	multiply_variable = { which = th_hpm_per_constitution_bonus which = $constitution$ }
	change_variable = { which = th_danmaku_hpm which = th_hpm_per_constitution_bonus }

	#Spirit
	set_variable = { which = th_mp_per_spirit_bonus which = $mp_per_spirit$ }
	multiply_variable = { which = th_mp_per_spirit_bonus which = th_danmaku_attribute_spirit }
	change_variable = { which = th_danmaku_max_mana which = th_mp_per_spirit_bonus }
	change_variable = { which = th_danmaku_mana which = th_mp_per_spirit_bonus }

	set_variable = { which = th_mpm_per_spirit_bonus which = $mpm_per_spirit$ }
	multiply_variable = { which = th_mpm_per_spirit_bonus which = $spirit$ }
	change_variable = { which = th_danmaku_mpm which = th_mpm_per_spirit_bonus }

	#Martial
	set_variable = { which = th_physical_attack_bonus_per_stat_bonus which = $physical_attack_bonus_per_stat$ }
	multiply_variable = { which = th_physical_attack_bonus_per_stat_bonus which = $martial$ }
	change_variable = { which = th_danmaku_physical_attack_bonus which = th_physical_attack_bonus_per_stat_bonus }

	#Spell Power
	set_variable = { which = th_magical_attack_bonus_per_stat_bonus which = $magical_attack_bonus_per_stat$ }
	multiply_variable = { which = th_magical_attack_bonus_per_stat_bonus which = $spell_power$ }
	change_variable = { which = th_danmaku_magical_attack_bonus which = th_magical_attack_bonus_per_stat_bonus }

	#Psi
	set_variable = { which = th_psionic_attack_bonus_per_stat_bonus which = $psionic_attack_bonus_per_stat$ }
	multiply_variable = { which = th_psionic_attack_bonus_per_stat_bonus which = $psi$ }
	change_variable = { which = th_danmaku_psionic_attack_bonus which = th_psionic_attack_bonus_per_stat_bonus }

	#Agility
	set_variable = { which = th_danmaku_armor_per_agility_bonus which = $armor_per_agility$ }
	multiply_variable = { which = th_danmaku_armor_per_agility_bonus which = $agility$ }
	change_variable = { which = th_danmaku_armor_class which = th_danmaku_armor_per_agility_bonus }

	set_variable = { which = th_danmaku_initiative_per_agility_bonus which = $initiative_per_agility$ }
	multiply_variable = { which = th_danmaku_initiative_per_agility_bonus which = th_danmaku_attribute_agility }
	change_variable = { which = th_danmaku_ini_bonus which = th_danmaku_initiative_per_agility_bonus }

	#Speed
	set_variable = { which = th_danmaku_ap_per_speed_bonus which = $ap_per_speed$ }
	multiply_variable = { which = th_danmaku_ap_per_speed_bonus which = $speed$ }
	change_variable = { which = th_danmaku_max_action_points which = th_danmaku_ap_per_speed_bonus }
	change_variable = { which = th_danmaku_action_points which = th_danmaku_ap_per_speed_bonus }

	#Durability
	set_variable = { which = th_danmaku_resistance_per_durability_bonus which = $resistance_per_durability$ }
	multiply_variable = { which = th_danmaku_resistance_per_durability_bonus which = $durability$ }
	change_variable = { which = th_danmaku_resistance which = th_danmaku_resistance_per_durability_bonus }
}
th_apply_player_stats = {
	th_convert_attributes_to_stats_and_apply = {
		constitution = th_danmaku_attribute_constitution
		spirit = th_danmaku_attribute_spirit
		martial = th_danmaku_attribute_martial
		spell_power = th_danmaku_attribute_spell_power
		psi = th_danmaku_attribute_psi
		agility = th_danmaku_attribute_agility
		speed = th_danmaku_attribute_speed
		durability = th_danmaku_attribute_durability

		hp_per_constitution = th_danmaku_hp_per_constitution
		hpm_per_constitution = th_danmaku_hpm_per_constitution
		mp_per_spirit = th_danmaku_mp_per_spirit
		mpm_per_spirit = th_danmaku_mpm_per_spirit
		physical_attack_bonus_per_stat = th_danmaku_physical_attack_bonus_per_stat
		magical_attack_bonus_per_stat = th_danmaku_magical_attack_bonus_per_stat
		psionic_attack_bonus_per_stat = th_danmaku_psionic_attack_bonus_per_stat
		armor_per_agility = th_danmaku_armor_per_agility
		initiative_per_agility = th_danmaku_initiative_per_agility
		ap_per_speed = th_danmaku_ap_per_speed
		resistance_per_durability = th_danmaku_resistance_per_durability
	}
}
th_apply_enemy_character_stats = {
	th_convert_attributes_to_stats_and_apply = {
		constitution = th_enemy_character_attribute_constitution
		spirit = th_enemy_character_attribute_spirit
		martial = th_enemy_character_attribute_martial
		spell_power = th_enemy_character_attribute_spell_power
		psi = th_enemy_character_attribute_psi
		agility = th_enemy_character_attribute_agility
		speed = th_enemy_character_attribute_speed
		durability = th_enemy_character_attribute_durability

		hp_per_constitution = th_enemy_character_hp_per_constitution
		hpm_per_constitution = th_enemy_character_hpm_per_constitution
		mp_per_spirit = th_enemy_character_mp_per_spirit
		mpm_per_spirit = th_enemy_character_mpm_per_spirit
		physical_attack_bonus_per_stat = th_enemy_character_physical_attack_bonus_per_stat
		magical_attack_bonus_per_stat = th_enemy_character_magical_attack_bonus_per_stat
		psionic_attack_bonus_per_stat = th_enemy_character_psionic_attack_bonus_per_stat
		armor_per_agility = th_enemy_character_armor_per_agility
		initiative_per_agility = th_enemy_character_initiative_per_agility
		ap_per_speed = th_enemy_character_ap_per_speed
		resistance_per_durability = th_enemy_character_resistance_per_durability
	}
}

th_setup_stats_from_levels = {
	set_variable = { which = th_level_loop_var which = th_ruler_danmaku_level }
	while = {
		limit = { check_variable = { which = th_level_loop_var value = 1 } }
		change_variable = { which = th_danmaku_attribute_constitution		which = th_danmaku_constitution_per_level }
		change_variable = { which = th_danmaku_attribute_spirit			which = th_danmaku_spirit_per_level }
		change_variable = { which = th_danmaku_attribute_martial			which = th_danmaku_martial_per_level }
		change_variable = { which = th_danmaku_attribute_spell_power		which = th_danmaku_spell_power_per_level }
		change_variable = { which = th_danmaku_attribute_psi				which = th_danmaku_psi_per_level }
		change_variable = { which = th_danmaku_attribute_agility			which = th_danmaku_agility_per_level }
		change_variable = { which = th_danmaku_attribute_speed				which = th_danmaku_speed_per_level }
		change_variable = { which = th_danmaku_attribute_durability		which = th_danmaku_durability_per_level }
		subtract_variable = { which = th_level_loop_var value = 1 }
	}
	th_apply_player_stats = yes

	#Set all the show variables
	th_gui_update_danmaku_bar_own_ruler = { type = health }
	th_gui_update_danmaku_bar_own_ruler = { type = mana }
	th_gui_update_danmaku_bar_own_ruler = { type = exp }
	th_gui_update_danmaku_bar_own_ruler = { type = action_points }
	th_update_gain_modifier = { type = gold }
	th_update_gain_modifier = { type = power }
}

th_setup_enemy_character_stats_from_levels = {
	set_variable = { which = th_level_loop_var which = th_enemy_character_level }
	while = {
		limit = { check_variable = { which = th_level_loop_var value = 1 } }
		change_variable = { which = th_enemy_character_attribute_constitution		which = th_enemy_character_constitution_per_level }
		change_variable = { which = th_enemy_character_attribute_spirit			which = th_enemy_character_spirit_per_level }
		change_variable = { which = th_enemy_character_attribute_martial			which = th_enemy_character_martial_per_level }
		change_variable = { which = th_enemy_character_attribute_spell_power		which = th_enemy_character_spell_power_per_level }
		change_variable = { which = th_enemy_character_attribute_psi				which = th_enemy_character_psi_per_level }
		change_variable = { which = th_enemy_character_attribute_agility			which = th_enemy_character_agility_per_level }
		change_variable = { which = th_enemy_character_attribute_speed				which = th_enemy_character_speed_per_level }
		change_variable = { which = th_enemy_character_attribute_durability		which = th_enemy_character_durability_per_level }
		subtract_variable = { which = th_level_loop_var value = 1 }
	}
	th_apply_enemy_character_stats = yes
}

th_transfer_default_stats_to_enemy_character = {
	1 = {
		PREV = {
			set_variable = { which = th_danmaku_default_max_health 					which = PREV }
			set_variable = { which = th_danmaku_default_max_mana					which = PREV }
			set_variable = { which = th_danmaku_default_max_action_points			which = PREV }
			set_variable = { which = th_danmaku_default_ini_bonus					which = PREV }
			set_variable = { which = th_danmaku_default_hit_bonus					which = PREV }
			
			set_variable = { which = th_danmaku_default_physical_attack_bonus		which = PREV }
			set_variable = { which = th_danmaku_default_physical_attack_die			which = PREV }
			set_variable = { which = th_danmaku_default_physical_attack_die_num		which = PREV }
			set_variable = { which = th_danmaku_default_physical_crit_roll_needed	which = PREV }
			set_variable = { which = th_danmaku_default_magical_attack_bonus		which = PREV }
			set_variable = { which = th_danmaku_default_magical_attack_die			which = PREV }
			set_variable = { which = th_danmaku_default_magical_attack_die_num		which = PREV }
			set_variable = { which = th_danmaku_default_magical_crit_roll_needed	which = PREV }
			set_variable = { which = th_danmaku_default_psionic_attack_bonus		which = PREV }
			set_variable = { which = th_danmaku_default_psionic_attack_die			which = PREV }
			set_variable = { which = th_danmaku_default_psionic_attack_die_num		which = PREV }
			set_variable = { which = th_danmaku_default_psionic_crit_roll_needed	which = PREV }
			set_variable = { which = th_danmaku_default_crit_roll_damage_multipler	which = PREV }

			set_variable = { which = th_danmaku_default_physical_damage_modifier		which = PREV }
			set_variable = { which = th_danmaku_default_magical_damage_modifier			which = PREV }
			set_variable = { which = th_danmaku_default_psionic_damage_modifier			which = PREV }
			set_variable = { which = th_danmaku_default_bludgeoning_damage_modifier		which = PREV }
			set_variable = { which = th_danmaku_default_piercing_damage_modifier		which = PREV }
			set_variable = { which = th_danmaku_default_slashing_damage_modifier		which = PREV }
			set_variable = { which = th_danmaku_default_fire_damage_modifier			which = PREV }
			set_variable = { which = th_danmaku_default_frost_damage_modifier			which = PREV }
			set_variable = { which = th_danmaku_default_earth_damage_modifier			which = PREV }
			set_variable = { which = th_danmaku_default_lightning_damage_modifier		which = PREV }
			set_variable = { which = th_danmaku_default_nature_damage_modifier			which = PREV }
			set_variable = { which = th_danmaku_default_holy_damage_modifier			which = PREV }
			set_variable = { which = th_danmaku_default_shadow_damage_modifier			which = PREV }
			set_variable = { which = th_danmaku_default_necrotic_damage_modifier		which = PREV }
			set_variable = { which = th_danmaku_default_arcane_damage_modifier			which = PREV }
			set_variable = { which = th_danmaku_default_infernal_damage_modifier		which = PREV }
			set_variable = { which = th_danmaku_default_physical_resistance				which = PREV }
			set_variable = { which = th_danmaku_default_magical_resistance				which = PREV }
			set_variable = { which = th_danmaku_default_psionic_resistance				which = PREV }
			set_variable = { which = th_danmaku_default_bludgeoning_resistance			which = PREV }
			set_variable = { which = th_danmaku_default_piercing_resistance				which = PREV }
			set_variable = { which = th_danmaku_default_slashing_resistance				which = PREV }
			set_variable = { which = th_danmaku_default_fire_resistance					which = PREV }
			set_variable = { which = th_danmaku_default_frost_resistance				which = PREV }
			set_variable = { which = th_danmaku_default_earth_resistance				which = PREV }
			set_variable = { which = th_danmaku_default_lightning_resistance			which = PREV }
			set_variable = { which = th_danmaku_default_nature_resistance				which = PREV }
			set_variable = { which = th_danmaku_default_holy_resistance					which = PREV }
			set_variable = { which = th_danmaku_default_shadow_resistance				which = PREV }
			set_variable = { which = th_danmaku_default_necrotic_resistance				which = PREV }
			set_variable = { which = th_danmaku_default_arcane_resistance				which = PREV }
			set_variable = { which = th_danmaku_default_infernal_resistance				which = PREV }

			set_variable = { which = th_danmaku_default_healing_die						which = PREV }
			set_variable = { which = th_danmaku_default_healing_die_num					which = PREV }
			set_variable = { which = th_danmaku_default_healing_crit_roll_needed		which = PREV }
			set_variable = { which = th_danmaku_default_healing_received_bonus			which = PREV }
			set_variable = { which = th_danmaku_default_healing_received_modifier		which = PREV }
			set_variable = { which = th_danmaku_default_armor_class						which = PREV }
			set_variable = { which = th_danmaku_default_saving_throw_die				which = PREV }
			set_variable = { which = th_danmaku_default_resistance						which = PREV }

			set_variable = { which = th_danmaku_default_start_level						which = PREV }
			set_variable = { which = th_danmaku_default_attack_type 					which = PREV }
			set_variable = { which = th_danmaku_default_attack_school 					which = PREV }

			#Attributes
			set_variable = { which = th_danmaku_default_attribute_constitution			which = PREV }
			set_variable = { which = th_danmaku_default_attribute_spirit				which = PREV }
			set_variable = { which = th_danmaku_default_attribute_martial				which = PREV }
			set_variable = { which = th_danmaku_default_attribute_spell_power			which = PREV }
			set_variable = { which = th_danmaku_default_attribute_psi					which = PREV }
			set_variable = { which = th_danmaku_default_attribute_agility				which = PREV }
			set_variable = { which = th_danmaku_default_attribute_speed					which = PREV }
			set_variable = { which = th_danmaku_default_attribute_durability			which = PREV }

			#Conversion rates
			set_variable = { which = th_danmaku_default_constitution_per_level			which = PREV }
			set_variable = { which = th_danmaku_default_spirit_per_level				which = PREV }
			set_variable = { which = th_danmaku_default_martial_per_level				which = PREV }
			set_variable = { which = th_danmaku_default_spell_power_per_level			which = PREV }
			set_variable = { which = th_danmaku_default_psi_per_level					which = PREV }
			set_variable = { which = th_danmaku_default_agility_per_level				which = PREV }
			set_variable = { which = th_danmaku_default_speed_per_level					which = PREV }
			set_variable = { which = th_danmaku_default_durability_per_level			which = PREV }
			set_variable = { which = th_danmaku_default_hp_per_constitution				which = PREV }
			set_variable = { which = th_danmaku_default_hpm_per_constitution			which = PREV }
			set_variable = { which = th_danmaku_default_mp_per_spirit					which = PREV }
			set_variable = { which = th_danmaku_default_mpm_per_spirit					which = PREV }
			set_variable = { which = th_danmaku_default_physical_attack_bonus_per_stat	which = PREV }
			set_variable = { which = th_danmaku_default_magical_attack_bonus_per_stat	which = PREV }
			set_variable = { which = th_danmaku_default_psionic_attack_bonus_per_stat	which = PREV }
			set_variable = { which = th_danmaku_default_armor_per_agility				which = PREV }
			set_variable = { which = th_danmaku_default_initiative_per_agility			which = PREV }
			set_variable = { which = th_danmaku_default_ap_per_speed					which = PREV }
			set_variable = { which = th_danmaku_default_resistance_per_durability		which = PREV }
			set_variable = { which = th_danmaku_default_resilience_per_durability		which = PREV }

			set_variable = { which = th_enemy_character_max_health								which = th_danmaku_default_max_health				}
			set_variable = { which = th_enemy_character_max_mana								which = th_danmaku_default_max_mana					}
			set_variable = { which = th_enemy_character_max_action_points						which = th_danmaku_default_max_action_points		}
			set_variable = { which = th_enemy_character_initiative_bonus						which = th_danmaku_default_ini_bonus				}
			set_variable = { which = th_enemy_character_hit_bonus								which = th_danmaku_default_hit_bonus				}

			set_variable = { which = th_enemy_character_physical_attack_bonus				which = th_danmaku_default_physical_attack_bonus		}
			set_variable = { which = th_enemy_character_physical_attack_die					which = th_danmaku_default_physical_attack_die			}
			set_variable = { which = th_enemy_character_physical_attack_die_num				which = th_danmaku_default_physical_attack_die_num		}
			set_variable = { which = th_enemy_character_physical_crit_roll_needed			which = th_danmaku_default_physical_crit_roll_needed	}
			set_variable = { which = th_enemy_character_physical_crit_roll_multiplier		which = th_danmaku_default_crit_roll_damage_multipler	}
			set_variable = { which = th_enemy_character_magical_attack_bonus				which = th_danmaku_default_magical_attack_bonus		}
			set_variable = { which = th_enemy_character_magical_attack_die					which = th_danmaku_default_magical_attack_die			}
			set_variable = { which = th_enemy_character_magical_attack_die_num				which = th_danmaku_default_magical_attack_die_num		}
			set_variable = { which = th_enemy_character_magical_crit_roll_needed			which = th_danmaku_default_magical_crit_roll_needed	}
			set_variable = { which = th_enemy_character_magical_crit_roll_multiplier		which = th_danmaku_default_crit_roll_damage_multipler	}
			set_variable = { which = th_enemy_character_psionic_attack_bonus				which = th_danmaku_default_psionic_attack_bonus		}
			set_variable = { which = th_enemy_character_psionic_attack_die					which = th_danmaku_default_psionic_attack_die			}
			set_variable = { which = th_enemy_character_psionic_attack_die_num				which = th_danmaku_default_psionic_attack_die_num		}
			set_variable = { which = th_enemy_character_psionic_crit_roll_needed			which = th_danmaku_default_psionic_crit_roll_needed	}
			set_variable = { which = th_enemy_character_psionic_crit_roll_multiplier		which = th_danmaku_default_crit_roll_damage_multipler	}

			set_variable = { which = th_enemy_character_physical_damage_modifier				which = th_danmaku_default_physical_damage_modifier	}
			set_variable = { which = th_enemy_character_magical_damage_modifier					which = th_danmaku_default_magical_damage_modifier		}
			set_variable = { which = th_enemy_character_psionic_damage_modifier					which = th_danmaku_default_psionic_damage_modifier		}
			set_variable = { which = th_enemy_character_bludgeoning_damage_modifier				which = th_danmaku_default_bludgeoning_damage_modifier	}
			set_variable = { which = th_enemy_character_piercing_damage_modifier				which = th_danmaku_default_piercing_damage_modifier	}
			set_variable = { which = th_enemy_character_slashing_damage_modifier				which = th_danmaku_default_slashing_damage_modifier	}
			set_variable = { which = th_enemy_character_fire_damage_modifier					which = th_danmaku_default_fire_damage_modifier		}
			set_variable = { which = th_enemy_character_frost_damage_modifier					which = th_danmaku_default_frost_damage_modifier		}
			set_variable = { which = th_enemy_character_earth_damage_modifier					which = th_danmaku_default_earth_damage_modifier		}
			set_variable = { which = th_enemy_character_lightning_damage_modifier				which = th_danmaku_default_lightning_damage_modifier	}
			set_variable = { which = th_enemy_character_nature_damage_modifier					which = th_danmaku_default_nature_damage_modifier		}
			set_variable = { which = th_enemy_character_holy_damage_modifier					which = th_danmaku_default_holy_damage_modifier		}
			set_variable = { which = th_enemy_character_shadow_damage_modifier					which = th_danmaku_default_shadow_damage_modifier		}
			set_variable = { which = th_enemy_character_necrotic_damage_modifier				which = th_danmaku_default_necrotic_damage_modifier	}
			set_variable = { which = th_enemy_character_arcane_damage_modifier					which = th_danmaku_default_arcane_damage_modifier		}
			set_variable = { which = th_enemy_character_infernal_damage_modifier				which = th_danmaku_default_infernal_damage_modifier	}
			set_variable = { which = th_enemy_character_physical_resistance						which = th_danmaku_default_physical_resistance			}
			set_variable = { which = th_enemy_character_magical_resistance						which = th_danmaku_default_magical_resistance			}
			set_variable = { which = th_enemy_character_psionic_resistance						which = th_danmaku_default_psionic_resistance			}
			set_variable = { which = th_enemy_character_bludgeoning_resistance					which = th_danmaku_default_bludgeoning_resistance		}
			set_variable = { which = th_enemy_character_piercing_resistance						which = th_danmaku_default_piercing_resistance			}
			set_variable = { which = th_enemy_character_slashing_resistance						which = th_danmaku_default_slashing_resistance			}
			set_variable = { which = th_enemy_character_fire_resistance							which = th_danmaku_default_fire_resistance				}
			set_variable = { which = th_enemy_character_frost_resistance						which = th_danmaku_default_frost_resistance			}
			set_variable = { which = th_enemy_character_earth_resistance						which = th_danmaku_default_earth_resistance			}
			set_variable = { which = th_enemy_character_lightning_resistance					which = th_danmaku_default_lightning_resistance		}
			set_variable = { which = th_enemy_character_nature_resistance						which = th_danmaku_default_nature_resistance			}
			set_variable = { which = th_enemy_character_holy_resistance							which = th_danmaku_default_holy_resistance				}
			set_variable = { which = th_enemy_character_shadow_resistance						which = th_danmaku_default_shadow_resistance			}
			set_variable = { which = th_enemy_character_necrotic_resistance						which = th_danmaku_default_necrotic_resistance			}
			set_variable = { which = th_enemy_character_arcane_resistance						which = th_danmaku_default_arcane_resistance			}
			set_variable = { which = th_enemy_character_infernal_resistance						which = th_danmaku_default_infernal_resistance			}

			set_variable = { which = th_enemy_character_healing_die								which = th_danmaku_default_healing_die					}
			set_variable = { which = th_enemy_character_healing_die_num							which = th_danmaku_default_healing_die_num				}
			set_variable = { which = th_enemy_character_healing_crit_roll_needed				which = th_danmaku_default_healing_crit_roll_needed	}
			set_variable = { which = th_enemy_character_healing_received_bonus					which = th_danmaku_default_healing_received_bonus		}
			set_variable = { which = th_enemy_character_healing_received_modifier				which = th_danmaku_default_healing_received_modifier	}
			set_variable = { which = th_enemy_character_saving_throw_die						which = th_danmaku_default_armor_class					}
			set_variable = { which = th_enemy_character_armor_class								which = th_danmaku_default_saving_throw_die			}
			set_variable = { which = th_enemy_character_resistance								which = th_danmaku_default_resistance					}

			#Attributes
			set_variable = { which = th_enemy_character_attribute_constitution			which = th_danmaku_default_attribute_constitution }
			set_variable = { which = th_enemy_character_attribute_spirit				which = th_danmaku_default_attribute_spirit }
			set_variable = { which = th_enemy_character_attribute_martial				which = th_danmaku_default_attribute_martial }
			set_variable = { which = th_enemy_character_attribute_spell_power			which = th_danmaku_default_attribute_spell_power }
			set_variable = { which = th_enemy_character_attribute_psi					which = th_danmaku_default_attribute_psi }
			set_variable = { which = th_enemy_character_attribute_agility				which = th_danmaku_default_attribute_agility }
			set_variable = { which = th_enemy_character_attribute_speed					which = th_danmaku_default_attribute_speed }
			set_variable = { which = th_enemy_character_attribute_durability			which = th_danmaku_default_attribute_durability }

			#Conversion rates
			set_variable = { which = th_enemy_character_constitution_per_level			which = th_danmaku_default_constitution_per_level }
			set_variable = { which = th_enemy_character_spirit_per_level				which = th_danmaku_default_spirit_per_level }
			set_variable = { which = th_enemy_character_martial_per_level				which = th_danmaku_default_martial_per_level }
			set_variable = { which = th_enemy_character_spell_power_per_level			which = th_danmaku_default_spell_power_per_level }
			set_variable = { which = th_enemy_character_psi_per_level					which = th_danmaku_default_psi_per_level }
			set_variable = { which = th_enemy_character_agility_per_level				which = th_danmaku_default_agility_per_level }
			set_variable = { which = th_enemy_character_speed_per_level					which = th_danmaku_default_speed_per_level }
			set_variable = { which = th_enemy_character_durability_per_level			which = th_danmaku_default_durability_per_level }
			set_variable = { which = th_enemy_character_hp_per_constitution				which = th_danmaku_default_hp_per_constitution }
			set_variable = { which = th_enemy_character_hpm_per_constitution			which = th_danmaku_default_hpm_per_constitution }
			set_variable = { which = th_enemy_character_mp_per_spirit					which = th_danmaku_default_mp_per_spirit }
			set_variable = { which = th_enemy_character_mpm_per_spirit					which = th_danmaku_default_mpm_per_spirit }
			set_variable = { which = th_enemy_character_physical_attack_bonus_per_stat	which = th_danmaku_default_physical_attack_bonus_per_stat }
			set_variable = { which = th_enemy_character_magical_attack_bonus_per_stat	which = th_danmaku_default_magical_attack_bonus_per_stat }
			set_variable = { which = th_enemy_character_psionic_attack_bonus_per_stat	which = th_danmaku_default_psionic_attack_bonus_per_stat }
			set_variable = { which = th_enemy_character_armor_per_agility				which = th_danmaku_default_armor_per_agility }
			set_variable = { which = th_enemy_character_initiative_per_agility			which = th_danmaku_default_initiative_per_agility }
			set_variable = { which = th_enemy_character_ap_per_speed					which = th_danmaku_default_ap_per_speed }
			set_variable = { which = th_enemy_character_resistance_per_durability		which = th_danmaku_default_resistance_per_durability }
			set_variable = { which = th_enemy_character_resilience_per_durability		which = th_danmaku_default_resilience_per_durability }

			set_variable = { which = th_enemy_character_level							which = th_danmaku_default_start_level					}
			set_variable = { which = th_enemy_character_damage_type 					which = th_danmaku_default_attack_type 					}
			set_variable = { which = th_enemy_character_damage_school 					which = th_danmaku_default_attack_school 				}
		}
	}
}


################################################
# ABILITY DEFINITOINS                          #
################################################
th_use_ability_attack = {
	th_change_combat_resource_ability = { ability = attack type = action_points value = -30 }
	th_perform_attack = {
		ability = attack
	}
	th_create_ability_combat_log = {
		type = current_recipient
		verb = attacks
		article = NULL
		ability = NULL
		preposition = NULL
		ability_effect = dealing
		number_impact = yes
		is_damage = yes
		is_health = NULL
		is_mana = NULL
		is_action_points = NULL
		hit_roll = yes
		ability_roll = yes
	}
}

th_use_ability_magic_bolt = {
	th_change_combat_resource_ability = { ability = magic_bolt type = action_points value = -30 }
	th_change_combat_resource_ability = { ability = magic_bolt type = mana value = -5 }
	th_perform_attack = {
		ability = magic_bolt
		override_damage_type = magical
		override_damage_school = arcane
		override_damage_die = 12
		override_damage_die_amount = 2
		override_damage_flat_bonus = 6
	}
	th_create_ability_combat_log = {
		type = current_recipient
		verb = casts
		article = NULL
		ability = magic_bolt
		preposition = against
		ability_effect = dealing
		number_impact = yes
		is_damage = yes
		is_health = NULL
		is_mana = NULL
		is_action_points = NULL
		hit_roll = yes
		ability_roll = yes
	}
}

th_use_ability_lesser_heal = {
	th_change_combat_resource_ability = { ability = lesser_heal type = action_points value = -30 }
	th_change_combat_resource_ability = { ability = lesser_heal type = mana value = -20 }
	th_heal = {
		heal_die = 6
		heal_die_amount = 2
	}
	th_create_ability_combat_log = {
		type = self
		verb = casts
		article = NULL
		ability = lesser_heal
		preposition = on
		ability_effect = healing
		number_impact = yes
		is_damage = NULL
		is_health = yes
		is_mana = NULL
		is_action_points = NULL
		hit_roll = NULL
		ability_roll = yes
	}
}