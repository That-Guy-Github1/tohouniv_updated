th_log_cleanup_action = {
	set_variable = { which = th_danmaku_duel_action_$action$_value 							value = 0 }
	set_variable = { which = th_danmaku_duel_action_$action$_hit_die						value = 0 }
	set_variable = { which = th_danmaku_duel_action_$action$_hit_die_amount					value = 0 }
	set_variable = { which = th_danmaku_duel_action_$action$_hit_die_result					value = 0 }
	set_variable = { which = th_danmaku_duel_action_$action$_enemy_ac						value = 0 }
	set_variable = { which = th_danmaku_duel_action_$action$_hit_die_flat_bonus				value = 0 }
	set_variable = { which = th_danmaku_duel_action_$action$_hit_die_bonus_per_roll			value = 0 }
	set_variable = { which = th_danmaku_duel_action_$action$_attack_die				 		value = 0 }
	set_variable = { which = th_danmaku_duel_action_$action$_attack_die_amount				value = 0 }
	set_variable = { which = th_danmaku_duel_action_$action$_attack_die_result				value = 0 }
	set_variable = { which = th_danmaku_duel_action_$action$_attack_die_bonus_per_roll		value = 0 }
	set_variable = { which = th_danmaku_duel_action_$action$_attack_die_flat_bonus			value = 0 }
	set_variable = { which = th_danmaku_duel_action_$action$_resistance_reduction			value = 0 }
	set_variable = { which = th_danmaku_duel_action_$action$_type_resistance_reduction		value = 0 }
	set_variable = { which = th_danmaku_duel_action_$action$_school_resistance_reduction	value = 0 }
	set_variable = { which = th_danmaku_duel_action_$action$_critical_damage_bonus			value = 0 }
	set_variable = { which = th_danmaku_duel_action_$action$_damage_type_multiplicator		value = 0 }
	set_variable = { which = th_danmaku_duel_action_$action$_damage_school_multiplicator	value = 0 }
	set_variable = { which = th_danmaku_duel_action_$action$_damage_type					value = 0 }
	set_variable = { which = th_danmaku_duel_action_$action$_damage_school					value = 0 }

	#Former country flags, now as variables
	set_variable = { which = th_danmaku_duel_action_$action$_actor 							value = 0 }
	set_variable = { which = th_danmaku_duel_action_$action$_recipient						value = 0 }
	th_log_ability_verb = { action = $action$ 												verb = NULL }
	th_log_ability_article = { action = $action$											article = NULL }
	th_log_ability_name = { action = $action$												ability = NULL }
	th_log_ability_preposition = { action = $action$										preposition = NULL }
	th_log_ability_effect = { action = $action$												ability_effect = NULL }
	th_log_ability_number_impact = { action = $action$										number_impact = NULL }
	th_log_ability_is_damage = { action = $action$											is_damage = NULL }
	th_log_ability_is_health = { action = $action$											is_health = NULL }
	th_log_ability_is_mana = { action = $action$											is_mana = NULL }
	th_log_ability_is_action_points = { action = $action$									is_action_points = NULL }
	th_log_ability_is_critical = { action = $action$										is_critical = NULL }
	th_log_ability_is_miss = { action = $action$											is_miss = NULL }
	th_log_ability_hit_roll = { action = $action$											hit_roll = NULL }
	th_log_ability_roll = { action = $action$												ability_roll = NULL }
}

th_cleanup_leftover_variables = {
	set_variable = { which = th_danmaku_duel_logged_actions value = 0 }
	th_log_cleanup_action = { action = 1 }
	th_log_cleanup_action = { action = 2 }
	th_log_cleanup_action = { action = 3 }
	th_log_cleanup_action = { action = 4 }
	th_log_cleanup_action = { action = 5 }
	th_log_cleanup_action = { action = 6 }
	th_log_cleanup_action = { action = 7 }
	th_log_cleanup_action = { action = 8 }
	th_log_cleanup_action = { action = 9 }
	th_log_cleanup_action = { action = 10 }
}

th_log_transfer_action = {
	set_variable = { which = th_danmaku_duel_action_$past_action$_value 						which = th_danmaku_duel_action_$action$_value }
	set_variable = { which = th_danmaku_duel_action_$past_action$_hit_die						which = th_danmaku_duel_action_$action$_hit_die }
	set_variable = { which = th_danmaku_duel_action_$past_action$_hit_die_amount				which = th_danmaku_duel_action_$action$_hit_die_amount }
	set_variable = { which = th_danmaku_duel_action_$past_action$_hit_die_result				which = th_danmaku_duel_action_$action$_hit_die_result }
	set_variable = { which = th_danmaku_duel_action_$past_action$_enemy_ac						which = th_danmaku_duel_action_$action$_enemy_ac }
	set_variable = { which = th_danmaku_duel_action_$past_action$_hit_die_flat_bonus			which = th_danmaku_duel_action_$action$_hit_die_flat_bonus }
	set_variable = { which = th_danmaku_duel_action_$past_action$_hit_die_bonus_per_roll		which = th_danmaku_duel_action_$action$_hit_die_bonus_per_roll }
	set_variable = { which = th_danmaku_duel_action_$past_action$_attack_die					which = th_danmaku_duel_action_$action$_attack_die }
	set_variable = { which = th_danmaku_duel_action_$past_action$_attack_die_amount				which = th_danmaku_duel_action_$action$_attack_die_amount }
	set_variable = { which = th_danmaku_duel_action_$past_action$_attack_die_result				which = th_danmaku_duel_action_$action$_attack_die_result }
	set_variable = { which = th_danmaku_duel_action_$past_action$_attack_die_bonus_per_roll		which = th_danmaku_duel_action_$action$_attack_die_bonus_per_roll }
	set_variable = { which = th_danmaku_duel_action_$past_action$_attack_die_flat_bonus			which = th_danmaku_duel_action_$action$_attack_die_flat_bonus }
	set_variable = { which = th_danmaku_duel_action_$past_action$_resistance_reduction			which = th_danmaku_duel_action_$action$_resistance_reduction }
	set_variable = { which = th_danmaku_duel_action_$past_action$_type_resistance_reduction		which = th_danmaku_duel_action_$action$_type_resistance_reduction }
	set_variable = { which = th_danmaku_duel_action_$past_action$_school_resistance_reduction	which = th_danmaku_duel_action_$action$_school_resistance_reduction }
	set_variable = { which = th_danmaku_duel_action_$past_action$_critical_damage_bonus			which = th_danmaku_duel_action_$action$_critical_damage_bonus }
	set_variable = { which = th_danmaku_duel_action_$past_action$_damage_type_multiplicator		which = th_danmaku_duel_action_$action$_damage_type_multiplicator }
	set_variable = { which = th_danmaku_duel_action_$past_action$_damage_school_multiplicator	which = th_danmaku_duel_action_$action$_damage_school_multiplicator }
	set_variable = { which = th_danmaku_duel_action_$past_action$_damage_type					which = th_danmaku_duel_action_$action$_damage_type }
	set_variable = { which = th_danmaku_duel_action_$past_action$_damage_school					which = th_danmaku_duel_action_$action$_damage_school }
	set_variable = { which = th_danmaku_duel_action_$past_action$_ability_verb 					which = th_danmaku_duel_action_$action$_ability_verb }
	set_variable = { which = th_danmaku_duel_action_$past_action$_ability_article 				which = th_danmaku_duel_action_$action$_ability_article }
	set_variable = { which = th_danmaku_duel_action_$past_action$_ability_name 					which = th_danmaku_duel_action_$action$_ability_name }
	set_variable = { which = th_danmaku_duel_action_$past_action$_ability_preposition 			which = th_danmaku_duel_action_$action$_ability_preposition }
	set_variable = { which = th_danmaku_duel_action_$past_action$_ability_effect 				which = th_danmaku_duel_action_$action$_ability_effect }
	set_variable = { which = th_danmaku_duel_action_$past_action$_ability_number_impact 		which = th_danmaku_duel_action_$action$_ability_number_impact }
	set_variable = { which = th_danmaku_duel_action_$past_action$_ability_is_damage 			which = th_danmaku_duel_action_$action$_ability_is_damage }
	set_variable = { which = th_danmaku_duel_action_$past_action$_ability_is_health 			which = th_danmaku_duel_action_$action$_ability_is_health }
	set_variable = { which = th_danmaku_duel_action_$past_action$_ability_is_mana 				which = th_danmaku_duel_action_$action$_ability_is_mana }
	set_variable = { which = th_danmaku_duel_action_$past_action$_ability_is_action_points 		which = th_danmaku_duel_action_$action$_ability_is_action_points }
	set_variable = { which = th_danmaku_duel_action_$past_action$_ability_is_critical 			which = th_danmaku_duel_action_$action$_ability_is_critical }
	set_variable = { which = th_danmaku_duel_action_$past_action$_ability_is_miss 				which = th_danmaku_duel_action_$action$_ability_is_miss }
	set_variable = { which = th_danmaku_duel_action_$past_action$_ability_hit_roll 				which = th_danmaku_duel_action_$action$_ability_hit_roll }
	set_variable = { which = th_danmaku_duel_action_$past_action$_ability_roll 					which = th_danmaku_duel_action_$action$_ability_roll }
	set_variable = { which = th_danmaku_duel_action_$past_action$_actor							which = th_danmaku_duel_action_$action$_actor }
	set_variable = { which = th_danmaku_duel_action_$past_action$_recipient						which = th_danmaku_duel_action_$action$_recipient }
	set_variable = { which = th_danmaku_duel_action_$past_action$_ability_article				which = th_danmaku_duel_action_$action$_ability_article }
	set_variable = { which = th_danmaku_duel_action_$past_action$_ability_name					which = th_danmaku_duel_action_$action$_ability_name }
	set_variable = { which = th_danmaku_duel_action_$past_action$_ability_preposition			which = th_danmaku_duel_action_$action$_ability_preposition }
	set_variable = { which = th_danmaku_duel_action_$past_action$_ability_effect				which = th_danmaku_duel_action_$action$_ability_effect }
	set_variable = { which = th_danmaku_duel_action_$past_action$_ability_number_impact			which = th_danmaku_duel_action_$action$_ability_number_impact }
	set_variable = { which = th_danmaku_duel_action_$past_action$_ability_is_damage				which = th_danmaku_duel_action_$action$_ability_is_damage }
	set_variable = { which = th_danmaku_duel_action_$past_action$_ability_is_health				which = th_danmaku_duel_action_$action$_ability_is_health }
	set_variable = { which = th_danmaku_duel_action_$past_action$_ability_is_mana				which = th_danmaku_duel_action_$action$_ability_is_mana }
	set_variable = { which = th_danmaku_duel_action_$past_action$_ability_is_action_points		which = th_danmaku_duel_action_$action$_ability_is_action_points }
	set_variable = { which = th_danmaku_duel_action_$past_action$_ability_is_critical			which = th_danmaku_duel_action_$action$_ability_is_critical }
	set_variable = { which = th_danmaku_duel_action_$past_action$_ability_is_miss				which = th_danmaku_duel_action_$action$_ability_is_miss }
	set_variable = { which = th_danmaku_duel_action_$past_action$_ability_hit_roll				which = th_danmaku_duel_action_$action$_ability_hit_roll }
	set_variable = { which = th_danmaku_duel_action_$past_action$_ability_roll					which = th_danmaku_duel_action_$action$_ability_roll }
}

# total_value = the end result of damage / healing
# hit_die = die used to hit the target
# hit_die_amount = amount of hit die used
# hit_die_result = the result from rolling hit_die_amount d hit_die
# enemy_ac = the ac at the moment of the die roll happening
# hit_die_flat_bonus = amount of flat bonus added to the hit die after all the die were rolled
# hit_die_bonus_per_roll = amount of bonus added atop of each hit die
# attack_die
# attack_die_amount
# attack_die_result
# attack_die_bonus_per_roll
# attack_die_flat_bonus
# resistance_reduction = amount of damage resisted
# type_resistance_reduction
# school_resistance_reduction
# critical_damage_bonus
# damage_type_multiplicator
# damage_school_multiplicator
th_log_memorize_value = {
	set_variable = {
		which = th_danmaku_effect_$type$
		which = $variable$
	}
}

th_log_memorize_type_damage_type_physical = {		set_variable = { which = th_danmaku_effect_damage_type value = 0 } }
th_log_memorize_type_damage_type_magical = {		set_variable = { which = th_danmaku_effect_damage_type value = 1 } }
th_log_memorize_type_damage_type_psionic = {		set_variable = { which = th_danmaku_effect_damage_type value = 2 } }
th_log_memorize_type_damage_school_bludgeoning = { 	set_variable = { which = th_danmaku_effect_damage_school value = 0 } }
th_log_memorize_type_damage_school_piercing = { 	set_variable = { which = th_danmaku_effect_damage_school value = 1 } }
th_log_memorize_type_damage_school_slashing = { 	set_variable = { which = th_danmaku_effect_damage_school value = 2 } }
th_log_memorize_type_damage_school_fire = { 		set_variable = { which = th_danmaku_effect_damage_school value = 3 } }
th_log_memorize_type_damage_school_frost = { 		set_variable = { which = th_danmaku_effect_damage_school value = 4 } }
th_log_memorize_type_damage_school_earth = { 		set_variable = { which = th_danmaku_effect_damage_school value = 5 } }
th_log_memorize_type_damage_school_lightning = { 	set_variable = { which = th_danmaku_effect_damage_school value = 6 } }
th_log_memorize_type_damage_school_nature = { 		set_variable = { which = th_danmaku_effect_damage_school value = 7 } }
th_log_memorize_type_damage_school_holy = { 		set_variable = { which = th_danmaku_effect_damage_school value = 8 } }
th_log_memorize_type_damage_school_shadow = { 		set_variable = { which = th_danmaku_effect_damage_school value = 9 } }
th_log_memorize_type_damage_school_necrotic = { 	set_variable = { which = th_danmaku_effect_damage_school value = 10 } }
th_log_memorize_type_damage_school_arcane = { 		set_variable = { which = th_danmaku_effect_damage_school value = 11 } }
th_log_memorize_type_damage_school_infernal = { 	set_variable = { which = th_danmaku_effect_damage_school value = 12 } }
th_log_memorize_type = {
	th_log_memorize_type_$type$ = yes
}

th_log_ability_verb_NULL = {		set_variable = { which = th_danmaku_duel_action_$action$_ability_verb		value = 0 }	}
th_log_ability_verb_uses = {		set_variable = { which = th_danmaku_duel_action_$action$_ability_verb		value = 1 }	}
th_log_ability_verb_performs = {	set_variable = { which = th_danmaku_duel_action_$action$_ability_verb		value = 2 }	}
th_log_ability_verb_casts = {		set_variable = { which = th_danmaku_duel_action_$action$_ability_verb		value = 3 }	}
th_log_ability_verb_enchants = {	set_variable = { which = th_danmaku_duel_action_$action$_ability_verb		value = 4 }	}
th_log_ability_verb_curses = {		set_variable = { which = th_danmaku_duel_action_$action$_ability_verb		value = 5 }	}
th_log_ability_verb_strikes = {		set_variable = { which = th_danmaku_duel_action_$action$_ability_verb		value = 6 }	}
th_log_ability_verb_shoots = {		set_variable = { which = th_danmaku_duel_action_$action$_ability_verb		value = 7 }	}
th_log_ability_verb_attacks = {		set_variable = { which = th_danmaku_duel_action_$action$_ability_verb		value = 8 }	}
th_log_ability_verb = {
	th_log_ability_verb_$verb$ = { action = $action$ }
}

th_log_ability_article_NULL = {			set_variable = { which = th_danmaku_duel_action_$action$_ability_article		value = 0 }	}
th_log_ability_article_undefined = {	set_variable = { which = th_danmaku_duel_action_$action$_ability_article		value = 1 }	}
th_log_ability_article_defined = {		set_variable = { which = th_danmaku_duel_action_$action$_ability_article		value = 2 }	}
th_log_ability_article = {
	th_log_ability_article_$article$ = { action = $action$ }
}

th_log_ability_name_NULL = {	set_variable = { which = th_danmaku_duel_action_$action$_ability_name		value = 0 }	}
th_log_ability_name_attack = {	set_variable = { which = th_danmaku_duel_action_$action$_ability_name		value = 1 }	}
th_log_ability_name_magic_bolt = {	set_variable = { which = th_danmaku_duel_action_$action$_ability_name		value = 2 }	}
th_log_ability_name = {
	th_log_ability_name_$ability$ = { action = $action$ }
}

th_log_ability_preposition_NULL = {		set_variable = { which = th_danmaku_duel_action_$action$_ability_preposition		value = 0 }	}
th_log_ability_preposition_against = {	set_variable = { which = th_danmaku_duel_action_$action$_ability_preposition		value = 1 }	}
th_log_ability_preposition_on = {		set_variable = { which = th_danmaku_duel_action_$action$_ability_preposition		value = 2 }	}
th_log_ability_preposition = {
	th_log_ability_preposition_$preposition$ = { action = $action$ }
}

th_log_ability_effect_NULL = {					set_variable = { which = th_danmaku_duel_action_$action$_ability_effect		value = 0 }	}
th_log_ability_effect_miss = {					set_variable = { which = th_danmaku_duel_action_$action$_ability_effect		value = 1 }	}
th_log_ability_effect_dealing = {				set_variable = { which = th_danmaku_duel_action_$action$_ability_effect		value = 2 }	}
th_log_ability_effect_healing = {				set_variable = { which = th_danmaku_duel_action_$action$_ability_effect		value = 3 }	}
th_log_ability_effect_restore = {				set_variable = { which = th_danmaku_duel_action_$action$_ability_effect		value = 4 }	}
th_log_ability_effect_afflicting_condition = {	set_variable = { which = th_danmaku_duel_action_$action$_ability_effect		value = 5 }	}
th_log_ability_effect_gaining_condition = {		set_variable = { which = th_danmaku_duel_action_$action$_ability_effect		value = 6 }	}
th_log_ability_effect = {
	th_log_ability_effect_$ability_effect$ = { action = $action$ }
}

th_log_ability_number_impact_NULL = {	set_variable = { which = th_danmaku_duel_action_$action$_ability_number_impact		value = 0 }	}
th_log_ability_number_impact_yes = {	set_variable = { which = th_danmaku_duel_action_$action$_ability_number_impact		value = 1 }	}
th_log_ability_number_impact = {
	th_log_ability_number_impact_$number_impact$ = { action = $action$ }
}

th_log_ability_is_damage_NULL = {	set_variable = { which = th_danmaku_duel_action_$action$_ability_is_damage		value = 0 }	}
th_log_ability_is_damage_yes = {	set_variable = { which = th_danmaku_duel_action_$action$_ability_is_damage		value = 1 }	}
th_log_ability_is_damage = {
	th_log_ability_is_damage_$is_damage$ = { action = $action$ }
}

th_log_ability_is_health_NULL = {	set_variable = { which = th_danmaku_duel_action_$action$_ability_is_health		value = 0 }	}
th_log_ability_is_health_yes = {	set_variable = { which = th_danmaku_duel_action_$action$_ability_is_health		value = 1 }	}
th_log_ability_is_health = {
	th_log_ability_is_health_$is_health$ = { action = $action$ }
}

th_log_ability_is_mana_NULL = {	set_variable = { which = th_danmaku_duel_action_$action$_ability_is_mana		value = 0 }	}
th_log_ability_is_mana_yes = {	set_variable = { which = th_danmaku_duel_action_$action$_ability_is_mana		value = 1 }	}
th_log_ability_is_mana = {
	th_log_ability_is_mana_$is_mana$ = { action = $action$ }
}

th_log_ability_is_action_points_NULL = {	set_variable = { which = th_danmaku_duel_action_$action$_ability_is_action_points		value = 0 }	}
th_log_ability_is_action_points_yes = {		set_variable = { which = th_danmaku_duel_action_$action$_ability_is_action_points		value = 1 }	}
th_log_ability_is_action_points = {
	th_log_ability_is_action_points_$is_action_points$ = { action = $action$ }
}

th_log_ability_is_critical_NULL = {	set_variable = { which = th_danmaku_duel_action_$action$_ability_is_critical		value = 0 }	}
th_log_ability_is_critical_yes = {	set_variable = { which = th_danmaku_duel_action_$action$_ability_is_critical		value = 1 }	}
th_log_ability_is_critical = {
	th_log_ability_is_critical_$is_critical$ = { action = $action$ }
}

th_log_ability_is_miss_NULL = {	set_variable = { which = th_danmaku_duel_action_$action$_ability_is_miss		value = 0 }	}
th_log_ability_is_miss_yes = {	set_variable = { which = th_danmaku_duel_action_$action$_ability_is_miss		value = 1 }	}
th_log_ability_is_miss = {
	th_log_ability_is_miss_$is_miss$ = { action = $action$ }
}

th_log_ability_hit_roll_NULL = {	set_variable = { which = th_danmaku_duel_action_$action$_ability_hit_roll		value = 0 }	}
th_log_ability_hit_roll_yes = {		set_variable = { which = th_danmaku_duel_action_$action$_ability_hit_roll		value = 1 }	}
th_log_ability_hit_roll = {
	th_log_ability_hit_roll_$hit_roll$ = { action = $action$ }
}

th_log_ability_roll_NULL = {	set_variable = { which = th_danmaku_duel_action_$action$_ability_roll		value = 0 }	}
th_log_ability_roll_yes = {		set_variable = { which = th_danmaku_duel_action_$action$_ability_roll		value = 1 }	}
th_log_ability_roll = {
	th_log_ability_roll_$ability_roll$ = { action = $action$ }
}

th_create_log = {
	if = {
		limit = { NOT = { check_variable = { which = th_danmaku_duel_logged_actions value = 10 } } }
		change_variable = { which = th_danmaku_duel_logged_actions value = 1 }
	}
	th_log_cleanup_action = { action = 10 }
	th_log_transfer_action = { action = 9 past_action = 10 }
	th_log_transfer_action = { action = 8 past_action = 9 }
	th_log_transfer_action = { action = 7 past_action = 8 }
	th_log_transfer_action = { action = 6 past_action = 7 }
	th_log_transfer_action = { action = 5 past_action = 6 }
	th_log_transfer_action = { action = 4 past_action = 5 }
	th_log_transfer_action = { action = 3 past_action = 4 }
	th_log_transfer_action = { action = 2 past_action = 3 }
	th_log_transfer_action = { action = 1 past_action = 2 }
	set_variable = { which = th_danmaku_duel_action_1_value 						which = th_danmaku_effect_total_value }
	set_variable = { which = th_danmaku_duel_action_1_hit_die						which = th_danmaku_effect_hit_die }
	set_variable = { which = th_danmaku_duel_action_1_hit_die_amount				which = th_danmaku_effect_hit_die_amount }
	set_variable = { which = th_danmaku_duel_action_1_hit_die_result				which = th_danmaku_effect_hit_die_result }
	set_variable = { which = th_danmaku_duel_action_1_enemy_ac						which = th_danmaku_effect_enemy_ac }
	set_variable = { which = th_danmaku_duel_action_1_hit_die_flat_bonus			which = th_danmaku_effect_hit_die_flat_bonus }
	set_variable = { which = th_danmaku_duel_action_1_hit_die_bonus_per_roll		which = th_danmaku_effect_hit_die_bonus_per_roll }
	set_variable = { which = th_danmaku_duel_action_1_attack_die					which = th_danmaku_effect_attack_die }
	set_variable = { which = th_danmaku_duel_action_1_attack_die_amount				which = th_danmaku_effect_attack_die_amount }
	set_variable = { which = th_danmaku_duel_action_1_attack_die_result				which = th_danmaku_effect_attack_die_result }
	set_variable = { which = th_danmaku_duel_action_1_attack_die_bonus_per_roll		which = th_danmaku_effect_attack_die_bonus_per_roll }
	set_variable = { which = th_danmaku_duel_action_1_attack_die_flat_bonus			which = th_danmaku_effect_attack_die_flat_bonus }
	set_variable = { which = th_danmaku_duel_action_1_resistance_reduction			which = th_danmaku_effect_resistance_reduction }
	set_variable = { which = th_danmaku_duel_action_1_type_resistance_reduction		which = th_danmaku_effect_type_resistance_reduction }
	set_variable = { which = th_danmaku_duel_action_1_school_resistance_reduction	which = th_danmaku_effect_school_resistance_reduction }
	set_variable = { which = th_danmaku_duel_action_1_critical_damage_bonus			which = th_danmaku_effect_critical_damage_bonus }
	set_variable = { which = th_danmaku_duel_action_1_damage_type_multiplicator		which = th_danmaku_effect_damage_type_multiplicator }
	set_variable = { which = th_danmaku_duel_action_1_damage_school_multiplicator	which = th_danmaku_effect_damage_school_multiplicator }
	set_variable = { which = th_danmaku_duel_action_1_damage_type					which = th_danmaku_effect_damage_type }
	set_variable = { which = th_danmaku_duel_action_1_damage_school					which = th_danmaku_effect_damage_school }
	
	set_variable = { which = th_danmaku_duel_action_1_actor							value = $actor$ }
	set_variable = { which = th_danmaku_duel_action_1_recipient						value = $recipient$ }
	th_log_ability_verb = { action = 1												verb = $verb$ }
	th_log_ability_article = { action = 1											article = $article$ }
	th_log_ability_name = { action = 1												ability = $ability$ }
	th_log_ability_preposition = { action = 1										preposition = $preposition$ }
	th_log_ability_effect = { action = 1											ability_effect = $ability_effect$ }
	th_log_ability_number_impact = { action = 1										number_impact = $number_impact$ }
	th_log_ability_is_damage = { action = 1											is_damage = $is_damage$ }
	th_log_ability_is_health = { action = 1											is_health = $is_health$ }
	th_log_ability_is_mana = { action = 1											is_mana = $is_mana$ }
	th_log_ability_is_action_points = { action = 1									is_action_points = $is_action_points$ }
	th_log_ability_hit_roll = { action = 1											hit_roll = $hit_roll$ }
	th_log_ability_roll = { action = 1												ability_roll = $ability_roll$ }
}

th_log_ability = {
	hidden_effect = {
		#Actor
		th_create_log = {
			actor = $actor$
			recipient = $recipient$
			verb = $verb$
			article = $article$
			ability = $ability$
			preposition = $preposition$
			ability_effect = $ability_effect$
			number_impact = $number_impact$
			is_damage = $is_damage$
			is_health = $is_health$
			is_mana = $is_mana$
			is_action_points = $is_action_points$
			hit_roll = $hit_roll$
			ability_roll = $ability_roll$
		}
		#Recipient
		if = {
			limit = { th_is_not_duelling_an_unlanded_character = yes }
			th_create_event_target_enemy_duelist = yes
			event_target:enemy_duelist = {
				set_variable = { which = th_danmaku_effect_total_value which = PREV }
				set_variable = { which = th_danmaku_effect_hit_die which = PREV }
				set_variable = { which = th_danmaku_effect_hit_die_amount which = PREV }
				set_variable = { which = th_danmaku_effect_hit_die_result which = PREV }
				set_variable = { which = th_danmaku_effect_enemy_ac which = PREV }
				set_variable = { which = th_danmaku_effect_hit_die_flat_bonus which = PREV }
				set_variable = { which = th_danmaku_effect_hit_die_bonus_per_roll which = PREV }
				set_variable = { which = th_danmaku_effect_attack_die which = PREV }
				set_variable = { which = th_danmaku_effect_attack_die_amount which = PREV }
				set_variable = { which = th_danmaku_effect_attack_die_result which = PREV }
				set_variable = { which = th_danmaku_effect_attack_die_bonus_per_roll which = PREV }
				set_variable = { which = th_danmaku_effect_attack_die_flat_bonus which = PREV }
				set_variable = { which = th_danmaku_effect_resistance_reduction which = PREV }
				set_variable = { which = th_danmaku_effect_type_resistance_reduction which = PREV }
				set_variable = { which = th_danmaku_effect_school_resistance_reduction which = PREV }
				set_variable = { which = th_danmaku_effect_critical_damage_bonus which = PREV }
				set_variable = { which = th_danmaku_effect_damage_type_multiplicator which = PREV }
				set_variable = { which = th_danmaku_effect_damage_school_multiplicator which = PREV }
				set_variable = { which = th_danmaku_effect_damage_type which = PREV }
				set_variable = { which = th_danmaku_effect_damage_school which = PREV }
				th_create_log = {
					actor = $actor$
					recipient = $recipient$
					verb = $verb$
					article = $article$
					ability = $ability$
					preposition = $preposition$
					ability_effect = $ability_effect$
					number_impact = $number_impact$
					is_damage = $is_damage$
					is_health = $is_health$
					is_mana = $is_mana$
					is_action_points = $is_action_points$
					hit_roll = $hit_roll$
					ability_roll = $ability_roll$
				}
				if = {
					limit = { PREV = { has_ruler_flag = th_danmaku_rolled_critical_hit } }
					th_log_ability_is_critical = { action = 1 is_critical = yes }
				}
				else = {
					th_log_ability_is_critical = { action = 1 is_critical = NULL }
				}
				if = {
					limit = { PREV = { has_ruler_flag = th_danmaku_duel_missed_attack } }
					th_log_ability_is_miss = { action = 1 is_miss = yes }
					th_log_ability_number_impact = { action = 1 number_impact = NULL }
					th_log_ability_is_damage = { action = 1 is_damage = NULL }
					th_log_ability_roll = { action = 1 ability_roll = NULL }
				}
				else = {
					th_log_ability_is_miss = { action = 1 is_miss = NULL }
					th_log_ability_number_impact = { action = 1 number_impact = yes }
				}
			}
		}
		if = {
			limit = { has_ruler_flag = th_danmaku_rolled_critical_hit }
			clr_ruler_flag = th_danmaku_rolled_critical_hit
			th_log_ability_is_critical = { action = 1 is_critical = yes }
		}
		else = {
			th_log_ability_is_critical = { action = 1 is_critical = NULL }
		}
		if = {
			limit = { has_ruler_flag = th_danmaku_duel_missed_attack }
			clr_ruler_flag = th_danmaku_duel_missed_attack
			th_log_ability_is_miss = { action = 1 is_miss = yes }
			th_log_ability_number_impact = { action = 1 number_impact = NULL }
			th_log_ability_is_damage = { action = 1 is_damage = NULL }
			th_log_ability_roll = { action = 1 ability_roll = NULL }
		}
		else = {
			th_log_ability_is_miss = { action = 1 is_miss = NULL }
			th_log_ability_number_impact = { action = 1 number_impact = yes }
		}
	}
}

th_log_ability_for_current_actor_against_nobody = {
	if = {
		limit = { th_is_duelling_an_unlanded_character = yes }
		if = {
			limit = { th_has_turn_ownership = yes }
			#1 is always the current ruler in a solo duel
			th_log_ability = {
				actor = 1
				recipient = 0
				verb = $verb$
				article = $article$
				ability = $ability$
				preposition = $preposition$
				ability_effect = $ability_effect$
				number_impact = $number_impact$
				is_damage = $is_damage$
				is_health = $is_health$
				is_mana = $is_mana$
				is_action_points = $is_action_points$
				hit_roll = $hit_roll$
				ability_roll = $ability_roll$
			}
		}
		else = {
			th_log_ability = {
				actor = 2
				recipient = 0
				verb = $verb$
				article = $article$
				ability = $ability$
				preposition = $preposition$
				ability_effect = $ability_effect$
				number_impact = $number_impact$
				is_damage = $is_damage$
				is_health = $is_health$
				is_mana = $is_mana$
				is_action_points = $is_action_points$
				hit_roll = $hit_roll$
				ability_roll = $ability_roll$
			}
		}
	}
	else = {
		if = {
			limit = { th_is_country_id_danmaku_duel = { country_id = 1 } }
			th_log_ability = {
				actor = 1
				recipient = 0
				verb = $verb$
				article = $article$
				ability = $ability$
				preposition = $preposition$
				ability_effect = $ability_effect$
				number_impact = $number_impact$
				is_damage = $is_damage$
				is_health = $is_health$
				is_mana = $is_mana$
				is_action_points = $is_action_points$
				hit_roll = $hit_roll$
				ability_roll = $ability_roll$
			}
		}
		else = {
			th_log_ability = {
				actor = 2
				recipient = 0
				verb = $verb$
				article = $article$
				ability = $ability$
				preposition = $preposition$
				ability_effect = $ability_effect$
				number_impact = $number_impact$
				is_damage = $is_damage$
				is_health = $is_health$
				is_mana = $is_mana$
				is_action_points = $is_action_points$
				hit_roll = $hit_roll$
				ability_roll = $ability_roll$
			}
		}
	}
}
th_log_ability_for_current_actor_against_self = {
	if = {
		limit = { th_is_duelling_an_unlanded_character = yes }
		if = {
			limit = { th_has_turn_ownership = yes }
			th_log_ability = {
				actor = 1
				recipient = 1
				verb = $verb$
				article = $article$
				ability = $ability$
				preposition = $preposition$
				ability_effect = $ability_effect$
				number_impact = $number_impact$
				is_damage = $is_damage$
				is_health = $is_health$
				is_mana = $is_mana$
				is_action_points = $is_action_points$
				hit_roll = $hit_roll$
				ability_roll = $ability_roll$
			}
		}
		else = {
			th_log_ability = {
				actor = 2
				recipient = 2
				verb = $verb$
				article = $article$
				ability = $ability$
				preposition = $preposition$
				ability_effect = $ability_effect$
				number_impact = $number_impact$
				is_damage = $is_damage$
				is_health = $is_health$
				is_mana = $is_mana$
				is_action_points = $is_action_points$
				hit_roll = $hit_roll$
				ability_roll = $ability_roll$
			}
		}
	}
	else = {
		if = {
			limit = { th_is_country_id_danmaku_duel = { country_id = 1 } }
			th_log_ability = {
				actor = 1
				recipient = 1
				verb = $verb$
				article = $article$
				ability = $ability$
				preposition = $preposition$
				ability_effect = $ability_effect$
				number_impact = $number_impact$
				is_damage = $is_damage$
				is_health = $is_health$
				is_mana = $is_mana$
				is_action_points = $is_action_points$
				hit_roll = $hit_roll$
				ability_roll = $ability_roll$
			}
		}
		else = {
			th_log_ability = {
				actor = 2
				recipient = 2
				verb = $verb$
				article = $article$
				ability = $ability$
				preposition = $preposition$
				ability_effect = $ability_effect$
				number_impact = $number_impact$
				is_damage = $is_damage$
				is_health = $is_health$
				is_mana = $is_mana$
				is_action_points = $is_action_points$
				hit_roll = $hit_roll$
				ability_roll = $ability_roll$
			}
		}
	}
}
th_log_ability_for_current_actor_against_current_recipient = {
	if = {
		limit = { th_is_duelling_an_unlanded_character = yes }
		if = {
			limit = { th_has_turn_ownership = yes }
			th_log_ability = {
				actor = 1
				recipient = 2
				verb = $verb$
				article = $article$
				ability = $ability$
				preposition = $preposition$
				ability_effect = $ability_effect$
				number_impact = $number_impact$
				is_damage = $is_damage$
				is_health = $is_health$
				is_mana = $is_mana$
				is_action_points = $is_action_points$
				hit_roll = $hit_roll$
				ability_roll = $ability_roll$
			}
		}
		else = {
			th_log_ability = {
				actor = 2
				recipient = 1
				verb = $verb$
				article = $article$
				ability = $ability$
				preposition = $preposition$
				ability_effect = $ability_effect$
				number_impact = $number_impact$
				is_damage = $is_damage$
				is_health = $is_health$
				is_mana = $is_mana$
				is_action_points = $is_action_points$
				hit_roll = $hit_roll$
				ability_roll = $ability_roll$
			}
		}
	}
	else = {
		if = {
			limit = { th_is_country_id_danmaku_duel = { country_id = 1 } }
			th_log_ability = {
				actor = 1
				recipient = 2
				verb = $verb$
				article = $article$
				ability = $ability$
				preposition = $preposition$
				ability_effect = $ability_effect$
				number_impact = $number_impact$
				is_damage = $is_damage$
				is_health = $is_health$
				is_mana = $is_mana$
				is_action_points = $is_action_points$
				hit_roll = $hit_roll$
				ability_roll = $ability_roll$
			}
		}
		else = {
			th_log_ability = {
				actor = 2
				recipient = 1
				verb = $verb$
				article = $article$
				ability = $ability$
				preposition = $preposition$
				ability_effect = $ability_effect$
				number_impact = $number_impact$
				is_damage = $is_damage$
				is_health = $is_health$
				is_mana = $is_mana$
				is_action_points = $is_action_points$
				hit_roll = $hit_roll$
				ability_roll = $ability_roll$
			}
		}
	}
}
th_create_ability_combat_log = {
	th_log_ability_for_current_actor_against_$type$ = {
		verb = $verb$
		article = $article$
		ability = $ability$
		preposition = $preposition$
		ability_effect = $ability_effect$
		number_impact = $number_impact$
		is_damage = $is_damage$
		is_health = $is_health$
		is_mana = $is_mana$
		is_action_points = $is_action_points$
		hit_roll = $hit_roll$
		ability_roll = $ability_roll$
	}
}