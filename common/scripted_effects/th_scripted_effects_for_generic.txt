th_add_random_ruler_personality_republic = {
	random_list = {
		1 = { add_ruler_personality = righteous_personality }
		1 = { add_ruler_personality = just_personality }
		1 = { add_ruler_personality = tolerant_personality }
		1 = { add_ruler_personality = kind_hearted_personality }
		1 = { add_ruler_personality = free_thinker_personality }
		1 = { add_ruler_personality = well_connected_personality }
		1 = { add_ruler_personality = calm_personality }
		1 = { add_ruler_personality = careful_personality }
		1 = { add_ruler_personality = secretive_personality }
		1 = { add_ruler_personality = intricate_web_weaver_personality }
		1 = { add_ruler_personality = well_advised_personality }
		1 = { add_ruler_personality = benevolent_personality }
		1 = { add_ruler_personality = zealot_personality }
		1 = { add_ruler_personality = lawgiver_personality }
		1 = { add_ruler_personality = midas_touched_personality }
		1 = { add_ruler_personality = incorruptible_personality }
		1 = { add_ruler_personality = architectural_visionary_personality }
		1 = { add_ruler_personality = scholar_personality }
		1 = { add_ruler_personality = entrepreneur_personality }
		1 = { add_ruler_personality = industrious_personality }
		1 = { add_ruler_personality = charismatic_negotiator_personality }
		1 = { add_ruler_personality = silver_tongue_personality }
		1 = { add_ruler_personality = conqueror_personality }
		1 = { add_ruler_personality = tactical_genius_personality }
		1 = { add_ruler_personality = bold_fighter_personality }
		1 = { add_ruler_personality = strict_personality }
		1 = { add_ruler_personality = inspiring_leader_personality }
		1 = { add_ruler_personality = martial_educator_personality }
		1 = { add_ruler_personality = navigator_personality }
		1 = { add_ruler_personality = fierce_negotiator_personality }
		1 = { add_ruler_personality = babbling_buffoon_personality }
		1 = { add_ruler_personality = embezzler_personality }
		1 = { add_ruler_personality = drunkard_personality }
		1 = { add_ruler_personality = sinner_personality }
		1 = { add_ruler_personality = greedy_personality }
		1 = { add_ruler_personality = cruel_personality }
		1 = { add_ruler_personality = naive_personality }
		1 = { add_ruler_personality = craven_personality }
		1 = { add_ruler_personality = loose_lips_personality }
		1 = { add_ruler_personality = obsessive_perfectionist_personality }
		1 = { add_ruler_personality = malevolent_personality }
		1 = { add_ruler_personality = reformist_personality }
		1 = { add_ruler_personality = patron_of_arts_personality }
	}
}

th_change_gensokyo_dev = {
	hidden_effect = {
		#min_plus_one is needed so provinces can't get into negative / zero development
		#If min_plus_one = 0 then this effect should not be used to decrease development (tax, production, manpower > 0)
		gensokyo_continent = {
			if = {
				limit = {
					base_tax = $min_plus_one$
				}
				add_base_tax = $tax$
			}
			else = {
				set_base_tax = 1
			}
			if = {
				limit = {
					base_production = $min_plus_one$
				}
				add_base_production = $production$
			}
			else = {
				set_base_production = 1
			}
			if = {
				limit = {
					base_manpower = $min_plus_one$
				}
				add_base_manpower = $manpower$
			}
			else = {
				set_base_manpower = 1
			}
		}
		moon_continent = {
			if = {
				limit = {
					base_tax = $min_plus_one$
				}
				add_base_tax = $tax$
			}
			else = {
				set_base_tax = 1
			}
			if = {
				limit = {
					base_production = $min_plus_one$
				}
				add_base_production = $production$
			}
			else = {
				set_base_production = 1
			}
			if = {
				limit = {
					base_manpower = $min_plus_one$
				}
				add_base_manpower = $manpower$
			}
			else = {
				set_base_manpower = 1
			}
		}
	}
}

th_cause_aggressive_expansion_against_target = {
	#Make sure to define own custom tooltip because PDX doesn't like parameters to be used in loc files
	set_variable = {
		which = th_ae_variable
		value = $value$
	}
	while = {
		limit = {
			check_variable = {
				which = th_ae_variable
				value = 1
			}
		}
		add_opinion = {
			who = $who$
			modifier = aggressive_expansion
		}
		subtract_variable = {
			which = th_ae_variable
			value = 1
		}
	}
}

th_build_uptodate_fort = {
	if = {
		limit = {
			owner = {
				mil_tech = 24
			}
		}
		add_building = fort_18th 
	}
	else_if = {
		limit = {
			owner = {
				mil_tech = 19
			}
		}
		add_building = fort_17th 
	}
	else_if = {
		limit = {
			owner = {
				mil_tech = 14
			}
		}
		add_building = fort_16th 
	}
	else = {
		add_building = fort_15th 
	}
}

th_colonize_dev_province = {
	$province$ = {
		if = {
			limit = {
				is_empty = yes
			}
			cede_province = PREV
			add_core = PREV		
			change_religion = PREV
			change_culture = PREV
			add_base_tax = 1
			add_base_production = 1
			add_base_manpower = 1
			[[trade_goods]
				change_trade_goods = $trade_goods$
			]
		}
		else_if = {
			limit = {
				owner = {
					OR = { 
						tag = PREV
						is_subject_of = PREV
					}
				}
			}
			add_base_tax = 1
			add_base_production = 1
			add_base_manpower = 1
			if = {
				limit = {
					NOT = { religion = PREV }
				}
				change_religion = PREV
			}
			if = {
				limit = {
					NOT = { culture = PREV }
				}
				change_culture = PREV
			}
			[[trade_goods]
				change_trade_goods = $trade_goods$
			]
		}
		else = {
			add_permanent_claim = PREV
		}
	}
}

th_colonize_dev_province_for_root = { #Deprecated
	ROOT = {
		th_colonize_dev_province = {
			province = $province$
			trade_goods = $trade_goods$
		}
	}
}

th_colonize_province_for_country = {	
	if = {
		limit = {
			is_empty = yes
		}
		cede_province = $who$
		add_core = $who$		
		change_religion = $who$
		change_culture = $who$
	}
	else_if = {
		limit = {
			owner = {
				OR = { 
					tag = $who$
					is_subject_of = $who$
				}
			}
		}
		add_base_tax = 1
		add_base_production = 1
		add_base_manpower = 1
		if = {
			limit = {
				NOT = { religion = $who$ }
			}
			change_religion = $who$
		}
		if = {
			limit = {
				NOT = { culture = $who$ }
			}
			change_culture = $who$
		}
	}
	else = {
		add_permanent_claim = $who$
	}
}

th_add_stability_or_adm_power = {
    tooltip = {
        add_stability = $amount$
    }
    custom_tooltip = th_add_stability_or_adm_power_tt
    hidden_effect = {
        for = {
            amount = $amount$
            effect = "
                if = {
                    limit = {
                        NOT = { stability = 3 }
                    }
                    add_stability = 1
                }
                else = {
                    add_adm_power = 50
                }
            "
        }
    }
}

th_immunity_against_the_plague = {	
	custom_tooltip = emp_ven_plague_doctor_training_tt
	hidden_effect = {
		set_country_flag = has_competent_doctors
	}
}

th_outdate_moon_defenses = {
	custom_tooltip = th_able_to_attack_lunarian_tt
	hidden_effect = {
		set_global_flag = th_lunarian_are_attackable_now_flag
	}
}

th_allow_shorter_deity_swapping = {
	custom_tooltip = th_allow_shorter_deity_swapping_tt
	hidden_effect = {
		set_country_flag = th_permanent_shorter_deity_swapping
	}
}

th_remove_autonomy_from_all_provinces_effect = {
	custom_tooltip = th_remove_autonomy_from_all_provinces
	hidden_effect = {
		every_owned_province = {
			add_local_autonomy = -100
		}
	}
}

th_add_manufactory = {
	if = {
		limit = {
			trade_goods = coal
			has_dlc = "Rule Britannia"
		}
		add_building = furnace
	}
	if = {
		limit = {
			th_has_wharf_trade_goods = yes
		}
		add_building = wharf
	}
	if = {
		limit = {
			th_has_weapons_trade_goods = yes
		}
		add_building = weapons
	}
	if = {
		limit = { 
			th_has_textile_trade_goods = yes
		}
		add_building = textile
	}
	if = {
		limit = {
			th_has_plantation_trade_goods = yes
		}
		add_building = plantations
	}
	if = {
		limit = {
			th_has_trade_company_trade_goods = yes
		}
		add_building = tradecompany
	}
	if = {
		limit = {
			th_has_farm_trade_goods = yes
		}
		add_building = farm_estate
	}
	if = {
		limit = {
			th_has_mills_trade_goods = yes
		}
		add_building = mills
	}
}

th_get_default_permanent_province_buff = {
	hidden_effect = {
		home_trade_node_effect_scope = {
			random_trade_node_member_province = {
				limit = {
					owned_by = ROOT
				}
				save_event_target_as = reward_province
			}
			random_trade_node_member_province = {
				limit = {
					owned_by = ROOT
					is_capital = yes
				}
				save_event_target_as = reward_province
			}
			random_trade_node_member_province = {
				limit = {
					owned_by = ROOT
					development = CAPITAL
					is_capital = no
				}
				save_event_target_as = reward_province
			}
			random_trade_node_member_province = {
				limit = {
					owned_by = ROOT
					development = CAPITAL
					is_capital = no
					development = 20
				}
				save_event_target_as = reward_province
			}
			random_trade_node_member_province = {
				limit = {
					owned_by = ROOT
					development = CAPITAL
					is_capital = no
					development = 25
				}
				save_event_target_as = reward_province
			}
			random_trade_node_member_province = {
				limit = {
					owned_by = ROOT
					development = CAPITAL
					is_capital = no
					development = 30
				}
				save_event_target_as = reward_province
			}
		}
	}
	if = {
		limit = { has_saved_event_target = reward_province }
		event_target:reward_province = {
			add_province_modifier = {
				name = "dominant_trade_hub"
				duration = -1
			}
		}
	}
	else = {
		custom_tooltip = dominant_home_node_reward_tooltip
	}
}

th_coastal_slave_raid_immunity = {
	custom_tooltip = th_coastal_slave_raid_immunity_tt
	hidden_effect = {
		add_permanent_province_modifier = {
			name = th_raid_immunity
			duration = -1
		}
	}
}

th_remove_merc_penalty = {
	custom_tooltip = th_remove_merc_penalty_tt
	hidden_effect = {
		set_country_flag = th_free_merc_companies
	}
}
th_add_merc_penalty = {
	custom_tooltip = th_add_merc_penalty_tt
	hidden_effect = {
		clr_country_flag = th_free_merc_companies
	}
}

th_add_global_prosperity = {
	tooltip = {
		capital_scope = {
			add_prosperity = $prosperity$
		}
	}
	custom_tooltip = th_add_global_prosperity_tt
	hidden_effect = {
		every_owned_province = {
			add_prosperity = $prosperity$
		}
	}
}
th_add_global_devastation = {
	tooltip = {
		capital_scope = {
			add_devastation = $devastation$
		}
	}
	custom_tooltip = th_add_global_devastation_tt
	hidden_effect = {
		every_owned_province = {
			add_devastation = $devastation$
		}
	}
}

###Supports the following estate privileges - No longer needed, use unlock_estate_privilege instead.
# th_estate_nobles_third_eye
# th_estate_burghers_arctic_development
# th_estate_burghers_mass_marine_conscription
# th_estate_burghers_elite_marines
# th_estate_burghers_naval_reinforcement
# th_estate_burghers_swamp_developers
# th_estate_church_force_conversion
#th_unlock_estate_privilege = {
#	custom_tooltip = th_unlock_$estate_privilege$_privilege_tt
#	hidden_effect = {
#		set_country_flag = th_unlocked_$estate_privilege$_privilege
#	}
#}

###Supports the following merc companies
# merc_th_level_titania
# merc_th_goliath_doll
# merc_th_level_leviathan
# merc_th_yukaris_royal_guard
# merc_th_law_enforcers_of_higan
th_unlock_mercenary_company = {
	custom_tooltip = th_unlock_$mercenary_company$_tt
	hidden_effect = {
		set_country_flag = th_unlock_$mercenary_company$
	}
	[[free_merc]
		custom_tooltip = costs_no_army_professionalism
	]
	[[global]
		custom_tooltip = global_merc_company
		hidden_effect = {
			set_global_flag = global_unlocked_$merc_company$
		}
	]
}
th_lock_mercenary_company = {
	custom_tooltip = th_lock_$mercenary_company$_tt
	hidden_effect = {
		clr_country_flag = th_unlock_$mercenary_company$
	}
}

#Make sure to make your own custom tooltip for it because parameters can't be given as input. Sadly.
th_transfer_treasury = {
	#custom_tooltip = th_transfer_treasury_tt	#Transfer §Y[$giver$.$variable$.GetValue]§! Ducats to $Y[$taker$.GetName]§!.
	hidden_effect = {
		$giver$ = {
			while = {
				limit = {
					check_variable = {
						which = $variable$
						value = 1
					}
				}
				$taker$ = {
					add_treasury = 1
				}
				add_treasury = -1
				subtract_variable = {
					which = $variable$
					value = 1
				}
			}
			multiply_variable = {
				which = $variable$
				value = 100
			}
			while = {
				limit = {
					check_variable = {
						which = $variable$
						value = 1
					}
				}
				$taker$ = {
					add_treasury = 0.01
				}
				add_treasury = -0.01
				subtract_variable = {
					which = $variable$
					value = 1
				}
			}
		}
	}
}

th_delete_treasury = {
	#custom_tooltip = th_transfer_treasury_tt	#Remove §Y[$giver$.$variable$.GetValue]§! Ducats. Oof...
	hidden_effect = {
		$giver$ = {
			while = {
				limit = {
					check_variable = {
						which = $variable$
						value = 1
					}
				}
				add_treasury = -1
				subtract_variable = {
					which = $variable$
					value = 1
				}
			}
			multiply_variable = {
				which = $variable$
				value = 100
			}
			while = {
				limit = {
					check_variable = {
						which = $variable$
						value = 1
					}
				}
				add_treasury = -0.01
				subtract_variable = {
					which = $variable$
					value = 1
				}
			}
		}
	}
}

th_change_national_focus = {
	custom_tooltip = th_change_national_focus_$type$
	hidden_effect = {
		change_national_focus = $type$
	}
}


##############################################################################################################################
# Unused
##############################################################################################################################
th_enable_university_education = {
	custom_tooltip = th_enable_university_education_tt
	hidden_effect = {
		set_country_flag = th_university_education_enabled
		if = {
			limit = {
				has_country_flag = th_fairy_university_education_enabled
			}
			clr_country_flag = th_fairy_university_education_enabled
		}
	}
}

th_enable_assert_dominance_cb_effect = {
	custom_tooltip = th_enable_assert_dominance_cb_effect_tt
	hidden_effect = {
		set_country_flag = th_can_use_assert_dominance_cb
	}
}

th_enable_diplomatic_immunity_effect = {
	custom_tooltip = th_enable_diplomatic_immunity_effect_tt
	hidden_effect = {
		set_country_flag = th_immunity_to_diplomatic_actions
	}
}

###BUY PROVINCE SCRIPTED EFFECT###
th_designate_provinces_for_purchase = {
	[[purchasable_province_1]
		if = {
			limit = {
				$purchasable_province_1$ = {
					NOT = { country_or_non_sovereign_subject_holds = ROOT }
					$trigger$
				}
			}
			$purchasable_province_1$ = {
				save_event_target_as = purchasable_province_1
			}
		}
	]
	[[purchasable_province_2]
		if = {
			limit = {
				$purchasable_province_2$ = {
					NOT = { country_or_non_sovereign_subject_holds = ROOT }
					$trigger$
				}
			}
			$purchasable_province_2$ = {
				save_event_target_as = purchasable_province_2
			}
		}
	]
	[[purchasable_province_3]
		if = {
			limit = {
				$purchasable_province_3$ = {
					NOT = { country_or_non_sovereign_subject_holds = ROOT }
					$trigger$
				}
			}
			$purchasable_province_3$ = {
				save_event_target_as = purchasable_province_3
			}
		}
	]
	[[purchasable_province_4]
		if = {
			limit = {
				$purchasable_province_4$ = {
					NOT = { country_or_non_sovereign_subject_holds = ROOT }
					$trigger$
				}
			}
			$purchasable_province_4$ = {
				save_event_target_as = purchasable_province_4
			}
		}
	]
	[[purchasable_province_5]
		if = {
			limit = {
				$purchasable_province_5$ = {
					NOT = { country_or_non_sovereign_subject_holds = ROOT }
					$trigger$
				}
			}
			$purchasable_province_5$ = {
				save_event_target_as = purchasable_province_5
			}
		}
	]
}

th_spawn_random_unit = {
	random_list = {
		$infantry_chance$ = {
			infantry = ROOT
		}
		$cavalry_chance$ = {
			cavalry = ROOT
		}
		$artillery_chance$ = {
			artillery = ROOT
		}
	}
}

th_enable_free_respawn = {
	custom_tooltip = th_enable_free_respawn_tt
	hidden_effect = {
		set_country_flag = th_free_respawn
	}
}

th_halve_respawn_cooldown = {
	custom_tooltip = th_halve_respawn_cooldown_tt
	hidden_effect = {
		set_country_flag = th_halved_respawn_cd
	}
}

th_grant_propogate_religion_immunity = {
	custom_tooltip = th_grant_propogate_religion_immunity_tt
	hidden_effect = {
		set_country_flag = th_immune_against_propogate_religion
	}
}

th_enable_population_suppression_on_merc_recruitment = {
	custom_tooltip = th_enable_population_suppression_on_merc_recruitment_tt
	hidden_effect = {
		set_country_flag = th_merc_suppress_revolt
	}
}

th_allow_insta_loot_on_merc_recruitment = {
	custom_tooltip = th_allow_insta_loot_on_merc_recruitment_tt
	hidden_effect = {
		set_country_flag = th_enabled_instant_loot_on_merc_recruitment
	}
}