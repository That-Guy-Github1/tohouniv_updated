th_has_danmaku_duels_unlocked = {
	custom_trigger_tooltip = {
		tooltip = th_has_danmaku_duels_unlocked_tt
		OR = {
			technology_group = tech_gensokyan_lunarian
			technology_group = tech_lunarian
			technology_group = tech_gensokyan
		}
	}
}

th_is_in_a_danmaku_duel = {
	custom_trigger_tooltip = {
		tooltip = th_is_in_a_danmaku_duel_tt
		has_ruler_flag = th_ruler_is_in_a_danmaku_duel
	}
	is_lesser_in_union = no
}

th_is_not_in_a_danmaku_duel = {
	custom_trigger_tooltip = {
		tooltip = th_is_not_in_a_danmaku_duel_tt
		NOT = { has_ruler_flag = th_ruler_is_in_a_danmaku_duel }
	}
}

th_is_duelling_an_unlanded_character = {
	custom_trigger_tooltip = {
		tooltip = th_is_duelling_an_unlanded_character_tt
		has_ruler_flag = th_is_duelling_an_unlanded_character
	}
}
th_is_not_duelling_an_unlanded_character = {
	custom_trigger_tooltip = {
		tooltip = th_is_not_duelling_an_unlanded_character_tt
		NOT = { has_ruler_flag = th_is_duelling_an_unlanded_character }
	}
}

th_is_duelling_character = {
	custom_trigger_tooltip = {
		tooltip = th_is_duelling_character_$target$_tt
		has_ruler_flag = th_is_duelling_character_$target$
	}
}

th_get_danmaku_duel_instance = {
	custom_trigger_tooltip = {
		tooltip = th_get_danmaku_duel_instance_$instance$_tt
		has_ruler_flag = th_is_in_danmaku_duel_instance_$instance$
	}
}

th_is_danmaku_duel_global_event_target = {
	has_saved_global_event_target = th_danmaku_duelist_of_id_$country_id$_of_instance_$instance$
	has_ruler_flag = th_is_in_danmaku_duel_instance_$instance$
	tag = event_target:th_danmaku_duelist_of_id_$country_id$_of_instance_$instance$
}

th_is_not_danmaku_duel_enemy_target = {
	has_saved_global_event_target = th_danmaku_duelist_of_id_$country_id$_of_instance_$instance$
	has_ruler_flag = th_is_in_danmaku_duel_instance_$instance$
	NOT = { tag = event_target:th_danmaku_duelist_of_id_$country_id$_of_instance_$instance$ }
}

th_has_turn_ownership = {
	custom_trigger_tooltip = {
		tooltip = th_has_turn_ownership_tt
		has_ruler_flag = th_danmaku_has_turn_ownership
	}
}

th_has_not_turn_ownership = {
	custom_trigger_tooltip = {
		tooltip = th_has_not_turn_ownership_tt
		NOT = { has_ruler_flag = th_danmaku_has_turn_ownership }
	}
}

th_enemy_is_touhou_character = {
	th_is_in_a_danmaku_duel = yes
	OR = {
		AND = {
			th_is_duelling_an_unlanded_character = yes
			th_is_duelling_character = { target = $who$ }
		}
		AND = {
			th_is_not_duelling_an_unlanded_character = yes
			OR = {
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 1 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_1 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 2 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_2 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 3 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_3 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 4 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_4 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 5 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_5 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 6 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_6 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 7 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_7 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 8 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_8 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 9 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_9 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 10 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_10 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 11 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_11 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 12 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_12 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 13 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_13 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 14 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_14 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 15 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_15 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 16 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_16 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 17 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_17 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 18 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_18 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 19 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_19 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 20 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_20 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 21 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_21 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 22 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_22 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 23 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_23 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 24 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_24 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 25 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_25 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 26 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_26 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 27 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_27 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 28 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_28 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 29 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_29 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 30 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_30 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 1 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_1 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 2 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_2 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 3 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_3 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 4 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_4 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 5 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_5 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 6 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_6 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 7 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_7 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 8 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_8 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 9 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_9 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 10 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_10 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 11 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_11 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 12 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_12 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 13 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_13 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 14 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_14 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 15 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_15 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 16 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_16 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 17 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_17 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 18 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_18 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 19 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_19 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 20 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_20 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 21 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_21 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 22 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_22 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 23 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_23 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 24 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_24 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 25 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_25 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 26 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_26 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 27 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_27 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 28 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_28 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 29 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_29 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 30 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_30 = { th_has_specific_touhou_character = { who = $who$ } }
				}
			}
		}
	}
}