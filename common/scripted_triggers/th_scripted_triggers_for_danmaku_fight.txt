th_has_danmaku_duels_unlocked = {
	custom_trigger_tooltip = {
		tooltip = th_has_danmaku_duels_unlocked_tt
		OR = {
			technology_group = tech_gensokyan_lunarian
			technology_group = tech_lunarian
			technology_group = tech_gensokyan
		}
	}
}

th_can_have_a_danmaku_duel = {
	th_has_danmaku_duels_unlocked = yes
	NOT = { has_ruler_modifier = th_danmaku_incapacitated }
	FROM = { NOT = { has_ruler_modifier = th_danmaku_incapacitated } }
	has_global_flag = th_initialized_danmaku_database
	has_ruler_flag = th_danmaku_ruler_is_set
	th_is_not_in_a_danmaku_duel = yes
	has_regency = no
}

th_can_have_a_danmaku_duel_against_target = {
	th_can_have_a_danmaku_duel = yes
	$target$ = {
		th_can_have_a_danmaku_duel = yes
		NOT = { war_with = ROOT }
	}
}

th_has_not_danmaku_duels_unlocked = {
	custom_trigger_tooltip = {
		tooltip = th_has_not_danmaku_duels_unlocked_tt
		NOT = { technology_group = tech_gensokyan_lunarian }
		NOT = { technology_group = tech_lunarian }
		NOT = { technology_group = tech_gensokyan }
	}
}

th_is_in_a_danmaku_duel = {
	custom_trigger_tooltip = {
		tooltip = th_is_in_a_danmaku_duel_tt
		has_ruler_flag = th_ruler_is_in_a_danmaku_duel
	}
	is_lesser_in_union = no
}

th_is_not_in_a_danmaku_duel = {
	custom_trigger_tooltip = {
		tooltip = th_is_not_in_a_danmaku_duel_tt
		NOT = { has_ruler_flag = th_ruler_is_in_a_danmaku_duel }
	}
}

th_is_duelling_an_unlanded_character = {
	custom_trigger_tooltip = {
		tooltip = th_is_duelling_an_unlanded_character_tt
		has_ruler_flag = th_is_duelling_an_unlanded_character
	}
}
th_is_not_duelling_an_unlanded_character = {
	custom_trigger_tooltip = {
		tooltip = th_is_not_duelling_an_unlanded_character_tt
		NOT = { has_ruler_flag = th_is_duelling_an_unlanded_character }
	}
}


th_get_unlanded_character_home_hell = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 100 }	}
th_get_unlanded_character_home_heaven = {				is_variable_equal = { which = th_danmaku_enemy_character_home value = 200 }	}
th_get_unlanded_character_home_youkai_mountain = {		is_variable_equal = { which = th_danmaku_enemy_character_home value = 300 }	}
th_get_unlanded_character_home_moon = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 400 }	}
th_get_unlanded_character_home_NET = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 1 }	}
th_get_unlanded_character_home_FUJ = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 2 }	}
th_get_unlanded_character_home_EIT = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 3 }	}
th_get_unlanded_character_home_SFF = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 4 }	}
th_get_unlanded_character_home_MHG = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 5 }	}
th_get_unlanded_character_home_SCR = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 6 }	}
th_get_unlanded_character_home_CRD = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 7 }	}
th_get_unlanded_character_home_TGU = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 8 }	}
th_get_unlanded_character_home_SNK = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 9 }	}
th_get_unlanded_character_home_MKI = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 10 }	}
th_get_unlanded_character_home_HIG = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 11 }	}
th_get_unlanded_character_home_FOM = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 12 }	}
th_get_unlanded_character_home_HMC = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 13 }	}
th_get_unlanded_character_home_YOF = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 14 }	}
th_get_unlanded_character_home_HVR = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 15 }	}
th_get_unlanded_character_home_MIM = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 16 }	}
th_get_unlanded_character_home_KPP = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 17 }	}
th_get_unlanded_character_home_HKR = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 18 }	}
th_get_unlanded_character_home_MRY = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 19 }	}
th_get_unlanded_character_home_HNG = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 20 }	}
th_get_unlanded_character_home_CIN = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 21 }	}
th_get_unlanded_character_home_FLR = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 22 }	}
th_get_unlanded_character_home_GNK = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 23 }	}
th_get_unlanded_character_home_SCD = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 24 }	}
th_get_unlanded_character_home_NMG = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 25 }	}
th_get_unlanded_character_home_KNN = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 26 }	}
th_get_unlanded_character_home_THR = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 27 }	}
th_get_unlanded_character_home_OKR = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 28 }	}
th_get_unlanded_character_home_YUM = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 29 }	}
th_get_unlanded_character_home_TFR = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 30 }	}
th_get_unlanded_character_home_LIL = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 31 }	}
th_get_unlanded_character_home_LRV = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 32 }	}
th_get_unlanded_character_home_AKI = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 33 }	}
th_get_unlanded_character_home_ONI = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 34 }	}
th_get_unlanded_character_home_KOG = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 35 }	}
th_get_unlanded_character_home_MYO = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 36 }	}
th_get_unlanded_character_home_OKI = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 37 }	}
th_get_unlanded_character_home_PRI = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 38 }	}
th_get_unlanded_character_home_KKO = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 39 }	}
th_get_unlanded_character_home_SEK = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 40 }	}
th_get_unlanded_character_home_NCS = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 41 }	}
th_get_unlanded_character_home_RAI = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 42 }	}
th_get_unlanded_character_home_KSE = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 43 }	}
th_get_unlanded_character_home_CLP = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 44 }	}
th_get_unlanded_character_home_JNK = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 45 }	}
th_get_unlanded_character_home_HEC = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 46 }	}
th_get_unlanded_character_home_SKT = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 47 }	}
th_get_unlanded_character_home_YAC = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 48 }	}
th_get_unlanded_character_home_GNU = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 49 }	}
th_get_unlanded_character_home_LCU = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 50 }	}
th_get_unlanded_character_home_KEI = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 51 }	}
th_get_unlanded_character_home_SKI = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 52 }	}
th_get_unlanded_character_home_ORN = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 53 }	}
th_get_unlanded_character_home_OKU = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 54 }	}
th_get_unlanded_character_home_FTP = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 55 }	}
th_get_unlanded_character_home_LEM = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 56 }	}
th_get_unlanded_character_home_MKN = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 57 }	}
th_get_unlanded_character_home_KMJ = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 58 }	}
th_get_unlanded_character_home_GGS = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 59 }	}
th_get_unlanded_character_home_SNZ = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 60 }	}
th_get_unlanded_character_home_GYK = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 61 }	}
th_get_unlanded_character_home_HIF = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 62 }	}
th_get_unlanded_character_home_YME = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 63 }	}
th_get_unlanded_character_home_MRU = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 64 }	}
th_get_unlanded_character_home_HAK = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 65 }	}
th_get_unlanded_character_home_NUE = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 66 }	}
th_get_unlanded_character_home_JOO = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 67 }	}
th_get_unlanded_character_home_SHI = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 68 }	}
th_get_unlanded_character_home_YMU = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 69 }	}
th_get_unlanded_character_home_ROD = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 70 }	}
th_get_unlanded_character_home_PRS = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 71 }	}
th_get_unlanded_character_home_SOU = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 72 }	}
th_get_unlanded_character_home_SEI = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 73 }	}
th_get_unlanded_character_home_MMU = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 74 }	}
th_get_unlanded_character_home_HVA = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 75 }	}
th_get_unlanded_character_home_RAN = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 76 }	}
th_get_unlanded_character_home_KNE = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 77 }	}
th_get_unlanded_character_home_KN2 = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 78 }	}
th_get_unlanded_character_home_CH2 = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 79 }	}
th_get_unlanded_character_home_DAY = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 80 }	}
th_get_unlanded_character_home_ZUT = {					is_variable_equal = { which = th_danmaku_enemy_character_home value = 81 }	}
th_get_unlanded_character_home = {
	th_get_unlanded_character_home_$home$ = yes
}


th_is_duelling_character_reimu = { 			is_variable_equal = { which = th_enemy_danmaku_character value = 1 } }
th_is_duelling_character_marisa = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 2 } }
th_is_duelling_character_mima = { 			is_variable_equal = { which = th_enemy_danmaku_character value = 3 } }
th_is_duelling_character_konngara = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 4 } }
th_is_duelling_character_sariel = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 5 } }
th_is_duelling_character_rika = { 			is_variable_equal = { which = th_enemy_danmaku_character value = 6 } }
th_is_duelling_character_meira = { 			is_variable_equal = { which = th_enemy_danmaku_character value = 7 } }
th_is_duelling_character_kana = { 			is_variable_equal = { which = th_enemy_danmaku_character value = 8 } }
th_is_duelling_character_kotohime = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 9 } }
th_is_duelling_character_ellen = { 			is_variable_equal = { which = th_enemy_danmaku_character value = 10 } }
th_is_duelling_character_rikako = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 11 } }
th_is_duelling_character_chiyuri = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 12 } }
th_is_duelling_character_yumemi = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 13 } }
th_is_duelling_character_kurumi = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 14 } }
th_is_duelling_character_elly = { 			is_variable_equal = { which = th_enemy_danmaku_character value = 15 } }
th_is_duelling_character_gengetsu = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 16 } }
th_is_duelling_character_mugetsu = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 17 } }
th_is_duelling_character_yuuka = { 			is_variable_equal = { which = th_enemy_danmaku_character value = 18 } }
th_is_duelling_character_alice = { 			is_variable_equal = { which = th_enemy_danmaku_character value = 19 } }
th_is_duelling_character_yuki = { 			is_variable_equal = { which = th_enemy_danmaku_character value = 20 } }
th_is_duelling_character_mai = { 			is_variable_equal = { which = th_enemy_danmaku_character value = 21 } }
th_is_duelling_character_yumeko = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 22 } }
th_is_duelling_character_shinki = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 23 } }
th_is_duelling_character_rumia = { 			is_variable_equal = { which = th_enemy_danmaku_character value = 24 } }
th_is_duelling_character_cirno = { 			is_variable_equal = { which = th_enemy_danmaku_character value = 25 } }
th_is_duelling_character_daiyousei = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 26 } }
th_is_duelling_character_meiling = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 27 } }
th_is_duelling_character_koakuma = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 28 } }
th_is_duelling_character_patchouli = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 29 } }
th_is_duelling_character_sakuya = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 30 } }
th_is_duelling_character_remilia = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 31 } }
th_is_duelling_character_flandre = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 32 } }
th_is_duelling_character_satsuki = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 33 } }
th_is_duelling_character_letty = { 			is_variable_equal = { which = th_enemy_danmaku_character value = 34 } }
th_is_duelling_character_chen = { 			is_variable_equal = { which = th_enemy_danmaku_character value = 35 } }
th_is_duelling_character_lily = { 			is_variable_equal = { which = th_enemy_danmaku_character value = 36 } }
th_is_duelling_character_prismriver = { 	is_variable_equal = { which = th_enemy_danmaku_character value = 37 } }
th_is_duelling_character_lunasa = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 38 } }
th_is_duelling_character_merlin = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 39 } }
th_is_duelling_character_lyrica = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 40 } }
th_is_duelling_character_layla = { 			is_variable_equal = { which = th_enemy_danmaku_character value = 41 } }
th_is_duelling_character_youmu = { 			is_variable_equal = { which = th_enemy_danmaku_character value = 42 } }
th_is_duelling_character_youki = { 			is_variable_equal = { which = th_enemy_danmaku_character value = 43 } }
th_is_duelling_character_yuyuko = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 44 } }
th_is_duelling_character_ran = { 			is_variable_equal = { which = th_enemy_danmaku_character value = 45 } }
th_is_duelling_character_yukari = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 46 } }
th_is_duelling_character_suika = { 			is_variable_equal = { which = th_enemy_danmaku_character value = 47 } }
th_is_duelling_character_wriggle = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 48 } }
th_is_duelling_character_mystia = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 49 } }
th_is_duelling_character_keine = { 			is_variable_equal = { which = th_enemy_danmaku_character value = 50 } }
th_is_duelling_character_tewi = { 			is_variable_equal = { which = th_enemy_danmaku_character value = 51 } }
th_is_duelling_character_reisen = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 52 } }
th_is_duelling_character_eirin = { 			is_variable_equal = { which = th_enemy_danmaku_character value = 53 } }
th_is_duelling_character_kaguya = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 54 } }
th_is_duelling_character_mokou = { 			is_variable_equal = { which = th_enemy_danmaku_character value = 55 } }
th_is_duelling_character_aya = { 			is_variable_equal = { which = th_enemy_danmaku_character value = 56 } }
th_is_duelling_character_medicine = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 57 } }
th_is_duelling_character_komachi = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 58 } }
th_is_duelling_character_eiki = { 			is_variable_equal = { which = th_enemy_danmaku_character value = 59 } }
th_is_duelling_character_shizuha = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 60 } }
th_is_duelling_character_minoriko = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 61 } }
th_is_duelling_character_hina = { 			is_variable_equal = { which = th_enemy_danmaku_character value = 62 } }
th_is_duelling_character_nitori = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 63 } }
th_is_duelling_character_momiji = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 64 } }
th_is_duelling_character_sanae = { 			is_variable_equal = { which = th_enemy_danmaku_character value = 65 } }
th_is_duelling_character_kanako = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 66 } }
th_is_duelling_character_suwako = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 67 } }
th_is_duelling_character_iku = { 			is_variable_equal = { which = th_enemy_danmaku_character value = 68 } }
th_is_duelling_character_tenshi = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 69 } }
th_is_duelling_character_kisume = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 70 } }
th_is_duelling_character_yamame = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 71 } }
th_is_duelling_character_parsee = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 72 } }
th_is_duelling_character_yuugi = { 			is_variable_equal = { which = th_enemy_danmaku_character value = 73 } }
th_is_duelling_character_satori = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 74 } }
th_is_duelling_character_orin = { 			is_variable_equal = { which = th_enemy_danmaku_character value = 75 } }
th_is_duelling_character_okuu = { 			is_variable_equal = { which = th_enemy_danmaku_character value = 76 } }
th_is_duelling_character_koishi = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 77 } }
th_is_duelling_character_nazrin = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 78 } }
th_is_duelling_character_kogasa = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 79 } }
th_is_duelling_character_ichirin = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 80 } }
th_is_duelling_character_minamitsu = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 81 } }
th_is_duelling_character_shou = { 			is_variable_equal = { which = th_enemy_danmaku_character value = 82 } }
th_is_duelling_character_byakuren = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 83 } }
th_is_duelling_character_nue = { 			is_variable_equal = { which = th_enemy_danmaku_character value = 84 } }
th_is_duelling_character_hatate = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 85 } }
th_is_duelling_character_kyouko = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 86 } }
th_is_duelling_character_yoshika = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 87 } }
th_is_duelling_character_seiga = { 			is_variable_equal = { which = th_enemy_danmaku_character value = 88 } }
th_is_duelling_character_tojiko = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 89 } }
th_is_duelling_character_futo = { 			is_variable_equal = { which = th_enemy_danmaku_character value = 90 } }
th_is_duelling_character_miko = { 			is_variable_equal = { which = th_enemy_danmaku_character value = 91 } }
th_is_duelling_character_mamizou = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 92 } }
th_is_duelling_character_kokoro = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 93 } }
th_is_duelling_character_wakasagihime = { 	is_variable_equal = { which = th_enemy_danmaku_character value = 94 } }
th_is_duelling_character_sekibanki = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 95 } }
th_is_duelling_character_kagerou = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 96 } }
th_is_duelling_character_benben = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 97 } }
th_is_duelling_character_yatsuhashi = { 	is_variable_equal = { which = th_enemy_danmaku_character value = 98 } }
th_is_duelling_character_seija = { 			is_variable_equal = { which = th_enemy_danmaku_character value = 99 } }
th_is_duelling_character_shinmyoumaru = { 	is_variable_equal = { which = th_enemy_danmaku_character value = 100 } }
th_is_duelling_character_raiko = { 			is_variable_equal = { which = th_enemy_danmaku_character value = 101 } }
th_is_duelling_character_sumireko = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 102 } }
th_is_duelling_character_renko = { 			is_variable_equal = { which = th_enemy_danmaku_character value = 103 } }
th_is_duelling_character_maribel = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 104 } }
th_is_duelling_character_seiran = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 105 } }
th_is_duelling_character_ringo = { 			is_variable_equal = { which = th_enemy_danmaku_character value = 106 } }
th_is_duelling_character_doremy = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 107 } }
th_is_duelling_character_sagume = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 108 } }
th_is_duelling_character_clownpiece = { 	is_variable_equal = { which = th_enemy_danmaku_character value = 109 } }
th_is_duelling_character_junko = { 			is_variable_equal = { which = th_enemy_danmaku_character value = 110 } }
th_is_duelling_character_hecatia = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 111 } }
th_is_duelling_character_toyohime = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 112 } }
th_is_duelling_character_yorihime = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 113 } }
th_is_duelling_character_change = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 114 } }
th_is_duelling_character_reisen_moon = { 	is_variable_equal = { which = th_enemy_danmaku_character value = 115 } }
th_is_duelling_character_joon = { 			is_variable_equal = { which = th_enemy_danmaku_character value = 116 } }
th_is_duelling_character_shion = { 			is_variable_equal = { which = th_enemy_danmaku_character value = 117 } }
th_is_duelling_character_sunny = { 			is_variable_equal = { which = th_enemy_danmaku_character value = 118 } }
th_is_duelling_character_star = { 			is_variable_equal = { which = th_enemy_danmaku_character value = 119 } }
th_is_duelling_character_luna = { 			is_variable_equal = { which = th_enemy_danmaku_character value = 120 } }
th_is_duelling_character_kasen = { 			is_variable_equal = { which = th_enemy_danmaku_character value = 121 } }
th_is_duelling_character_larva = { 			is_variable_equal = { which = th_enemy_danmaku_character value = 122 } }
th_is_duelling_character_nemuno = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 123 } }
th_is_duelling_character_aunn = { 			is_variable_equal = { which = th_enemy_danmaku_character value = 124 } }
th_is_duelling_character_narumi = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 125 } }
th_is_duelling_character_teireida = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 126 } }
th_is_duelling_character_satonono = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 127 } }
th_is_duelling_character_okina = { 			is_variable_equal = { which = th_enemy_danmaku_character value = 128 } }
th_is_duelling_character_eika = { 			is_variable_equal = { which = th_enemy_danmaku_character value = 129 } }
th_is_duelling_character_urumi = { 			is_variable_equal = { which = th_enemy_danmaku_character value = 130 } }
th_is_duelling_character_kutaka = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 131 } }
th_is_duelling_character_mayumi = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 132 } }
th_is_duelling_character_keiki = { 			is_variable_equal = { which = th_enemy_danmaku_character value = 133 } }
th_is_duelling_character_yachie = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 134 } }
th_is_duelling_character_saki = { 			is_variable_equal = { which = th_enemy_danmaku_character value = 135 } }
th_is_duelling_character_yuuma = { 			is_variable_equal = { which = th_enemy_danmaku_character value = 136 } }
th_is_duelling_character_mike = { 			is_variable_equal = { which = th_enemy_danmaku_character value = 137 } }
th_is_duelling_character_takane = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 138 } }
th_is_duelling_character_sannyo = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 139 } }
th_is_duelling_character_misumaru = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 140 } }
th_is_duelling_character_tsukasa = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 141 } }
th_is_duelling_character_megumu = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 142 } }
th_is_duelling_character_chimata = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 143 } }
th_is_duelling_character_momoyo = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 144 } }
th_is_duelling_character_son = { 			is_variable_equal = { which = th_enemy_danmaku_character value = 145 } }
th_is_duelling_character_enoko = { 			is_variable_equal = { which = th_enemy_danmaku_character value = 146 } }
th_is_duelling_character_chiyari = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 147 } }
th_is_duelling_character_hisami = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 148 } }
th_is_duelling_character_zanmu = { 			is_variable_equal = { which = th_enemy_danmaku_character value = 149 } }
th_is_duelling_character_rinnosuke = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 150 } }
th_is_duelling_character_tokiko = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 151 } }
th_is_duelling_character_miyoi = { 			is_variable_equal = { which = th_enemy_danmaku_character value = 152 } }
th_is_duelling_character_mizuchi = { 		is_variable_equal = { which = th_enemy_danmaku_character value = 153 } }
th_is_duelling_character_zun = { 			is_variable_equal = { which = th_enemy_danmaku_character value = 999 } }
th_is_duelling_character_generic = {		is_variable_equal = { which = th_enemy_danmaku_character value = 0 } }
###NON-TOUHOU CHARACTERS###
th_is_duelling_character_fairy_guard = {	is_variable_equal = { which = th_enemy_danmaku_character value = 1000 } }
th_is_duelling_character = {
	custom_trigger_tooltip = {
		tooltip = th_is_duelling_character_$target$_tt
		th_is_duelling_character_$target$ = yes
	}
}

th_get_danmaku_duel_instance = {
	custom_trigger_tooltip = {
		tooltip = th_get_danmaku_duel_instance_$instance$_tt
		is_variable_equal = { which = th_danmaku_duel_instance value = $instance$ }
	}
}

th_is_danmaku_duel_global_event_target = {
	has_saved_global_event_target = th_danmaku_duelist_of_id_$country_id$_of_instance_$instance$
	is_variable_equal = { which = th_danmaku_duel_instance value = $instance$ }
	tag = event_target:th_danmaku_duelist_of_id_$country_id$_of_instance_$instance$
}

th_is_not_danmaku_duel_enemy_target = {
	has_saved_global_event_target = th_danmaku_duelist_of_id_$country_id$_of_instance_$instance$
	is_variable_equal = { which = th_danmaku_duel_instance value = $instance$ }
	NOT = { tag = event_target:th_danmaku_duelist_of_id_$country_id$_of_instance_$instance$ }
}

th_is_country_id_danmaku_duel = {
	OR = {
		th_is_danmaku_duel_global_event_target = { instance = 1 country_id = $country_id$ }
		th_is_danmaku_duel_global_event_target = { instance = 2 country_id = $country_id$ }
		th_is_danmaku_duel_global_event_target = { instance = 3 country_id = $country_id$ }
		th_is_danmaku_duel_global_event_target = { instance = 4 country_id = $country_id$ }
		th_is_danmaku_duel_global_event_target = { instance = 5 country_id = $country_id$ }
		th_is_danmaku_duel_global_event_target = { instance = 6 country_id = $country_id$ }
		th_is_danmaku_duel_global_event_target = { instance = 7 country_id = $country_id$ }
		th_is_danmaku_duel_global_event_target = { instance = 8 country_id = $country_id$ }
		th_is_danmaku_duel_global_event_target = { instance = 9 country_id = $country_id$ }
		th_is_danmaku_duel_global_event_target = { instance = 10 country_id = $country_id$ }
		th_is_danmaku_duel_global_event_target = { instance = 11 country_id = $country_id$ }
		th_is_danmaku_duel_global_event_target = { instance = 12 country_id = $country_id$ }
		th_is_danmaku_duel_global_event_target = { instance = 13 country_id = $country_id$ }
		th_is_danmaku_duel_global_event_target = { instance = 14 country_id = $country_id$ }
		th_is_danmaku_duel_global_event_target = { instance = 15 country_id = $country_id$ }
	}
}

th_has_turn_ownership = {
	custom_trigger_tooltip = {
		tooltip = th_has_turn_ownership_tt
		has_ruler_flag = th_danmaku_has_turn_ownership
	}
}

th_has_not_turn_ownership = {
	custom_trigger_tooltip = {
		tooltip = th_has_not_turn_ownership_tt
		NOT = { has_ruler_flag = th_danmaku_has_turn_ownership }
	}
}

th_unlanded_character_has_turn_ownership = {
	custom_trigger_tooltip = {
		tooltip = th_unlanded_character_has_turn_ownership_tt
		has_ruler_flag = th_danmaku_unlanded_character_turn_ownership
	}
}

th_unlanded_character_has_not_turn_ownership = {
	custom_trigger_tooltip = {
		tooltip = th_unlanded_character_has_not_turn_ownership_tt
		NOT = { has_ruler_flag = th_danmaku_unlanded_character_turn_ownership }
	}
}

th_gui_can_press_danmaku_buttons = {
	if = {
		limit = { th_has_not_turn_ownership = yes }
		custom_trigger_tooltip = {
			tooltip = TH_HAS_CURRENTLY_NOT_THE_TURN_TT
			th_has_turn_ownership = yes
		}
	}
	if = {
		limit = { has_country_flag = th_danmaku_locked_actions }
		custom_trigger_tooltip = {
			tooltip = TH_COMBAT_WINDOW_IS_FROZEN_TT
			NOT = { has_country_flag = th_danmaku_locked_actions }
		}
	}
}

th_enemy_is_touhou_character = {
	th_is_in_a_danmaku_duel = yes
	OR = {
		AND = {
			th_is_duelling_an_unlanded_character = yes
			th_is_duelling_character = { target = $who$ }
		}
		AND = {
			th_is_not_duelling_an_unlanded_character = yes
			OR = {
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 1 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_1 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 2 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_2 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 3 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_3 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 4 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_4 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 5 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_5 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 6 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_6 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 7 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_7 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 8 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_8 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 9 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_9 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 10 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_10 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 11 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_11 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 12 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_12 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 13 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_13 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 14 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_14 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 15 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_15 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 1 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_1 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 2 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_2 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 3 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_3 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 4 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_4 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 5 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_5 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 6 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_6 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 7 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_7 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 8 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_8 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 9 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_9 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 10 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_10 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 11 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_11 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 12 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_12 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 13 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_13 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 14 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_14 = { th_has_specific_touhou_character = { who = $who$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 15 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_15 = { th_has_specific_touhou_character = { who = $who$ } }
				}
			}
		}
	}
}

th_enemy_is_class = {
	th_is_in_a_danmaku_duel = yes
	OR = {
		AND = {
			th_is_duelling_an_unlanded_character = yes
			th_unlanded_character_is_danmaku_class = { class = $class$ }
		}
		AND = {
			th_is_not_duelling_an_unlanded_character = yes
			OR = {
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 1 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_1 = { th_is_danmaku_class = { class = $class$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 2 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_2 = { th_is_danmaku_class = { class = $class$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 3 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_3 = { th_is_danmaku_class = { class = $class$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 4 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_4 = { th_is_danmaku_class = { class = $class$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 5 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_5 = { th_is_danmaku_class = { class = $class$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 6 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_6 = { th_is_danmaku_class = { class = $class$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 7 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_7 = { th_is_danmaku_class = { class = $class$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 8 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_8 = { th_is_danmaku_class = { class = $class$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 9 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_9 = { th_is_danmaku_class = { class = $class$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 10 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_10 = { th_is_danmaku_class = { class = $class$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 11 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_11 = { th_is_danmaku_class = { class = $class$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 12 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_12 = { th_is_danmaku_class = { class = $class$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 13 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_13 = { th_is_danmaku_class = { class = $class$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 14 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_14 = { th_is_danmaku_class = { class = $class$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 15 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_15 = { th_is_danmaku_class = { class = $class$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 1 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_1 = { th_is_danmaku_class = { class = $class$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 2 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_2 = { th_is_danmaku_class = { class = $class$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 3 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_3 = { th_is_danmaku_class = { class = $class$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 4 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_4 = { th_is_danmaku_class = { class = $class$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 5 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_5 = { th_is_danmaku_class = { class = $class$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 6 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_6 = { th_is_danmaku_class = { class = $class$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 7 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_7 = { th_is_danmaku_class = { class = $class$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 8 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_8 = { th_is_danmaku_class = { class = $class$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 9 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_9 = { th_is_danmaku_class = { class = $class$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 10 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_10 = { th_is_danmaku_class = { class = $class$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 11 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_11 = { th_is_danmaku_class = { class = $class$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 12 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_12 = { th_is_danmaku_class = { class = $class$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 13 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_13 = { th_is_danmaku_class = { class = $class$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 14 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_14 = { th_is_danmaku_class = { class = $class$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 15 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_15 = { th_is_danmaku_class = { class = $class$ } }
				}
			}
		}
	}
}

th_enemy_is_creature_type = {
	th_is_in_a_danmaku_duel = yes
	OR = {
		AND = {
			th_is_duelling_an_unlanded_character = yes
			th_is_enemy_character_danmaku_creature_type = { type = $type$ }
		}
		AND = {
			th_is_not_duelling_an_unlanded_character = yes
			OR = {
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 1 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_1 = { th_is_danmaku_creature_type = {  type = $type$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 2 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_2 = { th_is_danmaku_creature_type = {  type = $type$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 3 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_3 = { th_is_danmaku_creature_type = {  type = $type$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 4 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_4 = { th_is_danmaku_creature_type = {  type = $type$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 5 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_5 = { th_is_danmaku_creature_type = {  type = $type$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 6 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_6 = { th_is_danmaku_creature_type = {  type = $type$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 7 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_7 = { th_is_danmaku_creature_type = {  type = $type$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 8 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_8 = { th_is_danmaku_creature_type = {  type = $type$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 9 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_9 = { th_is_danmaku_creature_type = {  type = $type$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 10 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_10 = { th_is_danmaku_creature_type = {  type = $type$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 11 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_11 = { th_is_danmaku_creature_type = {  type = $type$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 12 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_12 = { th_is_danmaku_creature_type = {  type = $type$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 13 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_13 = { th_is_danmaku_creature_type = {  type = $type$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 14 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_14 = { th_is_danmaku_creature_type = {  type = $type$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 15 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_15 = { th_is_danmaku_creature_type = {  type = $type$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 1 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_1 = { th_is_danmaku_creature_type = {  type = $type$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 2 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_2 = { th_is_danmaku_creature_type = {  type = $type$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 3 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_3 = { th_is_danmaku_creature_type = {  type = $type$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 4 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_4 = { th_is_danmaku_creature_type = {  type = $type$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 5 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_5 = { th_is_danmaku_creature_type = {  type = $type$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 6 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_6 = { th_is_danmaku_creature_type = {  type = $type$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 7 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_7 = { th_is_danmaku_creature_type = {  type = $type$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 8 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_8 = { th_is_danmaku_creature_type = {  type = $type$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 9 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_9 = { th_is_danmaku_creature_type = {  type = $type$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 10 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_10 = { th_is_danmaku_creature_type = {  type = $type$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 11 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_11 = { th_is_danmaku_creature_type = {  type = $type$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 12 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_12 = { th_is_danmaku_creature_type = {  type = $type$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 13 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_13 = { th_is_danmaku_creature_type = {  type = $type$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 14 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_14 = { th_is_danmaku_creature_type = {  type = $type$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 15 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_15 = { th_is_danmaku_creature_type = {  type = $type$ } }
				}
			}
		}
	}
}

th_enemy_has_static_modifier = {
	th_is_in_a_danmaku_duel = yes
	OR = {
		AND = {
			th_is_duelling_an_unlanded_character = yes
			th_enemy_character_has_static_modifier_of_type = { type = $type$ }
		}
		AND = {
			th_is_not_duelling_an_unlanded_character = yes
			OR = {
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 1 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_1 = { th_has_static_modifier_of_type = {  type = $type$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 2 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_2 = { th_has_static_modifier_of_type = {  type = $type$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 3 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_3 = { th_has_static_modifier_of_type = {  type = $type$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 4 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_4 = { th_has_static_modifier_of_type = {  type = $type$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 5 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_5 = { th_has_static_modifier_of_type = {  type = $type$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 6 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_6 = { th_has_static_modifier_of_type = {  type = $type$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 7 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_7 = { th_has_static_modifier_of_type = {  type = $type$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 8 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_8 = { th_has_static_modifier_of_type = {  type = $type$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 9 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_9 = { th_has_static_modifier_of_type = {  type = $type$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 10 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_10 = { th_has_static_modifier_of_type = {  type = $type$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 11 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_11 = { th_has_static_modifier_of_type = {  type = $type$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 12 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_12 = { th_has_static_modifier_of_type = {  type = $type$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 13 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_13 = { th_has_static_modifier_of_type = {  type = $type$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 14 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_14 = { th_has_static_modifier_of_type = {  type = $type$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 15 }
					event_target:th_danmaku_duelist_of_id_1_of_instance_15 = { th_has_static_modifier_of_type = {  type = $type$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 1 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_1 = { th_has_static_modifier_of_type = {  type = $type$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 2 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_2 = { th_has_static_modifier_of_type = {  type = $type$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 3 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_3 = { th_has_static_modifier_of_type = {  type = $type$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 4 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_4 = { th_has_static_modifier_of_type = {  type = $type$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 5 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_5 = { th_has_static_modifier_of_type = {  type = $type$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 6 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_6 = { th_has_static_modifier_of_type = {  type = $type$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 7 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_7 = { th_has_static_modifier_of_type = {  type = $type$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 8 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_8 = { th_has_static_modifier_of_type = {  type = $type$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 9 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_9 = { th_has_static_modifier_of_type = {  type = $type$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 10 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_10 = { th_has_static_modifier_of_type = {  type = $type$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 11 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_11 = { th_has_static_modifier_of_type = {  type = $type$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 12 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_12 = { th_has_static_modifier_of_type = {  type = $type$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 13 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_13 = { th_has_static_modifier_of_type = {  type = $type$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 14 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_14 = { th_has_static_modifier_of_type = {  type = $type$ } }
				}
				AND = {
					th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 15 }
					event_target:th_danmaku_duelist_of_id_2_of_instance_15 = { th_has_static_modifier_of_type = {  type = $type$ } }
				}
			}
		}
	}
}
th_enemy_has_any_static_modifier = {
	OR = {
		th_enemy_has_static_modifier = { type = ruler }
		th_enemy_has_static_modifier = { type = weakling }
		th_enemy_has_static_modifier = { type = elite }
		th_enemy_has_static_modifier = { type = boss }
		th_enemy_has_static_modifier = { type = endboss }
	}
}

th_enemy_has_equipped_weapon = {
	th_is_in_a_danmaku_duel = yes
	OR = {
		AND = {
			th_is_duelling_an_unlanded_character = yes
			th_enemy_character_has_equipped_weapon = { weapon = $weapon$ }
		}
		AND = {
			th_is_not_duelling_an_unlanded_character = yes
			OR = {
				AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 1 } event_target:th_danmaku_duelist_of_id_1_of_instance_1 = { th_has_equipped_weapon = { weapon = $weapon$ } } }
				AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 2 } event_target:th_danmaku_duelist_of_id_1_of_instance_2 = { th_has_equipped_weapon = { weapon = $weapon$ } } }
				AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 3 } event_target:th_danmaku_duelist_of_id_1_of_instance_3 = { th_has_equipped_weapon = { weapon = $weapon$ } } }
				AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 4 } event_target:th_danmaku_duelist_of_id_1_of_instance_4 = { th_has_equipped_weapon = { weapon = $weapon$ } } }
				AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 5 } event_target:th_danmaku_duelist_of_id_1_of_instance_5 = { th_has_equipped_weapon = { weapon = $weapon$ } } }
				AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 6 } event_target:th_danmaku_duelist_of_id_1_of_instance_6 = { th_has_equipped_weapon = { weapon = $weapon$ } } }
				AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 7 } event_target:th_danmaku_duelist_of_id_1_of_instance_7 = { th_has_equipped_weapon = { weapon = $weapon$ } } }
				AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 8 } event_target:th_danmaku_duelist_of_id_1_of_instance_8 = { th_has_equipped_weapon = { weapon = $weapon$ } } }
				AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 9 } event_target:th_danmaku_duelist_of_id_1_of_instance_9 = { th_has_equipped_weapon = { weapon = $weapon$ } } }
				AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 10 } event_target:th_danmaku_duelist_of_id_1_of_instance_10 = { th_has_equipped_weapon = { weapon = $weapon$ } } }
				AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 11 } event_target:th_danmaku_duelist_of_id_1_of_instance_11 = { th_has_equipped_weapon = { weapon = $weapon$ } } }
				AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 12 } event_target:th_danmaku_duelist_of_id_1_of_instance_12 = { th_has_equipped_weapon = { weapon = $weapon$ } } }
				AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 13 } event_target:th_danmaku_duelist_of_id_1_of_instance_13 = { th_has_equipped_weapon = { weapon = $weapon$ } } }
				AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 14 } event_target:th_danmaku_duelist_of_id_1_of_instance_14 = { th_has_equipped_weapon = { weapon = $weapon$ } } }
				AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 15 } event_target:th_danmaku_duelist_of_id_1_of_instance_15 = { th_has_equipped_weapon = { weapon = $weapon$ } } }
				AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 1 } event_target:th_danmaku_duelist_of_id_2_of_instance_1 = { th_has_equipped_weapon = { weapon = $weapon$ } } }
				AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 2 } event_target:th_danmaku_duelist_of_id_2_of_instance_2 = { th_has_equipped_weapon = { weapon = $weapon$ } } }
				AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 3 } event_target:th_danmaku_duelist_of_id_2_of_instance_3 = { th_has_equipped_weapon = { weapon = $weapon$ } } }
				AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 4 } event_target:th_danmaku_duelist_of_id_2_of_instance_4 = { th_has_equipped_weapon = { weapon = $weapon$ } } }
				AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 5 } event_target:th_danmaku_duelist_of_id_2_of_instance_5 = { th_has_equipped_weapon = { weapon = $weapon$ } } }
				AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 6 } event_target:th_danmaku_duelist_of_id_2_of_instance_6 = { th_has_equipped_weapon = { weapon = $weapon$ } } }
				AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 7 } event_target:th_danmaku_duelist_of_id_2_of_instance_7 = { th_has_equipped_weapon = { weapon = $weapon$ } } }
				AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 8 } event_target:th_danmaku_duelist_of_id_2_of_instance_8 = { th_has_equipped_weapon = { weapon = $weapon$ } } }
				AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 9 } event_target:th_danmaku_duelist_of_id_2_of_instance_9 = { th_has_equipped_weapon = { weapon = $weapon$ } } }
				AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 10 } event_target:th_danmaku_duelist_of_id_2_of_instance_10 = { th_has_equipped_weapon = { weapon = $weapon$ } } }
				AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 11 } event_target:th_danmaku_duelist_of_id_2_of_instance_11 = { th_has_equipped_weapon = { weapon = $weapon$ } } }
				AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 12 } event_target:th_danmaku_duelist_of_id_2_of_instance_12 = { th_has_equipped_weapon = { weapon = $weapon$ } } }
				AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 13 } event_target:th_danmaku_duelist_of_id_2_of_instance_13 = { th_has_equipped_weapon = { weapon = $weapon$ } } }
				AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 14 } event_target:th_danmaku_duelist_of_id_2_of_instance_14 = { th_has_equipped_weapon = { weapon = $weapon$ } } }
				AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 15 } event_target:th_danmaku_duelist_of_id_2_of_instance_15 = { th_has_equipped_weapon = { weapon = $weapon$ } } }
			}
		}
	}
}

th_check_actions = {
	check_variable = {
		which = th_danmaku_duel_logged_actions
		value = $action$
	}
}


th_combat_log_get_actor_id = { 					is_variable_equal = { which = th_danmaku_duel_action_$action$_actor value = $actor$ } }
th_combat_log_get_recipient_id = { 				is_variable_equal = { which = th_danmaku_duel_action_$action$_recipient value = $recipient$ } }

th_combat_log_get_ability_verb_NULL = { 		is_variable_equal = { which = th_danmaku_duel_action_$action$_ability_verb value = 0 } }
th_combat_log_get_ability_verb_uses = { 		is_variable_equal = { which = th_danmaku_duel_action_$action$_ability_verb value = 1 } }
th_combat_log_get_ability_verb_performs = { 	is_variable_equal = { which = th_danmaku_duel_action_$action$_ability_verb value = 2 } }
th_combat_log_get_ability_verb_casts = { 		is_variable_equal = { which = th_danmaku_duel_action_$action$_ability_verb value = 3 } }
th_combat_log_get_ability_verb_enchants = { 	is_variable_equal = { which = th_danmaku_duel_action_$action$_ability_verb value = 4 } }
th_combat_log_get_ability_verb_curses = { 		is_variable_equal = { which = th_danmaku_duel_action_$action$_ability_verb value = 5 } }
th_combat_log_get_ability_verb_strikes = { 		is_variable_equal = { which = th_danmaku_duel_action_$action$_ability_verb value = 6 } }
th_combat_log_get_ability_verb_shoots = { 		is_variable_equal = { which = th_danmaku_duel_action_$action$_ability_verb value = 7 } }
th_combat_log_get_ability_verb_attacks = { 		is_variable_equal = { which = th_danmaku_duel_action_$action$_ability_verb value = 8 } }
th_combat_log_get_ability_verb = {
	th_combat_log_get_ability_verb_$verb$ = { action = $action$ }
}

th_combat_log_get_ability_article_NULL = { 		is_variable_equal = { which = th_danmaku_duel_action_$action$_ability_article value = 0 } }
th_combat_log_get_ability_article_undefined = { is_variable_equal = { which = th_danmaku_duel_action_$action$_ability_article value = 1 } }
th_combat_log_get_ability_article_defined = { 	is_variable_equal = { which = th_danmaku_duel_action_$action$_ability_article value = 2 } }
th_combat_log_get_ability_article = {
	th_combat_log_get_ability_article_$article$ = { action = $action$ }
}

th_combat_log_get_ability_id_NULL = { 			is_variable_equal = { which = th_danmaku_duel_action_$action$_ability_name value = 0 } }
th_combat_log_get_ability_id_attack = { 		is_variable_equal = { which = th_danmaku_duel_action_$action$_ability_name value = 1 } }
th_combat_log_get_ability_id_magic_bolt = { 		is_variable_equal = { which = th_danmaku_duel_action_$action$_ability_name value = 2 } }
th_combat_log_get_ability_id = {
	th_combat_log_get_ability_id_$ability$ = { action = $action$ }
}

th_combat_log_get_preposition_NULL = { 			is_variable_equal = { which = th_danmaku_duel_action_$action$_ability_preposition value = 0 } }
th_combat_log_get_preposition_against = { 		is_variable_equal = { which = th_danmaku_duel_action_$action$_ability_preposition value = 1 } }
th_combat_log_get_preposition_on = { 			is_variable_equal = { which = th_danmaku_duel_action_$action$_ability_preposition value = 2 } }
th_combat_log_get_preposition = {
	th_combat_log_get_preposition_$preposition$ = { action = $action$ }
}

th_combat_log_get_ability_effect_NULL = { 					is_variable_equal = { which = th_danmaku_duel_action_$action$_ability_effect value = 0 } }
th_combat_log_get_ability_effect_miss = { 					is_variable_equal = { which = th_danmaku_duel_action_$action$_ability_effect value = 1 } }
th_combat_log_get_ability_effect_dealing = { 				is_variable_equal = { which = th_danmaku_duel_action_$action$_ability_effect value = 2 } }
th_combat_log_get_ability_effect_healing = { 				is_variable_equal = { which = th_danmaku_duel_action_$action$_ability_effect value = 3 } }
th_combat_log_get_ability_effect_restore = { 				is_variable_equal = { which = th_danmaku_duel_action_$action$_ability_effect value = 4 } }
th_combat_log_get_ability_effect_afflicting_condition = { 	is_variable_equal = { which = th_danmaku_duel_action_$action$_ability_effect value = 5 } }
th_combat_log_get_ability_effect_gaining_condition = { 		is_variable_equal = { which = th_danmaku_duel_action_$action$_ability_effect value = 6 } }
th_combat_log_get_ability_effect = {
	th_combat_log_get_ability_effect_$ability_effect$ = { action = $action$ }
}

th_combat_log_get_ability_impact_value_NULL = { 	is_variable_equal = { which = th_danmaku_duel_action_$action$_ability_number_impact value = 0 } }
th_combat_log_get_ability_impact_value_yes = { 		is_variable_equal = { which = th_danmaku_duel_action_$action$_ability_number_impact value = 1 } }
th_combat_log_get_ability_impact_value = {
	th_combat_log_get_ability_impact_value_$number_impact$ = { action = $action$ }
}

th_combat_log_get_ability_is_damage_NULL = { 		is_variable_equal = { which = th_danmaku_duel_action_$action$_ability_is_damage value = 0 } }
th_combat_log_get_ability_is_damage_yes = { 		is_variable_equal = { which = th_danmaku_duel_action_$action$_ability_is_damage value = 1 } }
th_combat_log_get_ability_is_damage = {
	th_combat_log_get_ability_is_damage_$is_damage$ = { action = $action$ }
}

th_combat_log_get_ability_is_health_NULL = { 		is_variable_equal = { which = th_danmaku_duel_action_$action$_ability_is_health value = 0 } }
th_combat_log_get_ability_is_health_yes = { 		is_variable_equal = { which = th_danmaku_duel_action_$action$_ability_is_health value = 1 } }
th_combat_log_get_ability_is_health = {
	th_combat_log_get_ability_is_health_$is_health$ = { action = $action$ }
}

th_combat_log_get_ability_is_mana_NULL = { 			is_variable_equal = { which = th_danmaku_duel_action_$action$_ability_is_mana value = 0 } }
th_combat_log_get_ability_is_mana_yes = { 			is_variable_equal = { which = th_danmaku_duel_action_$action$_ability_is_mana value = 1 } }
th_combat_log_get_ability_is_mana = {
	th_combat_log_get_ability_is_mana_$is_mana$ = { action = $action$ }
}

th_combat_log_get_ability_is_action_points_NULL = { is_variable_equal = { which = th_danmaku_duel_action_$action$_ability_is_action_points value = 0 } }
th_combat_log_get_ability_is_action_points_yes = { 	is_variable_equal = { which = th_danmaku_duel_action_$action$_ability_is_action_points value = 1 } }
th_combat_log_get_ability_is_action_points = {
	th_combat_log_get_ability_is_action_points_$is_action_points$ = { action = $action$ }
}

th_combat_log_get_ability_is_critical_NULL = { 		is_variable_equal = { which = th_danmaku_duel_action_$action$_ability_is_critical value = 0 } }
th_combat_log_get_ability_is_critical_yes = { 		is_variable_equal = { which = th_danmaku_duel_action_$action$_ability_is_critical value = 1 } }
th_combat_log_get_ability_is_critical = {
	th_combat_log_get_ability_is_critical_$is_critical$ = { action = $action$ }
}

th_combat_log_get_ability_is_miss_NULL = { 		is_variable_equal = { which = th_danmaku_duel_action_$action$_ability_is_miss value = 0 } }
th_combat_log_get_ability_is_miss_yes = { 		is_variable_equal = { which = th_danmaku_duel_action_$action$_ability_is_miss value = 1 } }
th_combat_log_get_ability_is_miss = {
	th_combat_log_get_ability_is_miss_$is_miss$ = { action = $action$ }
}

th_combat_log_get_hit_roll_NULL = { 	is_variable_equal = { which = th_danmaku_duel_action_$action$_ability_hit_roll value = 0 } }
th_combat_log_get_hit_roll_yes = { 		is_variable_equal = { which = th_danmaku_duel_action_$action$_ability_hit_roll value = 1 } }
th_combat_log_get_hit_roll = {
	th_combat_log_get_hit_roll_$hit_roll$ = { action = $action$ }
}

th_combat_log_get_ability_roll_NULL = { 		is_variable_equal = { which = th_danmaku_duel_action_$action$_ability_roll value = 0 } }
th_combat_log_get_ability_roll_yes = { 			is_variable_equal = { which = th_danmaku_duel_action_$action$_ability_roll value = 1 } }
th_combat_log_get_ability_roll = {
	th_combat_log_get_ability_roll_$ability_roll$ = { action = $action$ }
}
th_pvp_combat_check_combat_resources_available = {
	check_variable = {
		which = th_danmaku_$type$
		value = $value$
	}
}
th_pve_combat_check_combat_resources_available = {
	check_variable = {
		which = th_enemy_character_current_$type$
		value = $value$
	}
}

th_pvp_is_danmaku_class = { th_is_danmaku_class = { class = $class$ } }
th_pve_is_danmaku_class = { th_enemy_is_class = { class = $class$ } }
th_can_use_ability_attack = {
	th_$type$_combat_check_combat_resources_available = { type = action_points value = 30 }
}
th_can_use_ability_magic_bolt = {
	th_$type$_combat_check_combat_resources_available = { type = action_points value = 30 }
	th_$type$_combat_check_combat_resources_available = { type = mana value = 5 }
	th_$type$_is_danmaku_class = { class = mage }
}
th_can_use_ability = {
	th_can_use_ability_$ability$ = { type = pvp }
}
th_ai_can_use_ability = {
	th_can_use_ability_$ability$ = { type = pve }
}
th_ai_can_use_any_ability = {
	OR = {
		th_ai_can_use_ability = { ability = attack }
		th_ai_can_use_ability = { ability = magic_bolt }
	}
}

th_is_alive = {
	check_variable = {
		which = th_danmaku_health
		value = 0.01
	}
}

th_is_alive_solo = {
	check_variable = {
		which = th_enemy_character_current_health
		value = 0.01
	}
}

th_danmaku_duel_is_active = {
	if = {
		limit = {
			has_ruler_flag = th_danmaku_duel_over
			OR = {
				AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 1 } event_target:th_danmaku_duelist_of_id_1_of_instance_1 = { has_ruler_flag = th_danmaku_duel_over } }
				AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 2 } event_target:th_danmaku_duelist_of_id_1_of_instance_2 = { has_ruler_flag = th_danmaku_duel_over } }
				AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 3 } event_target:th_danmaku_duelist_of_id_1_of_instance_3 = { has_ruler_flag = th_danmaku_duel_over } }
				AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 4 } event_target:th_danmaku_duelist_of_id_1_of_instance_4 = { has_ruler_flag = th_danmaku_duel_over } }
				AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 5 } event_target:th_danmaku_duelist_of_id_1_of_instance_5 = { has_ruler_flag = th_danmaku_duel_over } }
				AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 6 } event_target:th_danmaku_duelist_of_id_1_of_instance_6 = { has_ruler_flag = th_danmaku_duel_over } }
				AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 7 } event_target:th_danmaku_duelist_of_id_1_of_instance_7 = { has_ruler_flag = th_danmaku_duel_over } }
				AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 8 } event_target:th_danmaku_duelist_of_id_1_of_instance_8 = { has_ruler_flag = th_danmaku_duel_over } }
				AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 9 } event_target:th_danmaku_duelist_of_id_1_of_instance_9 = { has_ruler_flag = th_danmaku_duel_over } }
				AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 10 } event_target:th_danmaku_duelist_of_id_1_of_instance_10 = { has_ruler_flag = th_danmaku_duel_over } }
				AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 11 } event_target:th_danmaku_duelist_of_id_1_of_instance_11 = { has_ruler_flag = th_danmaku_duel_over } }
				AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 12 } event_target:th_danmaku_duelist_of_id_1_of_instance_12 = { has_ruler_flag = th_danmaku_duel_over } }
				AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 13 } event_target:th_danmaku_duelist_of_id_1_of_instance_13 = { has_ruler_flag = th_danmaku_duel_over } }
				AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 14 } event_target:th_danmaku_duelist_of_id_1_of_instance_14 = { has_ruler_flag = th_danmaku_duel_over } }
				AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 15 } event_target:th_danmaku_duelist_of_id_1_of_instance_15 = { has_ruler_flag = th_danmaku_duel_over } }
				AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 1 } event_target:th_danmaku_duelist_of_id_2_of_instance_1 = { has_ruler_flag = th_danmaku_duel_over } }
				AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 2 } event_target:th_danmaku_duelist_of_id_2_of_instance_2 = { has_ruler_flag = th_danmaku_duel_over } }
				AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 3 } event_target:th_danmaku_duelist_of_id_2_of_instance_3 = { has_ruler_flag = th_danmaku_duel_over } }
				AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 4 } event_target:th_danmaku_duelist_of_id_2_of_instance_4 = { has_ruler_flag = th_danmaku_duel_over } }
				AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 5 } event_target:th_danmaku_duelist_of_id_2_of_instance_5 = { has_ruler_flag = th_danmaku_duel_over } }
				AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 6 } event_target:th_danmaku_duelist_of_id_2_of_instance_6 = { has_ruler_flag = th_danmaku_duel_over } }
				AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 7 } event_target:th_danmaku_duelist_of_id_2_of_instance_7 = { has_ruler_flag = th_danmaku_duel_over } }
				AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 8 } event_target:th_danmaku_duelist_of_id_2_of_instance_8 = { has_ruler_flag = th_danmaku_duel_over } }
				AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 9 } event_target:th_danmaku_duelist_of_id_2_of_instance_9 = { has_ruler_flag = th_danmaku_duel_over } }
				AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 10 } event_target:th_danmaku_duelist_of_id_2_of_instance_10 = { has_ruler_flag = th_danmaku_duel_over } }
				AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 11 } event_target:th_danmaku_duelist_of_id_2_of_instance_11 = { has_ruler_flag = th_danmaku_duel_over } }
				AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 12 } event_target:th_danmaku_duelist_of_id_2_of_instance_12 = { has_ruler_flag = th_danmaku_duel_over } }
				AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 13 } event_target:th_danmaku_duelist_of_id_2_of_instance_13 = { has_ruler_flag = th_danmaku_duel_over } }
				AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 14 } event_target:th_danmaku_duelist_of_id_2_of_instance_14 = { has_ruler_flag = th_danmaku_duel_over } }
				AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 15 } event_target:th_danmaku_duelist_of_id_2_of_instance_15 = { has_ruler_flag = th_danmaku_duel_over } }
			}
		}
		custom_trigger_tooltip = {
			tooltip = th_danmaku_duel_is_active_tt
			OR = {
				NOT = { has_ruler_flag = th_danmaku_duel_over }
				OR = {
					AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 1 } event_target:th_danmaku_duelist_of_id_1_of_instance_1 = { NOT = { has_ruler_flag = th_danmaku_duel_over } } }
					AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 2 } event_target:th_danmaku_duelist_of_id_1_of_instance_2 = { NOT = { has_ruler_flag = th_danmaku_duel_over } } }
					AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 3 } event_target:th_danmaku_duelist_of_id_1_of_instance_3 = { NOT = { has_ruler_flag = th_danmaku_duel_over } } }
					AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 4 } event_target:th_danmaku_duelist_of_id_1_of_instance_4 = { NOT = { has_ruler_flag = th_danmaku_duel_over } } }
					AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 5 } event_target:th_danmaku_duelist_of_id_1_of_instance_5 = { NOT = { has_ruler_flag = th_danmaku_duel_over } } }
					AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 6 } event_target:th_danmaku_duelist_of_id_1_of_instance_6 = { NOT = { has_ruler_flag = th_danmaku_duel_over } } }
					AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 7 } event_target:th_danmaku_duelist_of_id_1_of_instance_7 = { NOT = { has_ruler_flag = th_danmaku_duel_over } } }
					AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 8 } event_target:th_danmaku_duelist_of_id_1_of_instance_8 = { NOT = { has_ruler_flag = th_danmaku_duel_over } } }
					AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 9 } event_target:th_danmaku_duelist_of_id_1_of_instance_9 = { NOT = { has_ruler_flag = th_danmaku_duel_over } } }
					AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 10 } event_target:th_danmaku_duelist_of_id_1_of_instance_10 = { NOT = { has_ruler_flag = th_danmaku_duel_over } } }
					AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 11 } event_target:th_danmaku_duelist_of_id_1_of_instance_11 = { NOT = { has_ruler_flag = th_danmaku_duel_over } } }
					AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 12 } event_target:th_danmaku_duelist_of_id_1_of_instance_12 = { NOT = { has_ruler_flag = th_danmaku_duel_over } } }
					AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 13 } event_target:th_danmaku_duelist_of_id_1_of_instance_13 = { NOT = { has_ruler_flag = th_danmaku_duel_over } } }
					AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 14 } event_target:th_danmaku_duelist_of_id_1_of_instance_14 = { NOT = { has_ruler_flag = th_danmaku_duel_over } } }
					AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 15 } event_target:th_danmaku_duelist_of_id_1_of_instance_15 = { NOT = { has_ruler_flag = th_danmaku_duel_over } } }
					AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 1 } event_target:th_danmaku_duelist_of_id_2_of_instance_1 = { NOT = { has_ruler_flag = th_danmaku_duel_over } } }
					AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 2 } event_target:th_danmaku_duelist_of_id_2_of_instance_2 = { NOT = { has_ruler_flag = th_danmaku_duel_over } } }
					AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 3 } event_target:th_danmaku_duelist_of_id_2_of_instance_3 = { NOT = { has_ruler_flag = th_danmaku_duel_over } } }
					AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 4 } event_target:th_danmaku_duelist_of_id_2_of_instance_4 = { NOT = { has_ruler_flag = th_danmaku_duel_over } } }
					AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 5 } event_target:th_danmaku_duelist_of_id_2_of_instance_5 = { NOT = { has_ruler_flag = th_danmaku_duel_over } } }
					AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 6 } event_target:th_danmaku_duelist_of_id_2_of_instance_6 = { NOT = { has_ruler_flag = th_danmaku_duel_over } } }
					AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 7 } event_target:th_danmaku_duelist_of_id_2_of_instance_7 = { NOT = { has_ruler_flag = th_danmaku_duel_over } } }
					AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 8 } event_target:th_danmaku_duelist_of_id_2_of_instance_8 = { NOT = { has_ruler_flag = th_danmaku_duel_over } } }
					AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 9 } event_target:th_danmaku_duelist_of_id_2_of_instance_9 = { NOT = { has_ruler_flag = th_danmaku_duel_over } } }
					AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 10 } event_target:th_danmaku_duelist_of_id_2_of_instance_10 = { NOT = { has_ruler_flag = th_danmaku_duel_over } } }
					AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 11 } event_target:th_danmaku_duelist_of_id_2_of_instance_11 = { NOT = { has_ruler_flag = th_danmaku_duel_over } } }
					AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 12 } event_target:th_danmaku_duelist_of_id_2_of_instance_12 = { NOT = { has_ruler_flag = th_danmaku_duel_over } } }
					AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 13 } event_target:th_danmaku_duelist_of_id_2_of_instance_13 = { NOT = { has_ruler_flag = th_danmaku_duel_over } } }
					AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 14 } event_target:th_danmaku_duelist_of_id_2_of_instance_14 = { NOT = { has_ruler_flag = th_danmaku_duel_over } } }
					AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 15 } event_target:th_danmaku_duelist_of_id_2_of_instance_15 = { NOT = { has_ruler_flag = th_danmaku_duel_over } } }
				}
			}
		}
	}
}

th_combat_log_check_variable = {
	OR = {
		check_variable = {
			which = th_danmaku_duel_action_$action$_$type$
			value = 0.01
		}
		NOT = {
			check_variable = {
				which = th_danmaku_duel_action_$action$_$type$
				value = 0
			}
		}
	}
}

th_combat_turn_is_running_out_for_instance = {
	th_get_danmaku_duel_instance = { instance = $instance$ }
	1 = {
		NOT = {
			check_variable = {
				which = th_danmaku_duel_instance_$instance$_turn_duration_counter
				which = th_danmaku_default_turn_duration_alarm
			}
		}
	}
}

th_combat_turn_is_running_out_for_current_instance = {
	OR = {
		th_combat_turn_is_running_out_for_instance = { instance = 1 }
		th_combat_turn_is_running_out_for_instance = { instance = 2 }
		th_combat_turn_is_running_out_for_instance = { instance = 3 }
		th_combat_turn_is_running_out_for_instance = { instance = 4 }
		th_combat_turn_is_running_out_for_instance = { instance = 5 }
		th_combat_turn_is_running_out_for_instance = { instance = 6 }
		th_combat_turn_is_running_out_for_instance = { instance = 7 }
		th_combat_turn_is_running_out_for_instance = { instance = 8 }
		th_combat_turn_is_running_out_for_instance = { instance = 9 }
		th_combat_turn_is_running_out_for_instance = { instance = 10 }
		th_combat_turn_is_running_out_for_instance = { instance = 11 }
		th_combat_turn_is_running_out_for_instance = { instance = 12 }
		th_combat_turn_is_running_out_for_instance = { instance = 13 }
		th_combat_turn_is_running_out_for_instance = { instance = 14 }
		th_combat_turn_is_running_out_for_instance = { instance = 15 }
	}
}

th_combat_turn_is_about_to_run_out = {
	th_is_in_a_danmaku_duel = yes
	th_has_turn_ownership = yes
	OR = {
		AND = {
			th_is_duelling_an_unlanded_character = yes
			NOT = {
				check_variable = {
					which = th_danmaku_unlanded_turn_duration
					which = th_danmaku_unlanded_turn_duration_alert
				}
			}
		}
		th_combat_turn_is_running_out_for_current_instance = yes
	}
}

th_danmaku_has_damage_modifier_not_zero = {
	OR = {
		check_variable = {
			which = th_danmaku_$type$_damage_modifier
			value = 0.01
		}
		NOT = {
			check_variable = {
				which = th_danmaku_$type$_damage_modifier
				value = -0.01
			}
		}
	}
}
th_danmaku_unlanded_character_has_damage_modifier_not_zero = {
	th_is_duelling_an_unlanded_character = yes
	OR = {
		check_variable = {
			which = th_enemy_character_$type$_damage_modifier
			value = 0.01
		}
		NOT = {
			check_variable = {
				which = th_enemy_character_$type$_damage_modifier
				value = -0.01
			}
		}
	}
}

th_enemy_has_damage_modifier_not_zero = {
	OR = {
		th_danmaku_unlanded_character_has_damage_modifier_not_zero = { type = $type$ }
		AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 1 } event_target:th_danmaku_duelist_of_id_1_of_instance_1 = { th_danmaku_has_damage_modifier_not_zero = { type = $type$ } } }
		AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 2 } event_target:th_danmaku_duelist_of_id_1_of_instance_2 = { th_danmaku_has_damage_modifier_not_zero = { type = $type$ } } }
		AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 3 } event_target:th_danmaku_duelist_of_id_1_of_instance_3 = { th_danmaku_has_damage_modifier_not_zero = { type = $type$ } } }
		AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 4 } event_target:th_danmaku_duelist_of_id_1_of_instance_4 = { th_danmaku_has_damage_modifier_not_zero = { type = $type$ } } }
		AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 5 } event_target:th_danmaku_duelist_of_id_1_of_instance_5 = { th_danmaku_has_damage_modifier_not_zero = { type = $type$ } } }
		AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 6 } event_target:th_danmaku_duelist_of_id_1_of_instance_6 = { th_danmaku_has_damage_modifier_not_zero = { type = $type$ } } }
		AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 7 } event_target:th_danmaku_duelist_of_id_1_of_instance_7 = { th_danmaku_has_damage_modifier_not_zero = { type = $type$ } } }
		AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 8 } event_target:th_danmaku_duelist_of_id_1_of_instance_8 = { th_danmaku_has_damage_modifier_not_zero = { type = $type$ } } }
		AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 9 } event_target:th_danmaku_duelist_of_id_1_of_instance_9 = { th_danmaku_has_damage_modifier_not_zero = { type = $type$ } } }
		AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 10 } event_target:th_danmaku_duelist_of_id_1_of_instance_10 = { th_danmaku_has_damage_modifier_not_zero = { type = $type$ } } }
		AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 11 } event_target:th_danmaku_duelist_of_id_1_of_instance_11 = { th_danmaku_has_damage_modifier_not_zero = { type = $type$ } } }
		AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 12 } event_target:th_danmaku_duelist_of_id_1_of_instance_12 = { th_danmaku_has_damage_modifier_not_zero = { type = $type$ } } }
		AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 13 } event_target:th_danmaku_duelist_of_id_1_of_instance_13 = { th_danmaku_has_damage_modifier_not_zero = { type = $type$ } } }
		AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 14 } event_target:th_danmaku_duelist_of_id_1_of_instance_14 = { th_danmaku_has_damage_modifier_not_zero = { type = $type$ } } }
		AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 1 instance = 15 } event_target:th_danmaku_duelist_of_id_1_of_instance_15 = { th_danmaku_has_damage_modifier_not_zero = { type = $type$ } } }
		AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 1 } event_target:th_danmaku_duelist_of_id_2_of_instance_1 = { th_danmaku_has_damage_modifier_not_zero = { type = $type$ } } }
		AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 2 } event_target:th_danmaku_duelist_of_id_2_of_instance_2 = { th_danmaku_has_damage_modifier_not_zero = { type = $type$ } } }
		AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 3 } event_target:th_danmaku_duelist_of_id_2_of_instance_3 = { th_danmaku_has_damage_modifier_not_zero = { type = $type$ } } }
		AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 4 } event_target:th_danmaku_duelist_of_id_2_of_instance_4 = { th_danmaku_has_damage_modifier_not_zero = { type = $type$ } } }
		AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 5 } event_target:th_danmaku_duelist_of_id_2_of_instance_5 = { th_danmaku_has_damage_modifier_not_zero = { type = $type$ } } }
		AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 6 } event_target:th_danmaku_duelist_of_id_2_of_instance_6 = { th_danmaku_has_damage_modifier_not_zero = { type = $type$ } } }
		AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 7 } event_target:th_danmaku_duelist_of_id_2_of_instance_7 = { th_danmaku_has_damage_modifier_not_zero = { type = $type$ } } }
		AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 8 } event_target:th_danmaku_duelist_of_id_2_of_instance_8 = { th_danmaku_has_damage_modifier_not_zero = { type = $type$ } } }
		AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 9 } event_target:th_danmaku_duelist_of_id_2_of_instance_9 = { th_danmaku_has_damage_modifier_not_zero = { type = $type$ } } }
		AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 10 } event_target:th_danmaku_duelist_of_id_2_of_instance_10 = { th_danmaku_has_damage_modifier_not_zero = { type = $type$ } } }
		AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 11 } event_target:th_danmaku_duelist_of_id_2_of_instance_11 = { th_danmaku_has_damage_modifier_not_zero = { type = $type$ } } }
		AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 12 } event_target:th_danmaku_duelist_of_id_2_of_instance_12 = { th_danmaku_has_damage_modifier_not_zero = { type = $type$ } } }
		AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 13 } event_target:th_danmaku_duelist_of_id_2_of_instance_13 = { th_danmaku_has_damage_modifier_not_zero = { type = $type$ } } }
		AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 14 } event_target:th_danmaku_duelist_of_id_2_of_instance_14 = { th_danmaku_has_damage_modifier_not_zero = { type = $type$ } } }
		AND = { th_is_not_danmaku_duel_enemy_target = { country_id = 2 instance = 15 } event_target:th_danmaku_duelist_of_id_2_of_instance_15 = { th_danmaku_has_damage_modifier_not_zero = { type = $type$ } } }
	}
}