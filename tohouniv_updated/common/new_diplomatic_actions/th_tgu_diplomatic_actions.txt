###TGU NEWSPAPER ABILITIES###

#Diplo actions here are just recycled and NOT the final addition

#TGU publishes propaganda in the target country -> target loses all AE opinion of root
th_sell_newspaper = {
	category = th_diplo_action
	require_acceptance = yes

	is_visible = {
		OR = {
			th_has_copied_from_target = {
				target = TGU
			}
			has_government_attribute = enables_tengu_newspaper
		}
	}

	is_allowed = {
		if = {
			limit = {
				OR = {
					is_rival = FROM
					is_enemy = FROM
				}
			}
			custom_trigger_tooltip = {
				tooltip = TH_CANNOT_SELL_NEWSPAPER_TO_RIVALS_TT
				NOT = { is_rival = FROM }
				NOT = { is_enemy = FROM }
			}
		}
		if = {
			limit = {
				war_with = FROM
			}
			custom_trigger_tooltip = {
				tooltip = TH_CANNOT_SELL_NEWSPAPER_TO_ENEMIES_TT
				NOT = { war_with = FROM }
			}
		}
		if = {
			limit = {
				FROM = {
					has_country_flag = th_received_newspaper_from_@ROOT
					NOT = {
						had_country_flag = {
							flag = th_received_newspaper_from_@ROOT
							days = 3650
						}
					}
				}
			}
			custom_trigger_tooltip = {
				tooltip = TH_CAN_SELL_ONLY_EVERY_10_YEARS_TT
				FROM = {
					OR = {
						NOT = { has_country_flag = th_received_newspaper_from_@ROOT }
						had_country_flag = {
							flag = th_received_newspaper_from_@ROOT
							days = 3650
						}
					}
				}
			}
		}
		if = {
			limit = {
				FROM = { is_subject_other_than_tributary_trigger = yes }
			}
			custom_trigger_tooltip = {
				tooltip = TH_CANNOT_SELL_NEWSPAPER_TO_SUBJECTS_TT
				FROM = { is_free_or_tributary_trigger = yes }
			}
		}
		if = {
			limit = {
				NOT = {
					any_owned_province = {
						trade_goods = paper
						NOT = { has_province_modifier = th_is_selling_exclusive_newspaper }
					}
				}
			}
			custom_trigger_tooltip = {
				tooltip = TH_NEEDS_ONE_AVAILABLE_PAPER_PROVINCE_TT
				any_owned_province = {
					trade_goods = paper
					NOT = { has_province_modifier = th_is_selling_exclusive_newspaper }
				}
			}
		}
	}

	on_accept = {
		th_clear_copy_flag = yes
		FROM = {
			clr_country_flag = th_received_newspaper_from_@ROOT
			set_country_flag = th_received_newspaper_from_@ROOT
			country_event = {
				id = th_diplo_events.51
			}
		}
		random_owned_province = {
			limit = {
				trade_goods = paper
				NOT = { has_province_modifier = th_is_selling_exclusive_newspaper }
			}
			add_province_modifier = {
				name = th_is_selling_exclusive_newspaper
				duration = 3650
			}
		}
	}


    ai_acceptance = {
        add_entry = {
            name = TH_DIPLO_OPPINION
			export_to_variable = {
				variable_name = ai_value
				value = opinion
				who = FROM
				with = ROOT
			}
			multiply_variable = {
				which = ai_value 
				value = 0.2
			}
        }
		add_entry = {
			name = TH_DIPLO_TRUST_WITH
			export_to_variable = {
				variable_name = ai_value
				value = trust
				who = FROM
				with = ROOT
			}			
			subtract_variable = { 
				which = ai_value
				value = 50
			}
			#1 trust = +4 ai points
			multiply_variable = {
				which = ai_value
				value = 0.4
			}
		}
		add_entry = {
			name = DIPLO_WANT_WAR
			limit = {
				FROM = {
					ai_attitude = {
						who = ROOT
						attitude = attitude_hostile
					}
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = 1
			}
			
			multiply_variable = {
				which = ai_value
				value = -50
			}
		}
		add_entry = {
			name = DIPLO_WANT_WAR
			limit = {
				FROM = {
					ai_attitude = {
						who = ROOT
						attitude = attitude_outraged
					}
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = 1
			}
			
			multiply_variable = {
				which = ai_value
				value = -50
			}
		}
		add_entry = {
			name = DIPLO_IS_RIVAL
			limit = {
				FROM = {
					ai_attitude = {
						who = ROOT
						attitude = attitude_rivalry
					}
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = 1
			}
			
			multiply_variable = {
				which = ai_value
				value = -1000
			}
		}
		add_entry = {
			name = DIPLO_FRIENDLINESS
			limit = {
				FROM = {
					ai_attitude = {
						who = ROOT
						attitude = attitude_friendly
					}
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = 1
			}
			
			multiply_variable = {
				which = ai_value
				value = 20
			}
		}
		add_entry = {
			name = DIPLO_DIPLOMATIC_REPUTATION
			limit = { }
			export_to_variable = {
				variable_name = ai_value
				value = trigger_value:diplomatic_reputation
			}
			#1 rep = 4
			multiply_variable = {
				which = ai_value
				value = 4
			}
		}
		add_entry = {
			name = DIPLO_HISTORICAL_RIVAL
			
			limit = {
				OR = { 
					historical_rival_with = FROM
					FROM = { historical_rival_with = ROOT }
				}
			}
			
			export_to_variable = {
				variable_name = ai_value
				value = 1
			}
			
			multiply_variable = {
				which = ai_value
				value = -100
			}
		}
		add_entry = {
			name = TH_WOULD_GET_IT_FOR_FREE
			limit = {
				FROM = { NOT = { years_of_income = 0.1 } }
			}
			
			export_to_variable = {
				variable_name = ai_value
				value = 1
			}
			
			multiply_variable = {
				which = ai_value
				value = 100
			}
		}
		add_entry = {
			name = TH_WOULD_GET_IT_CHEAPER
			limit = {
				FROM = { 
					years_of_income = 0.1
					NOT = { years_of_income = 0.2 } 
				}
			}
			
			export_to_variable = {
				variable_name = ai_value
				value = 1
			}
			
			multiply_variable = {
				which = ai_value
				value = 80
			}
		}
		add_entry = {
			name = TH_WOULD_GET_IT_CHEAPER
			limit = {
				FROM = { 
					years_of_income = 0.2
					NOT = { years_of_income = 0.3 } 
				}
			}
			
			export_to_variable = {
				variable_name = ai_value
				value = 1
			}
			
			multiply_variable = {
				which = ai_value
				value = 60
			}
		}
		add_entry = {
			name = TH_WOULD_GET_IT_CHEAPER
			limit = {
				FROM = { 
					years_of_income = 0.3
					NOT = { years_of_income = 0.4 } 
				}
			}
			
			export_to_variable = {
				variable_name = ai_value
				value = 1
			}
			
			multiply_variable = {
				which = ai_value
				value = 40
			}
		}
		add_entry = {
			name = TH_WOULD_GET_IT_CHEAPER
			limit = {
				FROM = { 
					years_of_income = 0.4
					NOT = { years_of_income = 0.5 } 
				}
			}
			
			export_to_variable = {
				variable_name = ai_value
				value = 1
			}
			
			multiply_variable = {
				which = ai_value
				value = 20
			}
		}
		add_entry = {
			name = TH_IS_BANKRUPT
			limit = {
				FROM = { 
					is_bankrupt = yes
				}
			}
			
			export_to_variable = {
				variable_name = ai_value
				value = 1
			}
			
			multiply_variable = {
				which = ai_value
				value = -100
			}
		}
    }

	ai_will_do = {
		always = no
	}
}

th_buyoff_newspaper = {
	category = th_diplo_action
	require_acceptance = no

	is_visible = {
		OR = {
			th_has_copied_from_target = {
				target = TGU
			}
			has_government_attribute = enables_tengu_newspaper
		}
	}

	is_allowed = {
		if = {
			limit = {
				OR = {
					is_rival = FROM
					is_enemy = FROM
				}
			}
			custom_trigger_tooltip = {
				tooltip = TH_CANNOT_SELL_NEWSPAPER_TO_RIVALS_TT
				NOT = { is_rival = FROM }
				NOT = { is_enemy = FROM }
			}
		}
		if = {
			limit = {
				war_with = FROM
			}
			custom_trigger_tooltip = {
				tooltip = TH_CANNOT_SELL_NEWSPAPER_TO_ENEMIES_TT
				NOT = { war_with = FROM }
			}
		}
		if = {
			limit = {
				FROM = {
					has_country_flag = th_got_its_newspaper_bought_by_@ROOT
					NOT = {
						had_country_flag = {
							flag = th_got_its_newspaper_bought_by_@ROOT
							days = 3650
						}
					}
				}
			}
			custom_trigger_tooltip = {
				tooltip = TH_ONLY_USABLE_EVERY_10_YEARS_TT
				FROM = {
					OR = {
						NOT = { has_country_flag = th_got_its_newspaper_bought_by_@ROOT }
						had_country_flag = {
							flag = th_got_its_newspaper_bought_by_@ROOT
							days = 3650
						}
					}
				}
			}
		}
		if = {
			limit = {
				FROM = { is_subject_other_than_tributary_trigger = yes }
			}
			custom_trigger_tooltip = {
				tooltip = TH_CANNOT_SELL_NEWSPAPER_TO_SUBJECTS_TT
				FROM = { is_free_or_tributary_trigger = yes }
			}
		}
		if = {
			limit = {
				NOT = { years_of_income = 0.25 }
			}
			years_of_income = 0.25
		}
	}

	on_accept = {
		th_clear_copy_flag = yes
		FROM = {
			clr_country_flag = th_got_its_newspaper_bought_by_@ROOT
			set_country_flag = th_got_its_newspaper_bought_by_@ROOT
			country_event = {
				id = th_diplo_events.53
			}
		}
	}

	ai_will_do = {
		always = no
	}
}

th_spread_good_image = {
	category = th_diplo_action
	require_acceptance = no

	is_visible = {
		OR = {
			th_has_copied_from_target = {
				target = TGU
			}
			has_government_attribute = enables_tengu_newspaper
		}
		FROM = { is_free_or_tributary_trigger = yes }
	}

	is_allowed = {
		if = {
			limit = {
				NOT = {
					has_spy_network_in = {
						who = FROM
						value = 30
					}
				}
			}
			custom_trigger_tooltip = {
				tooltip = TH_REQUIRES_30_SPY_NETWORK_TT
				has_spy_network_in = {
					who = FROM
					value = 30
				}
			}
		}
		if = {
			limit = {
				FROM = {
					has_country_flag = th_received_good_image_of_@ROOT
					NOT = {
						had_country_flag = {
							flag = th_received_good_image_of_@ROOT
							days = 3650
						}
					}
				}
			}
			custom_trigger_tooltip = {
				tooltip = th_spread_good_image_cd_tt
				FROM = {
					OR = {
						NOT = { has_country_flag = th_received_good_image_of_@ROOT }
						had_country_flag = {
							flag = th_received_good_image_of_@ROOT
							days = 3650
						}
					}
				}
			}
		}
		if = {
			limit = {
				FROM = {
					OR = {
						has_country_flag = th_immunity_to_diplomatic_actions
						has_government_attribute = enables_yama_authority
					}
				}
			}
			custom_trigger_tooltip = {
				tooltip = th_from_is_not_immune_to_diplomatic_actions_tt
				FROM = {
					NOT = { has_country_flag = th_immunity_to_diplomatic_actions }
					NOT = { has_government_attribute = enables_yama_authority }
				}
			}
		}
	}

	on_accept = {
		th_clear_copy_flag = yes
		add_stability = 1
		FROM = {
			clr_country_flag = th_received_good_image_of_@ROOT
			set_country_flag = th_received_good_image_of_@ROOT
			remove_opinion = {
				who = ROOT
				modifier = caught_spy
			}
			remove_opinion = {
				who = ROOT
				modifier = declared_war_on_neighbor
			}
			add_opinion = {
				who = ROOT
				modifier = th_good_image
			}
		}
		add_spy_network_in = {
			who = FROM
			value = -30
		}
	}

	ai_will_do = {
		always = no
	}
}

th_denounce_allies = {
	category = th_diplo_action
	require_acceptance = no

	is_visible = {
		OR = {
			th_has_copied_from_target = {
				target = TGU
			}
			AND = {
				has_government_attribute = enables_tengu_newspaper
				has_reform = Gensokyan_tgu_sophisticated_caste_system
			}
		}
		FROM = { is_free_or_tributary_trigger = yes }
	}

	is_allowed = {
		if = {
			limit = {
				NOT = {
					has_spy_network_in = {
						who = FROM
						value = 25
					}
				}
			}
			custom_trigger_tooltip = {
				tooltip = TH_REQUIRES_25_SPY_NETWORK_TT
				has_spy_network_in = {
					who = FROM
					value = 25
				}
			}
		}
		if = {
			limit = {
				FROM = {
					has_country_flag = th_had_to_denounce_allies_by_@ROOT
					NOT = {
						had_country_flag = {
							flag = th_had_to_denounce_allies_by_@ROOT
							days = 1825
						}
					}
				}
			}
			custom_trigger_tooltip = {
				tooltip = TH_CAN_DENOUNCE_EVERY_5_YEARS_TT
				FROM = {
					OR = {
						NOT = { has_country_flag = th_had_to_denounce_allies_by_@ROOT }
						had_country_flag = {
							flag = th_had_to_denounce_allies_by_@ROOT
							days = 1825
						}
					}
				}
			}
		}
		if = {
			limit = {
				FROM = {
					OR = {
						has_country_flag = th_immunity_to_diplomatic_actions
						has_government_attribute = enables_yama_authority
					}
				}
			}
			custom_trigger_tooltip = {
				tooltip = th_from_is_not_immune_to_diplomatic_actions_tt
				FROM = {
					NOT = { has_country_flag = th_immunity_to_diplomatic_actions }
					NOT = { has_government_attribute = enables_yama_authority }
				}
			}
		}
		if = {
			limit = {
				FROM = {
					NOT = { num_of_allies = 1 }
				}
			}
			custom_trigger_tooltip = {
				tooltip = TH_FROM_NEEDS_TO_HAVE_ALLIES
				FROM = {
					num_of_allies = 1
				}
			}
		}
	}

	on_accept = {
		th_clear_copy_flag = yes
		FROM = {
			clr_country_flag = th_had_to_denounce_allies_by_@ROOT
			set_country_flag = th_had_to_denounce_allies_by_@ROOT
			every_ally = {
				reverse_add_opinion = {
					who = FROM
					modifier = th_ally_denouncement
				}
			}
		}
		add_spy_network_in = {
			who = FROM
			value = -25
		}
	}

	ai_will_do = {
		always = no
	}
}

th_demotivate_military = {
	category = th_diplo_action
	require_acceptance = no

	is_visible = {
		OR = {
			th_has_copied_from_target = {
				target = TGU
			}
			AND = {
				has_government_attribute = enables_tengu_newspaper
				has_reform = Gensokyan_tgu_absolute_reign
			}
		}
		FROM = { is_free_or_tributary_trigger = yes }
	}

	is_allowed = {
		if = {
			limit = {
				NOT = {
					has_spy_network_in = {
						who = FROM
						value = 25
					}
				}
			}
			custom_trigger_tooltip = {
				tooltip = TH_REQUIRES_25_SPY_NETWORK_TT
				has_spy_network_in = {
					who = FROM
					value = 25
				}
			}
		}
		if = {
			limit = {
				FROM = {
					OR = {
						has_country_flag = th_immunity_to_diplomatic_actions
						has_government_attribute = enables_yama_authority
					}
				}
			}
			custom_trigger_tooltip = {
				tooltip = th_from_is_not_immune_to_diplomatic_actions_tt
				FROM = {
					NOT = { has_country_flag = th_immunity_to_diplomatic_actions }
					NOT = { has_government_attribute = enables_yama_authority }
				}
			}
		}
		if = {
			limit = {
				FROM = { has_country_modifier = th_demotivated_forces }
			}
			custom_trigger_tooltip = {
				tooltip = th_demotivate_military_tt
				FROM = { NOT = { has_country_modifier = th_demotivated_forces } }
			}
		}
	}

	on_accept = {
		th_clear_copy_flag = yes
		FROM = {
			clr_country_flag = th_got_military_demotivated_by_@ROOT
			set_country_flag = th_got_military_demotivated_by_@ROOT
			add_country_modifier = {
				name = th_demotivated_forces
				duration = 1825
			}
		}
		add_spy_network_in = {
			who = FROM
			value = -25
		}
	}

	ai_will_do = {
		always = no
	}
}

th_spread_republican_ideas = {
	category = th_diplo_action
	require_acceptance = no

	is_visible = {
		OR = {
			th_has_copied_from_target = {
				target = TGU
			}
			AND = {
				has_government_attribute = enables_tengu_newspaper
				has_reform = Gensokyan_tgu_tengu_republic
			}
		}
		FROM = { is_free_or_tributary_trigger = yes }
	}

	is_allowed = {
		if = {
			limit = {
				NOT = {
					has_spy_network_in = {
						who = FROM
						value = 20
					}
				}
			}
			custom_trigger_tooltip = {
				tooltip = TH_REQUIRES_20_SPY_NETWORK_TT
				has_spy_network_in = {
					who = FROM
					value = 20
				}
			}
		}
		if = {
			limit = {
				has_casus_belli = {
					type = cb_th_spread_republican_ideas
					target = FROM
				}
			}
			custom_trigger_tooltip = {
				tooltip = th_spread_republican_ideas_tt
				NOT = {
					has_casus_belli = {
						type = cb_th_spread_republican_ideas
						target = FROM
					}
				}
			}
		}
		if = {
			limit = {
				FROM = { government = repubic }
			}
			custom_trigger_tooltip = {
				tooltip = TH_IS_A_REPUBLIC_TT
				FROM = {
					NOT = { government = republic }
				}
			}
		}
		if = {
			limit = {
				FROM = { tag = PAP }
			}
			custom_trigger_tooltip = {
				tooltip = TH_IS_THE_POPE_TT
				FROM = { NOT = { tag = PAP } }
			}
		}
		if = {
			limit = {
				FROM = { 
					OR = {
						has_reform = celestial_empire
						has_reform = Gensokyan_celestial_empire
					}
				}
			}
			custom_trigger_tooltip = {
				tooltip = TH_IS_THE_CELESTIAL_EMPIRE_TT
				FROM = { 
					NOT = { has_reform = celestial_empire }
					NOT = { has_reform = Gensokyan_celestial_empire }
				}
			}
		}
		if = {
			limit = {
				FROM = {
					is_emperor = yes
				}
			}
			custom_trigger_tooltip = {
				tooltip = TH_IS_HRE_EMPEROR_TT
				FROM = { 
					is_emperor = no
				}
			}
		}
		if = {
			limit = {
				FROM = { 
					has_reform = Gensokyan_hig_yama_government
				}
			}
			custom_trigger_tooltip = {
				tooltip = TH_IS_THE_YAMAXANADU_TT
				FROM = { 
					NOT = { has_reform = Gensokyan_hig_yama_government }
				}
			}
		}
		if = {
			limit = {
				FROM = {
					OR = {
						has_country_flag = th_immunity_to_diplomatic_actions
						has_government_attribute = enables_yama_authority
					}
				}
			}
			custom_trigger_tooltip = {
				tooltip = th_from_is_not_immune_to_diplomatic_actions_tt
				FROM = {
					NOT = { has_country_flag = th_immunity_to_diplomatic_actions }
					NOT = { has_government_attribute = enables_yama_authority }
				}
			}
		}
	}

	on_accept = {
		th_clear_copy_flag = yes
		FROM = {
			clr_country_flag = th_was_targeted_for_cb_by_@ROOT
			set_country_flag = th_was_targeted_for_cb_by_@ROOT
		}
		add_casus_belli = {
			target = FROM
			type = cb_th_spread_republican_ideas
		}
		add_spy_network_in = {
			who = FROM
			value = -20
		}
	}

	ai_will_do = {
		always = no
	}
}

th_write_propaganda = {
	category = th_diplo_action
	require_acceptance = no

	is_visible = {
		OR = {
			th_has_copied_from_target = {
				target = TGU
			}
			has_government_attribute = enables_tengu_newspaper
			#AND = {
			#	#has_country_flag = tgu_unlocked_whitewashing_news
			#}
		}
	}

	is_allowed = {
		if = {
			limit = {
				NOT = {
					has_spy_network_in = {
						who = FROM
						value = 50
					}
				}
			}
			custom_trigger_tooltip = {
				tooltip = TH_REQUIRES_50_SPY_NETWORK_TT
				has_spy_network_in = {
					who = FROM
					value = 50
				}
			}
		}
		if = {
			limit = {
				FROM = {
					has_country_flag = th_read_propaganda_of_@ROOT
					NOT = {
						had_country_flag = {
							flag = th_read_propaganda_of_@ROOT
							days = 3650
						}
					}
				}
			}
			custom_trigger_tooltip = {
				tooltip = th_write_propaganda_cd_tt
				FROM = {
					OR = {
						NOT = { has_country_flag = th_read_propaganda_of_@ROOT }
						had_country_flag = {
							flag = th_read_propaganda_of_@ROOT
							days = 3650
						}
					}
				}
			}
		}
		if = {
			limit = {
				FROM = {
					NOT = {
						has_opinion_modifier = {
							who = ROOT
							modifier = aggressive_expansion
						}
					}
				}
			}
			custom_trigger_tooltip = {
				tooltip = th_has_aggressive_expansion_modifier
				FROM = {
					has_opinion_modifier = {
						who = ROOT
						modifier = aggressive_expansion
					}
				}
			}
		}
		if = {
			limit = {
				FROM = {
					OR = {
						has_country_flag = th_immunity_to_diplomatic_actions
						has_government_attribute = enables_yama_authority
					}
				}
			}
			custom_trigger_tooltip = {
				tooltip = th_from_is_not_immune_to_diplomatic_actions_tt
				FROM = {
					NOT = { has_country_flag = th_immunity_to_diplomatic_actions }
					NOT = { has_government_attribute = enables_yama_authority }
				}
			}
		}
	}

	on_accept = {
		th_clear_copy_flag = yes
		FROM = {
			clr_country_flag = th_read_propaganda_of_@ROOT
			set_country_flag = th_read_propaganda_of_@ROOT
			remove_opinion = {
				who = ROOT
				modifier = aggressive_expansion
			}
		}
		add_spy_network_in = {
			who = FROM
			value = -50
		}
	}

	ai_will_do = {
		always = no
	}
}