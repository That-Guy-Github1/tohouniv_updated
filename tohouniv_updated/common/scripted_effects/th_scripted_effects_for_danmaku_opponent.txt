#Get the extra buffs from the danmaku modifiers
#type
#skill_boni
#variable - the output
# th_character_skill_{{id}} = {
# 	set_variable = {#set a default
# 		which = $variable$
# 		value = 0
# 	}
# 	if = {
# 		limit = {
# 			exists = {{tag}}
# 		}
# 		{{tag}} = {
# 			th_getruler_fighting_skill = {
# 				skill_boni = $skill_boni$
# 				type = $type$
# 			}
#             th_danmaku_set_compare_variable = {
#                 type = $type$
#             }
#             th_export_root_variable_into_foreign = {
#                 who = PREV
#                 root_variable = th_current_fighting_skills_counter
#                 foreign_variable = $variable$
#             }
# 		}
# 	}#TODO other cases
# 	else = {
# 		set_variable = {
# 			which = $variable$
# 			value = {{danmaku_power}}
# 		}
# 	}
# }
th_character_skill_rumia = {
	set_variable = {#set a default
		which = $variable$
		value = 0
	}
	if = {
		limit = {
			exists = ROD
		}
		ROD = {
			th_getruler_fighting_skill = {
				skill_boni = $skill_boni$
				type = $type$
			}
            th_danmaku_set_compare_variable = {
                type = $type$
            }
            th_export_root_variable_into_foreign = {
                who = PREV
                root_variable = th_current_fighting_skills_counter
                foreign_variable = $variable$
            }
		}
	}#TODO other cases
	else = {
		set_variable = {
			which = $variable$
			value = 950
		}
	}
}

# th_initiate_danmaku_fight_against_{{id}} = {
# 	if = {
# 		limit = {
# 			exists = {{tag}}
# 		}
# 		{{tag}} = {
# 			clr_country_flag = th_was_already_danmaku_challenged_by_@ROOT
#             clr_country_flag = th_danmaku_duel_lost_against_@FROM
# 			[[normal]] = {
# 				country_event = {
# 					id = th_diplo_events.23
# 					days = 1
# 				}
# 			}
# 			[[incident]] = {
# 				country_event = {
# 					id = th_incidents_event.30
# 					days = 1
# 				}
# 			}
# 			if = {
# 				limit = { NOT = { has_country_flag = th_has_danmaku_decline_counter } }
# 				set_country_flag = th_has_danmaku_decline_counter
# 				set_variable = {
# 					which = th_declined_danmaku_duel_counter
# 					value = 0
# 				}
# 			}
# 		}
# 	}
# 	else = {
# 		th_danmaku_incident_fight_ruler_and_opponent = yes
# 	}
# }

th_initiate_danmaku_fight_against_rumia = {
	if = {
		limit = {
			exists = ROD
		}
		save_event_target_as = investigator_tag
		ROD = {
			clr_country_flag = th_was_already_danmaku_challenged_by_@ROOT
            clr_country_flag = th_danmaku_duel_lost_against_@FROM
			[[normal]] = {
				country_event = {
					id = th_diplo_events.23
					days = 1
				}
			}
			[[incident]] = {
				country_event = {
					id = th_incidents_event.30
					days = 1
				}
			}
			if = {
				limit = { NOT = { has_country_flag = th_has_danmaku_decline_counter } }
				set_country_flag = th_has_danmaku_decline_counter
				set_variable = {
					which = th_declined_danmaku_duel_counter
					value = 0
				}
			}
		}
	}
	else = {
		th_danmaku_incident_fight_ruler_and_opponent = yes
	}
}