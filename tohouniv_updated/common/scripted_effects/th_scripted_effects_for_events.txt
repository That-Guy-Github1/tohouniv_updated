th_states_spawn_rival_rebels = {
	if = {
		limit = {
			owner = {
				has_reform = Gensokyan_kaguya_states_reform
			}
		}
		spawn_rebels = {
			type = nationalist_rebels
			friend = FUJ
			size = $size$
		}
	}
	else_if = {
		limit = {
			owner = {
				has_reform = Gensokyan_mokou_states_reform				
			}
		}
		spawn_rebels = {
			type = nationalist_rebels
			friend = EIT
			size = $size$
		}
	}
	spawn_rebels = {		
		type = noble_rebels
		size = $size$
	}
}

th_change_gensokyo_dev = {
	hidden_effect = {
		#min_plus_one is needed so provinces can't get into negative / zero development
		#If min_plus_one = 0 then this effect should not be used to decrease development (tax, production, manpower > 0)
		gensokyo_continent = {
			if = {
				limit = {
					base_tax = $min_plus_one$
				}
				add_base_tax = $tax$
			}
			else = {
				set_base_tax = 1
			}
			if = {
				limit = {
					base_production = $min_plus_one$
				}
				add_base_production = $production$
			}
			else = {
				set_base_production = 1
			}
			if = {
				limit = {
					base_manpower = $min_plus_one$
				}
				add_base_manpower = $manpower$
			}
			else = {
				set_base_manpower = 1
			}
		}
		moon_continent = {
			if = {
				limit = {
					base_tax = $min_plus_one$
				}
				add_base_tax = $tax$
			}
			else = {
				set_base_tax = 1
			}
			if = {
				limit = {
					base_production = $min_plus_one$
				}
				add_base_production = $production$
			}
			else = {
				set_base_production = 1
			}
			if = {
				limit = {
					base_manpower = $min_plus_one$
				}
				add_base_manpower = $manpower$
			}
			else = {
				set_base_manpower = 1
			}
		}
	}
}

th_cause_aggressive_expansion_against_target = {
	#Make sure to define own custom tooltip because PDX doesn't like parameters to be used in loc files
	set_variable = {
		which = th_ae_variable
		value = $value$
	}
	while = {
		limit = {
			check_variable = {
				which = th_ae_variable
				value = 1
			}
		}
		add_opinion = {
			who = $who$
			modifier = aggressive_expansion
		}
		subtract_variable = {
			which = th_ae_variable
			value = 1
		}
	}
}

th_mry_shinto_remove_sanae_buffs = {
	hidden_effect = {
		remove_country_modifier = th_mry_shinto_hakureis_power
		remove_country_modifier = th_mry_shinto_keikis_idols
		remove_country_modifier = th_mry_shinto_kishin_lunar_naval
	}
}

th_mry_shinto_remove_suwako_buffs = {
	hidden_effect = {
		remove_country_modifier = th_mry_shinto_sukunas_envoys
		remove_country_modifier = th_mry_shinto_hinas_misfortune
		remove_country_modifier = th_mry_shinto_hecatias_hell_workers
	}
}

th_mry_shinto_remove_kanako_buffs = {
	hidden_effect = {
		remove_country_modifier = th_mry_shinto_junkos_fury
		remove_country_modifier = th_mry_shinto_shinkis_merchants
		remove_country_modifier = th_mry_shinto_satoris_influence
	}
}

th_mry_shinto_remove_boni = {
	hidden_effect = {
		th_mry_shinto_remove_sanae_buffs = yes
		th_mry_shinto_remove_suwako_buffs = yes
		th_mry_shinto_remove_kanako_buffs = yes
	}
}

th_buddhism_clear_meditation = {
	custom_tooltip = th_bdh_longer_cancel_meditation
	hidden_effect = {
		set_country_flag = th_buddhism_meditation_cd
		remove_country_modifier = th_buddhism_meditating
		clr_ruler_flag = th_buddhism_ruler_is_meditating
		clr_ruler_flag = th_buddhism_meditation_available
	}
}

th_taoism_remove_all_five_ways = {
	remove_country_modifier = th_taoism_wood_cycle
	remove_country_modifier = th_taoism_fire_cycle
	remove_country_modifier = th_taoism_earth_cycle
	remove_country_modifier = th_taoism_metal_cycle
	remove_country_modifier = th_taoism_water_cycle
}

th_taoism_normal_cycle = {
	if = {
		limit = {
			has_country_flag = th_taoism_had_wood
		}
		clr_country_flag = th_taoism_had_wood
		set_country_flag = th_taoism_had_fire
		add_country_modifier = {
			name = th_taoism_fire_cycle
			duration = -1
		}
	}
	else_if = {
		limit = {
			has_country_flag = th_taoism_had_fire
		}
		clr_country_flag = th_taoism_had_fire
		set_country_flag = th_taoism_had_earth
		add_country_modifier = {
			name = th_taoism_earth_cycle
			duration = -1
		}
	}
	else_if = {
		limit = {
			has_country_flag = th_taoism_had_earth
		}
		clr_country_flag = th_taoism_had_earth
		set_country_flag = th_taoism_had_metal
		add_country_modifier = {
			name = th_taoism_metal_cycle
			duration = -1
		}
	}
	else_if = {
		limit = {			
			has_country_flag = th_taoism_had_metal
		}
		clr_country_flag = th_taoism_had_metal
		set_country_flag = th_taoism_had_water
		add_country_modifier = {
			name = th_taoism_water_cycle
			duration = -1
		}
	}
	else_if = {
		limit = {
			has_country_flag = th_taoism_had_water
		}
		clr_country_flag = th_taoism_had_water
		set_country_flag = th_taoism_had_wood
		add_country_modifier = {
			name = th_taoism_wood_cycle
			duration = -1
		}
	}
}

th_taoism_revert_cycle = {
	if = {
		limit = {
			has_country_flag = th_taoism_had_wood
		}
		clr_country_flag = th_taoism_had_wood
		set_country_flag = th_taoism_had_water
		add_country_modifier = {
			name = th_taoism_water_cycle
			duration = -1
		}
	}
	else_if = {
		limit = {
			has_country_flag = th_taoism_had_fire
		}
		clr_country_flag = th_taoism_had_fire
		set_country_flag = th_taoism_had_wood
		add_country_modifier = {
			name = th_taoism_wood_cycle
			duration = -1
		}
	}
	else_if = {
		limit = {
			has_country_flag = th_taoism_had_earth
		}
		clr_country_flag = th_taoism_had_earth
		set_country_flag = th_taoism_had_fire
		add_country_modifier = {
			name = th_taoism_fire_cycle
			duration = -1
		}
	}
	else_if = {
		limit = {			
			has_country_flag = th_taoism_had_metal
		}
		clr_country_flag = th_taoism_had_metal
		set_country_flag = th_taoism_had_earth
		add_country_modifier = {
			name = th_taoism_earth_cycle
			duration = -1
		}
	}
	else_if = {
		limit = {
			has_country_flag = th_taoism_had_water
		}
		clr_country_flag = th_taoism_had_water
		set_country_flag = th_taoism_had_metal
		add_country_modifier = {
			name = th_taoism_metal_cycle
			duration = -1
		}
	}
}

th_taoism_control_cycle = {
	if = {
		limit = {
			has_country_flag = th_taoism_had_wood
		}
		clr_country_flag = th_taoism_had_wood
		set_country_flag = th_taoism_had_earth
		add_country_modifier = {
			name = th_taoism_earth_cycle
			duration = -1
		}
	}
	else_if = {
		limit = {
			has_country_flag = th_taoism_had_fire
		}
		clr_country_flag = th_taoism_had_fire
		set_country_flag = th_taoism_had_metal
		add_country_modifier = {
			name = th_taoism_metal_cycle
			duration = -1
		}
	}
	else_if = {
		limit = {
			has_country_flag = th_taoism_had_earth
		}
		clr_country_flag = th_taoism_had_earth
		set_country_flag = th_taoism_had_water
		add_country_modifier = {
			name = th_taoism_water_cycle
			duration = -1
		}
	}
	else_if = {
		limit = {			
			has_country_flag = th_taoism_had_metal
		}
		clr_country_flag = th_taoism_had_metal
		set_country_flag = th_taoism_had_wood
		add_country_modifier = {
			name = th_taoism_wood_cycle
			duration = -1
		}
	}
	else_if = {
		limit = {
			has_country_flag = th_taoism_had_water
		}
		clr_country_flag = th_taoism_had_water
		set_country_flag = th_taoism_had_fire
		add_country_modifier = {
			name = th_taoism_fire_cycle
			duration = -1
		}
	}
}

th_taoism_destroy_cycle = {
	if = {
		limit = {
			has_country_flag = th_taoism_had_wood
		}
		clr_country_flag = th_taoism_had_wood
		set_country_flag = th_taoism_had_metal
		add_country_modifier = {
			name = th_taoism_metal_cycle
			duration = -1
		}
	}
	else_if = {
		limit = {
			has_country_flag = th_taoism_had_fire
		}
		clr_country_flag = th_taoism_had_fire
		set_country_flag = th_taoism_had_water
		add_country_modifier = {
			name = th_taoism_water_cycle
			duration = -1
		}
	}
	else_if = {
		limit = {
			has_country_flag = th_taoism_had_earth
		}
		clr_country_flag = th_taoism_had_earth
		set_country_flag = th_taoism_had_wood
		add_country_modifier = {
			name = th_taoism_wood_cycle
			duration = -1
		}
	}
	else_if = {
		limit = {			
			has_country_flag = th_taoism_had_metal
		}
		clr_country_flag = th_taoism_had_metal
		set_country_flag = th_taoism_had_fire
		add_country_modifier = {
			name = th_taoism_fire_cycle
			duration = -1
		}
	}
	else_if = {
		limit = {
			has_country_flag = th_taoism_had_water
		}
		clr_country_flag = th_taoism_had_water
		set_country_flag = th_taoism_had_earth
		add_country_modifier = {
			name = th_taoism_earth_cycle
			duration = -1
		}
	}
}

###FAIRY ELECTION###
th_show_random_candidate_bonus = {
	if = {
		limit = {
			has_global_modifier_value = {
				which = candidate_random_bonus
				value = 1
			}
		}
		custom_tooltip = th_lottery_candidate_bonus_one
	}
}

th_show_random_candidate_bonus_plural = {
	if = {
		limit = {
			has_global_modifier_value = {
				which = candidate_random_bonus
				value = 1
			}
		}
		custom_tooltip = th_lottery_candidate_bonus_plural
	}
}

###MHG MERC STUFF###
th_mhg_set_merc_flags = {
	if = {
		limit = {
			NOT = {
				any_hired_mercenary_company = {
					template = merc_th_yukaris_royal_guard
				}
			}
			NOT = { has_country_flag = mhg_not_hired_royal_guard }
		}
		set_country_flag = mhg_not_hired_royal_guard
	}
	if = {
		limit = {
			NOT = {
				any_hired_mercenary_company = {
					template = merc_th_knights_templar
				}
			}
			NOT = { has_country_flag = mhg_not_hired_knights_templar }
		}
		set_country_flag = mhg_not_hired_knights_templar
	}
	if = {
		limit = {
			NOT = {
				any_hired_mercenary_company = {
					template = merc_th_swiss_canton_mercenaries
				}
			}
			NOT = { has_country_flag = mhg_not_hired_swiss_canton }
		}
		set_country_flag = mhg_not_hired_swiss_canton
	}
	if = {
		limit = {
			NOT = {
				any_hired_mercenary_company = {
					template = merc_th_doppelsoeldner
				}
			}
			NOT = { has_country_flag = mhg_not_hired_doppelsoeldner }
		}
		set_country_flag = mhg_not_hired_doppelsoeldner
	}
	if = {
		limit = {
			NOT = {
				any_hired_mercenary_company = {
					template = merc_th_hessian_jaegerkorps
				}
			}
			NOT = { has_country_flag = mhg_not_hired_jaegerkorps }
		}
		set_country_flag = mhg_not_hired_jaegerkorps
	}
	if = {
		limit = {
			NOT = {
				any_hired_mercenary_company = {
					template = merc_th_gorkhalis
				}
			}
			NOT = { has_country_flag = mhg_not_hired_gorkhalis }
		}
		set_country_flag = mhg_not_hired_gorkhalis
	}
	if = {
		limit = {
			NOT = {
				any_hired_mercenary_company = {
					template = merc_th_dahomey_amazons
				}
			}
			NOT = { has_country_flag = mhg_not_hired_amazons }
		}
		set_country_flag = mhg_not_hired_amazons
	}
}

th_mhg_refund_costs_for_mercs = {
	if = {
		limit = {
			any_hired_mercenary_company = {
				template = merc_th_yukaris_royal_guard
			}
			has_country_flag = mhg_not_hired_royal_guard
		}
		clr_country_flag = mhg_not_hired_royal_guard
		if = {
			limit = {
				has_country_flag = th_pay_mil_instead_of_prof
			}
			add_mil_power = 10
		}
		else_if = {
			limit = {
				has_country_flag = th_merc_eighty_percent_professionalism_cost
			}
			add_army_professionalism = 0.04
		}
		else = {
			add_army_professionalism = 0.05
		}
	}
	if = {
		limit = {
			any_hired_mercenary_company = {
				template = merc_th_knights_templar
			}
			has_country_flag = mhg_not_hired_knights_templar
		}
		clr_country_flag = mhg_not_hired_knights_templar
		if = {
			limit = {
				has_country_flag = th_pay_mil_instead_of_prof
			}
			add_mil_power = 10
		}
		else_if = {
			limit = {
				has_country_flag = th_merc_eighty_percent_professionalism_cost
			}
			add_army_professionalism = 0.04
		}
		else = {
			add_army_professionalism = 0.05
		}
	}
	if = {
		limit = {
			any_hired_mercenary_company = {
				template = merc_th_swiss_canton_mercenaries
			}
			has_country_flag = mhg_not_hired_swiss_canton
		}
		clr_country_flag = mhg_not_hired_swiss_canton
		if = {
			limit = {
				has_country_flag = th_pay_mil_instead_of_prof
			}
			add_mil_power = 10
		}
		else_if = {
			limit = {
				has_country_flag = th_merc_eighty_percent_professionalism_cost
			}
			add_army_professionalism = 0.04
		}
		else = {
			add_army_professionalism = 0.05
		}
	}
	if = {
		limit = {
			any_hired_mercenary_company = {
				template = merc_th_doppelsoeldner
			}
			has_country_flag = mhg_not_hired_doppelsoeldner
		}
		clr_country_flag = mhg_not_hired_doppelsoeldner
		if = {
			limit = {
				has_country_flag = th_pay_mil_instead_of_prof
			}
			add_mil_power = 10
		}
		else_if = {
			limit = {
				has_country_flag = th_merc_eighty_percent_professionalism_cost
			}
			add_army_professionalism = 0.04
		}
		else = {
			add_army_professionalism = 0.05
		}
	}
	if = {
		limit = {
			any_hired_mercenary_company = {
				template = merc_th_hessian_jaegerkorps
			}
			has_country_flag = mhg_not_hired_jaegerkorps
		}
		clr_country_flag = mhg_not_hired_jaegerkorps
		if = {
			limit = {
				has_country_flag = th_pay_mil_instead_of_prof
			}
			add_mil_power = 10
		}
		else_if = {
			limit = {
				has_country_flag = th_merc_eighty_percent_professionalism_cost
			}
			add_army_professionalism = 0.04
		}
		else = {
			add_army_professionalism = 0.05
		}
	}
	if = {
		limit = {
			any_hired_mercenary_company = {
				template = merc_th_gorkhalis
			}
			has_country_flag = mhg_not_hired_gorkhalis
		}
		clr_country_flag = mhg_not_hired_gorkhalis
		if = {
			limit = {
				has_country_flag = th_pay_mil_instead_of_prof
			}
			add_mil_power = 10
		}
		else_if = {
			limit = {
				has_country_flag = th_merc_eighty_percent_professionalism_cost
			}
			add_army_professionalism = 0.04
		}
		else = {
			add_army_professionalism = 0.05
		}
	}
	if = {
		limit = {
			any_hired_mercenary_company = {
				template = merc_th_dahomey_amazons
			}
			has_country_flag = mhg_not_hired_amazons
		}
		clr_country_flag = mhg_not_hired_amazons
		if = {
			limit = {
				has_country_flag = th_pay_mil_instead_of_prof
			}
			add_mil_power = 10
		}
		else_if = {
			limit = {
				has_country_flag = th_merc_eighty_percent_professionalism_cost
			}
			add_army_professionalism = 0.04
		}
		else = {
			add_army_professionalism = 0.05
		}
	}
}

th_mhg_mark_march_as_special_case = {
	custom_tooltip = th_mhg_mark_march_as_special_case_tt
	hidden_effect = {
		set_country_flag = mhg_is_special_case_march
	}
}