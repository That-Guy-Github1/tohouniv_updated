th_add_random_ruler_personality_republic = {
	random_list = {
		1 = { add_ruler_personality = righteous_personality }
		1 = { add_ruler_personality = just_personality }
		1 = { add_ruler_personality = tolerant_personality }
		1 = { add_ruler_personality = kind_hearted_personality }
		1 = { add_ruler_personality = free_thinker_personality }
		1 = { add_ruler_personality = well_connected_personality }
		1 = { add_ruler_personality = calm_personality }
		1 = { add_ruler_personality = careful_personality }
		1 = { add_ruler_personality = secretive_personality }
		1 = { add_ruler_personality = intricate_web_weaver_personality }
		1 = { add_ruler_personality = well_advised_personality }
		1 = { add_ruler_personality = benevolent_personality }
		1 = { add_ruler_personality = zealot_personality }
		1 = { add_ruler_personality = lawgiver_personality }
		1 = { add_ruler_personality = midas_touched_personality }
		1 = { add_ruler_personality = incorruptible_personality }
		1 = { add_ruler_personality = architectural_visionary_personality }
		1 = { add_ruler_personality = scholar_personality }
		1 = { add_ruler_personality = entrepreneur_personality }
		1 = { add_ruler_personality = industrious_personality }
		1 = { add_ruler_personality = charismatic_negotiator_personality }
		1 = { add_ruler_personality = silver_tongue_personality }
		1 = { add_ruler_personality = conqueror_personality }
		1 = { add_ruler_personality = tactical_genius_personality }
		1 = { add_ruler_personality = bold_fighter_personality }
		1 = { add_ruler_personality = strict_personality }
		1 = { add_ruler_personality = inspiring_leader_personality }
		1 = { add_ruler_personality = martial_educator_personality }
		1 = { add_ruler_personality = navigator_personality }
		1 = { add_ruler_personality = fierce_negotiator_personality }
		1 = { add_ruler_personality = babbling_buffoon_personality }
		1 = { add_ruler_personality = embezzler_personality }
		1 = { add_ruler_personality = drunkard_personality }
		1 = { add_ruler_personality = sinner_personality }
		1 = { add_ruler_personality = greedy_personality }
		1 = { add_ruler_personality = cruel_personality }
		1 = { add_ruler_personality = naive_personality }
		1 = { add_ruler_personality = craven_personality }
		1 = { add_ruler_personality = loose_lips_personality }
		1 = { add_ruler_personality = obsessive_perfectionist_personality }
		1 = { add_ruler_personality = malevolent_personality }
	}
}

th_mry_holy_site_activation_effect = {
	set_global_flag = $holy_site_flag$
	every_country = {
		limit = { religion = th_moriyashinto }
		country_event = {
			id = $activation_event$
		}
	}
}

th_mry_holy_site_deactivation_effect = {
	clr_global_flag = $holy_site_flag$
	every_country = {
		limit = { religion = th_moriyashinto }
		country_event = {
			id = $deactivation_event$
		}
	}
}

th_on_province_religion_converted_effect = {
	if = {
		limit = {
			religion = th_moriyashinto
		}
		mry_add_scaled_province_conversion_faith_power = {
			value = 1
			development_factor = 0.25
		}
	}
	if = {
		limit = {
			has_province_modifier = th_intolerance_to_mortals
			religion = ROOT
		}
		remove_province_modifier = th_intolerance_to_mortals
	}
}

th_on_province_owner_change_effect = {
	if = {
		limit = {
			owner = {
				OR = {
					has_government_attribute = th_winter_adaptability
					has_country_flag = th_winter_adaptability_flag
				}
			}
		}
		if = {
			limit = {
				has_climate = arctic
			}
			add_province_modifier = {
				name = mkn_arctic_immunity
				duration = -1
			}
		}
		if = {
			limit = {
				has_terrain = glacier
			}
			add_province_modifier = {
				name = mkn_glacial_immunity
				duration = -1
			}
		}
	}
	else = {
		if = {
			limit = {
				OR = {
					has_province_modifier = mkn_arctic_immunity
					has_province_modifier = mkn_glacial_immunity
				}
			}
			remove_province_modifier = mkn_arctic_immunity
			remove_province_modifier = mkn_glacial_immunity
		}
	}
	if = {
		limit = {
			owner = {
				OR = {
					has_government_attribute = th_winter_afinity
					has_country_flag = th_winter_afinity_flag
				}
			}
		}
		if = {
			limit = {
				has_winter = severe_winter
			}
			add_province_modifier = {
				name = mkn_severe_winter_affinity
				duration = -1
			}
		}
	}
	else = {
		if = {
			limit = {
				has_province_modifier = mkn_severe_winter_affinity
			}
			remove_province_modifier = mkn_severe_winter_affinity
		}
	}
	if = {
		limit = {
			owner = { NOT = { has_government_attribute = th_own_provinces_go_berserk } }
			th_hellfairy_has_any_flag = yes
		}
		if = {
			limit = { th_hellfairy_has_positive_berserk = yes }
			hellfairy_add_negative_berserk = {
				days = 1825
			}
		}
		hellfairy_remove_all_berserk_stack = yes
	}
	if = {
		limit = {
			religion = th_hakureishinto
			has_province_modifier = th_accepted_heretics
			owner = { NOT = { has_country_flag = revolution_of_shintoism_flag } }
		}
		remove_province_modifier = th_accepted_heretics
	}
	if = {
		limit = {
			religion = th_hakureishinto
			NOT = { has_province_modifier = th_accepted_heretics }
			owner = { has_country_flag = revolution_of_shintoism_flag }
		}
		add_province_modifier = {
			name = th_accepted_heretics
			duration = -1
		}
	}
	if = {
		limit = {
			has_pasha = yes
			owner = { has_government_attribute = pashas_purify_land }
		}
		add_province_modifier = {
			name = th_purifying_pasha
			duration = -1
		}
	}
	if = {
		limit = {
			owner = {
				has_government_attribute = uses_purified_land
			}
		}
		if = {
			limit = {
				OR = {
					lcu_is_accepted_province_culture = yes
					has_owner_culture = yes
				}
			}
			add_province_modifier = {
				name = th_pure_land
				duration = -1
			}
		}
		else_if = {
			limit = {
				has_owner_accepted_culture = no
				lcu_is_not_accepted_province_culture = yes
			}
			add_province_modifier = {
				name = th_impure_land
				duration = -1
			}
		}
	}
}

th_on_province_culture_change_effect = {
	remove_province_modifier = th_pure_land
	remove_province_modifier = th_impure_land
	if = {
		limit = {
			owner = {
				has_government_attribute = uses_purified_land
			}
		}
		if = {
			limit = {
				OR = {
					lcu_is_accepted_province_culture = yes
					has_owner_culture = yes
				}
			}
			add_province_modifier = {
				name = th_pure_land
				duration = -1
			}
		}
		else_if = {
			limit = {
				has_owner_accepted_culture = no
				lcu_is_not_accepted_province_culture = yes
			}
			add_province_modifier = {
				name = th_impure_land
				duration = -1
			}
		}
	}
}

th_on_province_owner_change_estate_privileges_effect = {
	#Dev Cost Reductions
	if = {
		limit = {
			owner = {
				has_estate_privilege = th_estate_burghers_swamp_developers
			}
		}
		if = {
			limit = {
				has_terrain = marsh
			}
			add_province_modifier = {
				name = th_estate_burghers_swamp_developers_marsh_modifier
				duration = -1
			}
		}
		if = {
			limit = {
				has_terrain = grasslands
			}
			add_province_modifier = {
				name = th_estate_burghers_swamp_developers_grassland_modifier
				duration = -1
			}
		}
		if = {
			limit = {
				has_terrain = farmlands
			}
			add_province_modifier = {
				name = th_estate_burghers_swamp_developers_farmlands_modifier
				duration = -1
			}
		}
		if = {
			limit = {
				has_terrain = jungle
			}
			add_province_modifier = {
				name = th_estate_burghers_swamp_developers_jungle_modifier
				duration = -1
			}
		}
	}
	if = {
		limit = {
			owner = {
				has_estate_privilege = estate_burghers_mountain_expansion
			}
		}
		if = {
			limit = {
				has_terrain = mountain
			}
			add_province_modifier = {
				name = estate_crow_tengu_mountain_expansion_mountains
				duration = -1
			}
		}
		if = {
			limit = {
				has_terrain = highlands
			}
			add_province_modifier = {
				name = estate_crow_tengu_mountain_expansion_highlands
				duration = -1
			}
		}
		if = {
			limit = {
				has_terrain = hills
			}
			add_province_modifier = {
				name = estate_crow_tengu_mountain_expansion_hills
				duration = -1
			}
		}
	}
	if = {
		limit = {
			OR = {
				area = Land_of_the_dead
				area = Eastern_higan
				area = Higan_southern_coast
			}
			owner = { has_estate_privilege = th_estate_nobles_lack_of_overseers }
		}
		add_local_autonomy = 50
		add_province_modifier = {
			name = hig_slacking_shinigami
			duration = -1
		}
	}
	#Monopolies
	if = {
		limit = {
			owner = { has_estate_privilege = estate_crow_tengu_monopoly_of_textiles }
			OR = {
				trade_goods = cloth
				trade_goods = silk
			}
		}
		add_province_modifier = {
			name = estate_crow_tengu_monopoly_of_textiles_mod
			duration = -1
		}
	}
	if = {
		limit = {
			owner = { has_estate_privilege = estate_crow_tengu_monopoly_of_dyes }
			trade_goods = dyes
		}
		add_province_modifier = {
			name = estate_crow_tengu_monopoly_of_dyes_mod
			duration = -1
		}
	}
	if = {
		limit = {
			owner = { has_estate_privilege = estate_crow_tengu_monopoly_of_glass }
			trade_goods = glass
		}
		add_province_modifier = {
			name = estate_crow_tengu_monopoly_of_glass_mod
			duration = -1
		}
	}
	if = {
		limit = {
			owner = { has_estate_privilege = estate_crow_tengu_monopoly_of_paper }
			trade_goods = paper
		}
		add_province_modifier = {
			name = estate_crow_tengu_monopoly_of_paper_mod
			duration = -1
		}
	}
	if = {
		limit = {
			owner = { has_estate_privilege = estate_great_tengu_monopoly_of_metals }
			OR = {
				trade_goods = copper
				trade_goods = iron
			}
		}
		add_province_modifier = {
			name = estate_great_tengu_monopoly_of_metals_mod
			duration = -1
		}
	}
	if = {
		limit = {
			owner = { has_estate_privilege = estate_great_tengu_monopoly_of_livestock }
			trade_goods = livestock
		}
		add_province_modifier = {
			name = estate_great_tengu_monopoly_of_livestock_mod
			duration = -1
		}
	}
	if = {
		limit = {
			owner = { has_estate_privilege = estate_great_tengu_monopoly_of_gems }
			trade_goods = gems
		}
		add_province_modifier = {
			name = estate_great_tengu_monopoly_of_gems_mod
			duration = -1
		}
	}
	if = {
		limit = {
			owner = { has_estate_privilege = estate_wolf_tengu_monopoly_of_wood }
			OR = {
				trade_goods = tropical_wood
				trade_goods = naval_supplies
			}
		}
		add_province_modifier = {
			name = estate_wolf_tengu_monopoly_of_wood_mod
			duration = -1
		}
	}
	if = {
		limit = {
			owner = { has_estate_privilege = estate_wolf_tengu_monopoly_of_cotton_and_sugar }
			OR = {
				trade_goods = cotton
				trade_goods = sugar
			}
		}
		add_province_modifier = {
			name = estate_wolf_tengu_monopoly_of_cotton_and_sugar_mod
			duration = -1
		}
	}
	if = {
		limit = {
			owner = { has_estate_privilege = estate_wolf_tengu_monopoly_of_grain_and_fish }
			OR = {
				trade_goods = grain
				trade_goods = fish
			}
		}
		add_province_modifier = {
			name = estate_wolf_tengu_monopoly_of_grain_and_fish_mod
			duration = -1
		}
	}
	if = {
		limit = {
			owner = { has_estate_privilege = th_estate_lunar_rabbits_monopoly_of_wood }
			OR = {
				trade_goods = tropical_wood
				trade_goods = naval_supplies
			}
		}
		add_province_modifier = {
			name = th_estate_lunar_rabbits_monopoly_of_wood_mod
			duration = -1
		}
	}
	if = {
		limit = {
			owner = { has_estate_privilege = th_estate_lunar_rabbits_monopoly_of_cotton_and_sugar }
			OR = {
				trade_goods = cotton
				trade_goods = sugar
			}
		}
		add_province_modifier = {
			name = th_estate_lunar_rabbits_monopoly_of_cotton_and_sugar_mod
			duration = -1
		}
	}
	if = {
		limit = {
			owner = { has_estate_privilege = th_estate_lunar_rabbits_monopoly_of_grain_and_fish }
			OR = {
				trade_goods = grain
				trade_goods = fish
			}
		}
		add_province_modifier = {
			name = th_estate_lunar_rabbits_monopoly_of_grain_and_fish_mod
			duration = -1
		}
	}
}

th_states_spawn_rival_rebels = {
	if = {
		limit = {
			owner = {
				has_reform = Gensokyan_kaguya_states_reform
			}
		}
		spawn_rebels = {
			type = nationalist_rebels
			friend = FUJ
			size = $size$
		}
	}
	else_if = {
		limit = {
			owner = {
				has_reform = Gensokyan_mokou_states_reform				
			}
		}
		spawn_rebels = {
			type = nationalist_rebels
			friend = EIT
			size = $size$
		}
	}
	spawn_rebels = {		
		type = noble_rebels
		size = $size$
	}
}

th_change_gensokyo_dev = {
	hidden_effect = {
		#min_plus_one is needed so provinces can't get into negative / zero development
		#If min_plus_one = 0 then this effect should not be used to decrease development (tax, production, manpower > 0)
		gensokyo_continent = {
			if = {
				limit = {
					base_tax = $min_plus_one$
				}
				add_base_tax = $tax$
			}
			else = {
				set_base_tax = 1
			}
			if = {
				limit = {
					base_production = $min_plus_one$
				}
				add_base_production = $production$
			}
			else = {
				set_base_production = 1
			}
			if = {
				limit = {
					base_manpower = $min_plus_one$
				}
				add_base_manpower = $manpower$
			}
			else = {
				set_base_manpower = 1
			}
		}
		moon_continent = {
			if = {
				limit = {
					base_tax = $min_plus_one$
				}
				add_base_tax = $tax$
			}
			else = {
				set_base_tax = 1
			}
			if = {
				limit = {
					base_production = $min_plus_one$
				}
				add_base_production = $production$
			}
			else = {
				set_base_production = 1
			}
			if = {
				limit = {
					base_manpower = $min_plus_one$
				}
				add_base_manpower = $manpower$
			}
			else = {
				set_base_manpower = 1
			}
		}
	}
}

th_cause_aggressive_expansion_against_target = {
	#Make sure to define own custom tooltip because PDX doesn't like parameters to be used in loc files
	set_variable = {
		which = th_ae_variable
		value = $value$
	}
	while = {
		limit = {
			check_variable = {
				which = th_ae_variable
				value = 1
			}
		}
		add_opinion = {
			who = $who$
			modifier = aggressive_expansion
		}
		subtract_variable = {
			which = th_ae_variable
			value = 1
		}
	}
}

th_yama_force_unlawful_territory_back = {
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			development = 10
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			development = 20
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			development = 30
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			development = 40
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			development = 50
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			development = 60
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			development = 70
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			development = 80
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			development = 90
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			development = 100
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			any_core_country = {
				exists = yes
			}
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			any_core_country = {
				exists = yes
			}
			development = 10
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			any_core_country = {
				exists = yes
			}
			development = 20
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			any_core_country = {
				exists = yes
			}
			development = 30
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			any_core_country = {
				exists = yes
			}
			development = 40
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			any_core_country = {
				exists = yes
			}
			development = 50
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			any_core_country = {
				exists = yes
			}
			development = 60
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			any_core_country = {
				exists = yes
			}
			development = 70
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			any_core_country = {
				exists = yes
			}
			development = 80
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			any_core_country = {
				exists = yes
			}
			development = 90
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			any_core_country = {
				exists = yes
			}
			development = 100
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			any_core_country = {
				exists = no
			}
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			any_core_country = {
				exists = no
			}
			development = 10
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			any_core_country = {
				exists = no
			}
			development = 20
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			any_core_country = {
				exists = no
			}
			development = 30
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			any_core_country = {
				exists = no
			}
			development = 40
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			any_core_country = {
				exists = no
			}
			development = 50
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			any_core_country = {
				exists = no
			}
			development = 60
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			any_core_country = {
				exists = no
			}
			development = 70
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			any_core_country = {
				exists = no
			}
			development = 80
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			any_core_country = {
				exists = no
			}
			development = 90
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			any_core_country = {
				exists = no
			}
			development = 100
		}
		save_event_target_as = th_unlawful_territory
	}
	event_target:th_unlawful_territory = {
		owner = { save_event_target_as = th_previous_owner }
		random_core_country = {
			save_event_target_as = th_new_owner
			event_target:th_unlawful_territory = {
				cede_province = PREV
			}
			add_opinion = {
				who = ROOT
				modifier = th_returned_our_core
			}
		}
		[[improved_effect]
			ROOT = {
				export_to_variable = {
					which = from_total_dev
					value = development
					who = PREV
				}
				country_event = {
					id = th_yama_authority_event.89
				}
			}
		]
	}
	if = {
		limit = {
			event_target:th_new_owner = {
				NOT = { num_of_cities = 2 }
			}
		}
		event_target:th_previous_owner = {
			add_truce_with = event_target:th_new_owner
		}
	}
}

th_yama_force_partition = {
	every_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			any_core_country = {
				is_core = PREV
			}
		}
		random_core_country = {
			limit = {
				NOT = { tag = ROOT }
			}
			PREV = { cede_province = PREV }
			add_opinion = {
				who = ROOT
				modifier = th_returned_our_core
			}
		}
	}
	#while = {
	#	limit = {
	#		any_owned_province = {
	#			continent = gensokyo_continent
	#			is_capital = no
	#			any_core_country = {
	#				OR = {
	#					exists = no
	#					has_country_flag = th_relaesed_from_partition_by_@FROM
	#				}
	#				is_core = PREV
	#			}
	#		}
	#	}
	#	random_owned_province = {
	#		limit = {
	#			continent = gensokyo_continent
	#			is_capital = no
	#			any_core_country = {
	#				OR = {
	#					exists = no
	#					has_country_flag = th_relaesed_from_partition_by_@FROM
	#				}
	#				is_core = PREV
	#			}
	#		}
	#		random_core_country = {
	#			PREV = {
	#				cede_province = PREV
	#			}
	#			if = {
	#				limit = { NOT = { has_country_flag = th_relaesed_from_partition_by_@FROM } }
	#				set_country_flag = th_relaesed_from_partition_by_@FROM
	#			}
	#		}
	#	}
	#}
	#every_country = {
	#	limit = { has_country_flag = th_relaesed_from_partition_by_@FROM }
	#	clr_country_flag = th_relaesed_from_partition_by_@FROM
	#}
}

th_yama_refuse_unlawful_territory_back = {
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			development = 10
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			development = 20
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			development = 30
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			development = 40
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			any_core_country = {
				exists = yes
			}
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			any_core_country = {
				exists = yes
			}
			development = 10
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			any_core_country = {
				exists = yes
			}
			development = 20
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			any_core_country = {
				exists = yes
			}
			development = 30
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			any_core_country = {
				exists = yes
			}
			development = 40
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			any_core_country = {
				exists = no
			}
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			any_core_country = {
				exists = no
			}
			development = 10
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			any_core_country = {
				exists = no
			}
			development = 20
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			any_core_country = {
				exists = no
			}
			development = 30
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			any_core_country = {
				exists = no
			}
			development = 40
		}
		save_event_target_as = th_unlawful_territory
	}
	event_target:th_unlawful_territory = {
		add_province_modifier = {
			name = th_unlawful_territory
			duration = 3650
		}
	}
}

th_yama_lecture_effect = {
	custom_tooltip = th_yama_lecture_effect_tt
	hidden_effect = {
		clr_country_flag = th_recently_lectured
		set_country_flag = th_recently_lectured
		country_event = {
			id = th_yama_authority_event.98
		}
	}
}

th_mry_shinto_remove_sanae_buffs = {
	hidden_effect = {
		remove_country_modifier = th_mry_shinto_hakureis_power
		remove_country_modifier = th_mry_shinto_keikis_idols
		remove_country_modifier = th_mry_shinto_kishin_lunar_naval
	}
}

th_mry_shinto_remove_suwako_buffs = {
	hidden_effect = {
		remove_country_modifier = th_mry_shinto_sukunas_envoys
		remove_country_modifier = th_mry_shinto_hinas_misfortune
		remove_country_modifier = th_mry_shinto_hecatias_hell_workers
	}
}

th_mry_shinto_remove_kanako_buffs = {
	hidden_effect = {
		remove_country_modifier = th_mry_shinto_junkos_fury
		remove_country_modifier = th_mry_shinto_shinkis_merchants
		remove_country_modifier = th_mry_shinto_satoris_influence
	}
}

th_mry_shinto_remove_boni = {
	hidden_effect = {
		th_mry_shinto_remove_sanae_buffs = yes
		th_mry_shinto_remove_suwako_buffs = yes
		th_mry_shinto_remove_kanako_buffs = yes
	}
}

th_buddhism_clear_meditation = {
	custom_tooltip = th_bdh_longer_cancel_meditation
	hidden_effect = {
		set_country_flag = th_buddhism_meditation_cd
		remove_country_modifier = th_buddhism_meditating
		clr_ruler_flag = th_buddhism_ruler_is_meditating
		clr_ruler_flag = th_buddhism_meditation_available
	}
}

th_buddhism_prepare_add_harmonized_religion_effect = {
	hidden_effect = {
		trigger_switch = {
			on_trigger = religion
			th_hakureishinto = { set_country_flag = th_was_th_hakureishinto }
			th_moriyashinto = { set_country_flag = th_was_th_moriyashinto }
			th_taoist = { set_country_flag = th_was_th_taoist }
			th_oldhakurei = { set_country_flag = th_was_th_oldhakurei }
			th_shinkism = { set_country_flag = th_was_th_shinkism }
			th_christian = { set_country_flag = th_was_th_christian }
			th_lunarian_religion = { set_country_flag = th_was_th_lunarian_religion }
			catholic = { set_country_flag = th_was_catholic }
			anglican = { set_country_flag = th_was_anglican }
			hussite = { set_country_flag = th_was_hussite }
			protestant = { set_country_flag = th_was_protestant }
			reformed = { set_country_flag = th_was_reformed }
			orthodox = { set_country_flag = th_was_orthodox }
			coptic = { set_country_flag = th_was_coptic }
			sunni = { set_country_flag = th_was_sunni }
			shiite = { set_country_flag = th_was_shiite }
			ibadi = { set_country_flag = th_was_ibadi }
			buddhism = { set_country_flag = th_was_buddhism }
			vajrayana = { set_country_flag = th_was_vajrayana }
			mahayana = { set_country_flag = th_was_mahayana }
			confucianism = { set_country_flag = th_was_confucianism }
			shinto = { set_country_flag = th_was_shinto }
			hinduism = { set_country_flag = th_was_hinduism }
			sikhism = { set_country_flag = th_was_sikhism }
			animism = { set_country_flag = th_was_animism }
			shamanism = { set_country_flag = th_was_shamanism }
			totemism = { set_country_flag = th_was_totemism }
			inti = { set_country_flag = th_was_inti }
			nahuatl = { set_country_flag = th_was_nahuatl }
			mesoamerican_religion = { set_country_flag = th_was_mesoamerican_religion }
			norse_pagan_reformed = { set_country_flag = th_was_norse_pagan_reformed }
			tengri_pagan_reformed = { set_country_flag = th_was_tengri_pagan_reformed }
			dreamtime = { set_country_flag = th_was_dreamtime }
			jewish = { set_country_flag = th_was_jewish }
			zoroastrian = { set_country_flag = th_was_zoroastrian }
		}
	}
}

th_buddhism_harmonize_previous_religion = {
	trigger_switch = {
		on_trigger = has_country_flag
		th_was_th_hakureishinto = {
			add_harmonized_religion = th_hakureishinto
			hidden_effect = { clr_country_flag = th_was_th_hakureishinto }
		}
		th_was_th_moriyashinto = {
			add_harmonized_religion = th_moriyashinto
			hidden_effect = { clr_country_flag = th_was_th_moriyashinto }
		}
		th_was_th_taoist = {
			add_harmonized_religion = th_taoist
			hidden_effect = { clr_country_flag = th_was_th_taoist }
		}
		th_was_th_oldhakurei = {
			add_harmonized_religion = th_oldhakurei
			hidden_effect = { clr_country_flag = th_was_th_oldhakurei }
		}
		th_was_th_shinkism = {
			add_harmonized_religion = th_shinkism
			hidden_effect = { clr_country_flag = th_was_th_shinkism }
		}
		th_was_th_christian = {
			add_harmonized_religion = th_christian
			hidden_effect = { clr_country_flag = th_was_th_christian }
		}
		th_was_th_lunarian_religion = {
			add_harmonized_religion = th_lunarian_religion
			hidden_effect = { clr_country_flag = th_was_th_lunarian_religion }
		}
		th_was_catholic = {
			add_harmonized_religion = catholic
			hidden_effect = { clr_country_flag = th_was_catholic }
		}
		th_was_anglican = {
			add_harmonized_religion = anglican
			hidden_effect = { clr_country_flag = th_was_anglican }
		}
		th_was_hussite = {
			add_harmonized_religion = hussite
			hidden_effect = { clr_country_flag = th_was_hussite }
		}
		th_was_protestant = {
			add_harmonized_religion = protestant
			hidden_effect = { clr_country_flag = th_was_protestant }
		}
		th_was_reformed = {
			add_harmonized_religion = reformed
			hidden_effect = { clr_country_flag = th_was_reformed }
		}
		th_was_orthodox = {
			add_harmonized_religion = orthodox
			hidden_effect = { clr_country_flag = th_was_orthodox }
		}
		th_was_coptic = {
			add_harmonized_religion = coptic
			hidden_effect = { clr_country_flag = th_was_coptic }
		}
		th_was_sunni = {
			add_harmonized_religion = sunni
			hidden_effect = { clr_country_flag = th_was_sunni }
		}
		th_was_shiite = {
			add_harmonized_religion = shiite
			hidden_effect = { clr_country_flag = th_was_shiite }
		}
		th_was_ibadi = {
			add_harmonized_religion = ibadi
			hidden_effect = { clr_country_flag = th_was_ibadi }
		}
		th_was_buddhism = {
			add_harmonized_religion = buddhism
			hidden_effect = { clr_country_flag = th_was_buddhism }
		}
		th_was_vajrayana = {
			add_harmonized_religion = vajrayana
			hidden_effect = { clr_country_flag = th_was_vajrayana }
		}
		th_was_mahayana = {
			add_harmonized_religion = mahayana
			hidden_effect = { clr_country_flag = th_was_mahayana }
		}
		th_was_confucianism = {
			add_harmonized_religion = confucianism
			hidden_effect = { clr_country_flag = th_was_confucianism }
		}
		th_was_shinto = {
			add_harmonized_religion = shinto
			hidden_effect = { clr_country_flag = th_was_shinto }
		}
		th_was_hinduism = {
			add_harmonized_religion = hinduism
			hidden_effect = { clr_country_flag = th_was_hinduism }
		}
		th_was_sikhism = {
			add_harmonized_religion = sikhism
			hidden_effect = { clr_country_flag = th_was_sikhism }
		}
		th_was_animism = {
			add_harmonized_religion = animism
			hidden_effect = { clr_country_flag = th_was_animism }
		}
		th_was_shamanism = {
			add_harmonized_religion = shamanism
			hidden_effect = { clr_country_flag = th_was_shamanism }
		}
		th_was_totemism = {
			add_harmonized_religion = totemism
			hidden_effect = { clr_country_flag = th_was_totemism }
		}
		th_was_inti = {
			add_harmonized_religion = inti
			hidden_effect = { clr_country_flag = th_was_inti }
		}
		th_was_nahuatl = {
			add_harmonized_religion = nahuatl
			hidden_effect = { clr_country_flag = th_was_nahuatl }
		}
		th_was_mesoamerican_religion = {
			add_harmonized_religion = mesoamerican_religion
			hidden_effect = { clr_country_flag = th_was_mesoamerican_religion }
		}
		th_was_norse_pagan_reformed = {
			add_harmonized_religion = norse_pagan_reformed
			hidden_effect = { clr_country_flag = th_was_norse_pagan_reformed }
		}
		th_was_tengri_pagan_reformed = {
			add_harmonized_religion = tengri_pagan_reformed
			hidden_effect = { clr_country_flag = th_was_tengri_pagan_reformed }
		}
		th_was_dreamtime = {
			add_harmonized_religion = dreamtime
			hidden_effect = { clr_country_flag = th_was_dreamtime }
		}
		th_was_jewish = {
			add_harmonized_religion = jewish
			hidden_effect = { clr_country_flag = th_was_jewish }
		}
		th_was_zoroastrian = {
			add_harmonized_religion = zoroastrian
			hidden_effect = { clr_country_flag = th_was_zoroastrian }
		}
	}
}

th_buddhism_clean_up_flags = {
	hidden_effect = {
		clr_country_flag = th_was_th_hakureishinto
		clr_country_flag = th_was_th_moriyashinto
		clr_country_flag = th_was_th_taoist
		clr_country_flag = th_was_th_oldhakurei
		clr_country_flag = th_was_th_shinkism
		clr_country_flag = th_was_th_christian
		clr_country_flag = th_was_th_lunarian_religion
		clr_country_flag = th_was_christian
		clr_country_flag = th_was_muslim
		clr_country_flag = th_was_eastern
		clr_country_flag = th_was_dharmic
		clr_country_flag = th_was_pagan
		clr_country_flag = th_was_jewish_group
		clr_country_flag = th_was_zoroastrian_group
		clr_country_flag = th_was_catholic
		clr_country_flag = th_was_anglican
		clr_country_flag = th_was_hussite
		clr_country_flag = th_was_protestant
		clr_country_flag = th_was_reformed
		clr_country_flag = th_was_orthodox
		clr_country_flag = th_was_coptic
		clr_country_flag = th_was_sunni
		clr_country_flag = th_was_shiite
		clr_country_flag = th_was_ibadi
		clr_country_flag = th_was_buddhism
		clr_country_flag = th_was_vajrayana
		clr_country_flag = th_was_mahayana
		clr_country_flag = th_was_confucianism
		clr_country_flag = th_was_shinto
		clr_country_flag = th_was_hinduism
		clr_country_flag = th_was_sikhism
		clr_country_flag = th_was_animism
		clr_country_flag = th_was_shamanism
		clr_country_flag = th_was_totemism
		clr_country_flag = th_was_inti
		clr_country_flag = th_was_nahuatl
		clr_country_flag = th_was_mesoamerican_religion
		clr_country_flag = th_was_norse_pagan_reformed
		clr_country_flag = th_was_tengri_pagan_reformed
		clr_country_flag = th_was_dreamtime
		clr_country_flag = th_was_jewish
		clr_country_flag = th_was_zoroastrian
	}
}

th_taoism_remove_all_five_ways = {
	remove_country_modifier = th_taoism_wood_cycle
	remove_country_modifier = th_taoism_fire_cycle
	remove_country_modifier = th_taoism_earth_cycle
	remove_country_modifier = th_taoism_metal_cycle
	remove_country_modifier = th_taoism_water_cycle
}

th_taoism_normal_cycle = {
	if = {
		limit = {
			has_country_flag = th_taoism_had_wood
		}
		clr_country_flag = th_taoism_had_wood
		set_country_flag = th_taoism_had_fire
		add_country_modifier = {
			name = th_taoism_fire_cycle
			duration = -1
		}
	}
	else_if = {
		limit = {
			has_country_flag = th_taoism_had_fire
		}
		clr_country_flag = th_taoism_had_fire
		set_country_flag = th_taoism_had_earth
		add_country_modifier = {
			name = th_taoism_earth_cycle
			duration = -1
		}
	}
	else_if = {
		limit = {
			has_country_flag = th_taoism_had_earth
		}
		clr_country_flag = th_taoism_had_earth
		set_country_flag = th_taoism_had_metal
		add_country_modifier = {
			name = th_taoism_metal_cycle
			duration = -1
		}
	}
	else_if = {
		limit = {			
			has_country_flag = th_taoism_had_metal
		}
		clr_country_flag = th_taoism_had_metal
		set_country_flag = th_taoism_had_water
		add_country_modifier = {
			name = th_taoism_water_cycle
			duration = -1
		}
	}
	else_if = {
		limit = {
			has_country_flag = th_taoism_had_water
		}
		clr_country_flag = th_taoism_had_water
		set_country_flag = th_taoism_had_wood
		add_country_modifier = {
			name = th_taoism_wood_cycle
			duration = -1
		}
	}
}

th_taoism_revert_cycle = {
	if = {
		limit = {
			has_country_flag = th_taoism_had_wood
		}
		clr_country_flag = th_taoism_had_wood
		set_country_flag = th_taoism_had_water
		add_country_modifier = {
			name = th_taoism_water_cycle
			duration = -1
		}
	}
	else_if = {
		limit = {
			has_country_flag = th_taoism_had_fire
		}
		clr_country_flag = th_taoism_had_fire
		set_country_flag = th_taoism_had_wood
		add_country_modifier = {
			name = th_taoism_wood_cycle
			duration = -1
		}
	}
	else_if = {
		limit = {
			has_country_flag = th_taoism_had_earth
		}
		clr_country_flag = th_taoism_had_earth
		set_country_flag = th_taoism_had_fire
		add_country_modifier = {
			name = th_taoism_fire_cycle
			duration = -1
		}
	}
	else_if = {
		limit = {			
			has_country_flag = th_taoism_had_metal
		}
		clr_country_flag = th_taoism_had_metal
		set_country_flag = th_taoism_had_earth
		add_country_modifier = {
			name = th_taoism_earth_cycle
			duration = -1
		}
	}
	else_if = {
		limit = {
			has_country_flag = th_taoism_had_water
		}
		clr_country_flag = th_taoism_had_water
		set_country_flag = th_taoism_had_metal
		add_country_modifier = {
			name = th_taoism_metal_cycle
			duration = -1
		}
	}
}

th_taoism_control_cycle = {
	if = {
		limit = {
			has_country_flag = th_taoism_had_wood
		}
		clr_country_flag = th_taoism_had_wood
		set_country_flag = th_taoism_had_earth
		add_country_modifier = {
			name = th_taoism_earth_cycle
			duration = -1
		}
	}
	else_if = {
		limit = {
			has_country_flag = th_taoism_had_fire
		}
		clr_country_flag = th_taoism_had_fire
		set_country_flag = th_taoism_had_metal
		add_country_modifier = {
			name = th_taoism_metal_cycle
			duration = -1
		}
	}
	else_if = {
		limit = {
			has_country_flag = th_taoism_had_earth
		}
		clr_country_flag = th_taoism_had_earth
		set_country_flag = th_taoism_had_water
		add_country_modifier = {
			name = th_taoism_water_cycle
			duration = -1
		}
	}
	else_if = {
		limit = {			
			has_country_flag = th_taoism_had_metal
		}
		clr_country_flag = th_taoism_had_metal
		set_country_flag = th_taoism_had_wood
		add_country_modifier = {
			name = th_taoism_wood_cycle
			duration = -1
		}
	}
	else_if = {
		limit = {
			has_country_flag = th_taoism_had_water
		}
		clr_country_flag = th_taoism_had_water
		set_country_flag = th_taoism_had_fire
		add_country_modifier = {
			name = th_taoism_fire_cycle
			duration = -1
		}
	}
}

th_taoism_destroy_cycle = {
	if = {
		limit = {
			has_country_flag = th_taoism_had_wood
		}
		clr_country_flag = th_taoism_had_wood
		set_country_flag = th_taoism_had_metal
		add_country_modifier = {
			name = th_taoism_metal_cycle
			duration = -1
		}
	}
	else_if = {
		limit = {
			has_country_flag = th_taoism_had_fire
		}
		clr_country_flag = th_taoism_had_fire
		set_country_flag = th_taoism_had_water
		add_country_modifier = {
			name = th_taoism_water_cycle
			duration = -1
		}
	}
	else_if = {
		limit = {
			has_country_flag = th_taoism_had_earth
		}
		clr_country_flag = th_taoism_had_earth
		set_country_flag = th_taoism_had_wood
		add_country_modifier = {
			name = th_taoism_wood_cycle
			duration = -1
		}
	}
	else_if = {
		limit = {			
			has_country_flag = th_taoism_had_metal
		}
		clr_country_flag = th_taoism_had_metal
		set_country_flag = th_taoism_had_fire
		add_country_modifier = {
			name = th_taoism_fire_cycle
			duration = -1
		}
	}
	else_if = {
		limit = {
			has_country_flag = th_taoism_had_water
		}
		clr_country_flag = th_taoism_had_water
		set_country_flag = th_taoism_had_earth
		add_country_modifier = {
			name = th_taoism_earth_cycle
			duration = -1
		}
	}
}

###FAIRY ELECTION###
th_show_random_candidate_bonus = {
	if = {
		limit = {
			has_global_modifier_value = {
				which = candidate_random_bonus
				value = 1
			}
		}
		custom_tooltip = th_lottery_candidate_bonus_one
	}
}

th_show_random_candidate_bonus_plural = {
	if = {
		limit = {
			has_global_modifier_value = {
				which = candidate_random_bonus
				value = 1
			}
		}
		custom_tooltip = th_lottery_candidate_bonus_plural
	}
}

###MHG MERC STUFF######MHG MERC STUFF###
th_mhg_mark_march_as_special_case = {
	custom_tooltip = th_mhg_mark_march_as_special_case_tt
	hidden_effect = {
		set_country_flag = mhg_is_special_case_march
	}
}

###NET CUISINE STUFF###
#Can unlock following cuisines: mediterranean, west_european, middle_european, muslim, east_african, west_african, southeast_asian, far_east, indian
net_unlock_cuisine = {
	[[cuisine]
		custom_tooltip = net_unlock_$cuisine$_cuisine_tt
		hidden_effect = {
			set_country_flag = net_unlocked_$cuisine$_cuisine
			change_variable = {
				which = net_unlocked_cuisines
				value = 1
			}
		}
	]
}

net_activate_cuisine_buff = {
	[[cuisine]
		hidden_effect = {
			change_variable = {
				which = net_active_cuisine_counter
				value = 1
			}
			set_country_flag = net_$cuisine$_cuisine_active
		}
		add_country_modifier = {
			name = net_$cuisine$_cuisine_modifier
			duration = $duration$
		}
	]
}

net_remove_cuisine_flag = {
	[[cuisine]
		hidden_effect = {
			clr_country_flag = net_$cuisine$_cuisine_active
			subtract_variable = {
				which = net_active_cuisine_counter
				value = 1
			}
		}
	]
}

net_pay_cuisine_fee = {
	if = {
		limit = {
			NOT = {
				check_variable = {
					which = net_active_cuisine_counter
					value = 1
				}
			}
		}
		add_years_of_income = -1
	}
	if = {
		limit = {
			check_variable = {
				which = net_active_cuisine_counter
				value = 1
			}
			NOT = {
				check_variable = {
					which = net_active_cuisine_counter
					value = 2
				}
			}
		}
		add_years_of_income = -3
	}
	if = {
		limit = {
			check_variable = {
				which = net_active_cuisine_counter
				value = 2
			}
			NOT = {
				check_variable = {
					which = net_active_cuisine_counter
					value = 3
				}
			}
		}
		add_years_of_income = -5
	}
	if = {
		limit = {
			check_variable = {
				which = net_active_cuisine_counter
				value = 3
			}
			NOT = {
				check_variable = {
					which = net_active_cuisine_counter
					value = 4
				}
			}
		}
		add_years_of_income = -7
	}
	if = {
		limit = {
			check_variable = {
				which = net_active_cuisine_counter
				value = 4
			}
			NOT = {
				check_variable = {
					which = net_active_cuisine_counter
					value = 5
				}
			}
		}
		add_years_of_income = -9
	}
	if = {
		limit = {
			check_variable = {
				which = net_active_cuisine_counter
				value = 5
			}
			NOT = {
				check_variable = {
					which = net_active_cuisine_counter
					value = 6
				}
			}
		}
		add_years_of_income = -11
	}
	if = {
		limit = {
			check_variable = {
				which = net_active_cuisine_counter
				value = 6
			}
			NOT = {
				check_variable = {
					which = net_active_cuisine_counter
					value = 7
				}
			}
		}
		add_years_of_income = -13
	}
	if = {
		limit = {
			check_variable = {
				which = net_active_cuisine_counter
				value = 7
			}
			NOT = {
				check_variable = {
					which = net_active_cuisine_counter
					value = 8
				}
			}
		}
		add_years_of_income = -15
	}
	if = {
		limit = {
			check_variable = {
				which = net_active_cuisine_counter
				value = 8
			}
		}
		add_years_of_income = -17
	}
}

###MKI DISASTER STUFF###
mki_reduce_province_debuff = {
	if = {
		limit = {
			has_country_flag = mki_reduced_makai_penalty_level_2 
		}
		custom_tooltip = mki_reduced_makai_penalty_level_3_tt
		hidden_effect = {
			clr_country_flag = mki_reduced_makai_penalty_level_2
			set_country_flag = mki_reduced_makai_penalty_level_3
			every_owned_province = {
				limit = {
					OR = {
						has_province_modifier = th_neglected_demons
						has_province_modifier = th_begrudging_demons
						has_province_modifier = th_grumpy_demons
					}
				}
				remove_province_modifier = th_neglected_demons
				remove_province_modifier = th_begrudging_demons
				remove_province_modifier = th_grumpy_demons
				add_province_modifier = {
					name = th_unhappy_demons
					duration = -1
				}
			}
		}
	}
	else_if = {
		limit = {
			has_country_flag = mki_reduced_makai_penalty_level_1 
		}
		custom_tooltip = mki_reduced_makai_penalty_level_2_tt
		hidden_effect = {
			clr_country_flag = mki_reduced_makai_penalty_level_1
			set_country_flag = mki_reduced_makai_penalty_level_2
			every_owned_province = {
				limit = {
					has_province_modifier = th_begrudging_demons
				}
				remove_province_modifier = th_begrudging_demons
				add_province_modifier = {
					name = th_grumpy_demons
					duration = -1
				}
			}
		}
	}
	else = {
		custom_tooltip = mki_reduced_makai_penalty_level_1_tt
		hidden_effect = {
			set_country_flag = mki_reduced_makai_penalty_level_1
			every_owned_province = {
				limit = {
					has_province_modifier = th_neglected_demons
				}
				remove_province_modifier = th_neglected_demons
				add_province_modifier = {
					name = th_begrudging_demons
					duration = -1
				}
			}
		}
	}
}

###HIG RELIGIOUS FIGUREHEAD###
hig_assign_religious_figurehead = {
	custom_tooltip = $custom_tooltip$
	hidden_effect = {
		export_to_variable = {
			variable_name = th_religious_head_total_dev
			value = total_development
			who = $tag$
		}
		while = {
			limit = {
				check_variable = {
					which = th_religious_head_total_dev
					value = 1
				}
			}
			add_treasury = 1
			subtract_variable = {
				which = th_religious_head_total_dev
				value = 1
			}
		}
		multiply_variable = {
			which = th_religious_head_total_dev
			value = 100
		}
		while = {
			limit = {
				check_variable = {
					which = th_religious_head_total_dev
					value = 1
				}
			}
			add_treasury = 0.01
			subtract_variable = {
				which = th_religious_head_total_dev
				value = 1
			}
		}
	}
	$tag$ = {
		capital_scope = {
			add_province_triggered_modifier = HIG_religious_legitimation_by_the_yama_$religion$
		}
		add_country_modifier = {
			name = hig_legitimation_from_the_yama
			duration = 9125
		}
	}
	reverse_add_opinion = {
		who = $tag$
		modifier = th_legitimized_us_as_religious_head
	}
	if = {
		limit = {
			NOT = { religion = $religion$ }
		}
		capital_scope = {
			area = {
				limit = {
					owned_by = ROOT
				}
				change_religion = $religion$
			}
		}
	}
	else = {
		add_country_modifier = {
			name = hig_legitimized_state_religion
			duration = 9125
		}
	}
}

###LAWGIVER EFFECTS###
th_enable_legal_code_for_gensokyo = {
	custom_tooltip = th_enable_legal_code_for_gensokyo_tt
	hidden_effect = {
		set_global_flag = th_gensokyan_code_enabled
		#Deprecated for now, script is kept for future Senkai update
		#save_global_event_target_as = LawgiverOfGensokyo
		#1 = {
		#	set_variable = {
		#		which = th_gensokyan_law_debate_pro
		#		value = 0
		#	}
		#	set_variable = {
		#		which = th_gensokyan_law_debate_con
		#		value = 0
		#	}
		#}
	}
	#event_target:LawgiverOfGensokyo = {
		add_country_modifier = {
			name = th_lawgiver_of_gensokyo
			duration = -1
		}
	#}
}

th_disable_legal_code_for_gensokyo = {
	custom_tooltip = th_disable_legal_code_for_gensokyo_tt
	hidden_effect = {
		#Deprecated for now, script is kept for future Senkai update
		#if = {
		#	limit = {
		#		has_global_flag = th_gensokyan_code_enabled
		#	}
		#	1 = {
		#		set_variable = {
		#			which = th_gensokyan_law_debate_pro
		#			value = 0
		#		}
		#		set_variable = {
		#			which = th_gensokyan_law_debate_con
		#			value = 0
		#		}
		#	}
			clr_global_flag = th_gensokyan_code_enabled
		#}
		#clear_global_event_target = LawgiverOfGensokyo
		every_country = {
			limit = {
				has_country_modifier = th_lawgiver_of_gensokyo
			}
			remove_country_modifier = th_lawgiver_of_gensokyo
		}
	}
}

th_invest_into_gensokyan_decree = {
	gensokyo_continent = {
		hidden_effect = {
			remove_province_modifier = th_local_yama_support
			remove_province_modifier = th_local_shrine_support
			remove_province_modifier = th_local_artisan_support
			remove_province_modifier = th_local_scholar_support
			remove_province_modifier = th_local_youkai_support
		}
		add_permanent_province_modifier = {
			name = th_local_$decree$_support
			duration = 7300
		}
	}
	custom_tooltip = th_monthly_income_negative_tt
	hidden_effect = {
		while = {
			limit = {
				check_variable = {
					which = th_monthly_income
					value = 1
				}
			}
			add_treasury = -1
			subtract_variable = {
				which = th_monthly_income
				value = 1
			}
		}
		multiply_variable = {
			which = th_monthly_income
			value = 100
		}
		while = {
			limit = {
				check_variable = {
					which = th_monthly_income
					value = 1
				}
			}
			add_treasury = -0.01
			subtract_variable = {
				which = th_monthly_income
				value = 1
			}
		}
		clr_global_flag = th_enacted_gensokyan_decree
		set_global_flag = th_enacted_gensokyan_decree
	}
}

th_yama_on_war_won_effect = {
	if = { #Defenders win
		limit = {
			ROOT = { has_country_flag = th_hig_defender }
			FROM = { has_country_flag = th_hig_attacker }
			event_target:YamaOfGensokyo = { has_country_flag = th_hig_joined_enforced_peace_war }
		}
		FROM = {
			event_target:YamaOfGensokyo = {
				country_event = {
					id = th_yama_authority_event.94
				}
				clr_country_flag = th_hig_joined_enforced_peace_war
			}
			clr_country_flag = th_hig_attacker
		}
		ROOT = { clr_country_flag = th_hig_attacker }
	}
	if = { #Attacker win
		limit = {
			FROM = { has_country_flag = th_hig_defender }
			ROOT = { has_country_flag = th_hig_attacker }
			event_target:YamaOfGensokyo = { has_country_flag = th_hig_joined_enforced_peace_war }
		}
		FROM = { clr_country_flag = th_hig_defender }
		ROOT = { clr_country_flag = th_hig_attacker }
		event_target:YamaOfGensokyo = {
			country_event = {
				id = th_yama_authority_event.93
			}
			clr_country_flag = th_hig_joined_enforced_peace_war
		}
	}
	if = { #Yamaxanadu Seperate Peaced out
		limit = {
			FROM = { has_country_flag = th_hig_attacker }
			ROOT = { has_country_flag = th_hig_joined_enforced_peace_war }
		}
		FROM = { clr_country_flag = th_hig_attacker }
		event_target:YamaOfGensokyo = {
			country_event = {
				id = th_yama_authority_event.92
			}
			clr_country_flag = th_hig_joined_enforced_peace_war
		}
		random_country = {
			limit = {
				has_country_flag = th_hig_defender
			}
			clr_country_flag = th_hig_defender
		}
	}
	if = { #Yamaxanadu gets Seperate Peaced out
		limit = {
			ROOT = { has_country_flag = th_hig_attacker }
			FROM = { has_country_flag = th_hig_joined_enforced_peace_war }
		}
		ROOT = { clr_country_flag = th_hig_attacker }
		event_target:YamaOfGensokyo = {
			country_event = {
				id = th_yama_authority_event.91
			}
			clr_country_flag = th_hig_joined_enforced_peace_war
		}
		random_country = {
			limit = {
				has_country_flag = th_hig_defender
			}
			clr_country_flag = th_hig_defender
		}
	}
}

###MIM MAGIC SCHOOL STUFF###
#Following schools are supported:
#conjuration
#evocation
#divination
#transmutation
#enchanting
#abjuration
mim_skill_magic_school = {
	tooltip = {
		if = {
			limit = { is_variable_equal = { which = th_magic_school_$school$ value = 0 } }
			add_country_modifier = { name = th_$school$_level_1 duration = -1 }
		}
		if = {
			limit = { is_variable_equal = { which = th_magic_school_$school$ value = 1 } }
			add_country_modifier = { name = th_$school$_level_2 duration = -1 }
		}
		if = {
			limit = { is_variable_equal = { which = th_magic_school_$school$ value = 2 } }
			add_country_modifier = { name = th_$school$_level_3 duration = -1 }
		}
		if = {
			limit = { is_variable_equal = { which = th_magic_school_$school$ value = 3 } }
			add_country_modifier = { name = th_$school$_level_4 duration = -1 }
		}
	}
	hidden_effect = {
		change_variable = {
			which = th_magic_school_$school$
			value = 1
		}
		change_variable = {
			which = th_magic_school_total_skill_points
			value = 1
		}
		if = {
			limit = { check_variable = { which = th_magic_school_$school$ value = 1 } }
			add_country_modifier = { name = th_$school$_level_1 duration = -1 }
		}
		if = {
			limit = { check_variable = { which = th_magic_school_$school$ value = 2 } }
			add_country_modifier = { name = th_$school$_level_2 duration = -1 }
		}
		if = {
			limit = { check_variable = { which = th_magic_school_$school$ value = 3 } }
			add_country_modifier = { name = th_$school$_level_3 duration = -1 }
		}
		if = {
			limit = { check_variable = { which = th_magic_school_$school$ value = 4 } }
			add_country_modifier = { name = th_$school$_level_4 duration = -1 }
		}
	}
}

mim_add_spell_modifier = {
	if = {
		limit = { is_variable_equal = { which = th_magic_school_$school$ value = 1 } }
		add_country_modifier = { name = $name$ duration = $level_1_duration$ }
	}
	if = {
		limit = { is_variable_equal = { which = th_magic_school_$school$ value = 2 } }
		add_country_modifier = { name = $name$ duration = $level_2_duration$ }
	}
	if = {
		limit = { is_variable_equal = { which = th_magic_school_$school$ value = 3 } }
		add_country_modifier = { name = $name$ duration = $level_3_duration$ }
	}
	if = {
		limit = { is_variable_equal = { which = th_magic_school_$school$ value = 4 } }
		add_country_modifier = { name = $name$ duration = $level_4_duration$ }
	}
	if = {
		limit = { NOT = { check_variable = { which = th_magic_school_$school$ value = 1 } } }
		add_country_modifier = { name = $name$ duration = $duration$ }
	}
}

mim_forget_specialization = {
	remove_country_modifier = th_conjuration_level_1
	remove_country_modifier = th_conjuration_level_2
	remove_country_modifier = th_conjuration_level_3
	remove_country_modifier = th_conjuration_level_4
	remove_country_modifier = th_evocation_level_1
	remove_country_modifier = th_evocation_level_2
	remove_country_modifier = th_evocation_level_3
	remove_country_modifier = th_evocation_level_4
	remove_country_modifier = th_divination_level_1
	remove_country_modifier = th_divination_level_2
	remove_country_modifier = th_divination_level_3
	remove_country_modifier = th_divination_level_4
	remove_country_modifier = th_transmutation_level_1
	remove_country_modifier = th_transmutation_level_2
	remove_country_modifier = th_transmutation_level_3
	remove_country_modifier = th_transmutation_level_4
	remove_country_modifier = th_enchanting_level_1
	remove_country_modifier = th_enchanting_level_2
	remove_country_modifier = th_enchanting_level_3
	remove_country_modifier = th_enchanting_level_4
	remove_country_modifier = th_abjuration_level_1
	remove_country_modifier = th_abjuration_level_2
	remove_country_modifier = th_abjuration_level_3
	remove_country_modifier = th_abjuration_level_4
	remove_country_modifier = th_conjuration_conjured_diplomat
	remove_country_modifier = th_conjuration_conjured_merchant
	remove_country_modifier = th_conjuration_conjured_colonist
	remove_country_modifier = th_conjuration_conjured_missionary
	remove_country_modifier = th_evocation_level_3_infantry_power
	remove_country_modifier = th_evocation_level_3_cavalry_power
	remove_country_modifier = th_evocation_level_3_artillery_power
	remove_country_modifier = th_evocation_level_4_infantry_power
	remove_country_modifier = th_evocation_level_4_cavalry_power
	remove_country_modifier = th_evocation_level_4_artillery_power
	remove_country_modifier = th_enchanting_absolute_shock_resistence
	remove_country_modifier = th_enchanting_absolute_fire_resistence
	set_variable = { which = th_magic_school_conjuration value = 0 }
	set_variable = { which = th_magic_school_evocation value = 0 }
	set_variable = { which = th_magic_school_divination value = 0 }
	set_variable = { which = th_magic_school_transmutation value = 0 }
	set_variable = { which = th_magic_school_enchanting value = 0 }
	set_variable = { which = th_magic_school_abjuration value = 0 }
}

mim_gain_new_skill_reward = {
	if = {
		limit = {
			has_government_attribute = th_has_spell_schools
			OR = {
				mim_has_not_reached_max_level_of_school = { school = conjuration }	
				mim_has_not_reached_max_level_of_school = { school = evocation }	
				mim_has_not_reached_max_level_of_school = { school = divination }	
				mim_has_not_reached_max_level_of_school = { school = transmutation }	
				mim_has_not_reached_max_level_of_school = { school = enchanting }	
				mim_has_not_reached_max_level_of_school = { school = abjuration }
			}
		}
		custom_tooltip = mim_gain_new_skill_reward_tt
		hidden_effect = {
			country_event = {
				id = th_magic_schools.12
			}
		}
	}
	else = {
		add_adm_power = 50
		add_dip_power = 50
		add_mil_power = 50
	}
}

###KPP GADGET EFFECTS###
#optical_camouflage
#perfect_cucumber_fertilizer
#machine_extending_arm
#sanpei_battleship
#super_scope_3D
#kappa_tanks
#aerial_torpedo
#australian_wildlife
#hisoutensoku
#kappa_shredder
#spice_fuel_engine
#bookkeep_inator
#kiku_ichimonji_compressor
#ooze_flooding
kpp_increase_gadget_usage_counter = {
	hidden_effect = {
		if = {
			limit = {
				NOT = {
					check_variable = {
						which = num_of_$gadget$_used
						value = 25
					}
				}
			}
			change_variable = {
				which = num_of_$gadget$_used
				value = 1
			}
		}
	}
}
kpp_apply_gadget = {
	add_country_modifier = {
		name = th_$gadget$_modifier
		duration = $duration$
	}
}
kpp_unlock_gadget = {
	custom_tooltip = kpp_unlock_$gadget$_tt
	hidden_effect = { set_country_flag = kpp_unlocked_$gadget$_gadget }
}

#TGU Mechanic
th_select_a_tenma_demand = {
	if = {
		limit = {
			has_estate = estate_great_tengu
			NOT = { has_country_flag = estate_great_tengu_$flag$ }
		}
		set_country_flag = estate_great_tengu_$flag$
		[[estate_action]
		$estate_action$ = estate_great_tengu
		]
	}
}

###BUY PROVINCE SCRIPTED EFFECT###
th_designate_provinces_for_purchase = {
	[[purchasable_province_1]
		if = {
			limit = {
				$purchasable_province_1$ = {
					NOT = { country_or_non_sovereign_subject_holds = ROOT }
					$trigger$
				}
			}
			$purchasable_province_1$ = {
				save_event_target_as = purchasable_province_1
			}
		}
	]
	[[purchasable_province_2]
		if = {
			limit = {
				$purchasable_province_2$ = {
					NOT = { country_or_non_sovereign_subject_holds = ROOT }
					$trigger$
				}
			}
			$purchasable_province_2$ = {
				save_event_target_as = purchasable_province_2
			}
		}
	]
	[[purchasable_province_3]
		if = {
			limit = {
				$purchasable_province_3$ = {
					NOT = { country_or_non_sovereign_subject_holds = ROOT }
					$trigger$
				}
			}
			$purchasable_province_3$ = {
				save_event_target_as = purchasable_province_3
			}
		}
	]
	[[purchasable_province_4]
		if = {
			limit = {
				$purchasable_province_4$ = {
					NOT = { country_or_non_sovereign_subject_holds = ROOT }
					$trigger$
				}
			}
			$purchasable_province_4$ = {
				save_event_target_as = purchasable_province_4
			}
		}
	]
	[[purchasable_province_5]
		if = {
			limit = {
				$purchasable_province_5$ = {
					NOT = { country_or_non_sovereign_subject_holds = ROOT }
					$trigger$
				}
			}
			$purchasable_province_5$ = {
				save_event_target_as = purchasable_province_5
			}
		}
	]
}