th_on_province_religion_converted_effect = {
	if = {
		limit = {
			religion = th_moriyashinto
		}
		mry_add_scaled_province_conversion_faith_power = {
			value = 1
			development_factor = 0.25
		}
	}
	if = {
		limit = {
			has_province_modifier = th_intolerance_to_mortals
			religion = ROOT
		}
		remove_province_modifier = th_intolerance_to_mortals
	}
}

th_on_province_owner_change_effect = {
	if = {
		limit = {
			owner = {
				OR = {
					has_government_attribute = th_winter_adaptability
					has_country_flag = th_winter_adaptability_flag
				}
			}
		}
		if = {
			limit = {
				has_climate = arctic
			}
			add_province_modifier = {
				name = mkn_arctic_immunity
				duration = -1
			}
		}
		if = {
			limit = {
				has_terrain = glacier
			}
			add_province_modifier = {
				name = mkn_glacial_immunity
				duration = -1
			}
		}
	}
	else = {
		if = {
			limit = {
				OR = {
					has_province_modifier = mkn_arctic_immunity
					has_province_modifier = mkn_glacial_immunity
				}
			}
			remove_province_modifier = mkn_arctic_immunity
			remove_province_modifier = mkn_glacial_immunity
		}
	}
	if = {
		limit = {
			owner = {
				OR = {
					has_government_attribute = th_winter_afinity
					has_country_flag = th_winter_afinity_flag
				}
			}
		}
		if = {
			limit = {
				has_winter = severe_winter
			}
			add_province_modifier = {
				name = mkn_severe_winter_affinity
				duration = -1
			}
		}
	}
	else = {
		if = {
			limit = {
				has_province_modifier = mkn_severe_winter_affinity
			}
			remove_province_modifier = mkn_severe_winter_affinity
		}
	}
	if = {
		limit = {
			OR = {
				area = Land_of_the_dead
				area = Eastern_higan
				area = Higan_southern_coast
			}
			owner = { has_estate_privilege = th_estate_nobles_lack_of_overseers }
		}
		add_local_autonomy = 50
		add_province_modifier = {
			name = hig_slacking_shinigami
			duration = -1
		}
	}
}

th_states_spawn_rival_rebels = {
	if = {
		limit = {
			owner = {
				has_reform = Gensokyan_kaguya_states_reform
			}
		}
		spawn_rebels = {
			type = nationalist_rebels
			friend = FUJ
			size = $size$
		}
	}
	else_if = {
		limit = {
			owner = {
				has_reform = Gensokyan_mokou_states_reform				
			}
		}
		spawn_rebels = {
			type = nationalist_rebels
			friend = EIT
			size = $size$
		}
	}
	spawn_rebels = {		
		type = noble_rebels
		size = $size$
	}
}

th_change_gensokyo_dev = {
	hidden_effect = {
		#min_plus_one is needed so provinces can't get into negative / zero development
		#If min_plus_one = 0 then this effect should not be used to decrease development (tax, production, manpower > 0)
		gensokyo_continent = {
			if = {
				limit = {
					base_tax = $min_plus_one$
				}
				add_base_tax = $tax$
			}
			else = {
				set_base_tax = 1
			}
			if = {
				limit = {
					base_production = $min_plus_one$
				}
				add_base_production = $production$
			}
			else = {
				set_base_production = 1
			}
			if = {
				limit = {
					base_manpower = $min_plus_one$
				}
				add_base_manpower = $manpower$
			}
			else = {
				set_base_manpower = 1
			}
		}
		moon_continent = {
			if = {
				limit = {
					base_tax = $min_plus_one$
				}
				add_base_tax = $tax$
			}
			else = {
				set_base_tax = 1
			}
			if = {
				limit = {
					base_production = $min_plus_one$
				}
				add_base_production = $production$
			}
			else = {
				set_base_production = 1
			}
			if = {
				limit = {
					base_manpower = $min_plus_one$
				}
				add_base_manpower = $manpower$
			}
			else = {
				set_base_manpower = 1
			}
		}
	}
}

th_cause_aggressive_expansion_against_target = {
	#Make sure to define own custom tooltip because PDX doesn't like parameters to be used in loc files
	set_variable = {
		which = th_ae_variable
		value = $value$
	}
	while = {
		limit = {
			check_variable = {
				which = th_ae_variable
				value = 1
			}
		}
		add_opinion = {
			who = $who$
			modifier = aggressive_expansion
		}
		subtract_variable = {
			which = th_ae_variable
			value = 1
		}
	}
}

th_yama_on_monarch_death_effect = {
	if = {
		limit = {
			NOT = { has_government_attribute = enables_yama_authority }
		}
		if = {
			limit = {
				OR = {
					religion_group = eastern
					AND = {
						religion_group = Touhou
						NOT = { has_reform = Gensokyan_divine_state }
						primary_culture = Gensokyo_human
					}
				}
			}
			event_target:YamaOfGensokyo = {
				country_event = {
					id = th_yama_authority_event.1
				}
			}
		}
		if = {
			limit = {
				religion_group = dharmic
				event_target:YamaOfGensokyo = {
					has_country_flag = th_can_judge_dharmic_rulers
				}
			}
			event_target:YamaOfGensokyo = {
				country_event = {
					id = th_yama_authority_event.2
				}
			}
		}
		if = {
			limit = {
				OR = {
					religion_group = christian
					religion_group = muslim
					religion_group = jewish_group
				}
				event_target:YamaOfGensokyo = {
					has_country_flag = th_can_judge_abrahamic_rulers
				}
			}
			event_target:YamaOfGensokyo = {
				country_event = {
					id = th_yama_authority_event.3
				}
			}
		}
	}
}

th_yama_force_unlawful_territory_back = {
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			development = 10
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			development = 20
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			development = 30
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			development = 40
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			any_core_country = {
				exists = yes
			}
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			any_core_country = {
				exists = yes
			}
			development = 10
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			any_core_country = {
				exists = yes
			}
			development = 20
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			any_core_country = {
				exists = yes
			}
			development = 30
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			any_core_country = {
				exists = yes
			}
			development = 40
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			any_core_country = {
				exists = no
			}
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			any_core_country = {
				exists = no
			}
			development = 10
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			any_core_country = {
				exists = no
			}
			development = 20
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			any_core_country = {
				exists = no
			}
			development = 30
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			any_core_country = {
				exists = no
			}
			development = 40
		}
		save_event_target_as = th_unlawful_territory
	}
	event_target:th_unlawful_territory = {
		random_core_country = {
			event_target:th_unlawful_territory = {
				cede_province = PREV
			}
		}
	}
}

th_yama_force_partition = {
	while = {
		limit = {
			any_owned_province = {
				continent = gensokyo_continent
				is_capital = no
				any_core_country = {
					OR = {
						exists = no
						has_country_flag = th_relaesed_from_partition_by_@FROM
					}
					is_core = PREV
				}
			}
		}
		random_owned_province = {
			limit = {
				continent = gensokyo_continent
				is_capital = no
				any_core_country = {
					OR = {
						exists = no
						has_country_flag = th_relaesed_from_partition_by_@FROM
					}
					is_core = PREV
				}
			}
			random_core_country = {
				PREV = {
					cede_province = PREV
				}
				if = {
					limit = { NOT = { has_country_flag = th_relaesed_from_partition_by_@FROM } }
					set_country_flag = th_relaesed_from_partition_by_@FROM
				}
			}
		}
	}
	every_country = {
		limit = { has_country_flag = th_relaesed_from_partition_by_@FROM }
		clr_country_flag = th_relaesed_from_partition_by_@FROM
	}
}

th_yama_refuse_unlawful_territory_back = {
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			development = 10
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			development = 20
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			development = 30
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			development = 40
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			any_core_country = {
				exists = yes
			}
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			any_core_country = {
				exists = yes
			}
			development = 10
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			any_core_country = {
				exists = yes
			}
			development = 20
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			any_core_country = {
				exists = yes
			}
			development = 30
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			any_core_country = {
				exists = yes
			}
			development = 40
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			any_core_country = {
				exists = no
			}
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			any_core_country = {
				exists = no
			}
			development = 10
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			any_core_country = {
				exists = no
			}
			development = 20
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			any_core_country = {
				exists = no
			}
			development = 30
		}
		save_event_target_as = th_unlawful_territory
	}
	random_owned_province = {
		limit = {
			continent = gensokyo_continent
			is_capital = no
			NOT = { has_province_modifier = th_unlawful_territory }
			NOT = { is_core = FROM }
			any_core_country = {
				exists = no
			}
			development = 40
		}
		save_event_target_as = th_unlawful_territory
	}
	event_target:th_unlawful_territory = {
		add_province_modifier = {
			name = th_unlawful_territory
			duration = 3650
		}
	}
}

th_mry_shinto_remove_sanae_buffs = {
	hidden_effect = {
		remove_country_modifier = th_mry_shinto_hakureis_power
		remove_country_modifier = th_mry_shinto_keikis_idols
		remove_country_modifier = th_mry_shinto_kishin_lunar_naval
	}
}

th_mry_shinto_remove_suwako_buffs = {
	hidden_effect = {
		remove_country_modifier = th_mry_shinto_sukunas_envoys
		remove_country_modifier = th_mry_shinto_hinas_misfortune
		remove_country_modifier = th_mry_shinto_hecatias_hell_workers
	}
}

th_mry_shinto_remove_kanako_buffs = {
	hidden_effect = {
		remove_country_modifier = th_mry_shinto_junkos_fury
		remove_country_modifier = th_mry_shinto_shinkis_merchants
		remove_country_modifier = th_mry_shinto_satoris_influence
	}
}

th_mry_shinto_remove_boni = {
	hidden_effect = {
		th_mry_shinto_remove_sanae_buffs = yes
		th_mry_shinto_remove_suwako_buffs = yes
		th_mry_shinto_remove_kanako_buffs = yes
	}
}

th_buddhism_clear_meditation = {
	custom_tooltip = th_bdh_longer_cancel_meditation
	hidden_effect = {
		set_country_flag = th_buddhism_meditation_cd
		remove_country_modifier = th_buddhism_meditating
		clr_ruler_flag = th_buddhism_ruler_is_meditating
		clr_ruler_flag = th_buddhism_meditation_available
	}
}

th_buddhism_prepare_add_harmonized_religion_effect = {
	hidden_effect = {
		trigger_switch = {
			on_trigger = religion
			th_hakureishinto = { set_country_flag = th_was_th_hakureishinto }
			th_moriyashinto = { set_country_flag = th_was_th_moriyashinto }
			th_taoist = { set_country_flag = th_was_th_taoist }
			th_oldhakurei = { set_country_flag = th_was_th_oldhakurei }
			th_shinkism = { set_country_flag = th_was_th_shinkism }
			th_christian = { set_country_flag = th_was_th_christian }
			th_lunarian_religion = { set_country_flag = th_was_th_lunarian_religion }
			catholic = { set_country_flag = th_was_catholic }
			anglican = { set_country_flag = th_was_anglican }
			hussite = { set_country_flag = th_was_hussite }
			protestant = { set_country_flag = th_was_protestant }
			reformed = { set_country_flag = th_was_reformed }
			orthodox = { set_country_flag = th_was_orthodox }
			coptic = { set_country_flag = th_was_coptic }
			sunni = { set_country_flag = th_was_sunni }
			shiite = { set_country_flag = th_was_shiite }
			ibadi = { set_country_flag = th_was_ibadi }
			buddhism = { set_country_flag = th_was_buddhism }
			vajrayana = { set_country_flag = th_was_vajrayana }
			mahayana = { set_country_flag = th_was_mahayana }
			confucianism = { set_country_flag = th_was_confucianism }
			shinto = { set_country_flag = th_was_shinto }
			hinduism = { set_country_flag = th_was_hinduism }
			sikhism = { set_country_flag = th_was_sikhism }
			animism = { set_country_flag = th_was_animism }
			shamanism = { set_country_flag = th_was_shamanism }
			totemism = { set_country_flag = th_was_totemism }
			inti = { set_country_flag = th_was_inti }
			nahuatl = { set_country_flag = th_was_nahuatl }
			mesoamerican_religion = { set_country_flag = th_was_mesoamerican_religion }
			norse_pagan_reformed = { set_country_flag = th_was_norse_pagan_reformed }
			tengri_pagan_reformed = { set_country_flag = th_was_tengri_pagan_reformed }
			dreamtime = { set_country_flag = th_was_dreamtime }
			jewish = { set_country_flag = th_was_jewish }
			zoroastrian = { set_country_flag = th_was_zoroastrian }
		}
	}
}

th_buddhism_harmonize_previous_religion = {
	trigger_switch = {
		on_trigger = has_country_flag
		th_was_th_hakureishinto = {
			add_harmonized_religion = th_hakureishinto
			hidden_effect = { clr_country_flag = th_was_th_hakureishinto }
		}
		th_was_th_moriyashinto = {
			add_harmonized_religion = th_moriyashinto
			hidden_effect = { clr_country_flag = th_was_th_moriyashinto }
		}
		th_was_th_taoist = {
			add_harmonized_religion = th_taoist
			hidden_effect = { clr_country_flag = th_was_th_taoist }
		}
		th_was_th_oldhakurei = {
			add_harmonized_religion = th_oldhakurei
			hidden_effect = { clr_country_flag = th_was_th_oldhakurei }
		}
		th_was_th_shinkism = {
			add_harmonized_religion = th_shinkism
			hidden_effect = { clr_country_flag = th_was_th_shinkism }
		}
		th_was_th_christian = {
			add_harmonized_religion = th_christian
			hidden_effect = { clr_country_flag = th_was_th_christian }
		}
		th_was_th_lunarian_religion = {
			add_harmonized_religion = th_lunarian_religion
			hidden_effect = { clr_country_flag = th_was_th_lunarian_religion }
		}
		th_was_catholic = {
			add_harmonized_religion = catholic
			hidden_effect = { clr_country_flag = th_was_catholic }
		}
		th_was_anglican = {
			add_harmonized_religion = anglican
			hidden_effect = { clr_country_flag = th_was_anglican }
		}
		th_was_hussite = {
			add_harmonized_religion = hussite
			hidden_effect = { clr_country_flag = th_was_hussite }
		}
		th_was_protestant = {
			add_harmonized_religion = protestant
			hidden_effect = { clr_country_flag = th_was_protestant }
		}
		th_was_reformed = {
			add_harmonized_religion = reformed
			hidden_effect = { clr_country_flag = th_was_reformed }
		}
		th_was_orthodox = {
			add_harmonized_religion = orthodox
			hidden_effect = { clr_country_flag = th_was_orthodox }
		}
		th_was_coptic = {
			add_harmonized_religion = coptic
			hidden_effect = { clr_country_flag = th_was_coptic }
		}
		th_was_sunni = {
			add_harmonized_religion = sunni
			hidden_effect = { clr_country_flag = th_was_sunni }
		}
		th_was_shiite = {
			add_harmonized_religion = shiite
			hidden_effect = { clr_country_flag = th_was_shiite }
		}
		th_was_ibadi = {
			add_harmonized_religion = ibadi
			hidden_effect = { clr_country_flag = th_was_ibadi }
		}
		th_was_buddhism = {
			add_harmonized_religion = buddhism
			hidden_effect = { clr_country_flag = th_was_buddhism }
		}
		th_was_vajrayana = {
			add_harmonized_religion = vajrayana
			hidden_effect = { clr_country_flag = th_was_vajrayana }
		}
		th_was_mahayana = {
			add_harmonized_religion = mahayana
			hidden_effect = { clr_country_flag = th_was_mahayana }
		}
		th_was_confucianism = {
			add_harmonized_religion = confucianism
			hidden_effect = { clr_country_flag = th_was_confucianism }
		}
		th_was_shinto = {
			add_harmonized_religion = shinto
			hidden_effect = { clr_country_flag = th_was_shinto }
		}
		th_was_hinduism = {
			add_harmonized_religion = hinduism
			hidden_effect = { clr_country_flag = th_was_hinduism }
		}
		th_was_sikhism = {
			add_harmonized_religion = sikhism
			hidden_effect = { clr_country_flag = th_was_sikhism }
		}
		th_was_animism = {
			add_harmonized_religion = animism
			hidden_effect = { clr_country_flag = th_was_animism }
		}
		th_was_shamanism = {
			add_harmonized_religion = shamanism
			hidden_effect = { clr_country_flag = th_was_shamanism }
		}
		th_was_totemism = {
			add_harmonized_religion = totemism
			hidden_effect = { clr_country_flag = th_was_totemism }
		}
		th_was_inti = {
			add_harmonized_religion = inti
			hidden_effect = { clr_country_flag = th_was_inti }
		}
		th_was_nahuatl = {
			add_harmonized_religion = nahuatl
			hidden_effect = { clr_country_flag = th_was_nahuatl }
		}
		th_was_mesoamerican_religion = {
			add_harmonized_religion = mesoamerican_religion
			hidden_effect = { clr_country_flag = th_was_mesoamerican_religion }
		}
		th_was_norse_pagan_reformed = {
			add_harmonized_religion = norse_pagan_reformed
			hidden_effect = { clr_country_flag = th_was_norse_pagan_reformed }
		}
		th_was_tengri_pagan_reformed = {
			add_harmonized_religion = tengri_pagan_reformed
			hidden_effect = { clr_country_flag = th_was_tengri_pagan_reformed }
		}
		th_was_dreamtime = {
			add_harmonized_religion = dreamtime
			hidden_effect = { clr_country_flag = th_was_dreamtime }
		}
		th_was_jewish = {
			add_harmonized_religion = jewish
			hidden_effect = { clr_country_flag = th_was_jewish }
		}
		th_was_zoroastrian = {
			add_harmonized_religion = zoroastrian
			hidden_effect = { clr_country_flag = th_was_zoroastrian }
		}
	}
}

th_buddhism_clean_up_flags = {
	hidden_effect = {
		clr_country_flag = th_was_th_hakureishinto
		clr_country_flag = th_was_th_moriyashinto
		clr_country_flag = th_was_th_taoist
		clr_country_flag = th_was_th_oldhakurei
		clr_country_flag = th_was_th_shinkism
		clr_country_flag = th_was_th_christian
		clr_country_flag = th_was_th_lunarian_religion
		clr_country_flag = th_was_christian
		clr_country_flag = th_was_muslim
		clr_country_flag = th_was_eastern
		clr_country_flag = th_was_dharmic
		clr_country_flag = th_was_pagan
		clr_country_flag = th_was_jewish_group
		clr_country_flag = th_was_zoroastrian_group
		clr_country_flag = th_was_catholic
		clr_country_flag = th_was_anglican
		clr_country_flag = th_was_hussite
		clr_country_flag = th_was_protestant
		clr_country_flag = th_was_reformed
		clr_country_flag = th_was_orthodox
		clr_country_flag = th_was_coptic
		clr_country_flag = th_was_sunni
		clr_country_flag = th_was_shiite
		clr_country_flag = th_was_ibadi
		clr_country_flag = th_was_buddhism
		clr_country_flag = th_was_vajrayana
		clr_country_flag = th_was_mahayana
		clr_country_flag = th_was_confucianism
		clr_country_flag = th_was_shinto
		clr_country_flag = th_was_hinduism
		clr_country_flag = th_was_sikhism
		clr_country_flag = th_was_animism
		clr_country_flag = th_was_shamanism
		clr_country_flag = th_was_totemism
		clr_country_flag = th_was_inti
		clr_country_flag = th_was_nahuatl
		clr_country_flag = th_was_mesoamerican_religion
		clr_country_flag = th_was_norse_pagan_reformed
		clr_country_flag = th_was_tengri_pagan_reformed
		clr_country_flag = th_was_dreamtime
		clr_country_flag = th_was_jewish
		clr_country_flag = th_was_zoroastrian
	}
}

th_taoism_remove_all_five_ways = {
	remove_country_modifier = th_taoism_wood_cycle
	remove_country_modifier = th_taoism_fire_cycle
	remove_country_modifier = th_taoism_earth_cycle
	remove_country_modifier = th_taoism_metal_cycle
	remove_country_modifier = th_taoism_water_cycle
}

th_taoism_normal_cycle = {
	if = {
		limit = {
			has_country_flag = th_taoism_had_wood
		}
		clr_country_flag = th_taoism_had_wood
		set_country_flag = th_taoism_had_fire
		add_country_modifier = {
			name = th_taoism_fire_cycle
			duration = -1
		}
	}
	else_if = {
		limit = {
			has_country_flag = th_taoism_had_fire
		}
		clr_country_flag = th_taoism_had_fire
		set_country_flag = th_taoism_had_earth
		add_country_modifier = {
			name = th_taoism_earth_cycle
			duration = -1
		}
	}
	else_if = {
		limit = {
			has_country_flag = th_taoism_had_earth
		}
		clr_country_flag = th_taoism_had_earth
		set_country_flag = th_taoism_had_metal
		add_country_modifier = {
			name = th_taoism_metal_cycle
			duration = -1
		}
	}
	else_if = {
		limit = {			
			has_country_flag = th_taoism_had_metal
		}
		clr_country_flag = th_taoism_had_metal
		set_country_flag = th_taoism_had_water
		add_country_modifier = {
			name = th_taoism_water_cycle
			duration = -1
		}
	}
	else_if = {
		limit = {
			has_country_flag = th_taoism_had_water
		}
		clr_country_flag = th_taoism_had_water
		set_country_flag = th_taoism_had_wood
		add_country_modifier = {
			name = th_taoism_wood_cycle
			duration = -1
		}
	}
}

th_taoism_revert_cycle = {
	if = {
		limit = {
			has_country_flag = th_taoism_had_wood
		}
		clr_country_flag = th_taoism_had_wood
		set_country_flag = th_taoism_had_water
		add_country_modifier = {
			name = th_taoism_water_cycle
			duration = -1
		}
	}
	else_if = {
		limit = {
			has_country_flag = th_taoism_had_fire
		}
		clr_country_flag = th_taoism_had_fire
		set_country_flag = th_taoism_had_wood
		add_country_modifier = {
			name = th_taoism_wood_cycle
			duration = -1
		}
	}
	else_if = {
		limit = {
			has_country_flag = th_taoism_had_earth
		}
		clr_country_flag = th_taoism_had_earth
		set_country_flag = th_taoism_had_fire
		add_country_modifier = {
			name = th_taoism_fire_cycle
			duration = -1
		}
	}
	else_if = {
		limit = {			
			has_country_flag = th_taoism_had_metal
		}
		clr_country_flag = th_taoism_had_metal
		set_country_flag = th_taoism_had_earth
		add_country_modifier = {
			name = th_taoism_earth_cycle
			duration = -1
		}
	}
	else_if = {
		limit = {
			has_country_flag = th_taoism_had_water
		}
		clr_country_flag = th_taoism_had_water
		set_country_flag = th_taoism_had_metal
		add_country_modifier = {
			name = th_taoism_metal_cycle
			duration = -1
		}
	}
}

th_taoism_control_cycle = {
	if = {
		limit = {
			has_country_flag = th_taoism_had_wood
		}
		clr_country_flag = th_taoism_had_wood
		set_country_flag = th_taoism_had_earth
		add_country_modifier = {
			name = th_taoism_earth_cycle
			duration = -1
		}
	}
	else_if = {
		limit = {
			has_country_flag = th_taoism_had_fire
		}
		clr_country_flag = th_taoism_had_fire
		set_country_flag = th_taoism_had_metal
		add_country_modifier = {
			name = th_taoism_metal_cycle
			duration = -1
		}
	}
	else_if = {
		limit = {
			has_country_flag = th_taoism_had_earth
		}
		clr_country_flag = th_taoism_had_earth
		set_country_flag = th_taoism_had_water
		add_country_modifier = {
			name = th_taoism_water_cycle
			duration = -1
		}
	}
	else_if = {
		limit = {			
			has_country_flag = th_taoism_had_metal
		}
		clr_country_flag = th_taoism_had_metal
		set_country_flag = th_taoism_had_wood
		add_country_modifier = {
			name = th_taoism_wood_cycle
			duration = -1
		}
	}
	else_if = {
		limit = {
			has_country_flag = th_taoism_had_water
		}
		clr_country_flag = th_taoism_had_water
		set_country_flag = th_taoism_had_fire
		add_country_modifier = {
			name = th_taoism_fire_cycle
			duration = -1
		}
	}
}

th_taoism_destroy_cycle = {
	if = {
		limit = {
			has_country_flag = th_taoism_had_wood
		}
		clr_country_flag = th_taoism_had_wood
		set_country_flag = th_taoism_had_metal
		add_country_modifier = {
			name = th_taoism_metal_cycle
			duration = -1
		}
	}
	else_if = {
		limit = {
			has_country_flag = th_taoism_had_fire
		}
		clr_country_flag = th_taoism_had_fire
		set_country_flag = th_taoism_had_water
		add_country_modifier = {
			name = th_taoism_water_cycle
			duration = -1
		}
	}
	else_if = {
		limit = {
			has_country_flag = th_taoism_had_earth
		}
		clr_country_flag = th_taoism_had_earth
		set_country_flag = th_taoism_had_wood
		add_country_modifier = {
			name = th_taoism_wood_cycle
			duration = -1
		}
	}
	else_if = {
		limit = {			
			has_country_flag = th_taoism_had_metal
		}
		clr_country_flag = th_taoism_had_metal
		set_country_flag = th_taoism_had_fire
		add_country_modifier = {
			name = th_taoism_fire_cycle
			duration = -1
		}
	}
	else_if = {
		limit = {
			has_country_flag = th_taoism_had_water
		}
		clr_country_flag = th_taoism_had_water
		set_country_flag = th_taoism_had_earth
		add_country_modifier = {
			name = th_taoism_earth_cycle
			duration = -1
		}
	}
}

###FAIRY ELECTION###
th_show_random_candidate_bonus = {
	if = {
		limit = {
			has_global_modifier_value = {
				which = candidate_random_bonus
				value = 1
			}
		}
		custom_tooltip = th_lottery_candidate_bonus_one
	}
}

th_show_random_candidate_bonus_plural = {
	if = {
		limit = {
			has_global_modifier_value = {
				which = candidate_random_bonus
				value = 1
			}
		}
		custom_tooltip = th_lottery_candidate_bonus_plural
	}
}

###MHG MERC STUFF######MHG MERC STUFF###
###TODO REMOVE IT WHEN "mercenary_company" IS FIXED###
th_mhg_set_merc_flags = {
	if = {
		limit = {
			NOT = {
				any_hired_mercenary_company = {
					template = merc_th_yukaris_royal_guard
				}
			}
			NOT = { has_country_flag = mhg_not_hired_royal_guard }
		}
		set_country_flag = mhg_not_hired_royal_guard
	}
	if = {
		limit = {
			NOT = {
				any_hired_mercenary_company = {
					template = merc_th_knights_templar
				}
			}
			NOT = { has_country_flag = mhg_not_hired_knights_templar }
		}
		set_country_flag = mhg_not_hired_knights_templar
	}
	if = {
		limit = {
			NOT = {
				any_hired_mercenary_company = {
					template = merc_th_swiss_canton_mercenaries
				}
			}
			NOT = { has_country_flag = mhg_not_hired_swiss_canton }
		}
		set_country_flag = mhg_not_hired_swiss_canton
	}
	if = {
		limit = {
			NOT = {
				any_hired_mercenary_company = {
					template = merc_th_doppelsoeldner
				}
			}
			NOT = { has_country_flag = mhg_not_hired_doppelsoeldner }
		}
		set_country_flag = mhg_not_hired_doppelsoeldner
	}
	if = {
		limit = {
			NOT = {
				any_hired_mercenary_company = {
					template = merc_th_hessian_jaegerkorps
				}
			}
			NOT = { has_country_flag = mhg_not_hired_jaegerkorps }
		}
		set_country_flag = mhg_not_hired_jaegerkorps
	}
	if = {
		limit = {
			NOT = {
				any_hired_mercenary_company = {
					template = merc_th_gorkhalis
				}
			}
			NOT = { has_country_flag = mhg_not_hired_gorkhalis }
		}
		set_country_flag = mhg_not_hired_gorkhalis
	}
	if = {
		limit = {
			NOT = {
				any_hired_mercenary_company = {
					template = merc_th_dahomey_amazons
				}
			}
			NOT = { has_country_flag = mhg_not_hired_amazons }
		}
		set_country_flag = mhg_not_hired_amazons
	}
}

th_mhg_refund_costs_for_mercs = {
	if = {
		limit = {
			any_hired_mercenary_company = {
				template = merc_th_yukaris_royal_guard
			}
			has_country_flag = mhg_not_hired_royal_guard
		}
		clr_country_flag = mhg_not_hired_royal_guard
		if = {
			limit = {
				has_country_flag = th_pay_mil_instead_of_prof
			}
			add_mil_power = 150
		}
		else_if = {
			limit = {
				has_country_flag = th_merc_eighty_percent_professionalism_cost
			}
			add_army_professionalism = 0.04
		}
		else = {
			add_army_professionalism = 0.05
		}
	}
	if = {
		limit = {
			any_hired_mercenary_company = {
				template = merc_th_knights_templar
			}
			has_country_flag = mhg_not_hired_knights_templar
		}
		clr_country_flag = mhg_not_hired_knights_templar
		if = {
			limit = {
				has_country_flag = th_pay_mil_instead_of_prof
			}
			add_mil_power = 150
		}
		else_if = {
			limit = {
				has_country_flag = th_merc_eighty_percent_professionalism_cost
			}
			add_army_professionalism = 0.04
		}
		else = {
			add_army_professionalism = 0.05
		}
	}
	if = {
		limit = {
			any_hired_mercenary_company = {
				template = merc_th_swiss_canton_mercenaries
			}
			has_country_flag = mhg_not_hired_swiss_canton
		}
		clr_country_flag = mhg_not_hired_swiss_canton
		if = {
			limit = {
				has_country_flag = th_pay_mil_instead_of_prof
			}
			add_mil_power = 150
		}
		else_if = {
			limit = {
				has_country_flag = th_merc_eighty_percent_professionalism_cost
			}
			add_army_professionalism = 0.04
		}
		else = {
			add_army_professionalism = 0.05
		}
	}
	if = {
		limit = {
			any_hired_mercenary_company = {
				template = merc_th_doppelsoeldner
			}
			has_country_flag = mhg_not_hired_doppelsoeldner
		}
		clr_country_flag = mhg_not_hired_doppelsoeldner
		if = {
			limit = {
				has_country_flag = th_pay_mil_instead_of_prof
			}
			add_mil_power = 150
		}
		else_if = {
			limit = {
				has_country_flag = th_merc_eighty_percent_professionalism_cost
			}
			add_army_professionalism = 0.04
		}
		else = {
			add_army_professionalism = 0.05
		}
	}
	if = {
		limit = {
			any_hired_mercenary_company = {
				template = merc_th_hessian_jaegerkorps
			}
			has_country_flag = mhg_not_hired_jaegerkorps
		}
		clr_country_flag = mhg_not_hired_jaegerkorps
		if = {
			limit = {
				has_country_flag = th_pay_mil_instead_of_prof
			}
			add_mil_power = 150
		}
		else_if = {
			limit = {
				has_country_flag = th_merc_eighty_percent_professionalism_cost
			}
			add_army_professionalism = 0.04
		}
		else = {
			add_army_professionalism = 0.05
		}
	}
	if = {
		limit = {
			any_hired_mercenary_company = {
				template = merc_th_gorkhalis
			}
			has_country_flag = mhg_not_hired_gorkhalis
		}
		clr_country_flag = mhg_not_hired_gorkhalis
		if = {
			limit = {
				has_country_flag = th_pay_mil_instead_of_prof
			}
			add_mil_power = 150
		}
		else_if = {
			limit = {
				has_country_flag = th_merc_eighty_percent_professionalism_cost
			}
			add_army_professionalism = 0.04
		}
		else = {
			add_army_professionalism = 0.05
		}
	}
	if = {
		limit = {
			any_hired_mercenary_company = {
				template = merc_th_dahomey_amazons
			}
			has_country_flag = mhg_not_hired_amazons
		}
		clr_country_flag = mhg_not_hired_amazons
		if = {
			limit = {
				has_country_flag = th_pay_mil_instead_of_prof
			}
			add_mil_power = 150
		}
		else_if = {
			limit = {
				has_country_flag = th_merc_eighty_percent_professionalism_cost
			}
			add_army_professionalism = 0.04
		}
		else = {
			add_army_professionalism = 0.05
		}
	}
}

th_mhg_mark_march_as_special_case = {
	custom_tooltip = th_mhg_mark_march_as_special_case_tt
	hidden_effect = {
		set_country_flag = mhg_is_special_case_march
	}
}

###NET CUISINE STUFF###
#Can unlock following cuisines: mediterranean, west_european, middle_european, muslim, east_african, west_african, southeast_asian, far_east, indian
net_unlock_cuisine = {
	[[cuisine]
		custom_tooltip = net_unlock_$cuisine$_cuisine_tt
		hidden_effect = {
			set_country_flag = net_unlocked_$cuisine$_cuisine
			change_variable = {
				which = net_unlocked_cuisines
				value = 1
			}
		}
	]
}

net_activate_cuisine_buff = {
	[[cuisine]
		hidden_effect = {
			change_variable = {
				which = net_active_cuisine_counter
				value = 1
			}
			set_country_flag = net_$cuisine$_cuisine_active
		}
		add_country_modifier = {
			name = net_$cuisine$_cuisine_modifier
			duration = $duration$
		}
	]
}

net_remove_cuisine_flag = {
	[[cuisine]
		hidden_effect = {
			clr_country_flag = net_$cuisine$_cuisine_active
			subtract_variable = {
				which = net_active_cuisine_counter
				value = 1
			}
		}
	]
}

net_pay_cuisine_fee = {
	if = {
		limit = {
			NOT = {
				check_variable = {
					which = net_active_cuisine_counter
					value = 1
				}
			}
		}
		add_years_of_income = -1
	}
	if = {
		limit = {
			check_variable = {
				which = net_active_cuisine_counter
				value = 1
			}
			NOT = {
				check_variable = {
					which = net_active_cuisine_counter
					value = 2
				}
			}
		}
		add_years_of_income = -3
	}
	if = {
		limit = {
			check_variable = {
				which = net_active_cuisine_counter
				value = 2
			}
			NOT = {
				check_variable = {
					which = net_active_cuisine_counter
					value = 3
				}
			}
		}
		add_years_of_income = -5
	}
	if = {
		limit = {
			check_variable = {
				which = net_active_cuisine_counter
				value = 3
			}
			NOT = {
				check_variable = {
					which = net_active_cuisine_counter
					value = 4
				}
			}
		}
		add_years_of_income = -7
	}
	if = {
		limit = {
			check_variable = {
				which = net_active_cuisine_counter
				value = 4
			}
			NOT = {
				check_variable = {
					which = net_active_cuisine_counter
					value = 5
				}
			}
		}
		add_years_of_income = -9
	}
	if = {
		limit = {
			check_variable = {
				which = net_active_cuisine_counter
				value = 5
			}
			NOT = {
				check_variable = {
					which = net_active_cuisine_counter
					value = 6
				}
			}
		}
		add_years_of_income = -11
	}
	if = {
		limit = {
			check_variable = {
				which = net_active_cuisine_counter
				value = 6
			}
			NOT = {
				check_variable = {
					which = net_active_cuisine_counter
					value = 7
				}
			}
		}
		add_years_of_income = -13
	}
	if = {
		limit = {
			check_variable = {
				which = net_active_cuisine_counter
				value = 7
			}
			NOT = {
				check_variable = {
					which = net_active_cuisine_counter
					value = 8
				}
			}
		}
		add_years_of_income = -15
	}
	if = {
		limit = {
			check_variable = {
				which = net_active_cuisine_counter
				value = 8
			}
		}
		add_years_of_income = -17
	}
}

###MKI DISASTER STUFF###
mki_reduce_province_debuff = {
	if = {
		limit = {
			has_country_flag = mki_reduced_makai_penalty_level_2 
		}
		custom_tooltip = mki_reduced_makai_penalty_level_3_tt
		hidden_effect = {
			clr_country_flag = mki_reduced_makai_penalty_level_2
			set_country_flag = mki_reduced_makai_penalty_level_3
			every_owned_province = {
				limit = {
					OR = {
						has_province_modifier = th_neglected_demons
						has_province_modifier = th_begrudging_demons
						has_province_modifier = th_grumpy_demons
					}
				}
				remove_province_modifier = th_neglected_demons
				remove_province_modifier = th_begrudging_demons
				remove_province_modifier = th_grumpy_demons
				add_province_modifier = {
					name = th_unhappy_demons
					duration = -1
				}
			}
		}
	}
	else_if = {
		limit = {
			has_country_flag = mki_reduced_makai_penalty_level_1 
		}
		custom_tooltip = mki_reduced_makai_penalty_level_2_tt
		hidden_effect = {
			clr_country_flag = mki_reduced_makai_penalty_level_1
			set_country_flag = mki_reduced_makai_penalty_level_2
			every_owned_province = {
				limit = {
					has_province_modifier = th_begrudging_demons
				}
				remove_province_modifier = th_begrudging_demons
				add_province_modifier = {
					name = th_grumpy_demons
					duration = -1
				}
			}
		}
	}
	else = {
		custom_tooltip = mki_reduced_makai_penalty_level_1_tt
		hidden_effect = {
			set_country_flag = mki_reduced_makai_penalty_level_1
			every_owned_province = {
				limit = {
					has_province_modifier = th_neglected_demons
				}
				remove_province_modifier = th_neglected_demons
				add_province_modifier = {
					name = th_begrudging_demons
					duration = -1
				}
			}
		}
	}
}

###HIG RELIGIOUS FIGUREHEAD###
hig_assign_religious_figurehead = {
	$tag$ = {
		capital_scope = {
			add_province_triggered_modifier = HIG_religious_legitimation_by_the_yama_$religion$
		}
		add_country_modifier = {
			name = hig_legitimation_from_the_yama
			duration = 9125
		}
	}
	reverse_add_opinion = {
		who = $tag$
		modifier = th_legitimized_us_as_religious_head
	}
	if = {
		limit = {
			NOT = { religion = $religion$ }
		}
		capital_scope = {
			area = {
				limit = {
					owned_by = ROOT
				}
				change_religion = $religion$
			}
		}
	}
	else = {
		add_country_modifier = {
			name = hig_legitimized_state_religion
			duration = 9125
		}
	}
}

###LAWGIVER EFFECTS###
th_enable_legal_code_for_gensokyo = {
	custom_tooltip = th_enable_legal_code_for_gensokyo_tt
	hidden_effect = {
		set_global_flag = th_gensokyan_code_enabled
		#Deprecated for now, script is kept for future Senkai update
		#save_global_event_target_as = LawgiverOfGensokyo
		#1 = {
		#	set_variable = {
		#		which = th_gensokyan_law_debate_pro
		#		value = 0
		#	}
		#	set_variable = {
		#		which = th_gensokyan_law_debate_con
		#		value = 0
		#	}
		#}
	}
	#event_target:LawgiverOfGensokyo = {
		add_country_modifier = {
			name = th_lawgiver_of_gensokyo
			duration = -1
		}
	#}
}

th_disable_legal_code_for_gensokyo = {
	custom_tooltip = th_disable_legal_code_for_gensokyo_tt
	hidden_effect = {
		#Deprecated for now, script is kept for future Senkai update
		#if = {
		#	limit = {
		#		has_global_flag = th_gensokyan_code_enabled
		#	}
		#	1 = {
		#		set_variable = {
		#			which = th_gensokyan_law_debate_pro
		#			value = 0
		#		}
		#		set_variable = {
		#			which = th_gensokyan_law_debate_con
		#			value = 0
		#		}
		#	}
			clr_global_flag = th_gensokyan_code_enabled
		#}
		#clear_global_event_target = LawgiverOfGensokyo
		every_country = {
			limit = {
				has_country_modifier = th_lawgiver_of_gensokyo
			}
			remove_country_modifier = th_lawgiver_of_gensokyo
		}
	}
}

th_invest_into_gensokyan_decree = {
	gensokyo_continent = {
		hidden_effect = {
			remove_province_modifier = th_local_yama_support
			remove_province_modifier = th_local_shrine_support
			remove_province_modifier = th_local_artisan_support
			remove_province_modifier = th_local_scholar_support
			remove_province_modifier = th_local_youkai_support
		}
		add_permanent_province_modifier = {
			name = th_local_$decree$_support
			duration = 7300
		}
	}
	custom_tooltip = th_monthly_income_negative_tt
	hidden_effect = {
		while = {
			limit = {
				check_variable = {
					which = th_monthly_income
					value = 1
				}
			}
			add_treasury = -1
			subtract_variable = {
				which = th_monthly_income
				value = 1
			}
		}
		multiply_variable = {
			which = th_monthly_income
			value = 100
		}
		while = {
			limit = {
				check_variable = {
					which = th_monthly_income
					value = 1
				}
			}
			add_treasury = -0.01
			subtract_variable = {
				which = th_monthly_income
				value = 1
			}
		}
		clr_global_flag = th_enacted_gensokyan_decree
		set_global_flag = th_enacted_gensokyan_decree
	}
}

th_yama_on_war_won_effect = {
	if = { #Defenders win
		limit = {
			ROOT = { has_country_flag = th_hig_defender }
			FROM = { has_country_flag = th_hig_attacker }
			event_target:YamaOfGensokyo = { has_country_flag = th_hig_joined_enforced_peace_war }
		}
		FROM = {
			event_target:YamaOfGensokyo = {
				country_event = {
					id = th_yama_authority_event.94
				}
				clr_country_flag = th_hig_joined_enforced_peace_war
			}
			clr_country_flag = th_hig_attacker
		}
		ROOT = { clr_country_flag = th_hig_attacker }
	}
	if = { #Attacker win
		limit = {
			FROM = { has_country_flag = th_hig_defender }
			ROOT = { has_country_flag = th_hig_attacker }
			event_target:YamaOfGensokyo = { has_country_flag = th_hig_joined_enforced_peace_war }
		}
		FROM = { clr_country_flag = th_hig_defender }
		ROOT = { clr_country_flag = th_hig_attacker }
		event_target:YamaOfGensokyo = {
			country_event = {
				id = th_yama_authority_event.93
			}
			clr_country_flag = th_hig_joined_enforced_peace_war
		}
	}
	if = { #Yamaxanadu Seperate Peaced out
		limit = {
			FROM = { has_country_flag = th_hig_attacker }
			ROOT = { has_country_flag = th_hig_joined_enforced_peace_war }
		}
		FROM = { clr_country_flag = th_hig_attacker }
		event_target:YamaOfGensokyo = {
			country_event = {
				id = th_yama_authority_event.92
			}
			clr_country_flag = th_hig_joined_enforced_peace_war
		}
		random_country = {
			limit = {
				has_country_flag = th_hig_defender
			}
			clr_country_flag = th_hig_defender
		}
	}
	if = { #Yamaxanadu gets Seperate Peaced out
		limit = {
			ROOT = { has_country_flag = th_hig_attacker }
			FROM = { has_country_flag = th_hig_joined_enforced_peace_war }
		}
		ROOT = { clr_country_flag = th_hig_attacker }
		event_target:YamaOfGensokyo = {
			country_event = {
				id = th_yama_authority_event.91
			}
			clr_country_flag = th_hig_joined_enforced_peace_war
		}
		random_country = {
			limit = {
				has_country_flag = th_hig_defender
			}
			clr_country_flag = th_hig_defender
		}
	}
}