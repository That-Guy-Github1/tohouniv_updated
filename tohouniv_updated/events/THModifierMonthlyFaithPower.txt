namespace = th_modifier_monthly_faith_power_events

#Set bonus
country_event = {
	id = th_modifier_monthly_faith_power_events.1
	title = none
	desc = none
	picture = SHRINE_eventPicture
	hidden = yes

	trigger = {
		mry_uses_faith_power = yes
		OR = {
			NOT = { has_country_flag = th_had_monthly_faith_power_event }
			had_country_flag = {
				flag = th_had_monthly_faith_power_event
				days = 29
			}
		}
	}
	
	mean_time_to_happen = {
		days = 1
	}


	immediate = {
		clr_country_flag = th_had_monthly_faith_power_event
		export_to_variable = {
			variable_name = th_additional_faith_power
			value = modifier:monthly_faith_power
			who = ROOT
		}
		export_to_variable = {
			which = faith_power_scaler
			value = modifier:faith_power_modifier
		}
		change_variable = {
			which = faith_power_scaler
			value = 1
		}
		if = {
			limit = {
				check_variable = {	#NO NEGATIVITY SCALER
					which = faith_power_scaler
					value = 0
				}
				check_variable = {	#NEGATIVE VALUES SHOULD NOT SCALE
					which = th_additional_faith_power
					value = 0
				}
			}
			multiply_variable = {
				which = th_additional_faith_power
				which = faith_power_scaler
			}
		}
		change_variable = {
			which = th_additional_faith_power
			which = faith_power
		}
		export_to_variable = {
			which = faith_power_limit
			value = modifier:faith_power_capacity
		}
		multiply_variable = {
			which = faith_power_limit
			value = 100
		}
	}

	option = {
		set_country_flag = th_had_monthly_faith_power_event
		if = {	#Underflow case
			limit = {
				NOT = {
					check_variable = {
						which = th_additional_faith_power
						value = 0
					}
				}
			}
			set_variable = {
				which = faith_power
				value = 0
			}
		}
		else_if = {	#Overflow case
			limit = {
				check_variable = {
					which = th_additional_faith_power
					which = faith_power_limit
				}
			}
			set_variable = {
				which = faith_power
				which = faith_power_limit
			}
		}
		else = {	#Normal case				
			hidden_effect = {
				subtract_variable = {
					which = th_additional_faith_power
					which = faith_power
				}
			}
			change_variable = {
				which = faith_power
				which = th_additional_faith_power
			}
		}

		ai_chance = {
			factor = 100
		}
	}
}
