

namespace = touhou_setting

###SETTING FOR TOUHOU MOD (INSPIRED BY IDEA VARIATION, DANKE NOCHMALS)###

###Activate/Deactivate the incidents###
country_event = {
	id = touhou_setting.1
	title = "touhou_setting.1.t"
	desc = "touhou_setting.1.desc"
	picture = YUKARI_eventPicture

	trigger = {
		ai = no
		NOT = { has_global_flag = th_incident_setting_finished }
	}

	mean_time_to_happen = { days = 0 }
	fire_only_once = yes
	major = yes
	
	immediate = {
		hidden_effect = {
			set_global_flag = th_incident_setting_finished
			if = {
				limit = {
					exists = HKR
				}
				HKR = {
					th_incident_initiate_good_outcome_counter = yes
				}
			}
			else = {
				random_country = {
					limit = {
						was_tag = HKR
					}
					th_incident_initiate_good_outcome_counter = yes
				}
			}
		}
	}
	
	option = {		#Let it be active.
		name = "touhou_setting.1.a"
		custom_tooltip = touhou_setting.1.a.tt
		country_event = {
			id = touhou_setting.8
			days = 0
		}

	}
	
	option = {		#No, deactivate this.
		name = "touhou_setting.1.b"
		custom_tooltip = touhou_setting.1.b.tt
		hidden_effect = {
			set_global_flag = th_deactivated_incidents
		}
	}
}

###REPLACE RULERS WITH YOUNGER RULERS FOR ALL IMMORTAL TOUHOU MONARCHS###

country_event = {
	id = touhou_setting.2
	title = "touhou_setting.2.t"
	desc = "touhou_setting.2.desc"
	picture = YUKARI_eventPicture
	
	trigger = {
		ai = no
		NOT = { has_global_flag = TH_setting_rights_of_man_checked }
		NOT = { has_dlc = "Rights of Man" }
	}
	
	mean_time_to_happen = { days = 0 }
	fire_only_once = yes
	
	immediate = {
		hidden_effect = {
			every_country = {
				limit = {
					ruler_age = 50
					capital_scope = { th_gensokyo_or_moon_continent = yes }
				}
				country_event = {
					id = touhou_setting.3
					days = 0
				}
			}
			set_global_flag = TH_setting_rights_of_man_checked 
		}
	}
	
	option = {			#Why are ruler personalities not in the base game yet?!?
		name = "touhou_setting.2.a"
	}
}

country_event = {
	id = touhou_setting.3
	title = "touhou_setting.3.title"
	desc = "touhou_setting.3.desc"
	picture = GENSOKYOTHRONE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		ruler_age = 50
		capital_scope = { th_gensokyo_or_moon_continent = yes }
	}
	
	immediate = {
		set_global_flag = TH_setting_younger_ruler 
	}
	
	option = {		#Younger Scarlets
		name = touhou_setting.3.a
		trigger = {
			tag = SCR
		}
		th_respawn_ruler_effect = yes
		th_respawn_heir_effect = yes
	}
	option = {		#Younger Komeijis
		name = touhou_setting.3.b
		trigger = {
			tag = CRD
		}
		th_respawn_ruler_effect = yes
		th_respawn_heir_effect = yes
	}
	option = {		#Younger Kaguya
		name = touhou_setting.3.c
		trigger = {
			tag = EIT
		}
		th_respawn_ruler_effect = yes
	}
	option = {		#Younger Mokou
		name = touhou_setting.3.d
		trigger = {
			tag = FUJ
		}
		th_respawn_ruler_effect = yes
	}
	option = {		#Younger Eiki
		name = touhou_setting.3.e
		trigger = {
			tag = HIG
		}
		th_respawn_ruler_effect = yes
	}
	option = {		#Younger Tenshi
		name = touhou_setting.3.f
		trigger = {
			tag = HVR
		}
		th_respawn_ruler_effect = yes
	}
	option = {		#Younger Yakumo
		name = touhou_setting.3.g
		trigger = {
			tag = MHG
		}
		th_respawn_ruler_effect = yes
		th_respawn_heir_effect = yes
	}
	option = {		#Younger Mima
		name = touhou_setting.3.h
		trigger = {
			tag = MIM
		}
		th_respawn_ruler_effect = yes
	}
	option = {		#Younger Shinki
		name = touhou_setting.3.i
		trigger = {
			tag = MKI
		}
		th_respawn_ruler_effect = yes
	}
	option = {		#Younger Sanae
		name = touhou_setting.3.j
		trigger = {
			tag = MRY
		}
		th_respawn_ruler_effect = yes
	}
	option = {		#Younger Yuyuko
		name = touhou_setting.3.k
		trigger = {
			tag = NET
		}
		th_respawn_ruler_effect = yes
	}
	option = {		#Younger Miko
		name = touhou_setting.3.l
		trigger = {
			tag = SNK
		}
		th_respawn_ruler_effect = yes
	}
	option = {		#Younger Hina
		name = touhou_setting.3.m
		trigger = {
			tag = YOF
		}
		th_respawn_ruler_effect = yes
	}
	option = {		#Younger Yuuka
		name = touhou_setting.3.n
		trigger = {
			tag = SFF
		}
		th_respawn_ruler_effect = yes
	}
	option = {		#Younger Aya
		name = touhou_setting.3.o
		trigger = {
			tag = TGU
		}
		th_respawn_ruler_effect = yes
	}
	option = {		#Younger Akis
		name = touhou_setting.3.p
		trigger = {
			tag = AKI
		}
		th_respawn_ruler_effect = yes
		th_respawn_heir_effect = yes
	}
	option = {		#Younger Gengetsu / Mugetsu
		name = touhou_setting.3.q
		trigger = {
			tag = GNU
		}
		th_respawn_ruler_effect = yes
		th_respawn_heir_effect = yes
	}
	option = {		#Younger Hecatia
		name = touhou_setting.3.r
		trigger = {
			tag = HEC
		}
		th_respawn_ruler_effect = yes
	}
	option = {		#Younger Junko
		name = touhou_setting.3.s
		trigger = {
			tag = JNK
		}
		th_respawn_ruler_effect = yes
	}
	option = {		#Younger Keiki
		name = touhou_setting.3.t
		trigger = {
			tag = KEI
		}
		th_respawn_ruler_effect = yes
	}
	option = {		#Younger Kokoro
		name = touhou_setting.3.u
		trigger = {
			tag = KKO
		}
		th_respawn_ruler_effect = yes
	}
	option = {		#Younger Konngara
		name = touhou_setting.3.v
		trigger = {
			tag = KNN
		}
		th_respawn_ruler_effect = yes
	}
	option = {		#Younger Kogasa
		name = touhou_setting.3.w
		trigger = {
			tag = KOG
		}
		th_respawn_ruler_effect = yes
	}
	option = {		#Younger Kasen
		name = touhou_setting.3.x
		trigger = {
			tag = KSE
		}
		th_respawn_ruler_effect = yes
	}
	option = {		#Younger Watatsuki
		name = touhou_setting.3.y
		trigger = {
			tag = LCU
		}
		th_respawn_ruler_effect = yes
		th_respawn_heir_effect = yes
	}
	option = {		#Younger Byakuren
		name = touhou_setting.3.z
		trigger = {
			tag = MYO
		}
		th_respawn_ruler_effect = yes
	}
	option = {		#Younger Sukuna
		name = touhou_setting.3.aa
		trigger = {
			tag = NCS
		}
		th_respawn_ruler_effect = yes
	}
	option = {		#Younger Okina
		name = touhou_setting.3.ab
		trigger = {
			tag = OKI
		}
		th_respawn_ruler_effect = yes
	}
	option = {		#Younger Yuugi
		name = touhou_setting.3.ac
		trigger = {
			tag = ONI
		}
		th_respawn_ruler_effect = yes
	}
	option = {		#Younger Prismriver
		name = touhou_setting.3.ad
		trigger = {
			tag = PRI
		}
		th_respawn_ruler_effect = yes
		th_respawn_heir_effect = yes
	}
	option = {		#Younger Raiko
		name = touhou_setting.3.ae
		trigger = {
			tag = RAI
		}
		th_respawn_ruler_effect = yes
	}
	option = {		#Younger Sekibanki
		name = touhou_setting.3.af
		trigger = {
			tag = SEK
		}
		th_respawn_ruler_effect = yes
	}
	option = {		#Younger Saki
		name = touhou_setting.3.ag
		trigger = {
			tag = SKI
		}
		th_respawn_ruler_effect = yes
	}
	option = {		#Younger Sakata
		name = touhou_setting.3.ah
		trigger = {
			tag = SKT
		}
		th_respawn_ruler_effect = yes
	}
	option = {		#Younger Yachie
		name = touhou_setting.3.ai
		trigger = {
			tag = YAC
		}
		th_respawn_ruler_effect = yes
	}
	option = {		#Younger Yuki&Mai
		name = touhou_setting.3.aj
		trigger = {
			tag = MKN
		}
		th_respawn_ruler_effect = yes
		th_respawn_heir_effect = yes
	}
	option = {		#New nations from submods - ruler only
		name = touhou_setting.3.b
		trigger = {
			th_new_nations_with_immortal_ruler = yes
		}
		th_respawn_ruler_effect = yes
	}
	option = {		#New nations from submods - ruler only
		name = touhou_setting.3.b
		trigger = {
			th_new_nations_with_immortal_ruler_heir = yes
		}
		th_respawn_ruler_effect = yes
		th_respawn_heir_effect = yes
	}
	option = {		#Standard
		name = touhou_setting.3.zzz
		trigger = {
			NOT = {
				th_is_or_was_a_tag_with_immortal_rulers = yes
			}
		}
	}
}

#Set age for Hong

country_event = {
	id = touhou_setting.4
	title = "touhou_setting.4.t"
	desc = "touhou_setting.4.desc"
	picture = GENSOKYOTHRONE_eventPicture
	
	mean_time_to_happen = {
		days = 1
	}
	
	trigger = {
		ruler_age = 50
		tag = HNG
		NOT = { has_dlc = "Rights of Man" }
		NOT = { has_country_flag = TH_picked_younger_Meiling }
	}
	
	immediate = {
		set_country_flag = TH_picked_younger_Meiling 
	}
	
	option = {		#Younger Meiling
		name = touhou_setting.4.a
		define_ruler = {
			name = "Meiling"
			dynasty = "Hong"
			culture = Scarlett
			fixed = yes
			adm = 3
			dip = 4
			mil = 6
			age = 20
			claim = 100
			female = yes
		}
		hidden_effect = {
			set_ruler_flag = touhou_character_ruler
			set_ruler_flag = touhou_original_ruler
		}
		if = {
			limit = {
				is_subject = yes
			}
			hidden_effect = {
				add_ruler_modifier = { 
					name = scr_meilings_loyalty
					duration = -1
				}
			}
		}
	}
}

#Set age for Flan

country_event = {
	id = touhou_setting.5
	title = "touhou_setting.5.t"
	desc = "touhou_setting.5.desc"
	picture = GENSOKYOTHRONE_eventPicture
	
	mean_time_to_happen = {
		days = 1
	}
	
	trigger = {
		ruler_age = 50
		tag = FLR
		NOT = { has_dlc = "Rights of Man" }
		NOT = { has_country_flag = TH_picked_younger_Flan }
	}
	
	immediate = {
		set_country_flag = TH_picked_younger_Flan
	}
	
	option = {		#Younger Flan
		name = touhou_setting.5.a
		define_ruler = {
			name = "Flandre"
			dynasty = "Scarlet"
			culture = Scarlett
			fixed = yes
			adm = 5
			dip = 3
			mil = 6
			age = 20
			claim = 100
			female = yes
		}
		hidden_effect = {
			set_ruler_flag = touhou_character_ruler
			set_ruler_flag = touhou_original_ruler
		}
		if = {
			limit = {
				is_subject = yes
			}
			hidden_effect = {
				add_ruler_modifier = { 
					name = scr_flans_loyalty
					duration = -1
				}
			}
		}
	}
}

#Remove all province modifiers when Leviathan is active
country_event = {
	id = touhou_setting.6
	title = "touhou_setting.6.t"
	desc = "touhou_setting.6.desc"
	picture = GENSOKYOTHRONE_eventPicture

	trigger = {
		OR = {
			AND = {
				has_dlc = "Leviathan"
				NOT = { has_global_flag = th_removed_province_modifiers }
			}
			AND = {
				NOT = { has_dlc = "Leviathan" }
				has_global_flag = th_removed_province_modifiers
			}
		}
	}
	
	mean_time_to_happen = {
		days = 1
	}

	hidden = yes

	option = {	#OK
		name = touhou_setting.7.a
		if = {
			limit = {
				has_dlc = "Leviathan"
			}
			set_global_flag = th_removed_province_modifiers
			every_province = {
				limit = {
					has_province_modifier = Important_regional_center
				}
				set_province_flag = th_had_important_regional_center
				remove_province_modifier = Important_regional_center
			}
		}
		else = {	#Restore the modifier when Leviathan gets deactivated again
			clr_global_flag = th_removed_province_modifiers
			every_province = {
				limit = {
					has_province_flag = th_had_important_regional_center
				}
				add_province_modifier = {
					name = Important_regional_center
					duration = -1
				}
				clr_province_flag = th_had_important_regional_center
			}
		}

		ai_chance = {
			factor = 1
		}
	}
}

#Major is a feminist
country_event = {
	id = touhou_setting.7
	title = "touhou_setting.7.t"
	desc = "touhou_setting.7.desc"
	picture = GENSOKYOTHRONE_eventPicture
	
	is_triggered_only = yes

	hidden = yes

	immediate = {
		if = {
			limit = {
				has_heir = yes
			}
			exile_heir_as = th_exiled_heir
			set_country_flag = th_has_exiled_heir
		}			
		exile_ruler_as = th_exiled_ruler
		if = {
			limit = {
				government = monarchy
				uses_devotion = no
			}
			add_stability = 1
		}
		define_ruler = {
 			name = "A girl behind a mask"
			dynasty = "Illusion"
    			age = 20
    			claim = 95
    			adm = 0
    			dip = 0
    			mil = 0
			fixed = yes
			male = yes
			culture = ROOT
			religion = ROOT
		}
		set_ruler_flag = th_a_feminist_major
	}

	option = {	#OK
		name = touhou_setting.7.a
	}
}

#Activate random incidents

country_event = {
	id = touhou_setting.8
	title = "touhou_setting.8.t"
	desc = "touhou_setting.8.desc"
	picture = YUKARI_eventPicture
	
	is_triggered_only = yes
	
	option = {		#Keep it chronological
		name = touhou_setting.8.a
		custom_tooltip = touhou_setting.8.a.tt
		if = {
			limit = {
				NOT = { tag = HKR }
				HKR = {
					ai = yes
					was_player = no
				}
				OR = {
					capital_scope = {
						superregion = gensokyo_superregion
					}
					any_country = {
						ai = no
						capital_scope = {
							superregion = gensokyo_superregion
						}
					}
				}
			}
			country_event = {
				id = touhou_setting.12
			}
		}
	}
	
	option = {		#Activate random Incidents
		name = touhou_setting.8.b
		custom_tooltip = touhou_setting.8.b.tt
		set_global_flag = th_random_incident_active
		if = {
			limit = {
				NOT = { tag = HKR }
				HKR = {
					ai = yes
					was_player = no
				}
				OR = {
					capital_scope = {
						superregion = gensokyo_superregion
					}
					any_country = {
						ai = no
						capital_scope = {
							superregion = gensokyo_superregion
						}
					}
				}
			}
			country_event = {
				id = touhou_setting.12
			}
		}
	}
}

#Development nerf event
country_event = {
	id = touhou_setting.9
	title = "touhou_setting.9.t"
	desc = "touhou_setting.9.desc"
	picture = GENSOKYOSGUARDIAN_eventPicture
	
	is_triggered_only = yes

	option = {	#Keep Original Gensokyo	- 5256 dev
		name = "touhou_setting.9.a"
		custom_tooltip = touhou_setting.9.a.tt
	}

	option = {	#Reduce the Gensokyan population please - 4120
		name = "touhou_setting.9.b"
		custom_tooltip = touhou_setting.9.b.tt
		th_change_gensokyo_dev = {
			min_plus_one = 2
			tax = -1
			production = -1
			manpower = -1
		}
	}

	option = {	#Only the strongest survive in Gensokyo - 3119
		name = "touhou_setting.9.c"
		custom_tooltip = touhou_setting.9.c.tt
		th_change_gensokyo_dev = {
			min_plus_one = 2
			tax = -2
			production = -2
			manpower = -2
		}
	}

	option = {	#Somebody pissed off Flandre - 2412
		name = "touhou_setting.9.d"
		custom_tooltip = touhou_setting.9.d.tt
		th_change_gensokyo_dev = {
			min_plus_one = 2
			tax = -3
			production = -3
			manpower = -3
		}
	}

	option = {	#This entire continent must be purged - 1965
		name = "touhou_setting.9.e"
		custom_tooltip = touhou_setting.9.e.tt
		th_change_gensokyo_dev = {
			min_plus_one = 5
			tax = -4
			production = -4
			manpower = -4
		}
	}

	option = {	#Okuu nukes Gensokyo
		name = "touhou_setting.9.f"
		custom_tooltip = touhou_setting.9.f.tt
		th_change_gensokyo_dev = {
			min_plus_one = 6
			tax = -5
			production = -5
			manpower = -5
		}
	}

	option = {	#Give me the Fallout 76 experience
		name = "touhou_setting.9.g"
		custom_tooltip = touhou_setting.9.g.tt
		th_change_gensokyo_dev = {
			min_plus_one = 7
			tax = -6
			production = -6
			manpower = -6
		}
	}
}

#Difficulty Setting event
country_event = {
	id = touhou_setting.10
	title = "touhou_setting.10.t"
	desc = "touhou_setting.10.desc"
	picture = GENSOKYOSGUARDIAN_eventPicture

	is_triggered_only = yes
	major = yes

	option = {
		name = "touhou_setting.10.a"
		custom_tooltip = touhou_setting.10.a.tt
		highlight = yes
		hidden_effect = {
			clr_global_flag = th_global_heroic_mode
			clr_global_flag = th_global_mythic_mode
			clr_global_flag = th_global_lunatic_mode
		}

		ai_chance = {
			factor = 1
		}
	}

	option = {
		name = "touhou_setting.10.b"
		custom_tooltip = touhou_setting.10.b.tt
		hidden_effect = {
			set_global_flag = th_global_heroic_mode
			clr_global_flag = th_global_mythic_mode
			clr_global_flag = th_global_lunatic_mode
		}
		hidden_effect = {
			country_event = {
				id = th_difficulty_event.3
			}
			every_country = {
				limit = {
					ai = no
				}
				country_event = {
					id = th_difficulty_event.3
				}
			}
		}

		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "touhou_setting.10.c"
		custom_tooltip = touhou_setting.10.c.tt
		hidden_effect = {
			clr_global_flag = th_global_heroic_mode
			set_global_flag = th_global_mythic_mode
			clr_global_flag = th_global_lunatic_mode
		}
		hidden_effect = {
			country_event = {
				id = th_difficulty_event.3
			}
			every_country = {
				limit = {
					ai = no
				}
				country_event = {
					id = th_difficulty_event.3
				}
			}
		}

		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "touhou_setting.10.d"
		custom_tooltip = touhou_setting.10.d.tt
		hidden_effect = {
			clr_global_flag = th_global_heroic_mode
			clr_global_flag = th_global_mythic_mode
			set_global_flag = th_global_lunatic_mode
		}
		hidden_effect = {
			country_event = {
				id = th_difficulty_event.3
			}
			every_country = {
				limit = {
					ai = no
				}
				country_event = {
					id = th_difficulty_event.3
				}
			}
		}

		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "touhou_setting.10.e"
		custom_tooltip = touhou_setting.10.e.tt
		hidden_effect = {
			clr_global_flag = th_global_heroic_mode
			clr_global_flag = th_global_mythic_mode
			clr_global_flag = th_global_lunatic_mode
		}
	
		ai_chance = {
			factor = 0
		}
	}
}

#Enable/Disable achievements
country_event = {
	id = touhou_setting.11
	title = "touhou_setting.11.t"
	desc = "touhou_setting.11.desc"
	picture = AYAPAPERNEWS_eventPicture
	
	trigger = {		
		ai = no
		normal_or_historical_nations = yes
		normal_province_values = yes
		ironman = yes
		start_date = 1444.11.11
	}

	mean_time_to_happen = {
		days = 1
	}

	fire_only_once = yes
	major = yes

	option = {
		name = "touhou_setting.11.a"
		custom_tooltip = touhou_setting.11.a.tt
		hidden_effect = {
			set_global_flag = th_global_achievements_enabled
		}

		ai_chance = {
			factor = 1
		}
	}

	option = {
		name = "touhou_setting.11.b"
		custom_tooltip = touhou_setting.11.b.tt
		hidden_effect = {
			clr_global_flag = th_global_achievements_enabled
		}
	}
}

#Enable / Disable player biased investigator

country_event = {
	id = touhou_setting.12
	title = "touhou_setting.12.t"
	desc = "touhou_setting.12.desc"
	picture = YUKARI_eventPicture
	
	is_triggered_only = yes
	
	option = {		#Keep it normal
		name = touhou_setting.12.a
		custom_tooltip = touhou_setting.12.a.tt
	}
	
	option = {		#I want to be the star of the show!
		name = touhou_setting.12.b
		custom_tooltip = touhou_setting.12.b.tt
		set_global_flag = th_biased_incident_active
	}
}
