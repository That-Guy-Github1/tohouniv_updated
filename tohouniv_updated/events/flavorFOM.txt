########################################
# Flavor Events for Forest of Magic
########################################

namespace = flavor_fom

###New Hourai Potion Mission Reward

country_event = {
	id = flavor_fom.1
	title = "flavor_fom.1.t"
	desc = "flavor_fom.1.desc"
	picture = ALCHEMYMARISA_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = flavor_fom.1.a
		custom_tooltip = flavor_fom.1.a.tt
		th_enable_free_respawn = yes
		th_halve_respawn_cooldown = yes
		hidden_effect = {
			th_increase_ruler_adm_stat = {
				adm = 1
			}
		}
		add_ruler_personality = immortal_personality
		add_adm_power = 150
		add_dip_power = 150
		add_mil_power = 150
		add_prestige = 15
	}
}

###Ellen joins FOM###
country_event = {
	id = flavor_fom.6
	title = "flavor_fom.6.t"
	desc = "flavor_fom.6.desc"
	picture = ELLEN_eventPicture

	is_triggered_only = yes

	option = {
		name = flavor_fom.6.a
		add_treasury = -250
		5087 = {
			add_base_tax = 2
			add_base_production = 2
			add_base_manpower = 1
			change_culture = Magician
			add_permanent_province_modifier = {
				name = fom_ellen_shop
				duration = 9125
			}
			change_province_name = "Ellen's Home"
			rename_capital = "Fluffy Magic Shop"
		}
						
		ai_chance = { 
			factor = 100
		}
	}

	option = {
		name = flavor_fom.6.b
		add_prestige = 5
						
		ai_chance = { 
			factor = 0
		}
	}
}

###Narumi joins FOM###
country_event = {
	id = flavor_fom.7
	title = "flavor_fom.7.t"
	desc = "flavor_fom.7.desc"
	picture = NARUMI_eventPicture

	is_triggered_only = yes

	option = {
		name = flavor_fom.7.a
		
		add_country_modifier = {
			name = fom_jizo_statues
			duration = -1
		}
						
		ai_chance = { 
			factor = 100
		}
	}
}

###Byakuren's Scrolls###
country_event = {
	id = flavor_fom.8
	title = "flavor_fom.8.t"
	desc = "flavor_fom.8.desc"
	picture = BYAKURENSCROLL_eventPicture

	is_triggered_only = yes

	option = {
		name = flavor_fom.8.a
		
		add_country_modifier = {
			name = fom_scroll_of_buddhistic_teachings
			duration = 9125
		}
						
		ai_chance = { 
			factor = 33
		}
	}

	option = {
		name = flavor_fom.8.b
		
		add_country_modifier = {
			name = fom_scroll_of_martial_art
			duration = 9125
		}
						
		ai_chance = { 
			factor = 33
		}
	}

	option = {
		name = flavor_fom.8.c
		
		add_country_modifier = {
			name = fom_scroll_of_creation
			duration = 9125
		}
						
		ai_chance = { 
			factor = 33
		}
	}
}

###Mai and Yuki join###
country_event = {
	id = flavor_fom.9
	title = "flavor_fom.9.t"
	desc = "flavor_fom.9.desc"
	picture = MAIYUKI_eventPicture

	is_triggered_only = yes

	option = {
		name = flavor_fom.9.a
		
		if = {
			limit = {
				MKI = {
					is_subject_of = ROOT
				}
			}
			MKI = {
				add_historical_friend = ROOT
			}
			add_historical_friend = MKI
		}
		custom_tooltip = flavor_fom.9.a.tt
		hidden_effect = {
			every_province = {
				limit = {
					country_or_non_sovereign_subject_holds = ROOT
					culture = Makaian
				}
				th_add_global_prosperity = {
					prosperity = 15
				}
			}
		}
						
		ai_chance = { 
			factor = 1
		}
	}
}

###Add Flag for not having any super doll active###
country_event = {
	id = flavor_fom.10
	title = "flavor_fom.10.t"
	desc = "flavor_fom.10.desc"
	picture = MAIYUKI_eventPicture

	trigger = {
		OR = {
			AND = {
				NOT = {
					any_hired_mercenary_company = {
						template = merc_th_goliath_doll
					}
				}
				NOT = { has_country_flag = fom_not_hired_doll_type_goliath }
			}
			AND = {
				NOT = {
					any_hired_mercenary_company = {
						template = merc_th_level_titania
					}
				}
				NOT = { has_country_flag = fom_not_hired_doll_type_titania }
			}
			AND = {
				NOT = {
					any_hired_mercenary_company = {
						template = merc_th_level_leviathan
					}
				}
				NOT = { has_country_flag = fom_not_hired_doll_type_leviathan }
			}
		}
		th_is_or_was_tag = {
			tag = FOM
		}
	}

	mean_time_to_happen = {
		days = 1
	}

	hidden = yes

	option = {
		name = flavor_fom.10.a
		
		if = {
			limit = {
				NOT = {
					any_hired_mercenary_company = {
						template = merc_th_goliath_doll
					}
				}
				NOT = { has_country_flag = fom_not_hired_doll_type_goliath }
			}
			set_country_flag = fom_not_hired_doll_type_goliath
		}
		if = {
			limit = {
				NOT = {
					any_hired_mercenary_company = {
						template = merc_th_level_titania
					}
				}
				NOT = { has_country_flag = fom_not_hired_doll_type_titania }
			}
			set_country_flag = fom_not_hired_doll_type_titania
		}
		if = {
			limit = {
				NOT = {
					any_hired_mercenary_company = {
						template = merc_th_level_leviathan
					}
				}
				NOT = { has_country_flag = fom_not_hired_doll_type_leviathan }
			}
			set_country_flag = fom_not_hired_doll_type_leviathan
		}
						
		ai_chance = { 
			factor = 1
		}
	}
}

###Remove Flag for having any super doll active###
country_event = {
	id = flavor_fom.11
	title = "flavor_fom.11.t"
	desc = "flavor_fom.11.desc"
	picture = MAIYUKI_eventPicture

	trigger = {
		OR = {
			AND = {
				any_hired_mercenary_company = {
					template = merc_th_goliath_doll
				}
				has_country_flag = fom_not_hired_doll_type_goliath
			}
			AND = {
				any_hired_mercenary_company = {
					template = merc_th_level_titania
				}
				has_country_flag = fom_not_hired_doll_type_titania
			}
			AND = {
				any_hired_mercenary_company = {
					template = merc_th_level_leviathan
				}
				has_country_flag = fom_not_hired_doll_type_leviathan
			}
		}
	}

	mean_time_to_happen = {
		days = 1
	}

	hidden = yes

	option = {
		name = flavor_fom.10.a
		
		if = {
			limit = {
				any_hired_mercenary_company = {
					template = merc_th_goliath_doll
				}
				has_country_flag = fom_not_hired_doll_type_goliath
			}
			clr_country_flag = fom_not_hired_doll_type_goliath
			add_army_professionalism = 0.05
		}
		if = {
			limit = {
				any_hired_mercenary_company = {
					template = merc_th_level_titania
				}
				has_country_flag = fom_not_hired_doll_type_titania
			}
			clr_country_flag = fom_not_hired_doll_type_titania
			add_army_professionalism = 0.05
		}
		if = {
			limit = {
				any_hired_mercenary_company = {
					template = merc_th_level_leviathan
				}
				has_country_flag = fom_not_hired_doll_type_leviathan
			}
			clr_country_flag = fom_not_hired_doll_type_leviathan
			add_army_professionalism = 0.05
		}
						
		ai_chance = { 
			factor = 1
		}
	}
}

#Rumia is happy
country_event = {
	id = flavor_fom.16
	title = "flavor_fom.16.t"
	desc = "flavor_fom.16.desc"
	picture = RUMIA_eventPicture

	is_triggered_only = yes

	option = {
		name = flavor_fom.16.a
		custom_tooltip = flavor_fom.16.a.tt
		hidden_effect = {
			every_country = {
				limit = {
					primary_culture = Gensokyo_human
				}
				add_opinion = {
					who = ROOT
					modifier = th_banished_the_rumia_threat
				}
			}
		}
						
		ai_chance = { 
			factor = 100
		}
	}
}

#Fight with Mima
country_event = {
	id = flavor_fom.17
	title = flavor_fom.17.t
	desc = flavor_fom.17.desc
	picture = MIMA_eventPicture
	
	is_triggered_only = yes
	
	immediate = {
		hidden_effect = {
			if = {
				limit = {
					has_ruler_flag = th_original_marisa
				}
				th_getruler_fighting_skill = {
					SKILL_BONI = 300
				}
			}
			else = {
				th_getruler_fighting_skill = {
					SKILL_BONI = 0
				}
			}
			#Mima
			set_variable = {
				which = th_fom_mima_combat_skills
				value = 1550
			}
			th_defineopponent_fighting_skill = {
				VARIABLE = th_fom_mima_combat_skills
			}
			clr_country_flag = fom_can_fight_mima
		}
	}
	
	option = {	#TAKE THIS
		name = flavor_fom.17.a
		if = {
			limit = {
				has_ruler_flag = th_original_marisa
			}
			custom_tooltip = flavor_fom.17.a.tt
		}
		else = {
			custom_tooltip = flavor_fom.17.a.ct
		}
		highlight = yes
		th_danmaku_normal_fight_ruler_and_opponent = {
			win_event = flavor_fom.18
			draw_event = flavor_fom.18
			defeat_event = flavor_fom.19
			days = 10
		}

		ai_chance = { 
			factor = 100
		}
	}
}

#Victory over Mima
country_event = {
	id = flavor_fom.18
	title = flavor_fom.18.t
	desc = flavor_fom.18.desc
	picture = MAIYUKI_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = flavor_fom.18.a
		custom_tooltip = flavor_fom.18.a.tt
		add_mil_power = 150
		hidden_effect = {
			set_country_flag = FOM_defeated_mima
		}

		ai_chance = { 
			factor = 100
		}
	}
}

#Defeat against Mima
country_event = {
	id = flavor_fom.19
	title = flavor_fom.19.t
	desc = flavor_fom.19.desc
	picture = MAIYUKI_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = flavor_fom.19.a
		custom_tooltip = flavor_fom.19.a.tt
		hidden_effect = {
			set_country_flag = fom_can_fight_mima
			set_country_flag = fom_lost_against_mima
		}

		ai_chance = { 
			factor = 100
		}
	}
}

#Fight with Yumeko
country_event = {
	id = flavor_fom.20
	title = flavor_fom.20.t
	desc = {
		trigger = {
			has_ruler_flag = th_original_alice
		}
		desc = flavor_fom.20.desc.a
	}
	desc = {
		trigger = {
			NOT = { has_ruler_flag = th_original_alice }
		}
		desc = flavor_fom.20.desc.b
	}
	picture = MAIYUKI_eventPicture
	
	is_triggered_only = yes
	
	immediate = {
		hidden_effect = {
			if = {
				limit = {
					has_ruler_flag = th_original_alice
				}
				th_getruler_fighting_skill = {
					SKILL_BONI = 300
				}
			}
			else = {
				th_getruler_fighting_skill = {
					SKILL_BONI = 0
				}
			}
			#Mai and Yuki
			set_variable = {
				which = th_fom_shinki_combat_skills
				value = 1750
			}
			th_defineopponent_fighting_skill = {
				VARIABLE = th_fom_shinki_combat_skills
			}
			clr_country_flag = fom_can_fight_yumeko
		}
	}
	
	option = {	#TAKE THIS
		name = flavor_fom.20.a
		if = {
			limit = {
				has_ruler_flag = th_original_alice
			}
			custom_tooltip = flavor_fom.20.a.tt
		}
		else = {
			custom_tooltip = flavor_fom.20.a.ct
		}
		highlight = yes
		th_danmaku_normal_fight_ruler_and_opponent = {
			win_event = flavor_fom.21
			draw_event = flavor_fom.21
			defeat_event = flavor_fom.22
			days = 10
		}

		ai_chance = { 
			factor = 100
		}
	}
}

#Victory over Yumeko
country_event = {
	id = flavor_fom.21
	title = flavor_fom.21.t
	desc = flavor_fom.21.desc
	picture = MAIYUKI_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = flavor_fom.21.a
		custom_tooltip = flavor_fom.21.a.tt
		add_mil_power = 150
		hidden_effect = {
			set_country_flag = FOM_defeated_yumeko
		}

		ai_chance = { 
			factor = 100
		}
	}
}

#Defeat against Yumeko
country_event = {
	id = flavor_fom.22
	title = flavor_fom.22.t
	desc = flavor_fom.22.desc
	picture = MAIYUKI_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = flavor_fom.22.a
		custom_tooltip = flavor_fom.22.a.tt
		hidden_effect = {
			set_country_flag = fom_can_fight_yumeko
			set_country_flag = fom_lost_against_yumeko
		}

		ai_chance = { 
			factor = 100
		}
	}
}