########################################
# Flavor Events for Higan
########################################

namespace = flavor_hig

#The many privileges of the Shinigami
country_event = {
	id = flavor_hig.1
	title = flavor_hig.1.t
	desc = flavor_hig.1.desc
	picture = KOMACHI_eventPicture
	fire_only_once = yes
	trigger = {
		th_is_or_was_tag = {
			tag = HIG
		}
		NOT = { has_country_flag = hig_has_dealt_with_slacking_komachi }
		has_estate_privilege = th_estate_nobles_slacking_shinigami
	}
	
	mean_time_to_happen = {
		months = 1
	}
	
	option = {
		name = flavor_hig.1.a

		ai_chance = { 
			factor = 100
		}
	}
}

#Resolvement of the Religious Chaos
country_event = {
	id = flavor_hig.2
	title = flavor_hig.2.t
	desc = flavor_hig.2.desc
	picture = GENSOKYOTHRONE_eventPicture
	is_triggered_only = yes
	
	option = {
		name = flavor_hig.2.a
		add_estate_loyalty = {
			estate = estate_yama
			loyalty = 25
		}

		ai_chance = { 
			factor = 100
			modifier = {
				factor = 0
				NOT = { alliance_with = HKR }
			}
		}
	}
}

#Hellish Union
country_event = {
	id = flavor_hig.3
	title = flavor_hig.3.t
	desc = flavor_hig.3.desc
	picture = SATORIOFFICE_eventPicture
	is_triggered_only = yes
	
	option = {
		name = flavor_hig.3.a
		add_adm_power = 100
		add_dip_power = 100
		add_mil_power = 100
		every_subject_country = {
			limit = {
				th_is_or_was_tag = {
					tag = CRD
				}
			}
			grant_independence = yes
			ROOT = {
				create_subject = {
					subject_type = th_exarch_subject
					subject = PREV
				}
			}
		}
		ai_chance = { 
			factor = 100
		}
	}
	
	option = {
		name = flavor_hig.3.b
		add_prestige = 25
		every_subject_country = {
			limit = {
				th_is_or_was_tag = {
					tag = CRD
				}
			}
			every_owned_province = {
				limit = {
					OR = {
						NOT = { continent = gensokyo_continent }
						region = former_hell_region
						region = hell_region
						region = netherworld_region
						area = Konngaras_state
					}
				}
				add_core = ROOT
				cede_province = ROOT
			}
		}

		ai_chance = { 
			factor = 100
		}
	}
}

#Appointing of a Religious Head
country_event = {
	id = flavor_hig.4
	title = flavor_hig.4.t
	desc = flavor_hig.4.desc
	picture = GENSOKYOTHRONE_eventPicture
	is_triggered_only = yes
	major = yes
	
	option = {
		name = flavor_hig.4.a
		trigger = {
			exists = HKR
		}
		hig_assign_religious_figurehead = {
			tag = HKR
			religion = th_hakureishinto
		}
		add_opinion = {
			who = MRY
			modifier = th_did_not_legitimize_us_as_religious_head
		}
		add_opinion = {
			who = OKR
			modifier = th_did_not_legitimize_us_as_religious_head
		}
		add_opinion = {
			who = MYO
			modifier = th_did_not_legitimize_us_as_religious_head
		}
		add_opinion = {
			who = SNK
			modifier = th_did_not_legitimize_us_as_religious_head
		}

		ai_chance = { 
			factor = 100
			modifier = {
				factor = 0
				NOT = { alliance_with = HKR }
			}
		}
	}
	
	option = {
		name = flavor_hig.4.b
		trigger = {
			exists = MRY
		}
		hig_assign_religious_figurehead = {
			tag = MRY
			religion = th_moriyashinto
		}
		add_opinion = {
			who = HKR
			modifier = th_did_not_legitimize_us_as_religious_head
		}
		add_opinion = {
			who = OKR
			modifier = th_did_not_legitimize_us_as_religious_head
		}
		add_opinion = {
			who = MYO
			modifier = th_did_not_legitimize_us_as_religious_head
		}
		add_opinion = {
			who = SNK
			modifier = th_did_not_legitimize_us_as_religious_head
		}

		ai_chance = { 
			factor = 100
			modifier = {
				factor = 0
				NOT = { alliance_with = MRY }
			}
		}
	}
	
	option = {
		name = flavor_hig.4.c
		trigger = {
			exists = OKR
		}
		hig_assign_religious_figurehead = {
			tag = OKR
			religion = th_oldhakurei
		}
		add_opinion = {
			who = MRY
			modifier = th_did_not_legitimize_us_as_religious_head
		}
		add_opinion = {
			who = HKR
			modifier = th_did_not_legitimize_us_as_religious_head
		}
		add_opinion = {
			who = MYO
			modifier = th_did_not_legitimize_us_as_religious_head
		}
		add_opinion = {
			who = SNK
			modifier = th_did_not_legitimize_us_as_religious_head
		}

		ai_chance = { 
			factor = 100
			modifier = {
				factor = 0
				NOT = { alliance_with = OKR }
			}
		}
	}
	
	option = {
		name = flavor_hig.4.d
		trigger = {
			exists = MYO
		}
		hig_assign_religious_figurehead = {
			tag = MYO
			religion = th_buddhist
		}
		add_opinion = {
			who = MRY
			modifier = th_did_not_legitimize_us_as_religious_head
		}
		add_opinion = {
			who = OKR
			modifier = th_did_not_legitimize_us_as_religious_head
		}
		add_opinion = {
			who = HKR
			modifier = th_did_not_legitimize_us_as_religious_head
		}
		add_opinion = {
			who = SNK
			modifier = th_did_not_legitimize_us_as_religious_head
		}

		ai_chance = { 
			factor = 100
			modifier = {
				factor = 0
				NOT = { alliance_with = MYO }
			}
		}
	}
	
	option = {
		name = flavor_hig.4.e
		trigger = {
			exists = SNK
		}
		hig_assign_religious_figurehead = {
			tag = SNK
			religion = th_taoist
		}
		add_opinion = {
			who = MRY
			modifier = th_did_not_legitimize_us_as_religious_head
		}
		add_opinion = {
			who = OKR
			modifier = th_did_not_legitimize_us_as_religious_head
		}
		add_opinion = {
			who = MYO
			modifier = th_did_not_legitimize_us_as_religious_head
		}
		add_opinion = {
			who = HKR
			modifier = th_did_not_legitimize_us_as_religious_head
		}

		ai_chance = { 
			factor = 100
			modifier = {
				factor = 0
				NOT = { alliance_with = SNK }
			}
		}
	}
	
	option = { #The law is above petty religious debacles
		name = flavor_hig.4.f
		add_estate_loyalty = {
			estate = estate_yama
			loyalty = 15
		}
		add_country_modifier = {
			name = hig_above_the_religious_scuffle
			duration = 9125
		}

		ai_chance = { 
			factor = 100
			modifier = {
				factor = 0
				OR = {
					alliance_with = HKR
					alliance_with = MRY
					alliance_with = OKR
					alliance_with = MYO
					alliance_with = SNK
				}
			}
		}
	}
}

#Remove Tenshi from HVR
country_event = {
	id = flavor_hig.5
	title = flavor_hig.5.t
	desc = flavor_hig.5.desc
	picture = TENSHI_eventPicture
	is_triggered_only = yes
	
	option = {	#Replace Tenshi with Iku
		name = flavor_hig.5.a
		white_peace = HVR
		HVR = {
			custom_tooltip = flavor_hig.5.a.tt
			add_stability = -2
			define_ruler = {
				name = "Iku"
				dynasty = "Nagae"
				culture = Youkai
				adm = 5
				dip = 6
				mil = 4
				age = 20
				claim = 100
				female = yes
				religion = th_hakureishinto
			}
			hidden_effect = {
				set_country_flag = hvr_cannot_get_tenshi
				set_ruler_flag = touhou_character_ruler
				set_ruler_flag = touhou_original_ruler
				add_ruler_personality = immortal_personality
			}
			add_ruler_modifier = {
				name = hig_competent_ruler
				duration = 9125
			}
			add_country_modifier = {
				name = hig_under_yama_influence
				duration = 9125
			}
		}
		add_prestige = 100
		add_estate_loyalty = {
			estate = estate_yama
			loyalty = 25
		}

		ai_chance = { 
			factor = 0
		}
	}
	
	option = {	#Lecture Tenshi
		name = flavor_hig.5.b
		white_peace = HVR
		HVR = {
			add_stability = -4
			add_ruler_modifier = {
				name = hig_lectured_tenshi
				duration = 9125
			}
			add_country_modifier = {
				name = hig_under_yama_influence
				duration = 9125
			}
		}
		add_prestige = 100
		add_estate_loyalty = {
			estate = estate_yama
			loyalty = 25
		}

		ai_chance = { 
			factor = 0
		}
	}
	
	option = {
		name = flavor_hig.5.c
		add_adm_power = 200
		add_dip_power = 200
		add_mil_power = 200
		add_estate_loyalty = {
			estate = estate_yama
			loyalty = -25
		}

		ai_chance = { 
			factor = 100
		}
	}
}

#Judgement of the Gang Leaders
country_event = {
	id = flavor_hig.6
	title = flavor_hig.6.t
	desc = flavor_hig.6.desc
	picture = TENSHI_eventPicture
	is_triggered_only = yes
	major = yes
	
	option = {
		name = flavor_hig.6.a
		trigger = {
			OR = {
				exists = SKI
				exists = GBD
				exists = YAC
			}
		}
		hidden_effect = {
			set_variable = {
				which = th_ae_variable
				value = 0
			}
		}
		if = {
			limit = {
				exists = SKI
			}
			white_peace = SKI
			create_subject = {
				subject_type = vassal
				subject = SKI
			}
			hidden_effect = {
				change_variable = {
					which = th_ae_variable
					value = 15
				}
			}
		}
		if = {
			limit = {
				exists = YAC
			}
			white_peace = YAC
			create_subject = {
				subject_type = vassal
				subject = YAC
			}
			hidden_effect = {
				change_variable = {
					which = th_ae_variable
					value = 15
				}
			}
		}
		if = {
			limit = {
				exists = GBD
			}
			white_peace = GBD
			create_subject = {
				subject_type = vassal
				subject = GBD
			}
			hidden_effect = {
				change_variable = {
					which = th_ae_variable
					value = 15
				}
			}
		}
		add_country_modifier = {
			name = hig_ruler_of_the_matriarchs
			duration = 10950
		}
		custom_tooltip = flavor_hig.6.a.tt
		while = {
			limit = {
				check_variable = {
					which = th_ae_variable
					value = 1
				}
			}
			every_known_country = {
				limit = {
					capital_scope = {
						continent = gensokyo_continent
					}
					NOT = { is_subject_of = ROOT }
					NOT = { alliance_with = ROOT }
				}
				add_opinion = {
					who = ROOT
					modifier = aggressive_expansion
				}
			}
			subtract_variable = {
				which = th_ae_variable
				value = 1
			}
		}

		ai_chance = { 
			factor = 100
		}
	}
	
	option = {
		name = flavor_hig.6.b
		trigger = {
			OR = {
				exists = SKI
				exists = GBD
				exists = YAC
			}
		}
		hidden_effect = {
			set_variable = {
				which = th_ae_variable
				value = 0
			}
		}
		if = {
			limit = {
				exists = SKI
			}
			white_peace = SKI
			create_subject = {
				subject_type = tributary_state
				subject = SKI
			}
			hidden_effect = {
				change_variable = {
					which = th_ae_variable
					value = 10
				}
			}
		}
		if = {
			limit = {
				exists = YAC
			}
			white_peace = YAC
			create_subject = {
				subject_type = tributary_state
				subject = YAC
			}
			hidden_effect = {
				change_variable = {
					which = th_ae_variable
					value = 10
				}
			}
		}
		if = {
			limit = {
				exists = GBD
			}
			white_peace = GBD
			create_subject = {
				subject_type = tributary_state
				subject = GBD
			}
			hidden_effect = {
				change_variable = {
					which = th_ae_variable
					value = 10
				}
			}
		}
		add_estate_loyalty = {
			estate = estate_yama
			loyalty = 25
		}
		custom_tooltip = flavor_hig.6.b.tt
		while = {
			limit = {
				check_variable = {
					which = th_ae_variable
					value = 1
				}
			}
			every_known_country = {
				limit = {
					capital_scope = {
						continent = gensokyo_continent
					}
					NOT = { is_subject_of = ROOT }
					NOT = { alliance_with = ROOT }
				}
				add_opinion = {
					who = ROOT
					modifier = aggressive_expansion
				}
			}
			subtract_variable = {
				which = th_ae_variable
				value = 1
			}
		}

		ai_chance = { 
			factor = 0
		}
	}
	
	option = {
		name = flavor_hig.6.c
		trigger = {
			OR = {
				exists = SKI
				exists = GBD
				exists = YAC
			}
		}
		if = {
			limit = {
				exists = SKI
			}
			kill_ruler = yes
			th_disable_respawn_ability = {
				custom_tooltip = flavor_hig.6.c.tt
				duration = 36500
			}
		}
		if = {
			limit = {
				exists = YAC
			}
			kill_ruler = yes
			th_disable_respawn_ability = {
				custom_tooltip = flavor_hig.6.c.tt
				duration = 36500
			}
		}
		if = {
			limit = {
				exists = SKI
			}
			kill_ruler = yes
			th_disable_respawn_ability = {
				custom_tooltip = flavor_hig.6.c.tt
				duration = 36500
			}
		}
		add_estate_loyalty = {
			estate = estate_yama
			loyalty = 50
		}

		ai_chance = { 
			factor = 0
		}
	}
}

#Kutaka becomes direct Vassal
country_event = {
	id = flavor_hig.7
	title = flavor_hig.7.t
	desc = flavor_hig.7.desc
	picture = KUTAKA_eventPicture
	is_triggered_only = yes
	
	option = {
		name = flavor_hig.7.a
		GGS = {
			grant_independence = yes
		}
		create_subject = {
			subject_type = vassal
			subject = GGS
		}
		ai_chance = { 
			factor = 100
		}
	}
}

#Creation of the New Ministry of Right and Wrong
country_event = {
	id = flavor_hig.8
	title = flavor_hig.8.t
	desc = flavor_hig.8.desc
	picture = GENSOKYOTHRONE_eventPicture
	is_triggered_only = yes
	major = yes
	
	option = {
		name = flavor_hig.8.a
		th_enable_legal_code_for_gensokyo = yes
		ai_chance = { 
			factor = 100
		}
	}
}

#Yukari and the High Judge
country_event = {
	id = flavor_hig.9
	title = flavor_hig.9.t
	desc = flavor_hig.9.desc
	picture = GENSOKYOTHRONE_eventPicture
	is_triggered_only = yes
	
	option = {
		name = flavor_hig.9.a
		add_power_projection = {
			type = mission_rewards_power_projection
			amount = 50
		}
		add_estate_loyalty = {
			estate = estate_yama
			loyalty = 25
		}
		
		ai_chance = { 
			factor = 100
		}
	}
}

#Handling of the Immortals
country_event = {
	id = flavor_hig.10
	title = flavor_hig.10.t
	desc = flavor_hig.10.desc
	picture = KAGUYAVSMOKOUFUN_eventPicture
	is_triggered_only = yes
	major = yes
	
	option = {	#Sentence Mokou as guilty
		name = flavor_hig.10.a
		if = {
			limit = {
				war_with = EIT
			}
			white_peace = EIT
		}
		if = {
			limit = {
				exists = FUJ
			}
			FUJ = {
				if = {
					limit = {
						has_estate = estate_rival_kaguya
					}
					add_estate_loyalty = {
						estate = estate_rival_kaguya
						loyalty = 30
					}
					add_estate_influence_modifier = {
						estate = estate_rival_kaguya
						influence = 30
						duration = 18250
						desc = TH_JUDGEMENT_OF_THE_YAMA
					}
				}
				add_stability = -2
				add_opinion = {
					who = ROOT
					modifier = th_sentenced_as_guilty
				}
			}
		}
		
		ai_chance = { 
			factor = 0
		}
	}
	
	option = {	#Sentence Kaguya as guilty
		name = flavor_hig.10.b
		if = {
			limit = {
				war_with = FUJ
			}
			white_peace = FUJ
		}
		if = {
			limit = {
				exists = EIT
			}
			EIT = {
				if = {
					limit = {
						has_estate = estate_rival_mokou
					}
					add_estate_loyalty = {
						estate = estate_rival_mokou
						loyalty = 30
					}
					add_estate_influence_modifier = {
						estate = estate_rival_mokou
						influence = 30
						duration = 18250
						desc = TH_JUDGEMENT_OF_THE_YAMA
					}
				}
				add_stability = -2
				add_opinion = {
					who = ROOT
					modifier = th_sentenced_as_guilty
				}
			}
		}
		
		ai_chance = { 
			factor = 0
		}
	}
	
	option = {	#Sentence both as guilty
		name = flavor_hig.10.c
		if = {
			limit = {
				exists = EIT
			}
			EIT = {
				add_stability = -1
				add_opinion = {
					who = ROOT
					modifier = th_misjudged
				}
			}
		}
		if = {
			limit = {
				exists = FUJ
			}
			FUJ = {
				add_stability = -1
				add_opinion = {
					who = ROOT
					modifier = th_misjudged
				}
			}
		}
		
		ai_chance = { 
			factor = 100
		}
	}
}

#Hecatia returns to Higan - HEC
country_event = {
	id = flavor_hig.11
	title = flavor_hig.11.t
	desc = flavor_hig.11.desc
	picture = HECATIA2_eventPicture
	is_triggered_only = yes
	major = yes
	
	option = {	#The realm is on its own now
		name = flavor_hig.11.a
		if = {
			limit = {
				exists = CLP
			}
			reverse_add_casus_belli = {
				type = cb_touhou_mission_personal_union_war
				target = CLP
				months = 600
			}
		}
		if = {
			limit = {
				exists = JNK
			}
			reverse_add_casus_belli = {
				type = cb_touhou_mission_personal_union_war
				target = JNK
				months = 600
			}
		}
		add_stability = -1
		tooltip = {
			exile_ruler_as = Hecatia
		}
		hidden_effect = {
			kill_ruler = yes
		}
		th_disable_respawn_ability = {
			custom_tooltip = flavor_hig.11.tt
			duration = 27375
		}
		
		ai_chance = { 
			factor = 100
		}
	}

	after = {
		random_country = {
			limit = {
				has_country_flag = hig_has_return_hecatia_war_cb_flag
			}
			clr_country_flag = hig_has_return_hecatia_war_cb_flag
		}
	}
}

#Hire Komachi
country_event = {
	id = flavor_hig.102
	title = flavor_hig.102.t
	desc = flavor_hig.102.desc
	picture = KOMACHI_eventPicture
	
	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			add_country_modifier = {
				name = th_hired_komachi_modifier
				duration = 10950
				hidden = yes
			}
		}
	}
	
	option = {	#Advisor Komachi
		name = flavor_hig.102.a
		define_advisor = {
			type = th_advisor_komachi
			name = "Komachi Onozuka"
			skill = 3
			location = 4969
			discount = yes
			female = yes
			culture = Higanean
			religion = ROOT
		}
		
		ai_chance = { 
			factor = 0
		}
	}
	
	option = {	#General Komachi
		name = flavor_hig.102.b
		define_general = {
			name = "Komachi Onozuka"
			shock = 6
			fire = 6
			manuever = 6
			siege = 4
			female = yes
			trait = goal_oriented_personality
		}
		
		
		ai_chance = { 
			factor = 1
			modifier = {
				factor = 100
				is_at_war = yes
			}
		}
	}
}