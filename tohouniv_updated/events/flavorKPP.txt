########################################
# Flavor Events for Kappapolis
########################################	

namespace = flavor_kpp

# Election!
country_event = {
	id = flavor_kpp.1
	title = flavor_kpp.1.t
	picture = NITORIBOSS_eventPicture	#TODO
	
	desc = {
		trigger = {
			has_regency = no
			NOT = { has_ruler_flag = leader_has_been_pushed_out }
			OR = {
				NOT = { has_government_attribute = th_has_limited_terms }
				check_variable = {
					which = max_election_term
					which = election_term
				}
			}
		}
		desc = flavor_kpp.1.desc.a
	}
	
	desc = {
		trigger = {
			OR = {
				has_regency = yes
				has_ruler_flag = leader_has_been_pushed_out
				AND = {
					has_government_attribute = th_has_limited_terms
					NOT = {
						check_variable = {
							which = max_election_term
							which = election_term
						}
					}
				}
			}
		}
		desc = flavor_kpp.1.desc.b
	}
	
	is_triggered_only = yes
	
	trigger = {
		has_government_attribute = th_has_kappa_elections
		NOT = { has_disaster = th_kappa_guild_wars_disaster }
	}

	option = {
		name = "EVTOPTA700"	# Current ruler stays
		trigger = {
			ai = no
			has_regency = no
			NOT = { has_ruler_flag = leader_has_been_pushed_out }
			OR = {
				NOT = { has_government_attribute = th_has_limited_terms }
				check_variable = {
					which = max_election_term
					which = election_term
				}
			}
		}
		ai_chance = { 
			factor = 60
			modifier = {
				factor = 0
				NOT = { republican_tradition = 25 }
			}	
			modifier = {
				factor = 0.5
				NOT = { republican_tradition = 50 }
			}				
			modifier = {
				factor = 0.5
				NOT = { republican_tradition = 75 }
			}	
			modifier = {
				factor = 2.0
				republican_tradition = 90
			}		
		}
		custom_tooltip = remains_ruler
		if = {
			limit = { has_government_attribute = th_has_limited_terms }
			custom_tooltip = th_current_term_tt
		}
		if = {
			limit = {
				has_ruler_modifier = th_elected_kappa_tinker
			}
			add_scaled_republican_tradition = -5
			random_list = {
				10 = {
					add_adm_power = 100
				}
				10 = {
					add_dip_power = 100
				}
				10 = {
					add_mil_power = 100
				}
			}
		}
		else = {
			change_adm = 1
			change_dip = 1
			change_mil = 1
			add_scaled_republican_tradition = -10
			random_list = {
				10 = {
					add_adm_power = 50
				}
				10 = {
					add_dip_power = 50
				}
				10 = {
					add_mil_power = 50
				}
			}
		}
		add_karma = -5
		if = {
			limit = { has_country_modifier = kpp_overcame_anti_teamwork_disaster }
			change_innovativeness = 1
		}
		hidden_effect = {
			change_variable = {
				which = election_term
				value = 1
			}
		}
	}
	option = {
		name = "EVTOPTB700"	# An administrator type
		ai_chance = { factor = 20 }
		define_ruler = {
			adm = 4
			dip = 1
			mil = 1
			random_gender = yes # Allows random gender for republics
		}
		if = {
			limit = { 
				has_faction = mr_guilds 
			}
			add_faction_influence = {
				faction = mr_guilds
				influence = 20
			}				
		}
		add_karma = 10
		if = {
			limit = { has_country_modifier = kpp_overcame_anti_teamwork_disaster }
			change_innovativeness = 1
		}
		hidden_effect = {
			set_variable = {
				which = election_term
				value = 1
			}
		}
	}
	option = {
		name = "EVTOPTC700"	# A diplomat
		ai_chance = { factor = 20 }
		define_ruler = {
			adm = 1
			dip = 4
			mil = 1					
			random_gender = yes # Allows random gender for republics
		}
		if = {
			limit = { 
				has_faction = mr_traders 
			}
			add_faction_influence = {
				faction = mr_traders
				influence = 20
			}				
		}
		add_karma = 10		
		if = {
			limit = { has_country_modifier = kpp_overcame_anti_teamwork_disaster }
			change_innovativeness = 1
		}
		hidden_effect = {
			set_variable = {
				which = election_term
				value = 1
			}
		}
	}
	option = {
		name = "EVTOPTD700"	# A military man
		ai_chance = { factor = 20 }
		define_ruler = {
			adm = 1
			dip = 1
			mil = 4
			random_gender = yes # Allows random gender for republics
		}
		if = {
			limit = { 
				has_faction = mr_aristocrats 
			}
			add_faction_influence = {
				faction = mr_aristocrats
				influence = 20
			}				
		}
		add_karma = 10
		if = {
			limit = { has_country_modifier = kpp_overcame_anti_teamwork_disaster }
			change_innovativeness = 1
		}
		hidden_effect = {
			set_variable = {
				which = election_term
				value = 1
			}
		}
	}

	option = { # Nepotism choice, re-electing within dynasty
		name = "EVTOPTE700"
		trigger = {
			has_government_attribute = enables_nepotism
		}
		ai_chance = { factor = 10 }
		if = {
			limit = {
				has_country_flag = strengthened_signoria_flag
			}
			custom_tooltip = strengthened_signoria_election_tt
			clr_country_flag = strengthened_signoria_flag
		}
		else = {
			add_scaled_republican_tradition = -4
		}
		define_ruler = {
			min_age = 20
			max_age = 40
			name = "lastname"
			random_gender = yes # Allows random gender for republics
		}
		if = {
			limit = { 
				has_faction = mr_aristocrats 
			}
			add_faction_influence = {
				faction = mr_aristocrats
				influence = 10
			}				
		}
		if = {
			limit = { has_country_modifier = kpp_overcame_anti_teamwork_disaster }
			change_innovativeness = 1
		}
		hidden_effect = {
			set_variable = {
				which = election_term
				value = 1
			}
		}
	}

	option = { # Nitori choice
		name = flavor_kpp.1.e
		trigger = {
			OR = {
				ai = yes
				AND = {
					has_government_attribute = th_kpp_can_elect_nitori
					th_has_not_original_ruler = yes
				}
			}
		}
		ai_chance = { factor = 100 }
		define_ruler = {
			name = "Nitori"
			dynasty = "Kawashiro"
			age = 20
			adm = 6
			dip = 5
			mil = 3
			female = yes
		}
		hidden_effect = {
			add_ruler_modifier = {
				name = th_elected_kappa_tinker
				duration = -1
			}
			add_ruler_personality = immortal_personality
			set_ruler_flag = touhou_character_ruler
			set_ruler_flag = touhou_original_ruler
			set_variable = {
				which = election_term
				value = 1
			}
		}
		if = {
			limit = { has_country_modifier = kpp_overcame_anti_teamwork_disaster }
			change_innovativeness = 1
		}
	}

	after = {
		if = {
			limit = { has_government_attribute = th_has_kappa_rebels }
			country_event = {
				id = flavor_kpp.30
			}
		}
	}
}

# Election! - Death
country_event = {
	id = flavor_kpp.2
	title = flavor_kpp.2.t
	picture = NITORIBOSS_eventPicture	#TODO
	desc = "EVTDESC701"
	
	is_triggered_only = yes
	
	trigger = {
		has_government_attribute = th_has_kappa_elections
		NOT = { has_disaster = th_kappa_guild_wars_disaster }
	}
	
	option = {
		name = "EVTOPTB700"	# An administrator type
		ai_chance = { factor = 40 }
		define_ruler = {
			mil = 1
			adm = 4
			dip = 1					
			random_gender = yes # Allows random gender for republics
		}
		if = {
			limit = { 
				has_faction = mr_guilds 
			}
			add_faction_influence = {
				faction = mr_guilds
				influence = 20
			}				
		}
		if = {
			limit = { has_country_modifier = kpp_overcame_anti_teamwork_disaster }
			change_innovativeness = 1
		}
	}
	option = {
		name = "EVTOPTC700"	# A diplomat
		ai_chance = { factor = 30 }
		define_ruler = {
			adm = 1
			dip = 4
			mil = 1		
			random_gender = yes # Allows random gender for republics
		}
		if = {
			limit = { 
				has_faction = mr_traders 
			}
			add_faction_influence = {
				faction = mr_traders
				influence = 20
			}				
		}			
		if = {
			limit = { has_country_modifier = kpp_overcame_anti_teamwork_disaster }
			change_innovativeness = 1
		}
	}
	option = {
		name = "EVTOPTD700"	# A military man
		ai_chance = { factor = 30 }
		define_ruler = {
			adm = 1
			dip = 1
			mil = 4
			random_gender = yes # Allows random gender for republics
		}
		if = {
			limit = { 
				has_faction = mr_aristocrats 
			}
			add_faction_influence = {
				faction = mr_aristocrats
				influence = 20
			}				
		}		
		if = {
			limit = { has_country_modifier = kpp_overcame_anti_teamwork_disaster }
			change_innovativeness = 1
		}
	}
	option = { # Nepotism choice, re-electing within dynasty
		name = "EVTOPTE700"
		trigger = {
			has_government_attribute = enables_nepotism
		}
		ai_chance = { factor = 10 }
		if = {
			limit = {
				has_country_flag = strengthened_signoria_flag
			}
			custom_tooltip = strengthened_signoria_election_tt
			clr_country_flag = strengthened_signoria_flag
		}
		else = {
			add_scaled_republican_tradition = -4
		}
		define_ruler = {
			min_age = 20
			max_age = 40
			name = "lastname"
			random_gender = yes # Allows random gender for republics
		}
		if = {
			limit = { 
				has_faction = mr_aristocrats 
			}
			add_faction_influence = {
				faction = mr_aristocrats
				influence = 10
			}				
		}
		if = {
			limit = { has_country_modifier = kpp_overcame_anti_teamwork_disaster }
			change_innovativeness = 1
		}
	}

	after = {
		hidden_effect = {
			set_variable = {
				which = election_term
				value = 1
			}
		}
		if = {
			limit = { has_government_attribute = th_has_kappa_rebels }
			country_event = {
				id = flavor_kpp.30
			}
		}
	}
}

# The Establishment of the Kappa Corps
country_event = {
	id = flavor_kpp.3
	title = flavor_kpp.3.t
	picture = NITORIBOSS_eventPicture	#TODO
	desc = flavor_kpp.3.desc
	is_triggered_only = yes

	#Welcome to the Corps!
	option = {
		name = flavor_kpp.3.a
		capital_scope = {
			marine_infantry = ROOT
			marine_infantry = ROOT
			marine_infantry = ROOT
			marine_infantry = ROOT
		}
		add_country_modifier = {
			name = kpp_the_kappa_conscription
			duration = -1
		}
		add_army_professionalism = 0.02

		ai_chance = {
			factor = 1
		}
	}
}

# Settlement of Guinea
country_event = {
	id = flavor_kpp.4
	title = flavor_kpp.4.t
	picture = NITORIBOSS_eventPicture	#TODO
	desc = {
		desc = flavor_kpp.4.desc.a
		trigger = {
			guinea_region = {
				is_empty = yes
				has_port = yes
			}
		}
	}
	desc = {
		desc = flavor_kpp.4.desc.b
		trigger = {
			guinea_region = {
				OR = {
					has_port = no
					is_empty = no
				}
				type = all
			}
		}
	}
	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			if = {
				limit = {
					guinea_region = {
						is_empty = yes
						has_port = yes
					}
				}
				random_province = {
					limit = {
						region = guinea_region
						is_empty = yes
						has_port = yes
						NOT = { has_province_flag = kpp_province_target }
					}
					save_event_target_as = kpp_african_province_to_settle_1
					set_province_flag = kpp_province_target
				}
				random_province = {
					limit = {
						region = guinea_region
						is_empty = yes
						has_port = yes
						NOT = { has_province_flag = kpp_province_target }
					}
					save_event_target_as = kpp_african_province_to_settle_2
					set_province_flag = kpp_province_target
				}
				random_province = {
					limit = {
						region = guinea_region
						is_empty = yes
						has_port = yes
						NOT = { has_province_flag = kpp_province_target }
					}
					save_event_target_as = kpp_african_province_to_settle_3
					set_province_flag = kpp_province_target
				}
				random_province = {
					limit = {
						region = guinea_region
						is_empty = yes
						has_port = yes
						NOT = { has_province_flag = kpp_province_target }
					}
					save_event_target_as = kpp_african_province_to_settle_4
					set_province_flag = kpp_province_target
				}
				random_province = {
					limit = {
						region = guinea_region
						is_empty = yes
						has_port = yes
						NOT = { has_province_flag = kpp_province_target }
					}
					save_event_target_as = kpp_african_province_to_settle_5
					set_province_flag = kpp_province_target
				}
			}
		}
	}
	after = {
		every_province = {
			limit = {
				has_province_flag = kpp_province_target
			}
			clr_province_flag = kpp_province_target
		}
	}

	#Colonize province 1
	option = {
		name = flavor_kpp.4.a
		goto = kpp_african_province_to_settle_1
		trigger = {
			has_saved_event_target = kpp_african_province_to_settle_1
		}
		event_target:kpp_african_province_to_settle_1 = {
			th_colonize_province_for_country = {
				who = ROOT
			}
		}

		ai_chance = {
			factor = 1
		}
	}

	#Colonize province 2
	option = {
		name = flavor_kpp.4.b
		goto = kpp_african_province_to_settle_2
		trigger = {
			has_saved_event_target = kpp_african_province_to_settle_2
		}
		event_target:kpp_african_province_to_settle_2 = {
			th_colonize_province_for_country = {
				who = ROOT
			}
		}

		ai_chance = {
			factor = 1
		}
	}

	#Colonize province 3
	option = {
		name = flavor_kpp.4.c
		goto = kpp_african_province_to_settle_3
		trigger = {
			has_saved_event_target = kpp_african_province_to_settle_3
		}
		event_target:kpp_african_province_to_settle_3 = {
			th_colonize_province_for_country = {
				who = ROOT
			}
		}

		ai_chance = {
			factor = 1
		}
	}

	#Colonize province 4
	option = {
		name = flavor_kpp.4.d
		goto = kpp_african_province_to_settle_4
		trigger = {
			has_saved_event_target = kpp_african_province_to_settle_4
		}
		event_target:kpp_african_province_to_settle_4 = {
			th_colonize_province_for_country = {
				who = ROOT
			}
		}

		ai_chance = {
			factor = 1
		}
	}

	#Colonize province 5
	option = {
		name = flavor_kpp.4.e
		goto = kpp_african_province_to_settle_5
		trigger = {
			has_saved_event_target = kpp_african_province_to_settle_5
		}
		event_target:kpp_african_province_to_settle_5 = {
			th_colonize_province_for_country = {
				who = ROOT
			}
		}

		ai_chance = {
			factor = 1
		}
	}

	#Nothing to colonize...
	option = {
		name = flavor_kpp.4.f
		trigger = {
			guinea_region = {
				OR = {
					has_port = no
					is_empty = no
				}
				type = all
			}
		}
		guinea_region = {
			limit = {
				NOT = { is_core = ROOT }
				NOT = { is_permanent_claim = ROOT }
			}
			add_permanent_claim = ROOT
		}

		ai_chance = {
			factor = 1
		}
	}
}

# The Tinker Federation
country_event = {
	id = flavor_kpp.5
	title = flavor_kpp.5.t
	picture = NITORIBOSS_eventPicture	#TODO
	desc = flavor_kpp.5.desc
	is_triggered_only = yes

	#A great day for the engineers, inventors and tinkers!
	option = {
		name = flavor_kpp.5.a
		add_government_reform = kpp_the_tinker_federation

		ai_chance = {
			factor = 1
		}
	}
}

# Weaponized Australian Wildlife
country_event = {
	id = flavor_kpp.8
	title = flavor_kpp.8.t
	picture = NITORIBOSS_eventPicture	#TODO
	desc = flavor_kpp.8.desc
	is_triggered_only = yes

	#Mount the machine guns on the super spiders!
	option = {
		name = flavor_kpp.8.a
		change_innovativeness = 1
		add_republican_tradition = 5
		kpp_unlock_gadget = {
			gadget = australian_rangers
		}
		kpp_apply_gadget = {
			gadget = australian_rangers
			duration = 7300
		}

		ai_chance = {
			factor = 1
		}
	}
}

# Integration of Yumemi's technology
country_event = {
	id = flavor_kpp.9
	title = flavor_kpp.9.t
	picture = NITORIBOSS_eventPicture	#TODO
	desc = flavor_kpp.9.desc
	is_triggered_only = yes

	#Astounding!
	option = {
		name = flavor_kpp.9.a
		change_innovativeness = 1
		add_republican_tradition = 5
		kpp_unlock_gadget = {
			gadget = aerial_torpedo
		}
		kpp_apply_gadget = {
			gadget = aerial_torpedo
			duration = 7300
		}

		ai_chance = {
			factor = 1
		}
	}
}

# Integration of Rika's technology
country_event = {
	id = flavor_kpp.10
	title = flavor_kpp.10.t
	picture = NITORIBOSS_eventPicture	#TODO
	desc = flavor_kpp.10.desc
	is_triggered_only = yes

	#Astounding!
	option = {
		name = flavor_kpp.10.a
		change_innovativeness = 1
		add_republican_tradition = 5
		kpp_unlock_gadget = {
			gadget = kappa_tanks
		}
		kpp_apply_gadget = {
			gadget = kappa_tanks
			duration = 7300
		}

		ai_chance = {
			factor = 1
		}
	}
}

# Invention of the Kappa Cybernetics
country_event = {
	id = flavor_kpp.11
	title = flavor_kpp.11.t
	picture = NITORIBOSS_eventPicture	#TODO
	desc = flavor_kpp.11.desc
	is_triggered_only = yes

	#Astounding!
	option = {
		name = flavor_kpp.11.a
		change_innovativeness = 1
		add_republican_tradition = 5
		kpp_unlock_gadget = {
			gadget = kappa_cybernetics
		}
		kpp_apply_gadget = {
			gadget = kappa_cybernetics
			duration = 7300
		}

		ai_chance = {
			factor = 1
		}
	}
}

# The technology of the future
country_event = {
	id = flavor_kpp.12
	title = flavor_kpp.12.t
	picture = NITORIBOSS_eventPicture	#TODO
	desc = flavor_kpp.12.desc
	is_triggered_only = yes

	#Astounding!
	option = {
		name = flavor_kpp.12.a
		change_innovativeness = 1
		add_republican_tradition = 5
		kpp_unlock_gadget = {
			gadget = sanpei_battleship
		}
		kpp_apply_gadget = {
			gadget = sanpei_battleship
			duration = 7300
		}

		ai_chance = {
			factor = 1
		}
	}
}

# Creation of the Hisoutensoku
country_event = {
	id = flavor_kpp.13
	title = flavor_kpp.13.t
	picture = NITORIBOSS_eventPicture	#TODO
	desc = flavor_kpp.13.desc
	is_triggered_only = yes

	#You utter fool! Kappa science is the best in the world!
	option = {
		name = flavor_kpp.13.a
		change_innovativeness = 10
		add_prestige = 50
		kpp_unlock_gadget = {
			gadget = hisoutensoku
		}
		kpp_apply_gadget = {
			gadget = hisoutensoku
			duration = 7300
		}
		th_unlock_mercenary_company = {
			mercenary_company = merc_th_hisoutensoku
		}

		ai_chance = {
			factor = 1
		}
	}
}

# Tributary Status of the Kappas
country_event = {
	id = flavor_kpp.14
	title = flavor_kpp.14.t
	picture = NITORIBOSS_eventPicture	#TODO
	desc = flavor_kpp.14.desc
	is_triggered_only = yes
	#We shall serve the Moriya Clan with our services
	option = {
		name = flavor_kpp.14.a
		trigger = {
			exists = MRY
			MRY = { religion = th_moriyashinto }
			religion = th_moriyashinto
		}
		custom_tooltip = flavor_kpp.14.a.tt
		hidden_effect = {
			MRY = {
				country_event = {
					id = flavor_kpp.15
				}
			}
		}

		ai_chance = {
			factor = 1
		}
	}
	option = {
		name = flavor_kpp.14.b
		trigger = {
			exists = MRY
			OR = {
				MRY = { NOT = { religion = th_moriyashinto } }
				NOT = { religion = th_moriyashinto }
			}
		}
		custom_tooltip = flavor_kpp.14.b.tt
		hidden_effect = {
			MRY = {
				country_event = {
					id = flavor_kpp.15
				}
			}
		}

		ai_chance = {
			factor = 0
		}
	}

	#All we need is an alliance with Moriya Clan
	option = {
		name = flavor_kpp.14.c
		trigger = {
			exists = MRY
		}
		custom_tooltip = flavor_kpp.14.c.tt
		hidden_effect = {
			MRY = {
				country_event = {
					id = flavor_kpp.16
				}
			}
		}

		ai_chance = {
			factor = 0
		}
	}

	#We are good on our own
	option = {
		name = flavor_kpp.14.d
		add_dip_power = 100

		ai_chance = {
			factor = 1
		}
	}
}

# Kappapolis wants to become our tributary
country_event = {
	id = flavor_kpp.15
	title = flavor_kpp.15.t
	picture = NITORIBOSS_eventPicture	#TODO
	desc = {
		desc = flavor_kpp.15.desc.a
		trigger = {
			FROM = { religion = th_moriyashinto }
			religion = th_moriyashinto
		}
	}
	desc = {
		desc = flavor_kpp.15.desc.b
		trigger = {
			OR = {
				NOT = { FROM = { religion = th_moriyashinto } }
				NOT = { religion = th_moriyashinto }
			}
		}
	}
	is_triggered_only = yes
	major = yes
	major_trigger = {
		tag = KPP
	}

	#Accept their request
	option = {
		name = flavor_kpp.15.a
		if = {
			limit = {
				religion = th_moriyashinto
				FROM = { religion = th_moriyashinto }
			}
			create_subject = {
				subject_type = th_religious_tributary
				subject = FROM
			}
		}
		else = {
			set_country_flag = forced_tributary_state
			create_subject = {
				subject_type = tributary_state
				subject = FROM
			}
			clr_country_flag = forced_tributary_state
		}
		add_trust = {
			who = FROM
			value = 25
			mutual = yes
		}

		ai_chance = {
			factor = 1
		}
	}

	#No lol
	option = {
		name = flavor_kpp.15.b
		reverse_add_casus_belli = {
			type = cb_insult
			target = FROM
			months = 60
		}
		reverse_add_opinion = {
			who = FROM
			modifier = th_kpp_refused_alliance
		}

		ai_chance = {
			factor = 0
		}
	}
}

# Kappapolis wants to become our ally (Moriya)
country_event = {
	id = flavor_kpp.16
	title = flavor_kpp.16.t
	picture = NITORIBOSS_eventPicture	#TODO
	desc = flavor_kpp.16.desc
	is_triggered_only = yes
	major = yes
	major_trigger = {
		tag = KPP
	}

	#Accept their request
	option = {
		name = flavor_kpp.16.a
		if = {
			limit = { is_rival = FROM }
			remove_rival = FROM
		}
		if = {
			limit = { is_enemy = FROM }
			FROM = { remove_rival = ROOT }
		}
		create_alliance = FROM
		add_trust = {
			who = FROM
			value = 25
			mutual = yes
		}
		if = {
			limit = {
				ai = yes
			}
			set_ai_attitude = {
				attitude = attitude_allied
				who = FROM
			}
		}

		ai_chance = {
			factor = 1
		}
	}

	#No lol
	option = {
		name = flavor_kpp.16.b
		reverse_add_casus_belli = {
			type = cb_insult
			target = FROM
			months = 60
		}
		reverse_add_opinion = {
			who = FROM
			modifier = th_kpp_refused_alliance
		}

		ai_chance = {
			factor = 0
		}
	}
}

# Kappa-Tengu Diplomacy
country_event = {
	id = flavor_kpp.17
	title = flavor_kpp.17.t
	picture = NITORIBOSS_eventPicture	#TODO
	desc = flavor_kpp.17.desc
	is_triggered_only = yes
	#We need a Kappa-Tengu alliance
	option = {
		name = flavor_kpp.17.a
		trigger = {
			exists = TGU
		}
		custom_tooltip = flavor_kpp.17.a.tt
		hidden_effect = {
			TGU = {
				country_event = {
					id = flavor_kpp.18
				}
			}
		}

		ai_chance = {
			factor = 1
		}
	}

	#We are good on our own
	option = {
		name = flavor_kpp.17.b
		add_dip_power = 100

		ai_chance = {
			factor = 1
		}
	}
}

# Kappapolis wants to become our ally (Tengu)
country_event = {
	id = flavor_kpp.18
	title = flavor_kpp.18.t
	picture = NITORIBOSS_eventPicture	#TODO
	desc = flavor_kpp.18.desc
	is_triggered_only = yes
	major = yes
	major_trigger = {
		tag = KPP
	}

	#Accept their request
	option = {
		name = flavor_kpp.18.a
		if = {
			limit = { is_rival = FROM }
			remove_rival = FROM
		}
		if = {
			limit = { is_enemy = FROM }
			FROM = { remove_rival = ROOT }
		}
		create_alliance = FROM
		add_trust = {
			who = FROM
			value = 25
			mutual = yes
		}
		if = {
			limit = {
				ai = yes
			}
			set_ai_attitude = {
				attitude = attitude_allied
				who = FROM
			}
		}

		ai_chance = {
			factor = 1
		}
	}

	#No lol
	option = {
		name = flavor_kpp.18.b
		reverse_add_casus_belli = {
			type = cb_insult
			target = FROM
			months = 60
		}
		reverse_add_opinion = {
			who = FROM
			modifier = th_kpp_refused_alliance
		}

		ai_chance = {
			factor = 0
		}
	}
}

# Kappa Shredder
country_event = {
	id = flavor_kpp.19
	title = flavor_kpp.19.t
	picture = NITORIBOSS_eventPicture	#TODO
	desc = flavor_kpp.19.desc
	is_triggered_only = yes

	#Astounding
	option = {
		name = flavor_kpp.19.a
		change_innovativeness = 1
		add_republican_tradition = 5
		kpp_unlock_gadget = {
			gadget = kappa_shredder
		}
		kpp_apply_gadget = {
			gadget = kappa_shredder
			duration = 7300
		}

		ai_chance = {
			factor = 1
		}
	}
}

#Random Innovativeness events

# Nitori gadget
country_event = {
	id = flavor_kpp.20
	title = flavor_kpp.20.t
	picture = NITORIBOSS_eventPicture	#TODO
	desc = flavor_kpp.20.desc
	is_triggered_only = yes
	trigger = {
		has_dlc = "Rule Britannia"
		has_government_attribute = th_passive_innovativeness
		NOT = { has_country_modifier = th_nitori_gadgets_modifier }
	}
	mean_time_to_happen = {
		days = 1
	}

	#
	option = {
		name = flavor_kpp.20.a
		change_innovativeness = 2
		add_country_modifier = {
			name = th_nitori_gadgets_modifier
			duration = 1825
		}

		ai_chance = {
			factor = 1
		}
	}
}

# Takane gadget
country_event = {
	id = flavor_kpp.21
	title = flavor_kpp.21.t
	picture = NITORIBOSS_eventPicture	#TODO
	desc = flavor_kpp.21.desc
	is_triggered_only = yes
	trigger = {
		has_dlc = "Rule Britannia"
		has_government_attribute = th_passive_innovativeness
		NOT = { has_country_modifier = th_takane_production_modifier }
	}
	mean_time_to_happen = {
		days = 1
	}

	#
	option = {
		name = flavor_kpp.21.a
		change_innovativeness = 2
		add_country_modifier = {
			name = th_takane_production_modifier
			duration = 1825
		}

		ai_chance = {
			factor = 1
		}
	}
}

# Yumemi's scientific breakthrough
country_event = {
	id = flavor_kpp.22
	title = flavor_kpp.22.t
	picture = NITORIBOSS_eventPicture	#TODO
	desc = flavor_kpp.22.desc
	is_triggered_only = yes
	trigger = {
		has_dlc = "Rule Britannia"
		has_government_attribute = th_passive_innovativeness
		NOT = { has_country_modifier = th_yumemi_robots_modifier }
	}
	mean_time_to_happen = {
		days = 1
	}

	#
	option = {
		name = flavor_kpp.22.a
		change_innovativeness = 2
		add_country_modifier = {
			name = th_yumemi_robots_modifier
			duration = 1825
		}

		ai_chance = {
			factor = 1
		}
	}
}

# Rika tank development
country_event = {
	id = flavor_kpp.23
	title = flavor_kpp.23.t
	picture = NITORIBOSS_eventPicture	#TODO
	desc = flavor_kpp.23.desc
	is_triggered_only = yes
	trigger = {
		has_dlc = "Rule Britannia"
		has_government_attribute = th_passive_innovativeness
		NOT = { has_country_modifier = th_rika_tanks_modifier }
	}
	mean_time_to_happen = {
		days = 1
	}

	#
	option = {
		name = flavor_kpp.23.a
		change_innovativeness = 2
		add_country_modifier = {
			name = th_rika_tanks_modifier
			duration = 1825
		}

		ai_chance = {
			factor = 1
		}
	}
}

#Trade Post events
# Trade Post at the English Channel
country_event = {
	id = flavor_kpp.24
	title = flavor_kpp.24.t
	picture = NITORIBOSS_eventPicture	#TODO
	desc = flavor_kpp.24.desc
	is_triggered_only = yes
	immediate = {
		hidden_effect = {
            export_to_variable = {
                which = th_money_to_give
                value = monthly_income
                who = ROOT
            }
            multiply_variable = {
                which = th_money_to_give
                value = 12
            }
			th_designate_provinces_for_purchase = {
				purchasable_province_1 = 1931
				purchasable_province_2 = 96
				purchasable_province_3 = 1860
				purchasable_province_4 = 167
				purchasable_province_5 = 89
				trigger = "owner = { has_opinion = { who = ROOT value = 50 } }"
			}
		}
	}

	#Purchase purchasable_province_1
	option = {
		name = flavor_kpp.24.a
		trigger = { has_saved_event_target = purchasable_province_1 }
		goto = purchasable_province_1
		event_target:purchasable_province_1 = {
			set_province_flag = kpp_special_province_to_buy
			owner = {
				country_event = {
					id = flavor_kpp.25
				}
			}
		}
		custom_tooltip = flavor_kpp.24.tt
		ai_chance = {
			factor = 1
		}
	}

	#Purchase purchasable_province_2
	option = {
		name = flavor_kpp.24.b
		trigger = { has_saved_event_target = purchasable_province_2 }
		goto = purchasable_province_2
		event_target:purchasable_province_2 = {
			set_province_flag = kpp_special_province_to_buy
			owner = {
				country_event = {
					id = flavor_kpp.25
				}
			}
		}
		custom_tooltip = flavor_kpp.24.tt
		ai_chance = {
			factor = 1
		}
	}

	#Purchase purchasable_province_3
	option = {
		name = flavor_kpp.24.c
		trigger = { has_saved_event_target = purchasable_province_3 }
		goto = purchasable_province_3
		event_target:purchasable_province_3 = {
			set_province_flag = kpp_special_province_to_buy
			owner = {
				country_event = {
					id = flavor_kpp.25
				}
			}
		}
		custom_tooltip = flavor_kpp.24.tt
		ai_chance = {
			factor = 1
		}
	}

	#Purchase purchasable_province_4
	option = {
		name = flavor_kpp.24.d
		trigger = { has_saved_event_target = purchasable_province_4 }
		goto = purchasable_province_4
		event_target:purchasable_province_4 = {
			set_province_flag = kpp_special_province_to_buy
			owner = {
				country_event = {
					id = flavor_kpp.25
				}
			}
		}
		custom_tooltip = flavor_kpp.24.tt
		ai_chance = {
			factor = 1
		}
	}

	#Purchase purchasable_province_5
	option = {
		name = flavor_kpp.24.e
		trigger = { has_saved_event_target = purchasable_province_5 }
		goto = purchasable_province_5
		event_target:purchasable_province_5 = {
			set_province_flag = kpp_special_province_to_buy
			owner = {
				country_event = {
					id = flavor_kpp.25
				}
			}
		}
		custom_tooltip = flavor_kpp.24.tt
		ai_chance = {
			factor = 1
		}
	}

	#Purchase none
	option = {
		name = flavor_kpp.24.f
		trigger = {
			OR = {
				has_saved_event_target = purchasable_province_1
				has_saved_event_target = purchasable_province_2
				has_saved_event_target = purchasable_province_3
				has_saved_event_target = purchasable_province_4
				has_saved_event_target = purchasable_province_5
			}
		}
		add_mercantilism = 5

		ai_chance = {
			factor = 1
		}
	}

	#Fallback
	option = {
		name = flavor_kpp.24.g
		trigger = {
			NOT = { has_saved_event_target = purchasable_province_1 }
			NOT = { has_saved_event_target = purchasable_province_2 }
			NOT = { has_saved_event_target = purchasable_province_3 }
			NOT = { has_saved_event_target = purchasable_province_4 }
			NOT = { has_saved_event_target = purchasable_province_5 }
		}
		add_mercantilism = 5

		ai_chance = {
			factor = 1
		}
	}
}

#Kappas want to buy a trade post
country_event = {
	id = flavor_kpp.25
	title = flavor_kpp.25.t
	picture = NITORIBOSS_eventPicture	#TODO
	desc = flavor_kpp.25.desc
	is_triggered_only = yes
	immediate = {
		hidden_effect = {
			random_owned_province = {
				limit = {
					has_province_flag = kpp_special_province_to_buy
				}
				clr_province_flag = kpp_special_province_to_buy
				save_event_target_as = kpp_purchase_province
			}
            export_to_variable = {
                which = th_money_to_gain
                value = monthly_income
                who = FROM
            }
            multiply_variable = {
                which = th_money_to_gain
                value = 12
            }
		}
	}

	#Deal
	option = {
		name = flavor_kpp.25.a
		goto = kpp_purchase_province
		event_target:kpp_purchase_province = {
			cede_province = FROM
			add_core = FROM
			add_to_trade_company = FROM
			if = {
				limit = { is_core = ROOT }
				remove_core = ROOT
			}
		}
		custom_tooltip = flavor_kpp.25.a.tt
		FROM = {
			country_event = {
				id = flavor_kpp.26
			}
		}
	}

	#No Deal
	option = {
		name = flavor_kpp.25.b
		FROM = {
			country_event = {
				id = flavor_kpp.27
			}
		}
		ai_chance = {
			factor = 0
		}
	}
}

#Trade Post Charter - ROOT - Has deal
country_event = {
    id = flavor_kpp.26
    title = flavor_kpp.26.t
    desc = flavor_kpp.26.desc
    picture = RINNOSUKE_eventPicture
    is_triggered_only = yes
    immediate = {
        hidden_effect = {
            export_to_variable = {
                which = th_money_to_transfer
                value = monthly_income
                who = ROOT
            }
            multiply_variable = {
                which = th_money_to_transfer
                value = 12
            }
        }
    }

    #Accept the deal
    option = {
        name = flavor_kpp.26.a
        custom_tooltip = flavor_kpp.26.a.tt
        th_transfer_treasury = {
            giver = ROOT
            taker = FROM
            variable = th_money_to_transfer
        }
        
        ai_chance = {
            factor = 100
        }
    }
}

#Trade Post Charter - ROOT - No deal
country_event = {
    id = flavor_kpp.27
    title = flavor_kpp.27.t
    desc = flavor_kpp.27.desc
    picture = RINNOSUKE_eventPicture
    is_triggered_only = yes

    #Accept the deal
    option = {
        name = flavor_kpp.27.a
		add_mercantilism = 5
        
        ai_chance = {
            factor = 100
        }
    }
}

# Trade Post at the Mediterranean Sea
country_event = {
	id = flavor_kpp.28
	title = flavor_kpp.28.t
	picture = NITORIBOSS_eventPicture	#TODO
	desc = flavor_kpp.28.desc
	is_triggered_only = yes
	immediate = {
		hidden_effect = {
            export_to_variable = {
                which = th_money_to_give
                value = monthly_income
                who = ROOT
            }
            multiply_variable = {
                which = th_money_to_give
                value = 12
            }
			th_designate_provinces_for_purchase = {
				purchasable_province_1 = 1247
				purchasable_province_2 = 126
				purchasable_province_3 = 163
				purchasable_province_4 = 321
				purchasable_province_5 = 333
				trigger = "owner = { has_opinion = { who = ROOT value = 50 } }"
			}
		}
	}

	#Purchase purchasable_province_1
	option = {
		name = flavor_kpp.24.a
		trigger = { has_saved_event_target = purchasable_province_1 }
		goto = purchasable_province_1
		event_target:purchasable_province_1 = {
			set_province_flag = kpp_special_province_to_buy
			owner = {
				country_event = {
					id = flavor_kpp.25
				}
			}
		}
		custom_tooltip = flavor_kpp.24.tt
		ai_chance = {
			factor = 1
		}
	}

	#Purchase purchasable_province_2
	option = {
		name = flavor_kpp.24.b
		trigger = { has_saved_event_target = purchasable_province_2 }
		goto = purchasable_province_2
		event_target:purchasable_province_2 = {
			set_province_flag = kpp_special_province_to_buy
			owner = {
				country_event = {
					id = flavor_kpp.25
				}
			}
		}
		custom_tooltip = flavor_kpp.24.tt
		ai_chance = {
			factor = 1
		}
	}

	#Purchase purchasable_province_3
	option = {
		name = flavor_kpp.24.c
		trigger = { has_saved_event_target = purchasable_province_3 }
		goto = purchasable_province_3
		event_target:purchasable_province_3 = {
			set_province_flag = kpp_special_province_to_buy
			owner = {
				country_event = {
					id = flavor_kpp.25
				}
			}
		}
		custom_tooltip = flavor_kpp.24.tt
		ai_chance = {
			factor = 1
		}
	}

	#Purchase purchasable_province_4
	option = {
		name = flavor_kpp.24.d
		trigger = { has_saved_event_target = purchasable_province_4 }
		goto = purchasable_province_4
		event_target:purchasable_province_4 = {
			set_province_flag = kpp_special_province_to_buy
			owner = {
				country_event = {
					id = flavor_kpp.25
				}
			}
		}
		custom_tooltip = flavor_kpp.24.tt
		ai_chance = {
			factor = 1
		}
	}

	#Purchase purchasable_province_5
	option = {
		name = flavor_kpp.24.e
		trigger = { has_saved_event_target = purchasable_province_5 }
		goto = purchasable_province_5
		event_target:purchasable_province_5 = {
			set_province_flag = kpp_special_province_to_buy
			owner = {
				country_event = {
					id = flavor_kpp.25
				}
			}
		}
		custom_tooltip = flavor_kpp.24.tt
		ai_chance = {
			factor = 1
		}
	}

	#Purchase none
	option = {
		name = flavor_kpp.24.f
		trigger = {
			OR = {
				has_saved_event_target = purchasable_province_1
				has_saved_event_target = purchasable_province_2
				has_saved_event_target = purchasable_province_3
				has_saved_event_target = purchasable_province_4
				has_saved_event_target = purchasable_province_5
			}
		}
		add_mercantilism = 5

		ai_chance = {
			factor = 1
		}
	}

	#Fallback
	option = {
		name = flavor_kpp.24.g
		trigger = {
			NOT = { has_saved_event_target = purchasable_province_1 }
			NOT = { has_saved_event_target = purchasable_province_2 }
			NOT = { has_saved_event_target = purchasable_province_3 }
			NOT = { has_saved_event_target = purchasable_province_4 }
			NOT = { has_saved_event_target = purchasable_province_5 }
		}
		add_mercantilism = 5

		ai_chance = {
			factor = 1
		}
	}
}

#The great Trade Empire of Kappapolis
country_event = {
	id = flavor_kpp.29
	title = flavor_kpp.29.t
	picture = NITORIBOSS_eventPicture	#TODO
	desc = flavor_kpp.29.desc
	is_triggered_only = yes

	option = {
		name = flavor_kpp.29.a
		if = {
			limit = { NOT = { government_rank = 3 } }
			set_government_rank = 3
		}
		add_power_projection = {
			type = mission_rewards_power_projection
			amount = 50
		}
		th_enable_purchase_war_support_diplo_action = yes
		th_enable_purchase_truce_diplo_action = yes
	}
}

#Kappa Rebellions on elections / new rulers
# Kappa Rebellion
country_event = {
	id = flavor_kpp.30
	title = flavor_kpp.30.t
	picture = NITORIBOSS_eventPicture	#TODO
	desc = flavor_kpp.30.desc
	is_triggered_only = yes
	trigger = {
		has_government_attribute = th_has_kappa_rebels
		NOT = { has_ruler_modifier = th_elected_kappa_tinker }
		NOT = { has_country_modifier = kpp_overcame_counter_movement_disaster }
		ai = no	#Too dificult for the AI too handle probably
	}
	goto = th_kappa_rebellion_province
	immediate = {
		hidden_effect = {
			random_owned_province = {
				limit = {
					is_overseas = no
					same_continent = ROOT
				}
				save_event_target_as = th_kappa_rebellion_province
			}
		}
	}

	#Cursed
	option = {
		name = flavor_kpp.30.a
		event_target:th_kappa_rebellion_province = {
			tooltip = {
				spawn_rebels = {
					size = 1
					type = th_kappa_rebels
				}
			}
			hidden_effect = {
				random_list = {
					1 = {
						spawn_rebels = {
							size = 1
							type = th_kappa_rebels
						}
					}
					1 = {
						spawn_rebels = {
							size = 1
							type = th_kappa_rebels
							female = yes
						}
					}
				}
			}
		}

		ai_chance = {
			factor = 1
		}
	}
}

#Join Kappa Trade Federation
# Buy the duchies of the Moluccas and Indonesia
country_event = {
	id = flavor_kpp.31
	title = flavor_kpp.31.t
	picture = NITORIBOSS_eventPicture	#TODO
	desc = flavor_kpp.31.desc
	is_triggered_only = yes
	immediate = {
		hidden_effect = {
			set_variable = {
				which = kpp_moluccas_tags
				value = 0
			}
			moluccas_region = {
				limit = {
					is_capital = yes
					owner = {
						ai = yes
						NOT = { tag = ROOT }
						NOT = { is_subject_of = ROOT }
					}
				}
				ROOT = {
					change_variable = {
						which = kpp_moluccas_tags
						value = 0.5
					}
				}
			}
			indonesia_region = {
				limit = {
					is_capital = yes
					owner = {
						ai = yes
						NOT = { tag = ROOT }
						NOT = { is_subject_of = ROOT }
					}
				}
				ROOT = {
					change_variable = {
						which = kpp_moluccas_tags
						value = 0.5
					}
				}
			}
			export_to_variable = {
				value = years_of_income
				which = kpp_money_to_spend_for_tags
			}
			multiply_variable = {
				which = kpp_money_to_spend_for_tags
				which = kpp_moluccas_tags
			}
		}
	}
	#Purchase the duchies
	option = {
		name = flavor_kpp.31.a
		trigger = {
			OR = {
				moluccas_region = {
					is_capital = yes
					owner = {
						ai = yes
						NOT = { tag = ROOT }
						NOT = { is_subject_of = ROOT }
					}
				}
				indonesia_region = {
					is_capital = yes
					owner = {
						ai = yes
						NOT = { tag = ROOT }
						NOT = { is_subject_of = ROOT }
					}
				}
			}
		}
		custom_tooltip = flavor_kpp.31.a.tt
		th_delete_treasury = {
			giver = ROOT
			variable = kpp_money_to_spend_for_tags
		}
		hidden_effect = {
			moluccas_region = {
				limit = {
					is_capital = yes
					owner = {
						ai = yes
						NOT = { tag = ROOT }
						NOT = { is_subject_of = ROOT }
					}
				}
				owner = {
					country_event = {
						id = flavor_kpp.32
					}
				}
			}
			indonesia_region = {
				limit = {
					is_capital = yes
					owner = {
						ai = yes
						NOT = { tag = ROOT }
						NOT = { is_subject_of = ROOT }
					}
				}
				owner = {
					country_event = {
						id = flavor_kpp.32
					}
				}
			}
		}
	}
	#Maybe later.
	option = {
		name = flavor_kpp.31.b
		trigger = {
			OR = {
				moluccas_region = {
					is_capital = yes
					owner = {
						ai = yes
						NOT = { tag = ROOT }
						NOT = { is_subject_of = ROOT }
					}
				}
				indonesia_region = {
					is_capital = yes
					owner = {
						ai = yes
						NOT = { tag = ROOT }
						NOT = { is_subject_of = ROOT }
					}
				}
			}
		}
		custom_tooltip = flavor_kpp.31.b.tt
		set_country_flag = kpp_delayed_moluccas_purchase
	}
	#No, thanks.
	option = {
		name = flavor_kpp.31.c
		trigger = {
			OR = {
				moluccas_region = {
					is_capital = yes
					owner = {
						ai = yes
						NOT = { tag = ROOT }
						NOT = { is_subject_of = ROOT }
					}
				}
				indonesia_region = {
					is_capital = yes
					owner = {
						ai = yes
						NOT = { tag = ROOT }
						NOT = { is_subject_of = ROOT }
					}
				}
			}
		}
		add_mercantilism = 3
		add_dip_power = 50
	}
	#But there is nothing.
	option = {
		name = flavor_kpp.31.d
		trigger = {
			NOT = {
				OR = {
					moluccas_region = {
						is_capital = yes
						owner = {
							ai = yes
							NOT = { tag = ROOT }
							NOT = { is_subject_of = ROOT }
						}
					}
					indonesia_region = {
						is_capital = yes
						owner = {
							ai = yes
							NOT = { tag = ROOT }
							NOT = { is_subject_of = ROOT }
						}
					}
				}
			}
		}
		add_adm_power = 100
		add_mil_power = 100
	}
}
# KPP buys us
country_event = {
	id = flavor_kpp.32
	title = flavor_kpp.32.t
	picture = NITORIBOSS_eventPicture	#TODO
	desc = flavor_kpp.32.desc
	is_triggered_only = yes
	major = yes
	major_trigger = {
		tag = KPP
	}
	#We shall join KPP
	option = {
		name = flavor_kpp.32.a
		trigger = {
			ai = yes
		}
		every_owned_province = {
			cede_province = FROM
			add_core = FROM
			add_local_autonomy = -50
		}
		ai_chance = {
			factor = 1
			modifier = {
				factor = 0
				num_of_cities = 6
			}
		}
	}
	#We take the money. Now get off my lawn
	option = {
		name = flavor_kpp.32.b
		add_treasury = 200
		ai_chance = {
			factor = 1
			modifier = {
				factor = 0
				NOT = { num_of_cities = 6 }
			}
		}
	}
}

# Buy Singapur
country_event = {
	id = flavor_kpp.33
	title = flavor_kpp.33.t
	picture = NITORIBOSS_eventPicture	#TODO
	desc = flavor_kpp.33.desc
	is_triggered_only = yes
	immediate = {
		hidden_effect = {
            export_to_variable = {
                which = th_money_to_give
                value = monthly_income
                who = ROOT
            }
            multiply_variable = {
                which = th_money_to_give
                value = 12
            }
			th_designate_provinces_for_purchase = {
				purchasable_province_1 = 4815
				trigger = ""
			}
		}
	}

	#Purchase purchasable_province_1
	option = {
		name = flavor_kpp.33.a
		trigger = { has_saved_event_target = purchasable_province_1 }
		goto = purchasable_province_1
		event_target:purchasable_province_1 = {
			set_province_flag = kpp_special_province_to_buy
			owner = {
				country_event = {
					id = flavor_kpp.25
				}
			}
		}
		custom_tooltip = flavor_kpp.24.tt
		ai_chance = {
			factor = 1
		}
	}

	#Purchase none
	option = {
		name = flavor_kpp.33.b
		trigger = {
			has_saved_event_target = purchasable_province_1
		}
		add_mercantilism = 5

		ai_chance = {
			factor = 1
		}
	}

	#Fallback
	option = {
		name = flavor_kpp.33.c
		trigger = {
			NOT = { has_saved_event_target = purchasable_province_1 }
		}
		add_mercantilism = 5

		ai_chance = {
			factor = 1
		}
	}
}

# Spice Fuel Engine
country_event = {
	id = flavor_kpp.34
	title = flavor_kpp.34.t
	picture = NITORIBOSS_eventPicture	#TODO
	desc = flavor_kpp.34.desc
	is_triggered_only = yes

	#Astounding!
	option = {
		name = flavor_kpp.34.a
		change_innovativeness = 1
		add_republican_tradition = 5
		kpp_unlock_gadget = {
			gadget = spice_fuel_engine
		}
		kpp_apply_gadget = {
			gadget = spice_fuel_engine
			duration = 7300
		}

		ai_chance = {
			factor = 1
		}
	}
}

# Super Scope 3D
country_event = {
	id = flavor_kpp.35
	title = flavor_kpp.35.t
	picture = NITORIBOSS_eventPicture	#TODO
	desc = flavor_kpp.35.desc
	is_triggered_only = yes

	#Astounding!
	option = {
		name = flavor_kpp.35.a
		change_innovativeness = 1
		add_republican_tradition = 5
		kpp_unlock_gadget = {
			gadget = super_scope_3D
		}
		kpp_apply_gadget = {
			gadget = super_scope_3D
			duration = 7300
		}

		ai_chance = {
			factor = 1
		}
	}
}

# Bookkeep-Inator
country_event = {
	id = flavor_kpp.36
	title = flavor_kpp.36.t
	picture = NITORIBOSS_eventPicture	#TODO
	desc = flavor_kpp.36.desc
	is_triggered_only = yes

	#Astounding
	option = {
		name = flavor_kpp.36.a
		change_innovativeness = 1
		add_republican_tradition = 5
		kpp_unlock_gadget = {
			gadget = bookkeep_inator
		}
		kpp_apply_gadget = {
			gadget = bookkeep_inator
			duration = 7300
		}

		ai_chance = {
			factor = 1
		}
	}
}

#Kappa Anti-Centralization events

# Start of the Reforms
country_event = {
	id = flavor_kpp.40
	title = flavor_kpp.40.t
	picture = NITORIBOSS_eventPicture	#TODO
	desc = flavor_kpp.40.desc
	is_triggered_only = yes

	#The reforms need to be done. Better be it quick and painful than too slow.
	option = {
		name = flavor_kpp.40.a
		custom_tooltip = flavor_kpp.40.a.tt
		set_country_flag = kpp_unlock_kappa_counter_movement_disaster_decision
		change_government_reform_progress = 100
		
		ai_chance = {
			factor = 0
		}
	}
}

#Special Election - Elect Nitori into office
country_event = {
	id = flavor_kpp.56
	title = flavor_kpp.56.t
	desc = flavor_kpp.56.desc
	picture = NITORIBOSS_eventPicture	#TODO
	trigger = {
	}	
	is_triggered_only = yes
	mean_time_to_happen = {
		days = 1
	}	
	option = {
		name = flavor_kpp.56.a
		define_ruler = {
			name = "Nitori"
			dynasty = "Kawashiro"
			age = 20
			adm = 6
			dip = 6
			mil = 6
			female = yes
		}
		hidden_effect = {
			add_ruler_personality = immortal_personality
			set_ruler_flag = touhou_character_ruler
			set_ruler_flag = touhou_original_ruler
			set_variable = {
				which = election_term
				value = 1
			}
		}
		add_ruler_modifier = {
			name = th_elected_kappa_tinker
			duration = -1
		}
		ai_chance = { factor = 10 }
	}
}

# First Major Reform
country_event = {
	id = flavor_kpp.57
	title = flavor_kpp.57.t
	picture = NITORIBOSS_eventPicture	#TODO
	desc = flavor_kpp.57.desc
	is_triggered_only = yes

	#If you are not for the reforms then you are an enemy of the state!
	option = {
		name = flavor_kpp.57.a
		add_country_modifier = {
			name = kpp_first_major_reform
			duration = -1
		}
		hidden_effect = {
			change_variable = {
				which = max_election_term
				value = 1
			}
		}
		
		ai_chance = {
			factor = 1
		}
	}
}

# Second Major Reform
country_event = {
	id = flavor_kpp.58
	title = flavor_kpp.58.t
	picture = NITORIBOSS_eventPicture	#TODO
	desc = flavor_kpp.58.desc
	is_triggered_only = yes

	#If you are not for the reforms then you are an enemy of the state!
	option = {
		name = flavor_kpp.58.a
		custom_tooltip = flavor_kpp.58.a.tt
		add_country_modifier = {
			name = kpp_second_major_reform
			duration = -1
		}
		add_country_modifier = {
			name = kpp_overcame_anti_teamwork_disaster
			duration = -1
		}
		custom_tooltip = flavor_kpp.58.a.ct
		hidden_effect = {
			set_country_flag = kpp_unlock_kappa_guild_wars_disaster_decision
			change_variable = {
				which = max_election_term
				value = 1
			}
		}
		
		ai_chance = {
			factor = 1
		}
	}
}

# Third Major Reform
country_event = {
	id = flavor_kpp.59
	title = flavor_kpp.59.t
	picture = NITORIBOSS_eventPicture	#TODO
	desc = flavor_kpp.59.desc
	is_triggered_only = yes

	#If you are not for the reforms then you are an enemy of the state!
	option = {
		name = flavor_kpp.59.a
		add_country_modifier = {
			name = kpp_third_major_reform
			duration = -1
		}
		hidden_effect = {
			set_country_flag = kpp_unlock_kappa_guild_wars_disaster_decision
			change_variable = {
				which = max_election_term
				value = 1
			}
		}
		
		ai_chance = {
			factor = 1
		}
	}
}

#Absolute Tinker Republic events
# Establishment of the United Tinker Republic
country_event = {
	id = flavor_kpp.60
	title = flavor_kpp.60.t
	picture = NITORIBOSS_eventPicture	#TODO
	desc = flavor_kpp.60.desc
	is_triggered_only = yes

	#If you are not for the reforms then you are an enemy of the state!
	option = {
		name = flavor_kpp.60.a
		remove_country_modifier = th_elected_kappa_tinker
		add_government_reform = Gensokyan_kpp_united_kappa_republic
		add_republican_tradition = 100
		
		ai_chance = {
			factor = 1
		}
	}
}

# Tinker Contest!
country_event = {
	id = flavor_kpp.61
	title = flavor_kpp.61.t
	picture = NITORIBOSS_eventPicture	#TODO
	desc = flavor_kpp.61.desc
	
	is_triggered_only = yes
	
	trigger = {
		has_government_attribute = th_has_tinker_contests
	}
	immediate = {
		hidden_effect = {
			remove_country_modifier = th_administrative_tinker
			remove_country_modifier = th_diplomatic_tinker
			remove_country_modifier = th_military_tinker
			remove_country_modifier = th_allrounder_tinker
		}
	}

	option = {	#Choose the administrative tinker
		name = flavor_kpp.61.a
		add_ruler_modifier = {
			name = th_administrative_tinker
			duration = -1
		}
		add_scaled_republican_tradition = -15
		add_adm_power = 60
		change_innovativeness = 1
		ai_chance = { 
			factor = 1
		}
	}

	option = {	#Choose the diplomatic tinker
		name = flavor_kpp.61.b
		add_ruler_modifier = {
			name = th_diplomatic_tinker
			duration = -1
		}
		add_scaled_republican_tradition = -15
		add_dip_power = 60
		change_innovativeness = 1
		ai_chance = { 
			factor = 1
		}
	}

	option = {	#Choose the military tinker
		name = flavor_kpp.61.c
		add_ruler_modifier = {
			name = th_military_tinker
			duration = -1
		}
		add_scaled_republican_tradition = -15
		add_mil_power = 60
		change_innovativeness = 1
		ai_chance = { 
			factor = 1
		}
	}

	option = {	#Choose the allrounder tinker
		name = flavor_kpp.61.d
		add_ruler_modifier = {
			name = th_allrounder_tinker
			duration = -1
		}
		add_scaled_republican_tradition = -15
		add_adm_power = 20
		add_dip_power = 20
		add_mil_power = 20
		change_innovativeness = 1
		ai_chance = { 
			factor = 1
		}
	}

	option = {	#Let the public decide
		name = flavor_kpp.61.e
		random_list = {
			1 = {
				add_ruler_modifier = {
					name = th_administrative_tinker
					duration = -1
				}
				add_adm_power = 60
			}
			1 = {
				add_ruler_modifier = {
					name = th_diplomatic_tinker
					duration = -1
				}
				add_dip_power = 60
			}
			1 = {
				add_ruler_modifier = {
					name = th_military_tinker
					duration = -1
				}
				add_mil_power = 60
			}
			1 = {
				add_ruler_modifier = {
					name = th_allrounder_tinker
					duration = -1
				}
				add_adm_power = 20
				add_dip_power = 20
				add_mil_power = 20
			}
		}
		change_innovativeness = 1
		ai_chance = { 
			factor = 1
		}
	}

	option = {	#Participate yourself in it
		name = flavor_kpp.61.f
		add_scaled_republican_tradition = 5
		add_adm_power = 33
		add_dip_power = 33
		add_mil_power = 33
		change_innovativeness = 5
		ai_chance = { 
			factor = 1
		}
	}
}

# Election! - Death
country_event = {
	id = flavor_kpp.62
	title = flavor_kpp.62.t
	desc = flavor_kpp.62.desc
	picture = NITORIBOSS_eventPicture	#TODO
	
	is_triggered_only = yes
	
	trigger = {
		has_government_attribute = th_has_tinker_elections_on_ruler_death
	}
	
	#Elect Nitori
	option = {
		name = flavor_kpp.62.a
		ai_chance = { factor = 40 }
		define_ruler = {
			name = "Nitori"
			dynasty = "Kawashiro"
			age = 20
			adm = 6
			dip = 6
			mil = 6
			female = yes
		}
		hidden_effect = {
			add_ruler_personality = immortal_personality
			set_ruler_flag = touhou_character_ruler
			set_ruler_flag = touhou_original_ruler
			set_variable = {
				which = election_term
				value = 1
			}
		}
	}
}