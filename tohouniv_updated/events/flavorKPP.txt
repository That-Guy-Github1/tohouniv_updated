########################################
# Flavor Events for Kappapolis
########################################	

namespace = flavor_kpp

# Election!
country_event = {
	id = flavor_kpp.1
	title = "EVTNAME700"
	picture = ELECTION_REPUBLICAN_eventPicture
	
	desc = {
		trigger = {
			NOT = { has_ruler_flag = leader_has_been_pushed_out }
			NOT = { has_country_flag = caretaker_revolutionary_government }
		}
		desc = EVTDESC700
	}
	
	desc = {
		trigger = { has_ruler_flag = leader_has_been_pushed_out }
		desc = elections.700.d
	}
	desc = {
		trigger = { has_country_flag = caretaker_revolutionary_government }
		desc = elections.700.caretaker
	}
	
	is_triggered_only = yes
	
	trigger = {
		has_government_attribute = th_has_kappa_elections
	}

	option = {
		name = "EVTOPTA700"	# Current ruler stays
		trigger = {
			has_regency = no
			NOT = { has_ruler_flag = leader_has_been_pushed_out }
		}
		ai_chance = { 
			factor = 60
			modifier = {
				factor = 0
				NOT = { republican_tradition = 25 }
			}	
			modifier = {
				factor = 0.5
				NOT = { republican_tradition = 50 }
			}				
			modifier = {
				factor = 0.5
				NOT = { republican_tradition = 75 }
			}	
			modifier = {
				factor = 2.0
				republican_tradition = 90
			}		
		}
		custom_tooltip = remains_ruler
		change_adm = 1
		change_dip = 1
		change_mil = 1
		if = {
			limit = {
				is_tribal = no 
				government = republic
				NOT = { republican_tradition = 20 }				
				NOT = { is_revolutionary_republic_trigger = yes }
				has_dlc = "Res Publica"
			}
			add_government_reform = presidential_despot_reform	
		}
		else_if = {
			limit = {
				government = republic
				NOT = { republican_tradition = 20 }	
				is_revolutionary_republic_trigger = yes
			}
			change_government_to_monarchy = yes
			add_government_reform = revolutionary_empire_reform
		}
		if = {
			limit = {
				is_tribal = no  
				government = republic
				NOT = { republican_tradition = 20 }
				NOT = { has_dlc = "Res Publica" }
			}
			change_government_to_monarchy = yes
			#set_legacy_government = despotic_monarchy
		}
		if = {
			limit = {
				has_country_flag = strengthened_signoria_flag
			}
			custom_tooltip = strengthened_signoria_election_tt
			clr_country_flag = strengthened_signoria_flag
		}
		else = {
			add_scaled_republican_tradition = -10
		}
		random_list = {
			10 = {
				add_adm_power = 50
			}
			10 = {
				add_dip_power = 50
			}
			10 = {
				add_mil_power = 50
			}
		}
		add_karma = -5
	}
	option = {
		name = "EVTOPTB700"	# An administrator type
		ai_chance = { factor = 20 }
		if = {
			limit = { republic_with_female_rulers_trigger = yes }
			define_ruler = {
				mil = 1
				adm = 4
				dip = 1
				random_gender = yes # Allows random gender for republics
			}
		}
		else = {
			define_ruler = {
				mil = 1
				adm = 4
				dip = 1					
			}
		}
		if = {
			limit = { 
				has_faction = mr_guilds 
			}
			add_faction_influence = {
				faction = mr_guilds
				influence = 20
			}				
		}
		add_karma = 10
	}
	option = {
		name = "EVTOPTC700"	# A diplomat
		ai_chance = { factor = 20 }
		if = {
			limit = { republic_with_female_rulers_trigger = yes }
			define_ruler = {
				dip = 4
				adm = 1
				mil = 1					
				random_gender = yes # Allows random gender for republics
			}
		}
		else = {
			define_ruler = {
				dip = 4
				adm = 1
				mil = 1					
			}
		}
		if = {
			limit = { 
				has_faction = mr_traders 
			}
			add_faction_influence = {
				faction = mr_traders
				influence = 20
			}				
		}
		add_karma = 10		
	}
	option = {
		name = "EVTOPTD700"	# A military man
		ai_chance = { factor = 20 }
		if = {
			limit = { republic_with_female_rulers_trigger = yes }
			define_ruler = {
				mil = 4
				adm = 1
				dip = 1					
				random_gender = yes # Allows random gender for republics
			}
		}
		else = {
			define_ruler = {
				mil = 4
				adm = 1
				dip = 1					
			}
		}
		if = {
			limit = { 
				has_faction = mr_aristocrats 
			}
			add_faction_influence = {
				faction = mr_aristocrats
				influence = 20
			}				
		}
		add_karma = 10
	}

	option = { # Nepotism choice, re-electing within dynasty
		name = "EVTOPTE700"
		trigger = {
			has_government_attribute = enables_nepotism
		}
		ai_chance = { factor = 10 }
		if = {
			limit = {
				has_country_flag = strengthened_signoria_flag
			}
			custom_tooltip = strengthened_signoria_election_tt
			clr_country_flag = strengthened_signoria_flag
		}
		else = {
			add_scaled_republican_tradition = -4
		}
		if = {
			limit = { 
				republic_with_female_rulers_trigger = yes
				NOT = { has_reform = signoria_reform }
			}
			define_ruler = {
				change_mil = -2
				change_adm = -2
				change_dip = -2
				min_age = 30
				max_age = 50
				name = "lastname"
				random_gender = yes # Allows random gender for republics
			}
		}
		else_if = {
			limit = { 
				republic_with_female_rulers_trigger = yes
				has_reform = signoria_reform
			}
			define_ruler = {
				min_age = 30
				max_age = 50
				name = "lastname"
				random_gender = yes # Allows random gender for republics
			}
		}
		else_if = {
			limit = { has_reform = signoria_reform }
			define_ruler = {
				min_age = 30
				max_age = 50
				name = "lastname"
			}
		}
		else = {
			define_ruler = {
				change_mil = -2
				change_adm = -2
				change_dip = -2
				min_age = 30
				max_age = 50
				name = "lastname"
			}
		}
		if = {
			limit = { 
				has_faction = mr_aristocrats 
			}
			add_faction_influence = {
				faction = mr_aristocrats
				influence = 10
			}				
		}
	}
}

# Election! - Death
country_event = {
	id = flavor_kpp.2
	title = "EVTNAME700"
	desc = "EVTDESC701"
	picture = ELECTION_REPUBLICAN_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_government_attribute = th_has_kappa_elections
	}
	
	option = {
		name = "EVTOPTB700"	# An administrator type
		ai_chance = { factor = 40 }
		if = {
			limit = { republic_with_female_rulers_trigger = yes }
			define_ruler = {
				mil = 1
				adm = 4
				dip = 1					
				random_gender = yes # Allows random gender for republics
			}
		}
		else = {
			define_ruler = {
				mil = 1
				adm = 4
				dip = 1					
			}
		}
		if = {
			limit = { 
				has_faction = mr_guilds 
			}
			add_faction_influence = {
				faction = mr_guilds
				influence = 20
			}				
		}
	}
	option = {
		name = "EVTOPTC700"	# A diplomat
		ai_chance = { factor = 30 }
		if = {
			limit = { republic_with_female_rulers_trigger = yes }
			define_ruler = {
				dip = 4
				adm = 1
				mil = 1					
				random_gender = yes # Allows random gender for republics
			}
		}
		else = {
			define_ruler = {
				dip = 4
				adm = 1
				mil = 1					
			}
		}
		if = {
			limit = { 
				has_faction = mr_traders 
			}
			add_faction_influence = {
				faction = mr_traders
				influence = 20
			}				
		}			
	}
	option = {
		name = "EVTOPTD700"	# A military man
		ai_chance = { factor = 30 }
		if = {
			limit = { republic_with_female_rulers_trigger = yes }
			define_ruler = {
				mil = 4
				adm = 1
				dip = 1					
				random_gender = yes # Allows random gender for republics
			}
		}
		else = {
			define_ruler = {
				mil = 4
				adm = 1
				dip = 1					
			}
		}
		if = {
			limit = { 
				has_faction = mr_aristocrats 
			}
			add_faction_influence = {
				faction = mr_aristocrats
				influence = 20
			}				
		}		
	}
	option = { # Nepotism choice, re-electing within dynasty
		name = "EVTOPTE700"
		trigger = {
			has_government_attribute = enables_nepotism
		}
		ai_chance = { factor = 10 }
		if = {
			limit = {
				has_country_flag = strengthened_signoria_flag
			}
			custom_tooltip = strengthened_signoria_election_tt
			clr_country_flag = strengthened_signoria_flag
		}
		else = {
			add_scaled_republican_tradition = -4
		}
		if = {
			limit = { 
				republic_with_female_rulers_trigger = yes
				NOT = { has_reform = signoria_reform }
			}
			define_ruler = {
				change_mil = -2
				change_adm = -2
				change_dip = -2
				min_age = 30
				max_age = 50
				name = "lastname"
				random_gender = yes # Allows random gender for republics
			}
		}
		else_if = {
			limit = { 
				republic_with_female_rulers_trigger = yes
				has_reform = signoria_reform
			}
			define_ruler = {
				min_age = 30
				max_age = 50
				name = "lastname"
				random_gender = yes # Allows random gender for republics
			}
		}
		else_if = {
			limit = { 
				has_reform = signoria_reform
			}
			define_ruler = {
				min_age = 30
				max_age = 50
				name = "lastname"
				random_gender = yes # Allows random gender for republics
			}
		}
		else = {
			define_ruler = {
				change_mil = -2
				change_adm = -2
				change_dip = -2
				min_age = 30
				max_age = 50
				name = "lastname"
			}
		}
		if = {
			limit = { 
				has_faction = mr_aristocrats 
			}
			add_faction_influence = {
				faction = mr_aristocrats
				influence = 10
			}				
		}
	}
}

# The Establishment of the Kappa Corps
country_event = {
	id = flavor_kpp.3
	title = flavor_kpp.3.t
	picture = NITORIBOSS_eventPicture	#TODO
	desc = flavor_kpp.3.desc
	is_triggered_only = yes

	#Welcome to the Corps!
	option = {
		name = flavor_kpp.3.a
		capital_scope = {
			marine_infantry = ROOT
			marine_infantry = ROOT
			marine_infantry = ROOT
			marine_infantry = ROOT
		}
		add_country_modifier = {
			name = kpp_the_kappa_conscription
			duration = -1
		}
		add_army_professionalism = 0.05

		ai_chance = {
			factor = 1
		}
	}
}

# Settlement of Guinea
country_event = {
	id = flavor_kpp.4
	title = flavor_kpp.4.t
	picture = NITORIBOSS_eventPicture	#TODO
	desc = {
		desc = flavor_kpp.4.desc.a
		trigger = {
			guinea_region = {
				is_empty = yes
				has_port = yes
			}
		}
	}
	desc = {
		desc = flavor_kpp.4.desc.b
		trigger = {
			guinea_region = {
				OR = {
					has_port = no
					is_empty = no
				}
				type = all
			}
		}
	}
	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			if = {
				limit = {
					guinea_region = {
						is_empty = yes
						has_port = yes
					}
				}
				random_province = {
					limit = {
						region = guinea_region
						is_empty = yes
						has_port = yes
						NOT = { has_province_flag = kpp_province_target }
					}
					save_event_target_as = kpp_african_province_to_settle_1
					set_province_flag = kpp_province_target
				}
				random_province = {
					limit = {
						region = guinea_region
						is_empty = yes
						has_port = yes
						NOT = { has_province_flag = kpp_province_target }
					}
					save_event_target_as = kpp_african_province_to_settle_2
					set_province_flag = kpp_province_target
				}
				random_province = {
					limit = {
						region = guinea_region
						is_empty = yes
						has_port = yes
						NOT = { has_province_flag = kpp_province_target }
					}
					save_event_target_as = kpp_african_province_to_settle_3
					set_province_flag = kpp_province_target
				}
				random_province = {
					limit = {
						region = guinea_region
						is_empty = yes
						has_port = yes
						NOT = { has_province_flag = kpp_province_target }
					}
					save_event_target_as = kpp_african_province_to_settle_4
					set_province_flag = kpp_province_target
				}
				random_province = {
					limit = {
						region = guinea_region
						is_empty = yes
						has_port = yes
						NOT = { has_province_flag = kpp_province_target }
					}
					save_event_target_as = kpp_african_province_to_settle_5
					set_province_flag = kpp_province_target
				}
			}
		}
	}
	after = {
		every_province = {
			limit = {
				has_province_flag = kpp_province_target
			}
			clr_province_flag = kpp_province_target
		}
	}

	#Colonize province 1
	option = {
		name = flavor_kpp.4.a
		goto = kpp_african_province_to_settle_1
		trigger = {
			has_saved_event_target = kpp_african_province_to_settle_1
		}
		event_target:kpp_african_province_to_settle_1 = {
			th_colonize_province_for_country = {
				who = ROOT
			}
		}

		ai_chance = {
			factor = 1
		}
	}

	#Colonize province 2
	option = {
		name = flavor_kpp.4.b
		goto = kpp_african_province_to_settle_2
		trigger = {
			has_saved_event_target = kpp_african_province_to_settle_2
		}
		event_target:kpp_african_province_to_settle_2 = {
			th_colonize_province_for_country = {
				who = ROOT
			}
		}

		ai_chance = {
			factor = 1
		}
	}

	#Colonize province 3
	option = {
		name = flavor_kpp.4.c
		goto = kpp_african_province_to_settle_3
		trigger = {
			has_saved_event_target = kpp_african_province_to_settle_3
		}
		event_target:kpp_african_province_to_settle_3 = {
			th_colonize_province_for_country = {
				who = ROOT
			}
		}

		ai_chance = {
			factor = 1
		}
	}

	#Colonize province 4
	option = {
		name = flavor_kpp.4.d
		goto = kpp_african_province_to_settle_4
		trigger = {
			has_saved_event_target = kpp_african_province_to_settle_4
		}
		event_target:kpp_african_province_to_settle_4 = {
			th_colonize_province_for_country = {
				who = ROOT
			}
		}

		ai_chance = {
			factor = 1
		}
	}

	#Colonize province 5
	option = {
		name = flavor_kpp.4.e
		goto = kpp_african_province_to_settle_5
		trigger = {
			has_saved_event_target = kpp_african_province_to_settle_5
		}
		event_target:kpp_african_province_to_settle_5 = {
			th_colonize_province_for_country = {
				who = ROOT
			}
		}

		ai_chance = {
			factor = 1
		}
	}

	#Nothing to colonize...
	option = {
		name = flavor_kpp.4.f
		trigger = {
			guinea_region = {
				OR = {
					has_port = no
					is_empty = no
				}
				type = all
			}
		}
		guinea_region = {
			limit = {
				NOT = { is_core = ROOT }
				NOT = { is_permanent_claim = ROOT }
			}
			add_permanent_claim = ROOT
		}

		ai_chance = {
			factor = 1
		}
	}
}

# The Tinker Federation
country_event = {
	id = flavor_kpp.5
	title = flavor_kpp.5.t
	picture = NITORIBOSS_eventPicture	#TODO
	desc = flavor_kpp.5.desc
	is_triggered_only = yes

	#A great day for the engineers, inventors and tinkerers!
	option = {
		name = flavor_kpp.5.a
		add_government_reform = kpp_the_tinkerer_federation
		change_innovativeness = 4
		add_adm_power = 50
		add_dip_power = 50
		add_mil_power = 50

		ai_chance = {
			factor = 1
		}
	}
}

# Ivory in Gensokyo
country_event = {
	id = flavor_kpp.6
	title = flavor_kpp.6.t
	picture = NITORIBOSS_eventPicture	#TODO
	desc = flavor_kpp.6.desc
	is_triggered_only = yes

	#The Youkais will love Ivory
	option = {
		name = flavor_kpp.6.a
		change_price = {
			trade_goods = ivory
			key = KPP_GREAT_IVORY_TRADE
			value = 0.5
			duration = -1
		}
		add_mercantilism = 5

		ai_chance = {
			factor = 1
		}
	}
}

# The Kappa Coffee
country_event = {
	id = flavor_kpp.7
	title = flavor_kpp.7.t
	picture = NITORIBOSS_eventPicture	#TODO
	desc = flavor_kpp.7.desc
	is_triggered_only = yes

	#The Yamas will love the coffee
	option = {
		name = flavor_kpp.7.a
		change_price = {
			trade_goods = coffee
			key = KPP_COFFEE_OF_AFRICA
			value = 0.5
			duration = -1
		}
		add_mercantilism = 5

		ai_chance = {
			factor = 1
		}
	}
}

# Weaponized Australian Wildlife
country_event = {
	id = flavor_kpp.8
	title = flavor_kpp.8.t
	picture = NITORIBOSS_eventPicture	#TODO
	desc = flavor_kpp.8.desc
	is_triggered_only = yes

	#Mount the machine guns on the super spiders!
	option = {
		name = flavor_kpp.8.a
		change_innovativeness = 4
		add_republican_tradition = 10
		kpp_unlock_gadget = {
			gadget = weaponized_wildlife
		}
		kpp_apply_gadget = {
			gadget = weaponized_wildlife
			duration = 7300
		}

		ai_chance = {
			factor = 1
		}
	}
}

# Integration of Yumemi's technology
country_event = {
	id = flavor_kpp.9
	title = flavor_kpp.9.t
	picture = NITORIBOSS_eventPicture	#TODO
	desc = flavor_kpp.9.desc
	is_triggered_only = yes

	#Astounding!
	option = {
		name = flavor_kpp.9.a
		change_innovativeness = 4
		add_republican_tradition = 10
		kpp_unlock_gadget = {
			gadget = aerial_torpedo
		}
		kpp_apply_gadget = {
			gadget = aerial_torpedo
			duration = 7300
		}

		ai_chance = {
			factor = 1
		}
	}
}

# Integration of Rika's technology
country_event = {
	id = flavor_kpp.10
	title = flavor_kpp.10.t
	picture = NITORIBOSS_eventPicture	#TODO
	desc = flavor_kpp.10.desc
	is_triggered_only = yes

	#Astounding!
	option = {
		name = flavor_kpp.10.a
		change_innovativeness = 4
		add_republican_tradition = 10
		kpp_unlock_gadget = {
			gadget = super_scope_3D
		}
		kpp_apply_gadget = {
			gadget = super_scope_3D
			duration = 7300
		}

		ai_chance = {
			factor = 1
		}
	}
}

# Invention of the Kappa Cybernetics
country_event = {
	id = flavor_kpp.11
	title = flavor_kpp.11.t
	picture = NITORIBOSS_eventPicture	#TODO
	desc = flavor_kpp.11.desc
	is_triggered_only = yes

	#Astounding!
	option = {
		name = flavor_kpp.11.a
		change_innovativeness = 4
		add_republican_tradition = 10
		kpp_unlock_gadget = {
			gadget = kappa_cybernetics
		}
		kpp_apply_gadget = {
			gadget = kappa_cybernetics
			duration = 7300
		}

		ai_chance = {
			factor = 1
		}
	}
}

# The technology of the future
country_event = {
	id = flavor_kpp.12
	title = flavor_kpp.12.t
	picture = NITORIBOSS_eventPicture	#TODO
	desc = flavor_kpp.12.desc
	is_triggered_only = yes

	#Astounding!
	option = {
		name = flavor_kpp.12.a
		change_innovativeness = 4
		add_republican_tradition = 10
		kpp_unlock_gadget = {
			gadget = fly_sanpei_fight
		}
		kpp_apply_gadget = {
			gadget = fly_sanpei_fight
			duration = 7300
		}

		ai_chance = {
			factor = 1
		}
	}
}

# Creation of the Hisoutensoku
country_event = {
	id = flavor_kpp.13
	title = flavor_kpp.13.t
	picture = NITORIBOSS_eventPicture	#TODO
	desc = flavor_kpp.13.desc
	is_triggered_only = yes

	#You utter fool! Kappa science is the best in the world!
	option = {
		name = flavor_kpp.13.a
		change_innovativeness = 10
		add_prestige = 50
		kpp_unlock_gadget = {
			gadget = hisoutensoku
		}
		kpp_apply_gadget = {
			gadget = hisoutensoku
			duration = 7300
		}
		th_unlock_mercenary_company = {
			mercenary_company = merc_th_hisoutensoku
		}

		ai_chance = {
			factor = 1
		}
	}
}