kpp_missions_marines_colonization_slot = {
	slot = 1
	generic = no
	ai = yes
	potential = {
		tag = KPP
		NOT = { map_setup = map_setup_random }
	}
	has_country_shield = yes
	
	KPP_diplomacy_with_tengus = {
		icon = mission_touhou_youkai_mountain
		required_missions = {  }
		position = 1
		provinces_to_highlight = {
			owned_by = TGU
		}
		trigger = {
			OR = {
				NOT = { exists = TGU }
				reverse_has_opinion = {
					who = TGU
					value = 100
				}
				is_rival = TGU
				is_enemy = TGU
			}
			army_size_percentage = 1
		}
		effect = {
			if = {
				limit = {
					NOT = { exists = TGU }
				}
				add_adm_power = 75
				add_dip_power = 75
				add_mil_power = 75
			}
			else_if = {
				limit = {
					reverse_has_opinion = {
						who = TGU
						value = 100
					}
				}
				country_event = {
					id = flavor_kpp.17
				}
			}
			else_if = {
				limit = {
					OR = {
						is_rival = TGU
						is_enemy = TGU
					}
				}
				define_general = {
					shock = 4
					fire = 4
					manuever = 3
					siege = 2
				}
			}
			else = {
				custom_tooltip = KPP_diplomacy_with_tengus_tt
			}
		}
	}
	
	KPP_a_net_of_alliances = {
		icon = mission_touhou_youkai_mountain
		required_missions = { 
			KPP_diplomacy_with_moriya
			KPP_diplomacy_with_tengus
		}
		position = 2
		provinces_to_highlight = {
			NOT = { country_or_non_sovereign_subject_holds = ROOT }
			owner = {
				has_discovered = ROOT
				is_subject = no
				total_development = 150
				NOT = { alliance_with = ROOT }
				NOT = { is_rival = ROOT }
				NOT = { is_enemy = ROOT }
			}
		}
		trigger = {
			OR = {
				total_development = 500
				calc_true_if = {
					desc = KPP_a_net_of_alliances_tt
					all_ally = {
						total_development = 150
					}
					amount = 3
				}
			}
		}
		effect = {
			custom_tooltip = KPP_a_net_of_alliances_ct
			hidden_effect = {
				every_ally = {
					ROOT = {
						add_favors = {
							who = PREV
							amount = 10
						}
					}
				}
			}
			add_country_modifier = {
				name = kpp_alliance_makers
				duration = 9125
			}
		}
	}
	
	KPP_call_the_fleet = {
		icon = mission_touhou_youkai_mountain
		required_missions = {  }
		position = 3
		provinces_to_highlight = {
		}
		trigger = {
			navy_size_percentage = 0.9
			num_of_admirals = 1
		}
		effect = {
			add_dip_power = 75
			define_advisor = {
				type = naval_reformer
				skill = 2
				cost_multiplier = 0.1
			}
		}
	}
	
	KPP_colonial_ambitions = {
		icon = mission_touhou_youkai_mountain
		required_missions = { KPP_call_the_fleet }
		position = 5
		provinces_to_highlight = {
		}
		trigger = {
			OR = {
				has_idea = KPP_Kappa_curiosity
				has_idea = colonial_ventures
				has_idea = additional_colonists
				NOT = { has_idea_group = KPP_ideas }
			}
		}
		effect = {
			define_explorer = {
				name = "Kappa Explorer"
				shock = 3
				fire = 6
				manuever = 6
				siege = 0
				female = yes
			}
			add_country_modifier = {
				name = kpp_kappa_curiosity_modifier
				duration = -1
			}
		}
	}
	
	KPP_break_through_the_barrier = {
		icon = mission_touhou_youkai_mountain
		required_missions = { KPP_colonial_ambitions }
		position = 7
		provinces_to_highlight = {
			OR = {
				region = moluccas_region
				region = australia_region
				region = indo_china_region
			}
			NOT = { has_discovered = ROOT }
		}
		trigger = {
			custom_trigger_tooltip = {
				tooltip = th_break_the_barrier_tt
				OR = {
					moluccas_region = { has_discovered = ROOT }
					australia_region = { has_discovered = ROOT }
					indo_china_region = { has_discovered = ROOT }
				}
			}
		}
		effect = {
			add_prestige = 15
			add_country_modifier = {
				name = kpp_explorer_spirit
				duration = 27375
			}
		}
	}
	
	KPP_discover_india = {
		icon = mission_touhou_youkai_mountain
		required_missions = { KPP_break_through_the_barrier }
		position = 10
		provinces_to_highlight = {
			superregion = india_superregion
			NOT = { has_discovered = ROOT }
		}
		trigger = {
			custom_trigger_tooltip = {
				tooltip = KPP_discover_india_tt
				india_superregion = {
					has_discovered = ROOT
				}
			}
		}
		effect = {
			add_country_modifier = {
				name = kpp_western_discoveries
				duration = 9125
			}
			create_explorer = { tradition = 100 }
			create_explorer = { tradition = 100 }
		}
	}

	KPP_explore_far_west = {
		icon = mission_touhou_youkai_mountain
		required_missions = { KPP_discover_india }
		position = 11
		provinces_to_highlight = {
			region = guinea_region
			NOT = { has_discovered = ROOT }
		}
		trigger = {
			custom_trigger_tooltip = {
				tooltip = KPP_explore_far_west_tt
				guinea_region = { has_discovered = ROOT }
			}
		}
		effect = {
			country_event = {
				id = flavor_kpp.4
			}
		}
	}
	
	KPP_discover_europe = {
		icon = mission_touhou_youkai_mountain
		required_missions = { KPP_explore_far_west }
		position = 13
		provinces_to_highlight = {
			OR = {
				region = iberia_region
				region = france_region
				region = low_countries_region
				region = british_isles_region
			}
			NOT = { has_discovered = ROOT }
		}
		trigger = {
			custom_trigger_tooltip = {
				tooltip = th_discovers_europe.tooltip
				OR = {
					iberia_region = { has_discovered = ROOT }
					france_region = { has_discovered = ROOT }
					low_countries_region = { has_discovered = ROOT }
					british_isles_region = { has_discovered = ROOT }
				}
			}
		}
		effect = {
			add_country_modifier = {
				name = "touhou_discovery_of_europe"
				duration = 7300
			}
			country_event = { id = TH_mission_events.4 }			
		}
	}
}

kpp_missions_tech_slot = {
	slot = 2
	generic = no
	ai = yes
	potential = {
		tag = KPP
		NOT = { map_setup = map_setup_random }
	}
	has_country_shield = yes
	
	KPP_diplomacy_with_moriya = {
		icon = mission_touhou_youkai_mountain
		required_missions = {  }
		position = 1
		provinces_to_highlight = {
			owned_by = MRY
		}
		trigger = {
			OR = {
				alliance_with = MRY
				reverse_has_opinion = {
					who = MRY
					value = 50
				}
				statesman = 2
				diplomat = 2
				spymaster = 2
				NOT = { exists = MRY }
			}
			is_subject = no
		}
		effect = {
			if = {
				limit = {
					exists = MRY
					NOT = { alliance_with = MRY }
					NOT = { is_subject_of = MRY }
				}
				country_event = {
					id = flavor_kpp.14
				}
			}
			else = {
				add_dip_power = 100
			}
		}
	}
	
	KPP_construct_kappa_defenses = {
		icon = mission_touhou_youkai_mountain
		required_missions = { KPP_great_army_of_the_republic }
		position = 2
		provinces_to_highlight = {
			OR = {
				province_id = 5356
				province_id = 5354
				province_id = 5221
				province_id = 5353
			}
			OR = {
				NOT = { is_core = ROOT }
				NOT = { owned_by = ROOT }
				NOT = { th_has_up_to_date_fort_building = { tag = ROOT } }
			}
		}
		trigger = {
			5356 = {
				is_core = ROOT
				owned_by = ROOT
				th_has_up_to_date_fort_building = {
					tag = ROOT
				}
			}
			5354 = {
				is_core = ROOT
				owned_by = ROOT
				th_has_up_to_date_fort_building = {
					tag = ROOT
				}
			}
			5221 = {
				is_core = ROOT
				owned_by = ROOT
				th_has_up_to_date_fort_building = {
					tag = ROOT
				}
			}
			5353 = {
				is_core = ROOT
				owned_by = ROOT
				th_has_up_to_date_fort_building = {
					tag = ROOT
				}
			}
		}
		effect = {
			add_mil_power = 150
			5356 = {
				add_province_modifier = {
					name = kpp_expanded_local_defenses
					duration = -1
				}
			}
			5354 = {
				add_province_modifier = {
					name = kpp_expanded_local_defenses
					duration = -1
				}
			}
			5221 = {
				add_province_modifier = {
					name = kpp_expanded_local_defenses
					duration = -1
				}
			}
			5353 = {
				add_province_modifier = {
					name = kpp_expanded_local_defenses
					duration = -1
				}
			}
		}
	}
	
	KPP_unbreakable_kappa_lands = {
		icon = mission_touhou_youkai_mountain
		required_missions = { KPP_construct_kappa_defenses }
		position = 3
		provinces_to_highlight = {
		}
		trigger = {
			always = yes
		}
		effect = {
			custom_tooltip = cool_effect
		}
	}
	
	KPP_the_ship_of_space = {
		icon = mission_touhou_youkai_mountain
		required_missions = { KPP_annex_the_mountain_kappas }
		position = 4
		provinces_to_highlight = {
			owned_by = YUM
		}
		trigger = {
			OR = {
				reverse_has_opinion = {
					who = YUM
					value = 100
				}
				NOT = { exists = YUM }
			}
			diplomatic_reputation = 1
		}
		effect = {
			country_event = {
				id = flavor_kpp.9
			}
			if = {
				limit = { exists = YUM }
				YUM = { add_historical_friend = ROOT }
				add_historical_friend = YUM
			}
			else = {
				Yumemi_space_state = {
					add_core = ROOT
				}
			}
		}
	}
	
	KPP_the_cyber_technology_of_the_future = {
		icon = mission_touhou_youkai_mountain
		required_missions = { KPP_tinkers_federation }
		position = 6
		provinces_to_highlight = {
		}
		trigger = {
			OR = {
				num_of_owned_and_controlled_institutions = 2
				innovativeness = 75
				AND = {
					monthly_adm = 10
					monthly_dip = 10
					monthly_mil = 10
				}
			}
			custom_trigger_tooltip = {
				tooltip = KPP_the_cyber_technology_of_the_future_tt
				NOT = {
					any_neighbor_country = {
						OR = {
							institution_difference = {
								who = ROOT
								value = 1
							}
							tech_difference = 1
						}
					}
				}
			}
		}
		effect = {
			country_event = {
				id = flavor_kpp.12
			}
		}
	}
	
	KPP_discover_australia = {
		icon = mission_touhou_youkai_mountain
		required_missions = { KPP_break_through_the_barrier }
		position = 8
		provinces_to_highlight = {
			region = australia_region
			NOT = { has_discovered = ROOT }
		}
		trigger = {
			custom_trigger_tooltip = {
				tooltip = KPP_discover_australia_tt
				australia_region = { has_discovered = ROOT }
			}
		}
		effect = {
			add_country_modifier = {
				name = kpp_australian_colonization
				duration = 14600
			}
			australia_region = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_permanent_claim = ROOT }
				}
				add_permanent_claim = ROOT
			}		
		}
	}
	
	KPP_colonize_australia = {
		icon = mission_touhou_youkai_mountain
		required_missions = { KPP_discover_australia }
		position = 9
		provinces_to_highlight = {
			region = australia_region
			NOT = { country_or_non_sovereign_subject_holds = ROOT }
		}
		trigger = {
			num_of_provinces_owned_or_owned_by_non_sovereign_subjects_with = {
				region = australia_region
				value = 30
			}
		}
		effect = {
			custom_tooltip = KPP_colonize_australia_tt
			hidden_effect = {
				australia_region = {
					limit = {
						country_or_non_sovereign_subject_holds = ROOT
					}
					add_base_tax = 1
					add_base_production = 1
					add_base_manpower = 1
				}
			}
			add_adm_power = 50
			add_dip_power = 50
			add_mil_power = 50
		}
	}
	
	KPP_weaponize_australian_wildlife = {
		icon = mission_touhou_youkai_mountain
		required_missions = { KPP_colonize_australia }
		position = 10
		provinces_to_highlight = {
			region = australia_region
		}
		trigger = {
			mil_tech = 15
			custom_trigger_tooltip = {
				tooltip = KPP_weaponize_australian_wildlife_tt
				australia_region = {
					infantry_in_province = 25
				}
			}
			australia_region = {
				country_or_non_sovereign_subject_holds = ROOT
				type = all
			}
			is_at_war = no
		}
		effect = {
			country_event = {
				id = flavor_kpp.8
			}
		}
	}

	KPP_colonize_the_cape = {
		icon = mission_touhou_youkai_mountain
		required_missions = { KPP_push_to_africa }
		position = 12
		provinces_to_highlight = {
			region = south_africa_region
			NOT = { country_or_non_sovereign_subject_holds = ROOT }
		}
		trigger = {
			num_of_provinces_owned_or_owned_by_non_sovereign_subjects_with = {
				region = south_africa_region
				value = 20
			}
			owns_core_province = 1177
		}
		effect = {
			if = {
				limit = {
					mission_completed = KPP_take_over_east_africa
					mission_completed = KPP_colonize_the_horn
				}
				central_africa_region = {
					limit = {
						NOT = { is_core = ROOT }
						NOT = { is_permanent_claim = ROOT }
					}
					add_permanent_claim = ROOT
				}
				kongo_region = {
					limit = {
						NOT = { is_core = ROOT }
						NOT = { is_permanent_claim = ROOT }
					}
					add_permanent_claim = ROOT
				}
			}
			else = {
				custom_tooltip = KPP_colonize_the_cape_tt
			}
			1177 = {
				change_province_name = "New Kappapolis"
				add_center_of_trade_level = 2
				add_base_tax = 6
				add_base_production = 6
				add_base_manpower = 4
				change_religion = ROOT
				change_culture = ROOT
				change_trade_goods = coal
			}
		}
	}
}

kpp_missions_war_slot = {
	slot = 3
	generic = no
	ai = yes
	potential = {
		tag = KPP
		NOT = { map_setup = map_setup_random }
	}
	has_country_shield = yes
	
	KPP_great_army_of_the_republic = {
		icon = mission_touhou_youkai_mountain
		required_missions = {  }
		position = 1
		trigger = {
			army_size_percentage = 1
			num_of_generals = 1
			#has_leaders = {
			#	value = 2
			#	type = general
			#	include_monarch = yes
			#	include_heir = yes
			#}
		}
		effect = {
			Kappa_delta = {
				limit = {
					NOT = { is_core = ROOT }
				}
				add_core = ROOT
			}
			Kappa_state = {
				limit = {
					NOT = { is_core = ROOT }
				}
				add_core = ROOT
			}
			Genbu_ravine_state = {
				limit = {
					NOT = { is_core = ROOT }
				}
				add_core = ROOT
			}
			Mountain_kappa_land = {
				limit = {
					NOT = { is_core = ROOT }
				}
				add_core = ROOT
			}
		}
	}
	
	KPP_annex_the_mountain_kappas = {
		icon = mission_touhou_youkai_mountain
		required_missions = { KPP_great_army_of_the_republic }
		position = 3
		provinces_to_highlight = {
			OR = {
				area = Kappa_delta
				area = Kappa_state
				area = Mountain_kappa_land
				area = Genbu_ravine_state
			}
			OR = {
				NOT = { is_core = ROOT }
				NOT = { owned_by = ROOT }
			}
		}
		trigger = {
			Kappa_delta = {
				is_core = ROOT
				owned_by = ROOT
				type = all
			}
			Kappa_state = {
				is_core = ROOT
				owned_by = ROOT
				type = all
			}
			Genbu_ravine_state = {
				is_core = ROOT
				owned_by = ROOT
				type = all
			}
			Mountain_kappa_land = {
				is_core = ROOT
				owned_by = ROOT
				type = all
			}
		}
		effect = {
			add_country_modifier = {
				name = kpp_takanes_diplomats
				duration = 10950
			}
			add_stability_or_adm_power = yes
		}
	}
	
	KPP_tinkers_federation = {
		icon = mission_touhou_youkai_mountain
		required_missions = {
			KPP_the_ship_of_space
			KPP_the_lost_tanks
			KPP_enact_the_first_reform
		}
		position = 5
		provinces_to_highlight = {
			OR = {
				AND = {
					NOT = { exists = YUM }
					area = Yumemi_space_state
					NOT = { country_or_non_sovereign_subject_holds = ROOT }
				}
				owned_by = YUM
				AND = {
					NOT = { exists = THR }
					area = Rika_state
					NOT = { country_or_non_sovereign_subject_holds = ROOT }
				}
				owned_by = THR
			}
		}
		trigger = {
			OR = {
				YUM = {
					OR = {
						alliance_with = ROOT
						is_subject_of = ROOT
					}
					has_opinion = {
						who = ROOT
						value = 150
					}
					trust = {
						who = ROOT
						value = 75
					}
				}
				AND = {
					NOT = { exists = YUM }
					Yumemi_space_state = {
						country_or_non_sovereign_subject_holds = ROOT
					}
				}
			}
			OR = {
				THR = {
					OR = {
						alliance_with = ROOT
						is_subject_of = ROOT
					}
					has_opinion = {
						who = ROOT
						value = 150
					}
					trust = {
						who = ROOT
						value = 75
					}
				}
				AND = {
					NOT = { exists = THR }
					Rika_state = {
						country_or_non_sovereign_subject_holds = ROOT
					}
				}
			}
			legitimacy_equivalent = 95
			stability = 1
			reform_level = 5
		}
		effect = {
			country_event = {
				id = flavor_kpp.5
			}
		}
	}
	
	KPP_greatest_technology = {
		icon = mission_touhou_youkai_mountain
		required_missions = {
			KPP_the_cyber_technology_of_the_future
			KPP_cybernetical_engeineering
			KPP_enact_the_third_reform
		}
		position = 7
		provinces_to_highlight = {
			OR = {
				trade_goods = iron
				trade_goods = copper
			}
			has_discovered = ROOT
			NOT = { owned_by = ROOT }
		}
		trigger = {
			is_bankrupt = no
			NOT = { num_of_loans = 1 }
			NOT = { corruption = 2 }
			monthly_income = 100
			stability = 2
			OR = {
				trading_bonus = { trade_goods = iron value = yes }
				production_leader = { trade_goods = iron }
				iron = 10
			}
			OR = {
				trading_bonus = { trade_goods = copper value = yes }
				production_leader = { trade_goods = copper }
				copper = 10
			}
		}
		effect = {
			country_event = {
				id = flavor_kpp.13
			}
		}
	}
	
	KPP_colonize_peru = {
		icon = mission_touhou_youkai_mountain
		required_missions = { KPP_discover_south_america }
		position = 9
		provinces_to_highlight = {
			colonial_region = colonial_peru
			NOT = { country_or_non_sovereign_subject_holds = ROOT }
		}
		trigger = {
			num_of_provinces_owned_or_owned_by_non_sovereign_subjects_with = {
				colonial_region = colonial_peru
				value = 25
			}
		}
		effect = {
			if = {
				limit = { gold = 1 }
				add_years_of_owned_provinces_production_income = {
					years = 4
					trigger = {
						trade_goods = gold
					}
					custom_tooltip = MONOPOLY_INCOME_GOLD_DESC
				}
			}
			if = {
				limit = {
					any_subject_country = {
						capital_scope = { colonial_region = colonial_peru }
						gold = 1
					}
				}
				hidden_effect = {
					every_subject_country = {
						limit = {
							capital_scope = { colonial_region = colonial_peru }
							gold = 1
						}
						export_to_variable = {
							which = kpp_old_subject_money
							value = treasury
						}
						add_years_of_owned_provinces_production_income = {
							years = 4
							trigger = {
								trade_goods = gold
							}
							custom_tooltip = MONOPOLY_INCOME_GOLD_DESC
						}
						export_to_variable = {
							which = kpp_new_subject_money
							value = treasury
						}
						subtract_variable = {
							which = kpp_new_subject_money
							which = kpp_old_subject_money
						}
						transfer_treasury = {
							giver = THIS
							taker = ROOT
							variable = kpp_new_subject_money
						}
					}
				}
			}
			custom_tooltip = KPP_colonize_peru_ct
			country_event = {
				id = flavor_kpp.19
			}
		}
	}
	
	KPP_push_to_africa = {
		icon = mission_touhou_youkai_mountain
		required_missions = { KPP_discover_india }
		position = 11
		provinces_to_highlight = {
			continent = africa
			is_sea = no
			NOT = { has_discovered = ROOT }
		}
		trigger = {
			custom_trigger_tooltip = {
				tooltip = KPP_push_to_africa_tt
				africa = {
					is_sea = no
					has_discovered = ROOT
				}
			}
		}
		effect = {
			kongo_region = {
				limit = {
					NOT = { is_permanent_claim = ROOT }
					NOT = { is_core = ROOT }
				}
				add_permanent_claim = ROOT
			}
			central_africa_region = {
				limit = {
					NOT = { is_permanent_claim = ROOT }
					NOT = { is_core = ROOT }
				}
				add_permanent_claim = ROOT
			}
			east_africa_region = {
				limit = {
					NOT = { is_permanent_claim = ROOT }
					NOT = { is_core = ROOT }
				}
				add_permanent_claim = ROOT
			}
			horn_of_africa_region = {
				limit = {
					NOT = { is_permanent_claim = ROOT }
					NOT = { is_core = ROOT }
				}
				add_permanent_claim = ROOT
			}
			south_africa_region = {
				limit = {
					NOT = { is_permanent_claim = ROOT }
					NOT = { is_core = ROOT }
				}
				add_permanent_claim = ROOT
			}
		}
	}
	
	KPP_take_over_east_africa = {
		icon = mission_touhou_youkai_mountain
		required_missions = { KPP_push_to_africa }
		position = 12
		provinces_to_highlight = {
			OR = {
				AND = {
					has_discovered = ROOT
					continent = africa
					trade_goods = ivory
				}
			}
			region = east_africa_region
			NOT = { country_or_non_sovereign_subject_holds = ROOT }
		}
		trigger = {
			num_of_provinces_owned_or_owned_by_non_sovereign_subjects_with = {
				region = east_africa_region
				value = 20
			}
			ivory = 12
		}
		effect = {
			if = {
				limit = {
					mission_completed = KPP_colonize_the_cape
					mission_completed = KPP_colonize_the_horn
				}
				central_africa_region = {
					limit = {
						NOT = { is_core = ROOT }
						NOT = { is_permanent_claim = ROOT }
					}
					add_permanent_claim = ROOT
				}
				kongo_region = {
					limit = {
						NOT = { is_core = ROOT }
						NOT = { is_permanent_claim = ROOT }
					}
					add_permanent_claim = ROOT
				}
			}
			else = {
				custom_tooltip = KPP_take_over_east_africa_tt
			}
			country_event = {
				id = flavor_kpp.6
			}
		}
	}
	
	KPP_scramble_for_africa = {
		icon = mission_touhou_youkai_mountain
		required_missions = {
			KPP_colonize_the_cape
			KPP_take_over_east_africa
			KPP_colonize_the_horn
		}
		position = 13
		provinces_to_highlight = {
			OR = {
				region = central_africa_region
				region = kongo_region
			}
			NOT = { country_or_non_sovereign_subject_holds = ROOT }
		}
		trigger = {
			num_of_provinces_owned_or_owned_by_non_sovereign_subjects_with = {
				OR = {
					region = central_africa_region
					region = kongo_region
				}
				value = 50
			}
		}
		effect = {
			add_country_modifier = {
				name = kpp_rulers_of_africa
				duration = -1
			}
		}
	}
}

kpp_missions_invention_slot = {
	slot = 4
	generic = no
	ai = yes
	potential = {
		tag = KPP
		NOT = { map_setup = map_setup_random }
	}
	has_country_shield = yes
	
	KPP_docks_of_the_kappas = {
		icon = mission_touhou_youkai_mountain
		required_missions = {  }
		position = 1
		provinces_to_highlight = {
			owned_by = ROOT
			NOT = { th_has_sailor_or_manpower_building = yes }
		}
		trigger = {
			num_of_owned_provinces_with = {
				th_has_sailor_or_manpower_building = yes
				value = 6
			}
			OR = {
				quartermaster = 1
				army_organiser = 1
				recruitmaster = 1
				naval_reformer = 1
			}
		}
		effect = {
			country_event = {
				id = flavor_kpp.3
			}
		}
	}
	
	KPP_marines_of_kappapolis = {
		icon = mission_touhou_youkai_mountain
		required_missions = { 
			KPP_great_army_of_the_republic
			KPP_docks_of_the_kappas
		}
		position = 2
		provinces_to_highlight = {
		}
		trigger = {
			if = {
				limit = {
					has_dlc = "Cradle of Civilization"
				}
				army_professionalism = 0.4
			}
			else = {
				army_tradition = 50
			}
			navy_tradition = 50
			if = {
				limit = {
					OR = {
						has_dlc = "Rule Britannia"
						has_dlc = "Golden Century"
					}
				}
				num_of_marines = 20
			}
			else = {
				land_forcelimit = 40
			}
			has_completed_idea_group_of_category = {
				mil_ideas = yes
			}
		}
		effect = {
			if = {
				limit = {
					OR = {
						has_dlc = "Rule Britannia"
						has_dlc = "Golden Century"
					}
				}
				add_country_modifier = {
					name = kpp_elite_kappa_marines
					duration = -1
				}
			}
			th_unlock_estate_privilege = {
				estate_privilege = th_estate_burghers_mass_marine_conscription
			}
			th_unlock_estate_privilege = {
				estate_privilege = th_estate_burghers_elite_marines
			}
			th_unlock_estate_privilege = {
				estate_privilege = th_estate_burghers_naval_reinforcement
			}
		}
	}
	
	KPP_great_amphibious_army = {
		icon = mission_touhou_youkai_mountain
		required_missions = { KPP_marines_of_kappapolis }
		position = 3
		provinces_to_highlight = {
		}
		trigger = {
			OR = {
				NOT = { has_estate = estate_burghers }
				has_estate_privilege = th_estate_burghers_mass_marine_conscription
				has_estate_privilege = th_estate_burghers_elite_marines
				has_estate_privilege = th_estate_burghers_naval_reinforcement
			}
			if = {
				limit = {
					OR = {
						has_dlc = "Rule Britannia"
						has_dlc = "Golden Century"
					}
				}
				num_of_marines = 40
			}
			else = {
				land_forcelimit = 80
			}
			if = {
				limit = {
					has_dlc = "Cradle of Civilization"
				}
				army_professionalism = 0.8
			}
			else = {
				army_tradition = 75
			}
			navy_tradition = 75
			navy_size = 50
		}
		effect = {
			if = {
				limit = {
					OR = {
						has_dlc = "Rule Britannia"
						has_dlc = "Golden Century"
					}
				}
				add_country_modifier = {
					name = kpp_marine_shock_troopers
					duration = -1
				}
			}
			add_country_modifier = {
				name = kpp_grand_amphibious_force
				duration = -1
			}
		}
	}
	
	KPP_the_lost_tanks = {
		icon = mission_touhou_youkai_mountain
		required_missions = { KPP_annex_the_mountain_kappas }
		position = 4
		provinces_to_highlight = {
			owned_by = THR
		}
		trigger = {
			OR = {
				reverse_has_opinion = {
					who = THR
					value = 100
				}
				NOT = { exists = THR }
			}
			diplomatic_reputation = 1
		}
		effect = {
			country_event = {
				id = flavor_kpp.10
			}
			if = {
				limit = { exists = THR }
				YUM = { add_historical_friend = ROOT }
				add_historical_friend = THR
			}
			else = {
				Rika_state = {
					add_core = ROOT
				}
			}
		}
	}
	
	KPP_cybernetical_engeineering = {
		icon = mission_touhou_youkai_mountain
		required_missions = { KPP_tinkers_federation }
		position = 6
		provinces_to_highlight = {
			is_capital_of = ROOT
			NOT = { has_production_building_trigger = yes }
		}
		trigger = {
			has_mil_advisor_3 = yes
			has_adm_advisor_3 = yes
			has_dip_advisor_3 = yes
			monthly_income = 75
			capital_scope = {
				has_production_building_trigger = yes
			}
			OR = {
				is_in_war = {
					duration = 1825
				}
				NOT = { manpower_percentage = 0.5 }
			}
		}
		effect = {
			country_event = {
				id = flavor_kpp.11
			}
		}
	}
	
	KPP_colonize_colombia = {
		icon = mission_touhou_youkai_mountain
		required_missions = { KPP_discover_south_america }
		position = 9
		provinces_to_highlight = {
			colonial_region = colonial_colombia
			NOT = { country_or_non_sovereign_subject_holds = ROOT }
		}
		trigger = {
			num_of_provinces_owned_or_owned_by_non_sovereign_subjects_with = {
				colonial_region = colonial_colombia
				value = 25
			}
		}
		effect = {
			835 = {
				add_trade_modifier = {
					who = ROOT
					duration = -1
					power = 100
					key = KPP_colonize_colombia_tt
				}
			}
			country_event = {
				id = flavor_kpp.19
			}
		}
	}
	
	KPP_colonize_the_horn = {
		icon = mission_touhou_youkai_mountain
		required_missions = { KPP_push_to_africa }
		position = 12
		provinces_to_highlight = {
			region = horn_of_africa_region
			NOT = { country_or_non_sovereign_subject_holds = ROOT }
		}
		trigger = {
			num_of_provinces_owned_or_owned_by_non_sovereign_subjects_with = {
				region = horn_of_africa_region
				value = 20
			}
			num_of_provinces_owned_or_owned_by_non_sovereign_subjects_with = {
				region = horn_of_africa_region
				trade_goods = coffee
				value = 5
			}
		}
		effect = {
			if = {
				limit = {
					mission_completed = KPP_take_over_east_africa
					mission_completed = KPP_colonize_the_cape
				}
				central_africa_region = {
					limit = {
						NOT = { is_core = ROOT }
						NOT = { is_permanent_claim = ROOT }
					}
					add_permanent_claim = ROOT
				}
				kongo_region = {
					limit = {
						NOT = { is_core = ROOT }
						NOT = { is_permanent_claim = ROOT }
					}
					add_permanent_claim = ROOT
				}
			}
			else = {
				custom_tooltip = KPP_colonize_the_horn_tt
			}
			country_event = {
				id = flavor_kpp.7
			}
		}
	}
}

kpp_missions_internal_struggle_slot = {
	slot = 5
	generic = no
	ai = yes
	potential = {
		tag = KPP
		NOT = { map_setup = map_setup_random }
	}
	has_country_shield = yes
	
	KPP_invest_in_the_kappalands = {
		icon = mission_touhou_youkai_mountain
		required_missions = {  }
		position = 1
		provinces_to_highlight = {
			culture = Kappa
			OR = {
				NOT = { owned_by = ROOT }
				NOT = { has_production_building_trigger = yes }
				NOT = { has_trade_building_trigger = yes }
			}
		}
		trigger = {
			num_of_owned_provinces_with = {
				culture = Kappa
				has_production_building_trigger = yes
				value = 6
			}
		}
		effect = {
			add_estate_loyalty = {
				estate = estate_burghers
				loyalty = 50
			}
			add_treasury = 300
			th_unlock_estate_privilege = {
				estate_privilege = th_estate_burghers_swamp_developers
			}
		}
	}
	
	KPP_curtail_the_estates = {
		icon = mission_touhou_youkai_mountain
		required_missions = {  }
		position = 3
		provinces_to_highlight = {
		}
		trigger = {
			crown_land_share = 40
			NOT = { num_of_rebel_armies = 1 }
			NOT = { num_of_rebel_controlled_provinces = 1 }
			OR = {
				has_estate_privilege = th_estate_burghers_governmental_focus
				NOT = {
					estate_influence = {
						influence = 50
						estate = estate_burghers
					}
				}
				NOT = { has_estate = estate_burghers }
			}
		}
		effect = {
			country_event = {
				id = flavor_kpp.40
			}
		}
	}
	
	KPP_enact_the_first_reform = {
		icon = mission_touhou_youkai_mountain
		required_missions = { KPP_curtail_the_estates }
		position = 4
		provinces_to_highlight = {
		}
		trigger = {
			has_reform = Gensokyan_kpp_kappa_state
			custom_trigger_tooltip = {
				tooltip = kpp_had_counter_movement_disaster_tt
				has_country_flag = kpp_had_counter_movement_disaster
			}
			reform_level = 3
		}
		effect = {
			country_event = {
				id = flavor_kpp.57
			}
		}
	}
	
	KPP_enact_the_second_reform = {
		icon = mission_touhou_youkai_mountain
		required_missions = { KPP_enact_the_first_reform }
		position = 5
		provinces_to_highlight = {
		}
		trigger = {
			has_reform = Gensokyan_kpp_kappa_state
			custom_trigger_tooltip = {
				tooltip = kpp_had_anti_teamwork_coalition_disaster_tt
				has_country_flag = kpp_had_anti_teamwork_coalition_disaster
			}
			reform_level = 4
		}
		effect = {
			country_event = {
				id = flavor_kpp.58
			}
		}
	}
	
	KPP_enact_the_third_reform = {
		icon = mission_touhou_youkai_mountain
		required_missions = { KPP_enact_the_second_reform }
		position = 6
		provinces_to_highlight = {
		}
		trigger = {
			has_reform = Gensokyan_kpp_kappa_state
			custom_trigger_tooltip = {
				tooltip = kpp_had_guild_wars_disaster_complete_tt
				has_country_flag = kpp_had_guild_wars_disaster
			}
			reform_level = 5
		}
		effect = {
			country_event = {
				id = flavor_kpp.59
			}
		}
	}
	
	KPP_unite_the_kappas_for_good = {
		icon = mission_touhou_youkai_mountain
		required_missions = { KPP_enact_the_third_reform }
		position = 7
		provinces_to_highlight = {
		}
		trigger = {
			has_any_disaster = no
			reform_level = 6
			stability = 3
			has_adm_advisor_3 = yes
			legitimacy_equivalent = 90
			is_in_deficit = no
			NOT = { corruption = 1 }
			NOT = { num_of_loans = 1 }
			NOT = { has_spawned_rebels = th_kappa_rebels }
			adm_tech = 10
			monthly_adm = 12
		}
		effect = {
			country_event = {
				id = flavor_kpp.60
			}
		}
	}
	
	KPP_discover_south_america = {
		icon = mission_touhou_youkai_mountain
		required_missions = { KPP_break_through_the_barrier }
		position = 8
		provinces_to_highlight = {
			continent = south_america
			NOT = { has_discovered = ROOT }
		}
		trigger = {
			custom_trigger_tooltip = {
				tooltip = KPP_discover_south_america_tt
				south_america = { has_discovered = ROOT }
			}
		}
		effect = {
			colonial_colombia = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_permanent_claim = ROOT }
				}
				add_permanent_claim = ROOT
			}
			colonial_brazil = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_permanent_claim = ROOT }
				}
				add_permanent_claim = ROOT
			}
			colonial_peru = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_permanent_claim = ROOT }
				}
				add_permanent_claim = ROOT
			}
			th_colonize_dev_province_for_root = {
				province = 1988
			}
		}
	}
	
	KPP_colonize_brazil = {
		icon = mission_touhou_youkai_mountain
		required_missions = { KPP_discover_south_america }
		position = 9
		provinces_to_highlight = {
			colonial_region = colonial_brazil
			NOT = { country_or_non_sovereign_subject_holds = ROOT }
		}
		trigger = {
			num_of_provinces_owned_or_owned_by_non_sovereign_subjects_with = {
				colonial_region = colonial_brazil
				value = 40
			}
		}
		effect = {
			country_event = {
				id = flavor_kpp.19
			}
			add_dip_power = 200
			capital_scope = {
				add_base_production = 6
			}
		}
	}
	
	KPP_new_world_colonization = {
		icon = mission_touhou_youkai_mountain
		required_missions = {
			KPP_colonize_colombia
			KPP_colonize_peru
			KPP_colonize_brazil
		}
		position = 10
		provinces_to_highlight = {
			OR = {
				continent = north_america
				continent = south_america
			}
			NOT = { country_or_non_sovereign_subject_holds = ROOT }
			has_discovered = ROOT
		}
		trigger = {
			num_of_provinces_owned_or_owned_by_non_sovereign_subjects_with = {
				OR = {
					continent = north_america
					continent = south_america
				}
				value = 200
			}
			NOT = {
				any_subject_country = {
					is_colonial_nation = yes
					liberty_desire = 30
				}
			}
		}
		effect = {
			custom_tooltip = KPP_new_world_colonization_tt
			hidden_effect = {
				south_america = {
					limit = {
						country_or_non_sovereign_subject_holds = ROOT
						trade_goods = gold
					}
					add_province_modifier = {
						name = kpp_perfect_gold_mining
						duration = -1
					}
				}
			}
			add_country_modifier = {
				name = kpp_colonial_empire
				duration = -1
			}
		}
	}
	
	KPP_grand_trade_fleet = {
		icon = mission_touhou_youkai_mountain
		required_missions = {  }
		position = 11
		provinces_to_highlight = {
		}
		trigger = {
			num_of_light_ship = 50
			OR = {
				full_idea_group = trade_ideas
				full_idea_group = maritime_ideas
				full_idea_group = plutocracy_ideas
				mercantilism = 50
				trader = 3
				trade_efficiency = 1
			}
			navy_tradition = 40
			if = {
				limit = {
					has_dlc = "Golden Century"
				}
				has_flagship = yes
			}
		}
		effect = {
			random_owned_province = {
				limit = {
					has_port = yes
				}
				create_flagship = {
					name = "The Flying Kappa"
					type = light_ship
				}
			}
			add_mercantilism = 10
		}
	}
	
	KPP_monopolize_moriya_trade = {
		icon = mission_touhou_youkai_mountain
		required_missions = { KPP_grand_trade_fleet }
		position = 13
		provinces_to_highlight = {
			OR = {
				AND = {
					province_id = 5019
					NOT = {
						trade_share = {
							country = ROOT
							share = 50
						}
					}
				}
				AND = {
					province_id = 5032
					NOT = {
						trade_share = {
							country = ROOT
							share = 50
						}
					}
				}
				AND = {
					province_id = 4999
					OR = {
						NOT = {
							trade_share = {
								country = ROOT
								share = 90
							}
						}
						highest_value_trade_node = no
					}
				}
				AND = {
					province_id = 4965
					OR = {
						NOT = { is_core = ROOT }
						NOT = { owned_by = ROOT }
					}
				}
			}
		}
		trigger = {
			4999 = {
				trade_share = {
					country = ROOT
					share = 90
				}
				highest_value_trade_node = yes
			}
			5019 = {
				trade_share = {
					country = ROOT
					share = 50
				}
			}
			5032 = {
				trade_share = {
					country = ROOT
					share = 50
				}
			}
			owns_core_province = 4965
		}
		effect = {
			4965 = {
				add_province_modifier = {
					name = kpp_main_port_to_gensokyo
					duration = -1
				}
			}
			add_years_of_trade_income = {
				years = 4
				custom_tooltip = zan_settle_trade_posts_ct
			}
		}
	}
}